{"code":"_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[70],{\"1Gic\":function(t,e,r){\"use strict\";var n=/([\\.#]?[a-zA-Z0-9_:-]+)/,s=/^\\.|#/;t.exports=function(t,e){if(!t)return\"div\";var r,i,a,o,u=!(\"id\"in e),c=t.split(n),f=null;s.test(c[1])&&(f=\"div\");for(o=0;o<c.length;o++)(i=c[o])&&(a=i.charAt(0),f?\".\"===a?(r=r||[]).push(i.substring(1,i.length)):\"#\"===a&&u&&(e.id=i.substring(1,i.length)):f=i);r&&(e.className&&r.push(e.className),e.className=r.join(\" \"));return f?f.toLowerCase():\"div\"}},\"20a2\":function(t,e,r){t.exports=r(\"nOHt\")},PFb9:function(t,e,r){\"use strict\";r.r(e),r.d(e,\"__N_SSP\",(function(){return a}));var n=r(\"j+1P\"),s=r.n(n),i=r(\"20a2\"),a=!0;e.default=function(t){var e=t.error,r=Object(i.useRouter)().query,n=r.sso,a=r.sig;return n&&a?e?s()(\"p\",\"An error occured, please check with the reffering site\"):s()(\"h1\",\"Logging you onto discourse...\"):s()(\"div\",\"Invalid SSO parameters!\")}},\"eU/r\":function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push([\"/sso\",function(){return r(\"PFb9\")}])},\"j+1P\":function(t,e,r){\"use strict\";var n=r(\"q1tI\"),s=r(\"1Gic\");function i(t){return\"string\"===typeof t||\"number\"===typeof t||Array.isArray(t)}t.exports=function t(e,r,a){if(1===arguments.length&&Array.isArray(e))return t(n.Fragment,null,e);!a&&i(r)?(a=r,r={}):2===arguments.length&&(a=[]);(r=r?Object.assign({},r):{}).dataset&&(Object.keys(r.dataset).forEach((function(t){var e=t.replace(/([a-z])([A-Z])/,(function(t){return t[0]+\"-\"+t[1].toLowerCase()}));r[\"data-\"+e]=r.dataset[t]})),r.dataset=void 0);r.attributes&&(Object.keys(r.attributes).forEach((function(t){r[t]=r.attributes[t]})),r.attributes=void 0);\"string\"===typeof e&&(e=s(e,r));var o=[e,r].concat(a);return n.createElement.apply(n,o)}}},[[\"eU/r\",0,2,1]]]);","map":{"version":3,"sources":["static/chunks/pages/sso-e36069b5597af0148b42.js"],"names":["_N_E","window","push","1Gic","module","exports","__webpack_require__","classIdSplit","notClassId","tag","props","classes","part","type","i","noId","tagParts","split","tagName","test","length","charAt","substring","id","className","join","toLowerCase","20a2","PFb9","__webpack_exports__","r","d","__N_SSP","react_hyperscript__WEBPACK_IMPORTED_MODULE_0__","react_hyperscript__WEBPACK_IMPORTED_MODULE_0___default","n","next_router__WEBPACK_IMPORTED_MODULE_1__","_ref","error","_router$query","Object","query","sso","sig","eU/r","__NEXT_P","j+1P","React","parseTag","isChildren","x","Array","isArray","h","componentOrTag","properties","children","arguments","Fragment","assign","dataset","keys","forEach","attrName","dashedAttr","replace","match","undefined","attributes","args","concat","createElement","apply"],"mappings":"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"},"name":"static/chunks/pages/sso-e36069b5597af0148b42.js","input":"_N_E =\n(window[\"webpackJsonp_N_E\"] = window[\"webpackJsonp_N_E\"] || []).push([[70],{\n\n/***/ \"1Gic\":\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* eslint-disable complexity, max-statements */\n\n\nvar classIdSplit = /([\\.#]?[a-zA-Z0-9_:-]+)/;\nvar notClassId = /^\\.|#/;\n\nmodule.exports = parseTag;\n\nfunction parseTag(tag, props) {\n  if (!tag) {\n    return 'div';\n  }\n\n  var noId = !('id' in props);\n\n  var tagParts = tag.split(classIdSplit);\n  var tagName = null;\n\n  if (notClassId.test(tagParts[1])) {\n    tagName = 'div';\n  }\n\n  var classes;\n  var part;\n  var type;\n  var i;\n  for (i = 0; i < tagParts.length; i++) {\n    part = tagParts[i];\n\n    if (!part) {\n      continue;\n    }\n\n    type = part.charAt(0);\n\n    if (!tagName) {\n      tagName = part;\n    } else if (type === '.') {\n      classes = classes || [];\n      classes.push(part.substring(1, part.length));\n    } else if (type === '#' && noId) {\n      props.id = part.substring(1, part.length);\n    }\n  }\n\n  if (classes) {\n    if (props.className) {\n      classes.push(props.className);\n    }\n\n    props.className = classes.join(' ');\n  }\n\n  return tagName ? tagName.toLowerCase() : 'div';\n}\n\n\n/***/ }),\n\n/***/ \"20a2\":\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(\"nOHt\")\n\n\n/***/ }),\n\n/***/ \"PFb9\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"__N_SSP\", function() { return __N_SSP; });\n/* harmony import */ var react_hyperscript__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"j+1P\");\n/* harmony import */ var react_hyperscript__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react_hyperscript__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"20a2\");\n/* harmony import */ var next_router__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_router__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\nvar SSO = function SSO(_ref) {\n  var error = _ref.error;\n  var router = Object(next_router__WEBPACK_IMPORTED_MODULE_1__[\"useRouter\"])();\n  var _router$query = router.query,\n      sso = _router$query.sso,\n      sig = _router$query.sig;\n  if (!sso || !sig) return react_hyperscript__WEBPACK_IMPORTED_MODULE_0___default()('div', 'Invalid SSO parameters!');\n  if (error) return react_hyperscript__WEBPACK_IMPORTED_MODULE_0___default()('p', 'An error occured, please check with the reffering site');\n  return react_hyperscript__WEBPACK_IMPORTED_MODULE_0___default()('h1', 'Logging you onto discourse...');\n};\n\nvar __N_SSP = true;\n/* harmony default export */ __webpack_exports__[\"default\"] = (SSO);\n\n/***/ }),\n\n/***/ \"eU/r\":\n/***/ (function(module, exports, __webpack_require__) {\n\n\n      (window.__NEXT_P = window.__NEXT_P || []).push([\n        \"/sso\",\n        function () {\n          return __webpack_require__(\"PFb9\");\n        }\n      ]);\n    \n\n/***/ }),\n\n/***/ \"j+1P\":\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar React = __webpack_require__(\"q1tI\");\n\nvar parseTag = __webpack_require__(\"1Gic\");\n\nmodule.exports = h;\n\nfunction h(componentOrTag, properties, children) {\n  // if only one argument which is an array, wrap items with React.Fragment\n  if (arguments.length === 1 && Array.isArray(componentOrTag)) {\n      return h(React.Fragment, null, componentOrTag);\n  } else if (!children && isChildren(properties)) {\n    // If a child array or text node are passed as the second argument, shift them\n    children = properties;\n    properties = {};\n  } else if (arguments.length === 2) {\n    // If no children were passed, we don't want to pass \"undefined\"\n    // and potentially overwrite the `children` prop\n    children = [];\n  }\n\n  properties = properties ? Object.assign({}, properties) : {};\n\n  // Supported nested dataset attributes\n  if (properties.dataset) {\n    Object.keys(properties.dataset).forEach(function unnest(attrName) {\n      var dashedAttr = attrName.replace(/([a-z])([A-Z])/, function dash(match) {\n        return match[0] + '-' + match[1].toLowerCase();\n      });\n      properties['data-' + dashedAttr] = properties.dataset[attrName];\n    });\n\n    properties.dataset = undefined;\n  }\n\n  // Support nested attributes\n  if (properties.attributes) {\n    Object.keys(properties.attributes).forEach(function unnest(attrName) {\n      properties[attrName] = properties.attributes[attrName];\n    });\n\n    properties.attributes = undefined;\n  }\n\n  // When a selector, parse the tag name and fill out the properties object\n  if (typeof componentOrTag === 'string') {\n    componentOrTag = parseTag(componentOrTag, properties);\n  }\n\n  // Create the element\n  var args = [componentOrTag, properties].concat(children);\n  return React.createElement.apply(React, args);\n}\n\nfunction isChildren(x) {\n  return typeof x === 'string' || typeof x === 'number' || Array.isArray(x);\n}\n\n\n/***/ })\n\n},[[\"eU/r\",0,2,1]]]);","inputSourceMap":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/react-hyperscript/parse-tag.js","/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/router.js","/Users/ayooluwaalfonso/code/krakeneduapp/pages/sso.ts","/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?page=%2Fsso&absolutePagePath=private-next-pages%2Fsso.ts!","/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/react-hyperscript/index.js"],"names":["SSO","error","router","useRouter","query","sso","sig","h"],"mappings":";;;;;;;AAAA;AACa;;AAEb;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,qBAAqB;AAClC;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;ACtDA,iBAAiB,mBAAO,CAAC,MAAsB;;;;;;;;;ACA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;AAQA,IAAMA,GAAG,GAAG,SAANA,GAAM,OAAmB;AAAA,MAAjBC,KAAiB,QAAjBA,KAAiB;AAC7B,MAAIC,MAAM,GAAGC,6DAAS,EAAtB;AAD6B,sBAEZD,MAAM,CAACE,KAFK;AAAA,MAExBC,GAFwB,iBAExBA,GAFwB;AAAA,MAEnBC,GAFmB,iBAEnBA,GAFmB;AAI7B,MAAG,CAACD,GAAD,IAAQ,CAACC,GAAZ,EAAiB,OAAOC,wDAAC,CAAC,KAAD,EAAQ,yBAAR,CAAR;AAEjB,MAAGN,KAAH,EAAU,OAAOM,wDAAC,CAAC,GAAD,EAAM,wDAAN,CAAR;AAEV,SAAOA,wDAAC,CAAC,IAAD,EAAO,+BAAP,CAAR;AACD,CATD;;;AAWeP,kEAAf,E;;;;;;;;ACrBA;AACA;AACA;AACA,iBAAiB,mBAAO,CAAC,MAA2B;AACpD;AACA;;;;;;;;;ACNa;AACb,YAAY,mBAAO,CAAC,MAAO;;AAE3B,eAAe,mBAAO,CAAC,MAAa;;AAEpC;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA,4CAA4C;;AAE5C;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"x","sourcesContent":["/* eslint-disable complexity, max-statements */\n'use strict';\n\nvar classIdSplit = /([\\.#]?[a-zA-Z0-9_:-]+)/;\nvar notClassId = /^\\.|#/;\n\nmodule.exports = parseTag;\n\nfunction parseTag(tag, props) {\n  if (!tag) {\n    return 'div';\n  }\n\n  var noId = !('id' in props);\n\n  var tagParts = tag.split(classIdSplit);\n  var tagName = null;\n\n  if (notClassId.test(tagParts[1])) {\n    tagName = 'div';\n  }\n\n  var classes;\n  var part;\n  var type;\n  var i;\n  for (i = 0; i < tagParts.length; i++) {\n    part = tagParts[i];\n\n    if (!part) {\n      continue;\n    }\n\n    type = part.charAt(0);\n\n    if (!tagName) {\n      tagName = part;\n    } else if (type === '.') {\n      classes = classes || [];\n      classes.push(part.substring(1, part.length));\n    } else if (type === '#' && noId) {\n      props.id = part.substring(1, part.length);\n    }\n  }\n\n  if (classes) {\n    if (props.className) {\n      classes.push(props.className);\n    }\n\n    props.className = classes.join(' ');\n  }\n\n  return tagName ? tagName.toLowerCase() : 'div';\n}\n","module.exports = require('./dist/client/router')\n","import h from 'react-hyperscript'\nimport querystring from 'querystring'\nimport crypto from 'crypto'\nimport {useRouter} from 'next/router'\nimport { GetServerSideProps } from 'next'\n\nimport {getToken} from 'src/token'\nimport {  makeSSOPayload } from 'src/discourse'\nimport {DISCOURSE_URL} from 'src/constants'\n\ntype Props = {error:boolean}\nconst SSO = ({error}:Props) => {\n  let router = useRouter()\n  let {sso, sig} = router.query\n\n  if(!sso || !sig) return h('div', 'Invalid SSO parameters!')\n\n  if(error) return h('p', 'An error occured, please check with the reffering site')\n\n  return h('h1', 'Logging you onto discourse...')\n}\n\nexport default SSO\n\nexport const getServerSideProps:GetServerSideProps = async ({req,res, query}) => {\n  let token = getToken(req)\n  if(!token) {\n    res.writeHead(301, {Location: '/login?redirect='+encodeURIComponent(req.url as string)})\n    res.end()\n    return {props:{}}\n  }\n  let {sso, sig} = query\n  if(typeof sso !== 'string') return {props: {error: true}}\n\n  const hmac1 = crypto.createHmac('sha256', process.env.DISCOURSE_SECRET || '');\n  hmac1.update(Buffer.from(sso))\n\n  let verifySig = hmac1.digest('hex')\n  if(verifySig !== sig) return  {props: {error: true}}\n\n  let {nonce} = querystring.parse(Buffer.from(sso as string, 'base64').toString())\n\n  res.writeHead(301, {\n    Location: `${DISCOURSE_URL}/session/sso_login?`\n      + makeSSOPayload({\n        nonce:nonce as string ,\n        email:token.email,\n        external_id: token.id\n      })\n  })\n  res.end()\n  return {props:{}}\n\n}\n","\n      (window.__NEXT_P = window.__NEXT_P || []).push([\n        \"/sso\",\n        function () {\n          return require(\"private-next-pages/sso.ts\");\n        }\n      ]);\n    ","'use strict';\nvar React = require('react');\n\nvar parseTag = require('./parse-tag');\n\nmodule.exports = h;\n\nfunction h(componentOrTag, properties, children) {\n  // if only one argument which is an array, wrap items with React.Fragment\n  if (arguments.length === 1 && Array.isArray(componentOrTag)) {\n      return h(React.Fragment, null, componentOrTag);\n  } else if (!children && isChildren(properties)) {\n    // If a child array or text node are passed as the second argument, shift them\n    children = properties;\n    properties = {};\n  } else if (arguments.length === 2) {\n    // If no children were passed, we don't want to pass \"undefined\"\n    // and potentially overwrite the `children` prop\n    children = [];\n  }\n\n  properties = properties ? Object.assign({}, properties) : {};\n\n  // Supported nested dataset attributes\n  if (properties.dataset) {\n    Object.keys(properties.dataset).forEach(function unnest(attrName) {\n      var dashedAttr = attrName.replace(/([a-z])([A-Z])/, function dash(match) {\n        return match[0] + '-' + match[1].toLowerCase();\n      });\n      properties['data-' + dashedAttr] = properties.dataset[attrName];\n    });\n\n    properties.dataset = undefined;\n  }\n\n  // Support nested attributes\n  if (properties.attributes) {\n    Object.keys(properties.attributes).forEach(function unnest(attrName) {\n      properties[attrName] = properties.attributes[attrName];\n    });\n\n    properties.attributes = undefined;\n  }\n\n  // When a selector, parse the tag name and fill out the properties object\n  if (typeof componentOrTag === 'string') {\n    componentOrTag = parseTag(componentOrTag, properties);\n  }\n\n  // Create the element\n  var args = [componentOrTag, properties].concat(children);\n  return React.createElement.apply(React, args);\n}\n\nfunction isChildren(x) {\n  return typeof x === 'string' || typeof x === 'number' || Array.isArray(x);\n}\n"]}}