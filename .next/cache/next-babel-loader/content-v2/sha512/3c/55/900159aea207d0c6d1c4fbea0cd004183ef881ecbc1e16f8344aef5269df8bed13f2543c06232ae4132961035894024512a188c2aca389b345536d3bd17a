{"ast":null,"code":"import h from \"react-hyperscript\";\nimport { useUserData } from \"src/data\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useApi } from \"src/apiHelpers\";\nimport { getDiscounts, setDiscounts } from \"src/clientData\";\nimport { Box } from \"components/Layout\";\nimport { Modal } from \"components/Modal\";\nimport { Primary } from \"components/Button\";\nimport compress from \"src/paystack/compress-data\";\nimport toast from \"react-hot-toast\"; // import {PaystackProps} from 'src/paystack/types';\n// import Toast from 'light-toast';\n\nconst errorNotify = msg => toast.error(msg, {\n  icon: \"😟\"\n});\n\nconst successNotify = msg => toast.success(msg, {\n  icon: \"👏\"\n});\n\nconst defaultConfig = {\n  publicKey: process.env.NEXT_PUBLIC_PAYSTACK_KEY\n};\n\nconst onSuccess = () => {\n  successNotify(\"Your payment was successful!\");\n};\n\nconst onClose = () => {\n  errorNotify(\"Your payment failed, try again?\");\n};\n\nconst paystackHook = config => {\n  try {\n    let initializePayment = compress(config, defaultConfig); // @ts-ignore\n\n    initializePayment(onSuccess, onClose)();\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nexport const SubEnrollButton = props => {\n  let {\n    data: user\n  } = useUserData();\n  let router = useRouter();\n  let {\n    0: error,\n    1: setError\n  } = useState(false);\n  let [status, callEnroll] = useApi([], async res => {\n    if (res.zeroCost) await router.push(\"/courses/[slug]/[id]/cohorts/[cohortId]\", `/courses/${router.query.slug}/${props.course}/cohorts/${props.id}?welcome`);\n    paystackHook(res);\n  });\n\n  let onClick = async e => {\n    e.preventDefault();\n    if (user === false) await router.push(\"/login?redirect=\" + encodeURIComponent(router.asPath));\n    if (!props.id) return;\n    let discount = getDiscounts().find(d => d.course === props.course);\n    let res = await callEnroll(`/api/cohorts/${props.id}/enroll`, {\n      discount: discount === null || discount === void 0 ? void 0 : discount.code,\n      paystack: true\n    });\n\n    if (res.status === 403) {\n      setError(true);\n      setDiscounts(getDiscounts().filter(d => res.status === 403 && d.code !== res.result.discount));\n    }\n  };\n\n  return h(Box, {\n    gap: 4,\n    style: {\n      alignItems: \"center\"\n    }\n  }, [h(Modal, {\n    display: error\n  }, [h(\"h3\", \"Sorry, the discount code you're using is no longer valid\")]), h(Primary, {\n    onClick,\n    status,\n    disabled: !props.invited || props.max_size !== 0 && props.max_size === props.learners\n  }, props.children)]);\n};","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/components/Course/SubEnrollButton.ts"],"names":["h","useUserData","useRouter","useState","useApi","getDiscounts","setDiscounts","Box","Modal","Primary","compress","toast","errorNotify","msg","error","icon","successNotify","success","defaultConfig","publicKey","process","env","NEXT_PUBLIC_PAYSTACK_KEY","onSuccess","onClose","paystackHook","config","initializePayment","console","log","SubEnrollButton","props","data","user","router","setError","status","callEnroll","res","zeroCost","push","query","slug","course","id","onClick","e","preventDefault","encodeURIComponent","asPath","discount","find","d","code","paystack","filter","result","gap","style","alignItems","display","disabled","invited","max_size","learners","children"],"mappings":"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","sourcesContent":["import h from \"react-hyperscript\";\nimport { useUserData } from \"src/data\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useApi } from \"src/apiHelpers\";\nimport { EnrollMsg, EnrollResponse } from \"pages/api/cohorts/[cohortId]/enroll\";\nimport { getDiscounts, setDiscounts } from \"src/clientData\";\nimport { Box } from \"components/Layout\";\nimport { Modal } from \"components/Modal\";\nimport { Primary } from \"components/Button\";\nimport compress from \"src/paystack/compress-data\"\nimport toast from \"react-hot-toast\";\n// import {PaystackProps} from 'src/paystack/types';\n// import Toast from 'light-toast';\n\nconst errorNotify = (msg: string) =>\n  toast.error(msg, {\n    icon: \"😟\",\n  });\n\nconst successNotify = (msg: string) =>\n  toast.success(msg, {\n    icon: \"👏\",\n  });\n\nconst defaultConfig = {\n  publicKey: process.env.NEXT_PUBLIC_PAYSTACK_KEY,\n};\n\nconst onSuccess = () => {\n  successNotify(\"Your payment was successful!\");\n};\n\nconst onClose = () => {\n  errorNotify(\"Your payment failed, try again?\");\n};\n\nconst paystackHook = (config:{}) => {\n  try {\n    let initializePayment = compress(config, defaultConfig)\n    // @ts-ignore\n    initializePayment(onSuccess, onClose)();\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nexport const SubEnrollButton: React.FC<{\n  id: number;\n  course: number;\n  max_size: number;\n  learners: number;\n  invited: boolean;\n}> = (props) => {\n  let { data: user } = useUserData();\n  let router = useRouter();\n  let [error, setError] = useState(false);\n  let [status, callEnroll] = useApi<EnrollMsg, EnrollResponse>(\n    [],\n    async (res) => {\n    \n      if (res.zeroCost)\n        await router.push(\n          \"/courses/[slug]/[id]/cohorts/[cohortId]\",\n          `/courses/${router.query.slug}/${props.course}/cohorts/${props.id}?welcome`\n        );\n      paystackHook(res);\n    }\n  );\n\n  let onClick = async (e: React.MouseEvent) => {\n    e.preventDefault();\n    if (user === false)\n      await router.push(\"/login?redirect=\" + encodeURIComponent(router.asPath));\n    if (!props.id) return;\n    let discount = getDiscounts().find((d) => d.course === props.course);\n    let res = await callEnroll(`/api/cohorts/${props.id}/enroll`, {\n      discount: discount?.code,\n      paystack: true,\n    });\n\n    if (res.status === 403) {\n      setError(true);\n      setDiscounts(\n        getDiscounts().filter(\n          (d) => res.status === 403 && d.code !== res.result.discount\n        )\n      );\n    }\n  };\n\n  return h(Box, { gap: 4, style: { alignItems: \"center\" } }, [\n    h(Modal, { display: error }, [\n      h(\"h3\", \"Sorry, the discount code you're using is no longer valid\"),\n    ]),\n    h(\n      Primary,\n      {\n        onClick,\n        status,\n        disabled:\n          !props.invited ||\n          (props.max_size !== 0 && props.max_size === props.learners),\n      },\n      props.children as React.ReactElement\n    ),\n  ]);\n};\n"]},"metadata":{},"sourceType":"module"}