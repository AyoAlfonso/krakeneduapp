{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _styled from \"@emotion/styled-base\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _EMOTION_STRINGIFIED_CSS_ERROR__() { return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\"; }\n\nimport h from 'react-hyperscript';\nimport { useState } from 'react';\nimport Link from 'next/link';\nimport { Box, Seperator, TwoColumn, Sidebar } from 'components/Layout';\nimport { Tabs, StickyWrapper } from 'components/Tabs';\nimport { colors } from 'components/Tokens';\nimport Loader, { PageLoader } from 'components/Loader';\nimport { Info } from 'components/Form';\nimport { Pill } from 'components/Pill';\nimport Enroll from 'components/Course/Enroll';\nimport Text from 'components/Text';\nimport { SmallCohortCard } from 'components/Cards/SmallCohortCard';\nimport { TwoColumnBanner } from 'components/Banner';\nimport { Modal } from 'components/Modal';\nimport { Primary, Destructive, LinkButton } from 'components/Button';\nimport { WatchCourse } from 'components/Course/WatchCourse';\nimport { DISCOURSE_URL } from 'src/constants';\nimport { useUserData, useUserCohorts, useCourseData } from 'src/data';\nimport { callApi } from 'src/apiHelpers';\nimport { cohortPrettyDate } from 'components/Cards/CohortCard';\nimport ErrorPage from 'pages/404';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport { AccentImg } from 'components/Images';\nimport { TodoList } from 'components/TodoList';\nimport { cohortName, sortByDateAndName } from 'src/utils';\nvar COPY = {\n  curriculumTab: \"Curriculum\",\n  cohortTab: \"All Cohorts\",\n  activeCohorts: \"Your Current Cohorts\",\n  settings: \"You can edit details, create new cohorts, and more.\",\n  enrollButton: \"Enroll in a cohort\",\n  updateCurriculum: function updateCurriculum(props) {\n    return h(Info, [\"\\uD83D\\uDCA1 You can make changes to the curriculum by editing \", h('a', {\n      href: \"\".concat(DISCOURSE_URL, \"/session/sso?return_path=/t/\").concat(props.id)\n    }, \"this topic\"), \" in the forum\"]);\n  }\n};\n\nvar WrappedCoursePage = function WrappedCoursePage(props) {\n  return props.notFound ? h(ErrorPage) : h(CoursePage, props);\n};\n\nexport var __N_SSG = true;\nexport default WrappedCoursePage;\n\nvar CoursePage = function CoursePage(props) {\n  var _tabs;\n\n  var _useUserData = useUserData(),\n      user = _useUserData.data;\n\n  var _useUserCohorts = useUserCohorts(),\n      userCohorts = _useUserCohorts.data;\n\n  var _useCourseData = useCourseData(props.id, props.course || undefined),\n      course = _useCourseData.data;\n\n  if (!course) return h(PageLoader);\n  var activeCohorts = course.course_cohorts.filter(function (c) {\n    if (!user) return false;\n    return c.completed === null && (!!c.cohort_facilitators.find(function (f) {\n      return user && f.facilitator === user.id;\n    }) || c.people_in_cohorts.find(function (p) {\n      return p.people.id === (user ? user.id : undefined);\n    }));\n  }).sort(sortByDateAndName);\n  var enrolled = activeCohorts.filter(function (c) {\n    return !c.cohort_facilitators.find(function (f) {\n      return user && f.facilitator === user.id;\n    });\n  }).length > 0;\n  var upcomingCohorts = course.course_cohorts.filter(function (c) {\n    return new Date(c.start_date) > new Date() && c.live;\n  }).sort(sortByDateAndName);\n  var isMaintainer = !!(course !== null && course !== void 0 && course.course_maintainers.find(function (maintainer) {\n    return user && maintainer.maintainer === user.id;\n  }));\n  var invited = !!(userCohorts !== null && userCohorts !== void 0 && userCohorts.invited_courses.find(function (course) {\n    return course.id === props.course.id;\n  })); //Setting up the layout for the course page\n\n  return h('div', [h(Head, {\n    children: [h('meta', {\n      property: \"og:title\",\n      content: course.name,\n      key: \"og:title\"\n    }), h('meta', {\n      property: \"og:description\",\n      content: course.description,\n      key: \"og:description\"\n    }), h('meta', {\n      property: \"og:image\",\n      content: course.card_image.split(',')[0],\n      key: \"og:image\"\n    }), h('meta', {\n      property: \"twitter:card\",\n      content: \"summary\",\n      key: \"twitter:card\"\n    })]\n  }), h(Banners, {\n    draft: course.status === 'draft',\n    id: props.id,\n    isMaintainer: isMaintainer,\n    slug: course.slug\n  }), h(TwoColumn, [h(Box, {\n    gap: 32\n  }, [h(Box, {\n    gap: 16\n  }, [h('h1', course === null || course === void 0 ? void 0 : course.name)]), h('p.big', (course === null || course === void 0 ? void 0 : course.description) || ''), upcomingCohorts.length > 0 && activeCohorts.length === 0 ? h(Box, {\n    padding: 32,\n    style: {\n      backgroundColor: colors.accentPeach\n    }\n  }, _toConsumableArray(upcomingCohorts.flatMap(function (cohort) {\n    return [h(Cohort, {\n      cohort: cohort,\n      enrolled: false,\n      facilitating: false,\n      invited: invited,\n      slug: (course === null || course === void 0 ? void 0 : course.slug) || '',\n      cohort_max_size: (course === null || course === void 0 ? void 0 : course.cohort_max_size) || 0\n    }), h(Seperator)];\n  }).slice(0, -1))) : activeCohorts.length === 0 ? null : h(Box, {\n    padding: 32,\n    style: {\n      backgroundColor: colors.grey95\n    }\n  }, [h('h3', COPY.activeCohorts)].concat(_toConsumableArray(activeCohorts.map(function (cohort) {\n    return h(SmallCohortCard, _objectSpread(_objectSpread({}, cohort), {}, {\n      facilitators: cohort.cohort_facilitators.map(function (f) {\n        return f.people.display_name || f.people.username;\n      }),\n      courses: {\n        name: (course === null || course === void 0 ? void 0 : course.name) || '',\n        slug: (course === null || course === void 0 ? void 0 : course.slug) || ''\n      },\n      facilitating: !!cohort.cohort_facilitators.find(function (f) {\n        return user && f.facilitator === user.id;\n      }),\n      enrolled: !cohort.cohort_facilitators.find(function (f) {\n        return user && f.facilitator === user.id;\n      })\n    }));\n  }))))]), h(Tabs, {\n    tabs: (_tabs = {}, _defineProperty(_tabs, COPY.curriculumTab, h(Box, [isMaintainer ? h(COPY.updateCurriculum, {\n      id: props.content.id\n    }) : null, h(Text, {\n      source: props.content.text\n    })])), _defineProperty(_tabs, COPY.cohortTab, h(Cohorts, {\n      cohorts: course.course_cohorts,\n      slug: course.slug,\n      user: user ? user.id : '',\n      invited: invited,\n      cohort_max_size: (course === null || course === void 0 ? void 0 : course.cohort_max_size) || 0\n    })), _defineProperty(_tabs, \"Facilitators\", h(Box, {\n      gap: 32\n    }, course.course_maintainers.map(function (maintainer) {\n      return h(Box, {}, [h('h3', maintainer.people.display_name || maintainer.people.username), !maintainer.people.link ? null : h('a', {\n        href: maintainer.people.link\n      }, h('b', maintainer.people.link)), !maintainer.people.bio ? null : h(Box, {\n        width: 640\n      }, h(Text, {\n        source: maintainer.people.bio\n      }))]);\n    }))), _tabs)\n  }), h(Sidebar, [h(StickyWrapper, [h(Enroll, {\n    course: course\n  }, [h(Box, [h(EnrollStatus, {\n    courseId: course.id,\n    courseSlug: course.slug,\n    draft: course.status === 'draft',\n    maintainer: isMaintainer,\n    inviteOnly: course.invite_only,\n    invited: invited,\n    loggedIn: !!user,\n    enrolled: enrolled,\n    upcoming: upcomingCohorts.length !== 0\n  }), h(Seperator), !isMaintainer ? h(WatchCourse, {\n    id: course.id\n  }) : h(Box, [h(Box, {\n    gap: 8\n  }, [h('h3', \"You maintain this \".concat(course.type)), h('p.textSecondary', COPY.settings)]), h(Link, {\n    href: '/courses/[slug]/[id]/settings',\n    as: \"/courses/\".concat(course.slug, \"/\").concat(course.id, \"/settings\")\n  }, h(Destructive, 'Settings'))])])])])])])]);\n};\n\nfunction EnrollStatus(props) {\n  if (props.draft) {\n    if (props.maintainer) return h('span.accentRed', \"Learners can't enroll in this course until you publish it!\");\n    return h('span.accentRed', \"This course is still a draft. You can enroll once the creator publishes it!\");\n  }\n\n  if (props.enrolled) {\n    if (props.upcoming) return h('span.accentSuccess', \"You're enrolled in an upcoming cohort. Feel free to enroll in another one though!\");\n    return h('span.accentSuccess', \"You're enrolled in an upcoming cohort\");\n  }\n\n  if (!props.upcoming) {\n    if (props.maintainer) return h('span.accentRed', [\"Looks like there aren't any cohorts planned. Create one \", h(Link, {\n      href: \"/courses/[slug]/[id]/settings\",\n      as: \"/courses/\".concat(props.courseSlug, \"/\").concat(props.courseId, \"/settings\")\n    }, h('a', 'here')), '.']);\n    return h('span.accentRed', \"Looks like there aren't any cohorts planned :(\");\n  }\n\n  if (props.inviteOnly) {\n    if (props.maintainer) return h('span.accentRed', [\"Learners need to be invited to enroll. Invite someone \", h(Link, {\n      href: \"/courses/\".concat(props.courseSlug, \"/\").concat(props.courseId, \"/settings\")\n    }, h('a', 'here')), '.']);\n    if (props.invited) return h('span.accentSuccess', \"You're invited!\");\n    if (props.loggedIn) return h('div', {}, h('span.accentRed', \"This course is invite only. Reach out to the facilitators if you're interested!\"));\n    return h('div', {}, h('span.accentRed', \"This course is invite only. If you've been invited, please log in.\"));\n  }\n\n  return null;\n}\n\nvar Cohorts = function Cohorts(props) {\n  var _props$cohorts$filter = props.cohorts.filter(function (c) {\n    if (c.live) return true;\n    return !!c.cohort_facilitators.find(function (f) {\n      return f.facilitator === props.user;\n    });\n  }).sort(sortByDateAndName).reduce(function (acc, cohort) {\n    var enrolled = !!cohort.people_in_cohorts.find(function (p) {\n      return p.people.id === props.user;\n    });\n    var facilitating = !!cohort.cohort_facilitators.find(function (f) {\n      return f.facilitator === props.user;\n    });\n    acc[new Date(cohort.start_date) < new Date() ? 0 : 1].push(h(Cohort, {\n      cohort: cohort,\n      enrolled: enrolled,\n      facilitating: facilitating,\n      slug: props.slug,\n      cohort_max_size: props.cohort_max_size,\n      invited: props.invited\n    }));\n    return acc;\n  }, [[], []]),\n      _props$cohorts$filter2 = _slicedToArray(_props$cohorts$filter, 2),\n      pastCohorts = _props$cohorts$filter2[0],\n      upcomingCohorts = _props$cohorts$filter2[1];\n\n  return h(Box, {\n    gap: 32\n  }, [upcomingCohorts.length === 0 ? null : h('h2', \"Upcoming Cohorts\")].concat(_toConsumableArray(upcomingCohorts), [upcomingCohorts.length === 0 || pastCohorts.length === 0 ? null : h(Seperator), pastCohorts.length === 0 ? null : h('h2', 'Ongoing and Past Cohorts')], _toConsumableArray(pastCohorts)));\n};\n\nexport var Cohort = function Cohort(props) {\n  var id = props.cohort.id;\n  var router = useRouter();\n  var past = new Date(props.cohort.start_date) < new Date();\n  return h(Box, {\n    h: true,\n    style: {\n      gridAutoColumns: 'auto'\n    }\n  }, [h(Box, {\n    gap: 4\n  }, [!props.enrolled && !props.facilitating ? null : h('div', [props.enrolled ? h(Pill, 'enrolled') : null, ' ', props.facilitating ? h(Pill, {\n    borderOnly: true\n  }, 'facilitating') : null, ' ', !props.cohort.live ? h(Pill, {\n    borderOnly: true,\n    red: true\n  }, 'draft') : null]), h('h3', {}, h(Link, {\n    href: '/courses/[slug]/[id]/cohorts/[cohortId]',\n    as: \"/courses/\".concat(props.slug, \"/\").concat(props.cohort.course, \"/cohorts/\").concat(id)\n  }, h('a', {\n    style: {\n      textDecoration: 'none'\n    }\n  }, cohortName(props.cohort.name)))), h(Box, {\n    style: {\n      color: colors.textSecondary\n    },\n    gap: 4\n  }, [h('strong', cohortPrettyDate(props.cohort.start_date, props.cohort.completed)), h('div', [\"Facilitated by \"].concat(_toConsumableArray(props.cohort.cohort_facilitators.flatMap(function (f) {\n    return [h(Link, {\n      href: \"/people/\".concat(f.people.username)\n    }, h('a', f.people.display_name || f.people.username)), ', '];\n  }).slice(0, -1))))]), props.cohort_max_size === 0 || past ? null : props.cohort_max_size > props.cohort.people_in_cohorts.length ? h('span.accentSuccess', \"\".concat(props.cohort_max_size - props.cohort.people_in_cohorts.length, \" \").concat(props.cohort_max_size - props.cohort.people_in_cohorts.length === 1 ? 'spot' : 'spots', \" left!\")) : h('span.accentRed', \"Sorry! This cohort is full.\")]), past || props.enrolled || props.facilitating ? null : h(Box, {\n    gap: 8,\n    style: {\n      alignItems: 'center',\n      alignContent: 'center',\n      justifySelf: 'right',\n      textAlign: 'right'\n    }\n  }, [h(Link, {\n    href: \"/courses/\".concat(router.query.slug, \"/\").concat(props.cohort.course, \"/cohorts/\").concat(props.cohort.id)\n  }, h('a', {}, h(Primary, 'See schedule')))])]);\n}; //feature to add a new cohort to a course\n\nfunction MarkCourseLive(props) {\n  var _useCourseData2 = useCourseData(props.id),\n      course = _useCourseData2.data,\n      mutate = _useCourseData2.mutate;\n\n  var _useState = useState('normal'),\n      state = _useState[0],\n      setState = _useState[1];\n\n  var onClick = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n\n              if (course) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              setState('loading');\n              _context.next = 6;\n              return callApi(\"/api/courses/\".concat(props.id), {\n                status: 'live'\n              });\n\n            case 6:\n              res = _context.sent;\n\n              if (res.status === 200) {\n                setState('normal');\n                mutate(_objectSpread(_objectSpread({}, course), {}, {\n                  status: 'live'\n                }));\n              }\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onClick(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  if (state === 'confirm' || state === 'loading') return h(Modal, {\n    display: true,\n    closeText: \"nevermind\",\n    onExit: function onExit() {\n      return setState(\"normal\");\n    }\n  }, [h(Box, {\n    gap: 32\n  }, [h(\"h2\", {\n    style: {\n      textAlign: \"center\"\n    }\n  }, \"Are you sure?\"), h(Box, {\n    gap: 16\n  }, [\"Before going live please check that you've done these things\", h(Box.withComponent(\"ul\", {\n    target: \"e1iqf50g1\"\n  }), {\n    gap: 16\n  }, [h(\"li\", [\"Edit important details in \", h(\"a\", {\n    href: \"https://app.krakenedu.com/courses/\".concat(props.slug, \"/\").concat(props.id, \"/settings?tab=Details\")\n  }, \"course settings\"), \".\"]), h(\"li\", [\"Written a \", h(\"a\", {\n    href: \"\".concat(DISCOURSE_URL, \"/session/sso?return_path=/t/\").concat(props.id)\n  }, \"curriculum\"), \".\"])]), h(Primary, {\n    style: {\n      justifySelf: \"center\"\n    },\n    onClick: onClick\n  }, state === \"loading\" ? h(Loader) : \"Go Live!\")])])]);\n  return h(Primary, {\n    onClick: function () {\n      var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                e.preventDefault();\n                setState('confirm');\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function onClick(_x2) {\n        return _onClick.apply(this, arguments);\n      }\n\n      return onClick;\n    }()\n  }, \"Publish!\");\n} // Feature to edit course detail (length, prereqs, one line description)\n// Define Banners\n\n\nvar Banners = function Banners(props) {\n  if (props.draft && props.isMaintainer) {\n    if (props.isMaintainer) {\n      return h(TODOBanner, props);\n    }\n\n    return h(TwoColumnBanner, {\n      red: true\n    }, h(Box, {\n      gap: 16\n    }, [h(Box, {\n      gap: 16\n    }, [h('h3', \"This course isn't live yet!\"), h('p', [\"The maintainer is still working on getting this course in shape. Let them know\\nif you have any feedback!\"])])]));\n  }\n\n  return null;\n}; // Draft Course ToDo Banner\n\n\nvar TODOBanner = function TODOBanner(props) {\n  var _useState2 = useState(false),\n      expanded = _useState2[0],\n      setExpanded = _useState2[1];\n\n  return h(TwoColumnBanner, {\n    red: true\n  }, [h(BannerContent, [h(AccentImg, {\n    height: 32,\n    width: 36,\n    src: \"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Seedling.png\"\n  }), h(Box, {\n    gap: 8\n  }, [h('h4', \"This course is still a draft\"), h('p', 'It’s hidden from public view. People can’t see this page until you publish it.')])].concat(_toConsumableArray(!expanded ? [] : [h(AccentImg, {\n    height: 32,\n    width: 36,\n    src: \"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Bud.png\"\n  }), h(Box, {\n    gap: 16\n  }, [h('h4', \"Before you publish this course make sure that you ...  \"), h(TodoList, {\n    persistKey: \"course-creation-todo\",\n    items: [h(\"span\", [\"Edit important details, like description and price, in \", h('a', {\n      href: \"https://app.krakenedu.com/courses/\".concat(props.slug, \"/\").concat(props.id, \"/settings?tab=Details\")\n    }, \"course settings\"), \".\"]), h(\"span\", [\"Write a comprehensive curriculum for your course, by editing the \", h('a', {\n      href: \"\".concat(DISCOURSE_URL, \"/session/sso?return_path=/t/\").concat(props.id)\n    }, \"Curriculum topic\"), \" in the forum.\"]), h(\"span\", [\"Create or edit \", h('a', {\n      href: \"https://app.krakenedu.com/courses/\".concat(props.slug, \"/\").concat(props.id, \"/settings?tab=Templates\")\n    }, \"templates\"), \" for reusable forum topics so you don't need to rewrite them for every cohort you run (or you can add these later).\"]), h(\"span\", [\"Create your first cohort, in \", h('a', {\n      href: \"https://app.krakenedu.com/courses/\".concat(props.slug, \"/\").concat(props.id, \"/settings?tab=Cohorts\")\n    }, \"course settings\"), \". It will also be a draft that you need to edit before publishing. We'll guide you through it!\"])]\n  })]), h(AccentImg, {\n    height: 32,\n    width: 36,\n    src: \"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Flower.png\"\n  }), h(Box, {\n    gap: 16\n  }, [h('h4', \"Once you're ready, you can publish it here!\"), h(MarkCourseLive, props)])]))), h(LinkButton, {\n    style: {\n      justifySelf: 'right',\n      textDecoration: 'none'\n    },\n    onClick: function onClick() {\n      return setExpanded(!expanded);\n    }\n  }, expanded ? \"hide checklist\" : \"show checklist\")]);\n};\n\nvar BannerContent = /*#__PURE__*/_styled('div', {\n  target: \"e1iqf50g0\"\n})(true ? {\n  name: \"12gnjoo\",\n  styles: \"display:grid;grid-template-columns:min-content auto;grid-column-gap:16px;grid-row-gap:32px;\"\n} : {\n  name: \"12gnjoo\",\n  styles: \"display:grid;grid-template-columns:min-content auto;grid-column-gap:16px;grid-row-gap:32px;\",\n  map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9heW9vbHV3YWFsZm9uc28vY29kZS9rcmFrZW5lZHVhcHAvcGFnZXMvY291cnNlcy9bc2x1Z10vW2lkXS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0YW9DIiwiZmlsZSI6Ii9Vc2Vycy9heW9vbHV3YWFsZm9uc28vY29kZS9rcmFrZW5lZHVhcHAvcGFnZXMvY291cnNlcy9bc2x1Z10vW2lkXS9pbmRleC50cyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBoIGZyb20gJ3JlYWN0LWh5cGVyc2NyaXB0J1xuaW1wb3J0IHsgdXNlU3RhdGUsIFJlYWN0RWxlbWVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IExpbmsgZnJvbSAnbmV4dC9saW5rJ1xuaW1wb3J0IHsgSW5mZXJHZXRTdGF0aWNQcm9wc1R5cGUgfSBmcm9tICduZXh0J1xuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnXG5pbXBvcnQgcHJpc21hIGZyb20gXCJsaWIvcHJpc21hXCI7XG5pbXBvcnQgeyBCb3gsIFNlcGVyYXRvciwgVHdvQ29sdW1uLCBTaWRlYmFyIH0gZnJvbSAnY29tcG9uZW50cy9MYXlvdXQnXG5pbXBvcnQge1RhYnMsIFN0aWNreVdyYXBwZXJ9IGZyb20gJ2NvbXBvbmVudHMvVGFicydcbmltcG9ydCB7IGNvbG9ycyB9IGZyb20gJ2NvbXBvbmVudHMvVG9rZW5zJ1xuaW1wb3J0IExvYWRlciwgeyBQYWdlTG9hZGVyIH0gZnJvbSAnY29tcG9uZW50cy9Mb2FkZXInXG5pbXBvcnQgeyBJbmZvIH0gZnJvbSAnY29tcG9uZW50cy9Gb3JtJ1xuaW1wb3J0IHtQaWxsfSBmcm9tICdjb21wb25lbnRzL1BpbGwnXG5pbXBvcnQgRW5yb2xsIGZyb20gJ2NvbXBvbmVudHMvQ291cnNlL0Vucm9sbCdcbmltcG9ydCBUZXh0IGZyb20gJ2NvbXBvbmVudHMvVGV4dCdcbmltcG9ydCB7U21hbGxDb2hvcnRDYXJkfSBmcm9tICdjb21wb25lbnRzL0NhcmRzL1NtYWxsQ29ob3J0Q2FyZCdcbmltcG9ydCB7VHdvQ29sdW1uQmFubmVyfSBmcm9tICdjb21wb25lbnRzL0Jhbm5lcidcbmltcG9ydCB7TW9kYWx9IGZyb20gJ2NvbXBvbmVudHMvTW9kYWwnXG5pbXBvcnQgeyBQcmltYXJ5LCBEZXN0cnVjdGl2ZSwgTGlua0J1dHRvbn0gZnJvbSAnY29tcG9uZW50cy9CdXR0b24nXG5pbXBvcnQge1dhdGNoQ291cnNlfSBmcm9tICdjb21wb25lbnRzL0NvdXJzZS9XYXRjaENvdXJzZSdcblxuaW1wb3J0IHsgZ2V0VGFnZ2VkUG9zdCB9IGZyb20gJ3NyYy9kaXNjb3Vyc2UnXG5pbXBvcnQge0RJU0NPVVJTRV9VUkx9IGZyb20gJ3NyYy9jb25zdGFudHMnXG5pbXBvcnQgeyB1c2VVc2VyRGF0YSwgdXNlVXNlckNvaG9ydHMsIHVzZUNvdXJzZURhdGEsIENvdXJzZSB9IGZyb20gJ3NyYy9kYXRhJ1xuaW1wb3J0IHsgVXBkYXRlQ291cnNlTXNnLCBVcGRhdGVDb3Vyc2VSZXNwb25zZX0gZnJvbSAncGFnZXMvYXBpL2NvdXJzZXMvW2lkXSdcbmltcG9ydCB7IGNhbGxBcGkgfSBmcm9tICdzcmMvYXBpSGVscGVycydcbmltcG9ydCB7IGNvaG9ydFByZXR0eURhdGUgfSBmcm9tICdjb21wb25lbnRzL0NhcmRzL0NvaG9ydENhcmQnXG5pbXBvcnQgRXJyb3JQYWdlIGZyb20gJ3BhZ2VzLzQwNCdcbmltcG9ydCB7IGNvdXJzZURhdGFRdWVyeSB9IGZyb20gJ3BhZ2VzL2FwaS9jb3Vyc2VzL1tpZF0nXG5pbXBvcnQgSGVhZCBmcm9tICduZXh0L2hlYWQnXG5pbXBvcnQgeyB1c2VSb3V0ZXIgfSBmcm9tICduZXh0L3JvdXRlcidcbmltcG9ydCB7IEFjY2VudEltZyB9IGZyb20gJ2NvbXBvbmVudHMvSW1hZ2VzJ1xuaW1wb3J0IHsgVG9kb0xpc3QgfSBmcm9tICdjb21wb25lbnRzL1RvZG9MaXN0J1xuaW1wb3J0IHsgY29ob3J0TmFtZSwgc29ydEJ5RGF0ZUFuZE5hbWUgfSBmcm9tICdzcmMvdXRpbHMnXG5cbmNvbnN0IENPUFkgPSB7XG4gIGN1cnJpY3VsdW1UYWI6IFwiQ3VycmljdWx1bVwiLFxuICBjb2hvcnRUYWI6IFwiQWxsIENvaG9ydHNcIixcbiAgYWN0aXZlQ29ob3J0czogXCJZb3VyIEN1cnJlbnQgQ29ob3J0c1wiLFxuICBzZXR0aW5nczogXCJZb3UgY2FuIGVkaXQgZGV0YWlscywgY3JlYXRlIG5ldyBjb2hvcnRzLCBhbmQgbW9yZS5cIixcbiAgZW5yb2xsQnV0dG9uOiBcIkVucm9sbCBpbiBhIGNvaG9ydFwiLFxuICB1cGRhdGVDdXJyaWN1bHVtOiAocHJvcHM6IHtpZDogc3RyaW5nfSkgPT4gaChJbmZvLCBbXG4gICAgYPCfkqEgWW91IGNhbiBtYWtlIGNoYW5nZXMgdG8gdGhlIGN1cnJpY3VsdW0gYnkgZWRpdGluZyBgLFxuICAgIGgoJ2EnLCB7aHJlZjogYCR7RElTQ09VUlNFX1VSTH0vc2Vzc2lvbi9zc28/cmV0dXJuX3BhdGg9L3QvJHtwcm9wcy5pZH1gfSwgYHRoaXMgdG9waWNgKSxcbiAgICBgIGluIHRoZSBmb3J1bWBcbiAgXSlcbn1cblxudHlwZSBQcm9wcyA9IEluZmVyR2V0U3RhdGljUHJvcHNUeXBlPHR5cGVvZiBnZXRTdGF0aWNQcm9wcz5cblxuY29uc3QgV3JhcHBlZENvdXJzZVBhZ2UgPSAocHJvcHM6IFByb3BzKT0+cHJvcHMubm90Rm91bmQgPyBoKEVycm9yUGFnZSkgOiBoKENvdXJzZVBhZ2UsIHByb3BzKVxuZXhwb3J0IGRlZmF1bHQgV3JhcHBlZENvdXJzZVBhZ2VcblxuY29uc3QgQ291cnNlUGFnZSA9IChwcm9wczpFeHRyYWN0PFByb3BzLCB7bm90Rm91bmQ6IGZhbHNlfT4pID0+IHtcbiAgbGV0IHtkYXRhOiB1c2VyfSA9IHVzZVVzZXJEYXRhKClcbiAgbGV0IHtkYXRhOnVzZXJDb2hvcnRzfSA9IHVzZVVzZXJDb2hvcnRzKClcbiAgbGV0IHtkYXRhOiBjb3Vyc2V9ID0gdXNlQ291cnNlRGF0YShwcm9wcy5pZCwgcHJvcHMuY291cnNlIHx8IHVuZGVmaW5lZClcblxuICBpZighY291cnNlKSByZXR1cm4gaChQYWdlTG9hZGVyKVxuXG4gIGxldCBhY3RpdmVDb2hvcnRzID0gY291cnNlLmNvdXJzZV9jb2hvcnRzXG4gICAgLmZpbHRlcihjID0+IHtcbiAgICAgIGlmKCF1c2VyKSByZXR1cm4gZmFsc2VcbiAgICAgIHJldHVybiBjLmNvbXBsZXRlZCA9PT0gbnVsbCAmJiAoISFjLmNvaG9ydF9mYWNpbGl0YXRvcnMuZmluZChmPT51c2VyJiZmLmZhY2lsaXRhdG9yPT09dXNlci5pZClcbiAgICAgICAgfHwgYy5wZW9wbGVfaW5fY29ob3J0c1xuICAgICAgICAgIC5maW5kKHAgPT4gcC5wZW9wbGUuaWQgPT09ICh1c2VyID8gdXNlci5pZCA6IHVuZGVmaW5lZCkpKVxuICAgIH0pXG4gICAgLnNvcnQoc29ydEJ5RGF0ZUFuZE5hbWUpXG5cbiAgbGV0IGVucm9sbGVkID0gYWN0aXZlQ29ob3J0cy5maWx0ZXIoYz0+IWMuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PnVzZXImJmYuZmFjaWxpdGF0b3I9PT11c2VyLmlkKSkubGVuZ3RoID4gMFxuICBsZXQgdXBjb21pbmdDb2hvcnRzID0gY291cnNlLmNvdXJzZV9jb2hvcnRzLmZpbHRlcihjPT4gKG5ldyBEYXRlKGMuc3RhcnRfZGF0ZSkgPiBuZXcgRGF0ZSgpKSAmJiBjLmxpdmUpLnNvcnQoc29ydEJ5RGF0ZUFuZE5hbWUpXG5cbiAgbGV0IGlzTWFpbnRhaW5lciA9ICEhKGNvdXJzZT8uY291cnNlX21haW50YWluZXJzLmZpbmQobWFpbnRhaW5lciA9PiB1c2VyICYmIG1haW50YWluZXIubWFpbnRhaW5lciA9PT0gdXNlci5pZCkpXG4gIGxldCBpbnZpdGVkID0gISF1c2VyQ29ob3J0cz8uaW52aXRlZF9jb3Vyc2VzLmZpbmQoY291cnNlPT5jb3Vyc2UuaWQgPT09IHByb3BzLmNvdXJzZS5pZCApXG5cbiAgLy9TZXR0aW5nIHVwIHRoZSBsYXlvdXQgZm9yIHRoZSBjb3Vyc2UgcGFnZVxuICByZXR1cm4gaCgnZGl2JywgW1xuICAgIGgoSGVhZCwge2NoaWxkcmVuOiBbXG4gICAgICBoKCdtZXRhJywge3Byb3BlcnR5Olwib2c6dGl0bGVcIiwgY29udGVudDpjb3Vyc2UubmFtZSwga2V5Olwib2c6dGl0bGVcIn0pLFxuICAgICAgaCgnbWV0YScsIHtwcm9wZXJ0eTogXCJvZzpkZXNjcmlwdGlvblwiLCBjb250ZW50OiBjb3Vyc2UuZGVzY3JpcHRpb24sIGtleTogXCJvZzpkZXNjcmlwdGlvblwifSksXG4gICAgICBoKCdtZXRhJywge3Byb3BlcnR5OiBcIm9nOmltYWdlXCIsIGNvbnRlbnQ6IGNvdXJzZS5jYXJkX2ltYWdlLnNwbGl0KCcsJylbMF0sIGtleTogXCJvZzppbWFnZVwifSksXG4gICAgICBoKCdtZXRhJywge3Byb3BlcnR5OiBcInR3aXR0ZXI6Y2FyZFwiLCBjb250ZW50OiBcInN1bW1hcnlcIiwga2V5OlwidHdpdHRlcjpjYXJkXCJ9KVxuICAgIF19KSxcbiAgICBoKEJhbm5lcnMsIHtkcmFmdDogY291cnNlLnN0YXR1cyA9PT0gJ2RyYWZ0JywgaWQ6IHByb3BzLmlkLCBpc01haW50YWluZXIsIHNsdWc6IGNvdXJzZS5zbHVnfSksXG4gICAgaChUd29Db2x1bW4sIFtcbiAgICAgIGgoQm94LCB7Z2FwOiAzMn0sIFtcbiAgICAgICAgaChCb3gsIHtnYXA6IDE2fSwgW1xuICAgICAgICAgIGgoJ2gxJywgY291cnNlPy5uYW1lKSxcbiAgICAgICAgXSksXG4gICAgICAgIGgoJ3AuYmlnJywgY291cnNlPy5kZXNjcmlwdGlvbiB8fCAnJyksXG5cbiAgICAgICAgdXBjb21pbmdDb2hvcnRzLmxlbmd0aCA+IDAgJiYgKGFjdGl2ZUNvaG9ydHMubGVuZ3RoID09PSAwKVxuICAgICAgICAgID8gaChCb3gsIHtwYWRkaW5nOiAzMiwgc3R5bGU6IHtiYWNrZ3JvdW5kQ29sb3I6IGNvbG9ycy5hY2NlbnRQZWFjaH19LFtcbiAgICAgICAgICAgIC4uLnVwY29taW5nQ29ob3J0cy5mbGF0TWFwKGNvaG9ydD0+e1xuICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIGgoQ29ob3J0LCB7XG4gICAgICAgICAgICAgICAgICBjb2hvcnQsXG4gICAgICAgICAgICAgICAgICBlbnJvbGxlZDogZmFsc2UsIGZhY2lsaXRhdGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICBpbnZpdGVkLFxuICAgICAgICAgICAgICAgICAgc2x1ZzogY291cnNlPy5zbHVnIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgY29ob3J0X21heF9zaXplOiBjb3Vyc2U/LmNvaG9ydF9tYXhfc2l6ZSB8fCAwXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgaChTZXBlcmF0b3IpXVxuICAgICAgICAgICAgfSkuc2xpY2UoMCwgLTEpXG4gICAgICAgICAgXSlcbiAgICAgICAgICA6IGFjdGl2ZUNvaG9ydHMubGVuZ3RoID09PSAwID8gbnVsbCA6IGgoQm94LCB7cGFkZGluZzogMzIsIHN0eWxlOiB7YmFja2dyb3VuZENvbG9yOiBjb2xvcnMuZ3JleTk1fX0sIFtcbiAgICAgICAgICAgIGgoJ2gzJywgQ09QWS5hY3RpdmVDb2hvcnRzKSxcbiAgICAgICAgICAgIC4uLmFjdGl2ZUNvaG9ydHMubWFwKGNvaG9ydD0+IGgoU21hbGxDb2hvcnRDYXJkLCB7XG4gICAgICAgICAgICAgIC4uLmNvaG9ydCxcbiAgICAgICAgICAgICAgZmFjaWxpdGF0b3JzOiBjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5tYXAoZj0+Zi5wZW9wbGUuZGlzcGxheV9uYW1lIHx8IGYucGVvcGxlLnVzZXJuYW1lKSxcbiAgICAgICAgICAgICAgY291cnNlczoge1xuICAgICAgICAgICAgICAgIG5hbWU6IGNvdXJzZT8ubmFtZSB8fCAnJyxcbiAgICAgICAgICAgICAgICBzbHVnOiBjb3Vyc2U/LnNsdWcgfHwgJycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZhY2lsaXRhdGluZzogISFjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PnVzZXImJmYuZmFjaWxpdGF0b3I9PT11c2VyLmlkKSxcbiAgICAgICAgICAgICAgZW5yb2xsZWQ6ICFjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PnVzZXImJmYuZmFjaWxpdGF0b3I9PT11c2VyLmlkKVxuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgXSksXG4gICAgICBdKSxcbiAgICAgIGgoVGFicywge3RhYnM6IHtcbiAgICAgICAgW0NPUFkuY3VycmljdWx1bVRhYl06ICBoKEJveCwgW1xuICAgICAgICAgIGlzTWFpbnRhaW5lciA/IGgoQ09QWS51cGRhdGVDdXJyaWN1bHVtLCB7aWQ6IHByb3BzLmNvbnRlbnQuaWR9KSA6IG51bGwsXG4gICAgICAgICAgaChUZXh0LCB7c291cmNlOiBwcm9wcy5jb250ZW50LnRleHR9KVxuICAgICAgICBdKSxcbiAgICAgICAgW0NPUFkuY29ob3J0VGFiXTogaChDb2hvcnRzLHtjb2hvcnRzOiBjb3Vyc2UuY291cnNlX2NvaG9ydHMsIHNsdWc6IGNvdXJzZS5zbHVnLCB1c2VyOiB1c2VyID8gdXNlci5pZCA6ICcnLCBpbnZpdGVkLCBjb2hvcnRfbWF4X3NpemU6IGNvdXJzZT8uY29ob3J0X21heF9zaXplIHx8IDB9KSxcbiAgICAgICAgRmFjaWxpdGF0b3JzOiBoKEJveCwge2dhcDozMn0sIGNvdXJzZS5jb3Vyc2VfbWFpbnRhaW5lcnMubWFwKG1haW50YWluZXI9PntcbiAgICAgICAgICByZXR1cm4gaChCb3gsIHt9LCBbXG4gICAgICAgICAgICBoKCdoMycsIG1haW50YWluZXIucGVvcGxlLmRpc3BsYXlfbmFtZSB8fCBtYWludGFpbmVyLnBlb3BsZS51c2VybmFtZSksXG4gICAgICAgICAgICAhbWFpbnRhaW5lci5wZW9wbGUubGluayA/IG51bGwgOiBoKCdhJywge2hyZWY6IG1haW50YWluZXIucGVvcGxlLmxpbmt9LCBoKCdiJywgbWFpbnRhaW5lci5wZW9wbGUubGluaykpLFxuICAgICAgICAgICAgIW1haW50YWluZXIucGVvcGxlLmJpbyA/IG51bGwgOiBoKEJveCwge3dpZHRoOiA2NDB9LCBoKFRleHQsIHtzb3VyY2U6IG1haW50YWluZXIucGVvcGxlLmJpb30pKVxuICAgICAgICAgIF0pXG4gICAgICAgIH0pKVxuICAgICAgfX0pLFxuICAgICAgaChTaWRlYmFyLCBbXG4gICAgICAgIGgoU3RpY2t5V3JhcHBlciwgW1xuICAgICAgICAgIGgoRW5yb2xsLCB7Y291cnNlfSwgW1xuICAgICAgICAgICAgaChCb3gsIFtcbiAgICAgICAgICAgICAgaChFbnJvbGxTdGF0dXMsIHtcbiAgICAgICAgICAgICAgICBjb3Vyc2VJZDogY291cnNlLmlkLFxuICAgICAgICAgICAgICAgIGNvdXJzZVNsdWc6IGNvdXJzZS5zbHVnLFxuICAgICAgICAgICAgICAgIGRyYWZ0OmNvdXJzZS5zdGF0dXM9PT0nZHJhZnQnLFxuICAgICAgICAgICAgICAgIG1haW50YWluZXI6IGlzTWFpbnRhaW5lcixcbiAgICAgICAgICAgICAgICBpbnZpdGVPbmx5OmNvdXJzZS5pbnZpdGVfb25seSxcbiAgICAgICAgICAgICAgICBpbnZpdGVkLFxuICAgICAgICAgICAgICAgIGxvZ2dlZEluOiAhIXVzZXIsXG4gICAgICAgICAgICAgICAgZW5yb2xsZWQsXG4gICAgICAgICAgICAgICAgdXBjb21pbmc6dXBjb21pbmdDb2hvcnRzLmxlbmd0aCAhPT0gMCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIGgoU2VwZXJhdG9yKSxcbiAgICAgICAgICAgICAgIWlzTWFpbnRhaW5lciA/IGgoV2F0Y2hDb3Vyc2UsIHtpZDogY291cnNlLmlkfSkgOiBoKEJveCwgW1xuICAgICAgICAgICAgICAgIGgoQm94LCB7Z2FwOjh9LCBbXG4gICAgICAgICAgICAgICAgICBoKCdoMycsIGBZb3UgbWFpbnRhaW4gdGhpcyAke2NvdXJzZS50eXBlfWApLFxuICAgICAgICAgICAgICAgICAgaCgncC50ZXh0U2Vjb25kYXJ5JywgQ09QWS5zZXR0aW5ncyksXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgaChMaW5rLCB7aHJlZjonL2NvdXJzZXMvW3NsdWddL1tpZF0vc2V0dGluZ3MnLCBhczpgL2NvdXJzZXMvJHtjb3Vyc2Uuc2x1Z30vJHtjb3Vyc2UuaWR9L3NldHRpbmdzYH0sIGgoRGVzdHJ1Y3RpdmUsICdTZXR0aW5ncycpKVxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgXSlcbiAgICAgICAgICBdKV0pLFxuICAgICAgXSlcbiAgICBdKVxuICBdKVxufVxuXG5mdW5jdGlvbiBFbnJvbGxTdGF0dXMgKHByb3BzOiB7XG4gIGRyYWZ0OmJvb2xlYW4sXG4gIG1haW50YWluZXI6Ym9vbGVhbixcbiAgaW52aXRlT25seTpib29sZWFuLFxuICBpbnZpdGVkOmJvb2xlYW4sXG4gIGxvZ2dlZEluOmJvb2xlYW4sXG4gIGVucm9sbGVkOmJvb2xlYW47XG4gIHVwY29taW5nOmJvb2xlYW47XG4gIGNvdXJzZUlkOm51bWJlcjtcbiAgY291cnNlU2x1ZzpzdHJpbmdcbn0pIHtcbiAgaWYgKHByb3BzLmRyYWZ0KSB7XG4gICAgaWYgKHByb3BzLm1haW50YWluZXIpIHJldHVybiBoKCdzcGFuLmFjY2VudFJlZCcsIFwiTGVhcm5lcnMgY2FuJ3QgZW5yb2xsIGluIHRoaXMgY291cnNlIHVudGlsIHlvdSBwdWJsaXNoIGl0IVwiKVxuICAgIHJldHVybiBoKCdzcGFuLmFjY2VudFJlZCcsIFwiVGhpcyBjb3Vyc2UgaXMgc3RpbGwgYSBkcmFmdC4gWW91IGNhbiBlbnJvbGwgb25jZSB0aGUgY3JlYXRvciBwdWJsaXNoZXMgaXQhXCIpXG4gIH1cblxuICBpZiAocHJvcHMuZW5yb2xsZWQpe1xuICAgIGlmIChwcm9wcy51cGNvbWluZykgcmV0dXJuIGgoJ3NwYW4uYWNjZW50U3VjY2VzcycsIFwiWW91J3JlIGVucm9sbGVkIGluIGFuIHVwY29taW5nIGNvaG9ydC4gRmVlbCBmcmVlIHRvIGVucm9sbCBpbiBhbm90aGVyIG9uZSB0aG91Z2ghXCIpXG4gICAgcmV0dXJuICBoKCdzcGFuLmFjY2VudFN1Y2Nlc3MnLCBcIllvdSdyZSBlbnJvbGxlZCBpbiBhbiB1cGNvbWluZyBjb2hvcnRcIilcbiAgfVxuXG4gIGlmICghcHJvcHMudXBjb21pbmcpIHtcbiAgICBpZihwcm9wcy5tYWludGFpbmVyKSByZXR1cm4gaCgnc3Bhbi5hY2NlbnRSZWQnLCBbXG4gICAgICBcIkxvb2tzIGxpa2UgdGhlcmUgYXJlbid0IGFueSBjb2hvcnRzIHBsYW5uZWQuIENyZWF0ZSBvbmUgXCIsIGgoTGluaywge2hyZWY6IFwiL2NvdXJzZXMvW3NsdWddL1tpZF0vc2V0dGluZ3NcIiwgYXM6IGAvY291cnNlcy8ke3Byb3BzLmNvdXJzZVNsdWd9LyR7cHJvcHMuY291cnNlSWR9L3NldHRpbmdzYH0sIGgoJ2EnLCAnaGVyZScpKSwgJy4nXG4gICAgXSlcbiAgICByZXR1cm4gaCgnc3Bhbi5hY2NlbnRSZWQnLCBcIkxvb2tzIGxpa2UgdGhlcmUgYXJlbid0IGFueSBjb2hvcnRzIHBsYW5uZWQgOihcIilcbiAgfVxuXG4gIGlmIChwcm9wcy5pbnZpdGVPbmx5KSB7XG4gICAgaWYgKHByb3BzLm1haW50YWluZXIpIHJldHVybiBoKCdzcGFuLmFjY2VudFJlZCcsIFtcbiAgICAgIFwiTGVhcm5lcnMgbmVlZCB0byBiZSBpbnZpdGVkIHRvIGVucm9sbC4gSW52aXRlIHNvbWVvbmUgXCIsIGgoTGluaywge2hyZWY6IGAvY291cnNlcy8ke3Byb3BzLmNvdXJzZVNsdWd9LyR7cHJvcHMuY291cnNlSWR9L3NldHRpbmdzYH0sIGgoJ2EnLCAnaGVyZScpKSwgJy4nXSlcbiAgICBpZihwcm9wcy5pbnZpdGVkKSByZXR1cm4gaCgnc3Bhbi5hY2NlbnRTdWNjZXNzJywgXCJZb3UncmUgaW52aXRlZCFcIilcbiAgICBpZihwcm9wcy5sb2dnZWRJbikgcmV0dXJuIGgoJ2RpdicsIHt9LCBoKCdzcGFuLmFjY2VudFJlZCcsIFwiVGhpcyBjb3Vyc2UgaXMgaW52aXRlIG9ubHkuIFJlYWNoIG91dCB0byB0aGUgZmFjaWxpdGF0b3JzIGlmIHlvdSdyZSBpbnRlcmVzdGVkIVwiKSlcbiAgICByZXR1cm4gaCgnZGl2Jywge30sIGgoJ3NwYW4uYWNjZW50UmVkJywgXCJUaGlzIGNvdXJzZSBpcyBpbnZpdGUgb25seS4gSWYgeW91J3ZlIGJlZW4gaW52aXRlZCwgcGxlYXNlIGxvZyBpbi5cIikpXG4gIH1cbiAgcmV0dXJuIG51bGxcbn1cblxuXG5jb25zdCBDb2hvcnRzID0gKHByb3BzOntjb2hvcnRzOiBDb3Vyc2VbJ2NvdXJzZV9jb2hvcnRzJ10sIHVzZXI6IHN0cmluZywgc2x1Zzogc3RyaW5nLCBjb2hvcnRfbWF4X3NpemU6IG51bWJlciwgaW52aXRlZDpib29sZWFufSkgPT4ge1xuICBsZXQgW3Bhc3RDb2hvcnRzLCB1cGNvbWluZ0NvaG9ydHNdID0gcHJvcHMuY29ob3J0c1xuICAuZmlsdGVyKGM9PntcbiAgICBpZihjLmxpdmUpIHJldHVybiB0cnVlXG4gICAgcmV0dXJuICEhYy5jb2hvcnRfZmFjaWxpdGF0b3JzLmZpbmQoZj0+Zi5mYWNpbGl0YXRvcj09PXByb3BzLnVzZXIpXG4gIH0pLnNvcnQoc29ydEJ5RGF0ZUFuZE5hbWUpXG4gICAgLnJlZHVjZSgoYWNjLCBjb2hvcnQpPT57XG4gICAgICBsZXQgZW5yb2xsZWQgPSAhIWNvaG9ydC5wZW9wbGVfaW5fY29ob3J0cy5maW5kKHAgPT4gcC5wZW9wbGUuaWQgPT09IHByb3BzLnVzZXIpXG4gICAgICBsZXQgZmFjaWxpdGF0aW5nID0gISFjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PmYuZmFjaWxpdGF0b3IgPT09IHByb3BzLnVzZXIpXG4gICAgICBhY2NbbmV3IERhdGUoY29ob3J0LnN0YXJ0X2RhdGUpPCBuZXcgRGF0ZSgpID8gMCA6IDFdLnB1c2goXG4gICAgICAgIGgoQ29ob3J0LCB7XG4gICAgICAgICAgY29ob3J0LFxuICAgICAgICAgIGVucm9sbGVkLCBmYWNpbGl0YXRpbmcsXG4gICAgICAgICAgc2x1ZzogcHJvcHMuc2x1ZyxcbiAgICAgICAgICBjb2hvcnRfbWF4X3NpemU6IHByb3BzLmNvaG9ydF9tYXhfc2l6ZSxcbiAgICAgICAgICBpbnZpdGVkOiBwcm9wcy5pbnZpdGVkXG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICByZXR1cm4gYWNjXG4gICAgfSxbW10sW11dIGFzIEFycmF5PEFycmF5PFJlYWN0RWxlbWVudD4+KVxuXG4gIHJldHVybiBoKEJveCwge2dhcDozMn0sIFtcbiAgICB1cGNvbWluZ0NvaG9ydHMubGVuZ3RoID09PSAwID8gbnVsbCA6IGgoJ2gyJywgXCJVcGNvbWluZyBDb2hvcnRzXCIpLFxuICAgIC4uLnVwY29taW5nQ29ob3J0cyxcbiAgICB1cGNvbWluZ0NvaG9ydHMubGVuZ3RoID09PSAwIHx8IHBhc3RDb2hvcnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBoKFNlcGVyYXRvciksXG4gICAgcGFzdENvaG9ydHMubGVuZ3RoID09PSAwID8gbnVsbCA6IGgoJ2gyJywgJ09uZ29pbmcgYW5kIFBhc3QgQ29ob3J0cycpLFxuICAgIC4uLnBhc3RDb2hvcnRzXG4gICAgXSlcbn1cblxuZXhwb3J0IGNvbnN0IENvaG9ydCA9IChwcm9wczoge1xuICBjb2hvcnQ6IENvdXJzZVsnY291cnNlX2NvaG9ydHMnXVswXSxcbiAgZmFjaWxpdGF0aW5nPzogYm9vbGVhbixcbiAgZW5yb2xsZWQ/OiBib29sZWFuLFxuICBzbHVnOnN0cmluZyxcbiAgY29ob3J0X21heF9zaXplOiBudW1iZXIsXG4gIGludml0ZWQ6IGJvb2xlYW5cbn0pID0+IHtcbiAgbGV0IGlkPSBwcm9wcy5jb2hvcnQuaWRcbiAgbGV0IHJvdXRlciA9IHVzZVJvdXRlcigpXG4gIGxldCBwYXN0ID0gbmV3IERhdGUocHJvcHMuY29ob3J0LnN0YXJ0X2RhdGUpIDwgbmV3IERhdGUoKVxuXG4gIHJldHVybiBoKEJveCwge2g6IHRydWUsIHN0eWxlOntncmlkQXV0b0NvbHVtbnM6J2F1dG8nfX0sIFtcbiAgICBoKEJveCwge2dhcDogNH0sIFtcbiAgICAgICFwcm9wcy5lbnJvbGxlZCAmJiAhcHJvcHMuZmFjaWxpdGF0aW5nID8gbnVsbCA6IGgoJ2RpdicsIFtcbiAgICAgICAgcHJvcHMuZW5yb2xsZWQgPyBoKFBpbGwsICdlbnJvbGxlZCcpIDogbnVsbCxcbiAgICAgICAgJyAnLFxuICAgICAgICBwcm9wcy5mYWNpbGl0YXRpbmcgPyBoKFBpbGwsIHtib3JkZXJPbmx5OiB0cnVlfSwgJ2ZhY2lsaXRhdGluZycpIDogbnVsbCxcbiAgICAgICAgJyAnLFxuICAgICAgICAhcHJvcHMuY29ob3J0LmxpdmUgPyBoKFBpbGwsIHtib3JkZXJPbmx5OiB0cnVlLCByZWQ6IHRydWV9LCAnZHJhZnQnKSA6IG51bGwsXG4gICAgICBdKSxcbiAgICAgIGgoJ2gzJywge30sIGgoTGluaywge1xuICAgICAgICBocmVmOicvY291cnNlcy9bc2x1Z10vW2lkXS9jb2hvcnRzL1tjb2hvcnRJZF0nLFxuICAgICAgICBhczogIGAvY291cnNlcy8ke3Byb3BzLnNsdWd9LyR7cHJvcHMuY29ob3J0LmNvdXJzZX0vY29ob3J0cy8ke2lkfWBcbiAgICAgIH0sIGgoJ2EnLCB7c3R5bGU6IHt0ZXh0RGVjb3JhdGlvbjogJ25vbmUnfX0sIGNvaG9ydE5hbWUocHJvcHMuY29ob3J0Lm5hbWUpKSkpLFxuICAgICAgaChCb3gsIHtzdHlsZToge2NvbG9yOiBjb2xvcnMudGV4dFNlY29uZGFyeX0sIGdhcDogNH0sIFtcbiAgICAgICAgaCgnc3Ryb25nJywgY29ob3J0UHJldHR5RGF0ZShwcm9wcy5jb2hvcnQuc3RhcnRfZGF0ZSwgcHJvcHMuY29ob3J0LmNvbXBsZXRlZCkpLFxuICAgICAgICBoKCdkaXYnLCBbXG4gICAgICAgICAgYEZhY2lsaXRhdGVkIGJ5IGAsXG4gICAgICAgICAgLi4ucHJvcHMuY29ob3J0LmNvaG9ydF9mYWNpbGl0YXRvcnMuZmxhdE1hcChmPT57XG4gICAgICAgICAgICByZXR1cm4gW2goTGluaywge2hyZWY6YC9wZW9wbGUvJHtmLnBlb3BsZS51c2VybmFtZX1gfSwgaCgnYScsIGYucGVvcGxlLmRpc3BsYXlfbmFtZSB8fCBmLnBlb3BsZS51c2VybmFtZSkpLCAnLCAnXVxuICAgICAgICAgIH0pLnNsaWNlKDAsIC0xKVxuICAgICAgICBdKVxuICAgICAgXSksXG4gICAgICBwcm9wcy5jb2hvcnRfbWF4X3NpemUgPT09IDAgfHwgcGFzdCA/IG51bGwgOiBwcm9wcy5jb2hvcnRfbWF4X3NpemUgPiBwcm9wcy5jb2hvcnQucGVvcGxlX2luX2NvaG9ydHMubGVuZ3RoXG4gICAgICAgID8gaCgnc3Bhbi5hY2NlbnRTdWNjZXNzJywgYCR7cHJvcHMuY29ob3J0X21heF9zaXplIC0gcHJvcHMuY29ob3J0LnBlb3BsZV9pbl9jb2hvcnRzLmxlbmd0aH0gJHtwcm9wcy5jb2hvcnRfbWF4X3NpemUgLSBwcm9wcy5jb2hvcnQucGVvcGxlX2luX2NvaG9ydHMubGVuZ3RoID09PSAxID8gJ3Nwb3QnIDogJ3Nwb3RzJ30gbGVmdCFgKVxuICAgICAgICA6IGgoJ3NwYW4uYWNjZW50UmVkJywgYFNvcnJ5ISBUaGlzIGNvaG9ydCBpcyBmdWxsLmApXG4gICAgXSksXG4gICAgcGFzdCB8fCBwcm9wcy5lbnJvbGxlZCB8fCBwcm9wcy5mYWNpbGl0YXRpbmcgPyBudWxsIDogaChCb3gsIHtnYXA6OCwgc3R5bGU6IHthbGlnbkl0ZW1zOiAnY2VudGVyJywgYWxpZ25Db250ZW50OiAnY2VudGVyJywganVzdGlmeVNlbGY6ICdyaWdodCcsIHRleHRBbGlnbjogJ3JpZ2h0J319LCBbXG4gICAgICBoKExpbmssIHtcbiAgICAgICAgaHJlZjogYC9jb3Vyc2VzLyR7cm91dGVyLnF1ZXJ5LnNsdWd9LyR7cHJvcHMuY29ob3J0LmNvdXJzZX0vY29ob3J0cy8ke3Byb3BzLmNvaG9ydC5pZH1gXG4gICAgICB9LCBoKCdhJywge30sIGgoUHJpbWFyeSwgJ1NlZSBzY2hlZHVsZScpKSlcbiAgICBdKVxuICBdKVxufVxuLy9mZWF0dXJlIHRvIGFkZCBhIG5ldyBjb2hvcnQgdG8gYSBjb3Vyc2VcbmZ1bmN0aW9uIE1hcmtDb3Vyc2VMaXZlKHByb3BzOiB7aWQ6bnVtYmVyLCBzbHVnOiBzdHJpbmd9KSB7XG4gIGxldCB7ZGF0YTpjb3Vyc2UsIG11dGF0ZX0gPSB1c2VDb3Vyc2VEYXRhKHByb3BzLmlkKVxuICBsZXQgW3N0YXRlLCBzZXRTdGF0ZV0gPSB1c2VTdGF0ZTwnbm9ybWFsJ3wnY29uZmlybSd8J2xvYWRpbmcnfCdjb21wbGV0ZSc+KCdub3JtYWwnKVxuXG4gIGNvbnN0IG9uQ2xpY2sgPSBhc3luYyAoZTogUmVhY3QuTW91c2VFdmVudCkgID0+e1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGlmKCFjb3Vyc2UpIHJldHVyblxuICAgIHNldFN0YXRlKCdsb2FkaW5nJylcbiAgICBsZXQgcmVzID0gYXdhaXQgY2FsbEFwaTxVcGRhdGVDb3Vyc2VNc2csIFVwZGF0ZUNvdXJzZVJlc3BvbnNlPihgL2FwaS9jb3Vyc2VzLyR7cHJvcHMuaWR9YCwge3N0YXR1czogJ2xpdmUnfSlcbiAgICBpZihyZXMuc3RhdHVzPT09MjAwKXtcbiAgICAgIHNldFN0YXRlKCdub3JtYWwnKVxuICAgICAgbXV0YXRlKHsuLi5jb3Vyc2UsIHN0YXR1czogJ2xpdmUnfSlcbiAgICB9XG4gIH1cblxuICBpZihzdGF0ZSA9PT0gJ2NvbmZpcm0nIHx8IHN0YXRlID09PSAnbG9hZGluZycpIHJldHVybiBoKFxuICAgIE1vZGFsLFxuICAgIHsgZGlzcGxheTogdHJ1ZSwgY2xvc2VUZXh0OiBcIm5ldmVybWluZFwiLCBvbkV4aXQ6ICgpID0+IHNldFN0YXRlKFwibm9ybWFsXCIpIH0sXG4gICAgW1xuICAgICAgaChCb3gsIHsgZ2FwOiAzMiB9LCBbXG4gICAgICAgIGgoXCJoMlwiLCB7IHN0eWxlOiB7IHRleHRBbGlnbjogXCJjZW50ZXJcIiB9IH0sIFwiQXJlIHlvdSBzdXJlP1wiKSxcbiAgICAgICAgaChCb3gsIHsgZ2FwOiAxNiB9LCBbXG4gICAgICAgICAgXCJCZWZvcmUgZ29pbmcgbGl2ZSBwbGVhc2UgY2hlY2sgdGhhdCB5b3UndmUgZG9uZSB0aGVzZSB0aGluZ3NcIixcbiAgICAgICAgICBoKEJveC53aXRoQ29tcG9uZW50KFwidWxcIiksIHsgZ2FwOiAxNiB9LCBbXG4gICAgICAgICAgICBoKFwibGlcIiwgW1xuICAgICAgICAgICAgICBcIkVkaXQgaW1wb3J0YW50IGRldGFpbHMgaW4gXCIsXG4gICAgICAgICAgICAgIGgoXG4gICAgICAgICAgICAgICAgXCJhXCIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgaHJlZjogYGh0dHBzOi8vYXBwLmtyYWtlbmVkdS5jb20vY291cnNlcy8ke3Byb3BzLnNsdWd9LyR7cHJvcHMuaWR9L3NldHRpbmdzP3RhYj1EZXRhaWxzYCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwiY291cnNlIHNldHRpbmdzXCJcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgXCIuXCIsXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGgoXCJsaVwiLCBbXG4gICAgICAgICAgICAgIFwiV3JpdHRlbiBhIFwiLFxuICAgICAgICAgICAgICBoKFxuICAgICAgICAgICAgICAgIFwiYVwiLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGhyZWY6IGAke0RJU0NPVVJTRV9VUkx9L3Nlc3Npb24vc3NvP3JldHVybl9wYXRoPS90LyR7cHJvcHMuaWR9YCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwiY3VycmljdWx1bVwiXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIFwiLlwiLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgaChcbiAgICAgICAgICAgIFByaW1hcnksXG4gICAgICAgICAgICB7IHN0eWxlOiB7IGp1c3RpZnlTZWxmOiBcImNlbnRlclwiIH0sIG9uQ2xpY2sgfSxcbiAgICAgICAgICAgIHN0YXRlID09PSBcImxvYWRpbmdcIiA/IGgoTG9hZGVyKSA6IFwiR28gTGl2ZSFcIlxuICAgICAgICAgICksXG4gICAgICAgIF0pLFxuICAgICAgXSksXG4gICAgXVxuICApO1xuXG4gIHJldHVybiBoKFByaW1hcnksIHtvbkNsaWNrOiBhc3luYyBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBzZXRTdGF0ZSgnY29uZmlybScpXG4gIH19LCBcIlB1Ymxpc2ghXCIpXG59XG5cbi8vIEZlYXR1cmUgdG8gZWRpdCBjb3Vyc2UgZGV0YWlsIChsZW5ndGgsIHByZXJlcXMsIG9uZSBsaW5lIGRlc2NyaXB0aW9uKVxuXG5cblxuLy8gRGVmaW5lIEJhbm5lcnNcbmNvbnN0IEJhbm5lcnMgPSAocHJvcHM6e2RyYWZ0OiBib29sZWFuLCBpZDogbnVtYmVyLCBzbHVnOnN0cmluZywgaXNNYWludGFpbmVyOiBib29sZWFufSkgPT4ge1xuICBpZihwcm9wcy5kcmFmdCAmJiBwcm9wcy5pc01haW50YWluZXIpIHtcbiAgICBpZihwcm9wcy5pc01haW50YWluZXIpe1xuICAgICAgcmV0dXJuIGgoVE9ET0Jhbm5lciwgcHJvcHMpXG4gICAgfVxuICAgIHJldHVybiBoKFR3b0NvbHVtbkJhbm5lciwge3JlZDogdHJ1ZX0sIGgoQm94LCB7Z2FwOjE2fSxbXG4gICAgICBoKEJveCwge2dhcDoxNn0sIFtcbiAgICAgICAgaCgnaDMnLCBcIlRoaXMgY291cnNlIGlzbid0IGxpdmUgeWV0IVwiKSxcbiAgICAgICAgaCgncCcsW2BUaGUgbWFpbnRhaW5lciBpcyBzdGlsbCB3b3JraW5nIG9uIGdldHRpbmcgdGhpcyBjb3Vyc2UgaW4gc2hhcGUuIExldCB0aGVtIGtub3dcbmlmIHlvdSBoYXZlIGFueSBmZWVkYmFjayFgXSlcbiAgICAgIF0pXG4gICAgXSkpXG4gIH1cbiAgcmV0dXJuIG51bGxcbn1cblxuLy8gRHJhZnQgQ291cnNlIFRvRG8gQmFubmVyXG5jb25zdCBUT0RPQmFubmVyID0gKHByb3BzOntcbiAgaWQ6bnVtYmVyXG4gIHNsdWc6c3RyaW5nXG59KSA9PiB7XG4gIGxldCBbZXhwYW5kZWQsIHNldEV4cGFuZGVkXSA9IHVzZVN0YXRlKGZhbHNlKVxuXG4gIHJldHVybiBoKFR3b0NvbHVtbkJhbm5lciwge3JlZDogdHJ1ZX0sIFtcbiAgICBoKEJhbm5lckNvbnRlbnQsIFtcbiAgICAgIGgoQWNjZW50SW1nLCB7aGVpZ2h0OjMyLCB3aWR0aDozNiwgc3JjOlwiaHR0cHM6Ly9oeXBlcmxpbmstZGF0YS5ueWMzLmNkbi5kaWdpdGFsb2NlYW5zcGFjZXMuY29tL2ljb25zL1NlZWRsaW5nLnBuZ1wifSksXG4gICAgICBoKEJveCwge2dhcDo4fSwgW1xuICAgICAgICBoKCdoNCcsIFwiVGhpcyBjb3Vyc2UgaXMgc3RpbGwgYSBkcmFmdFwiKSxcbiAgICAgICAgaCgncCcsICdJdOKAmXMgaGlkZGVuIGZyb20gcHVibGljIHZpZXcuIFBlb3BsZSBjYW7igJl0IHNlZSB0aGlzIHBhZ2UgdW50aWwgeW91IHB1Ymxpc2ggaXQuJylcbiAgICAgIF0pLFxuICAgICAgLi4uICFleHBhbmRlZCA/IFtdIDogW1xuICAgICAgICBoKEFjY2VudEltZywge2hlaWdodDozMiwgd2lkdGg6MzYsIHNyYzpcImh0dHBzOi8vaHlwZXJsaW5rLWRhdGEubnljMy5jZG4uZGlnaXRhbG9jZWFuc3BhY2VzLmNvbS9pY29ucy9CdWQucG5nXCJ9KSxcbiAgICAgICAgaChCb3gsIHtnYXA6MTZ9LCBbXG4gICAgICAgICAgaCgnaDQnLCBcIkJlZm9yZSB5b3UgcHVibGlzaCB0aGlzIGNvdXJzZSBtYWtlIHN1cmUgdGhhdCB5b3UgLi4uICBcIiksXG4gICAgICAgICAgaChUb2RvTGlzdCwge1xuICAgICAgICAgICAgcGVyc2lzdEtleTogXCJjb3Vyc2UtY3JlYXRpb24tdG9kb1wiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgaChcInNwYW5cIiwgW1xuICAgICAgICAgICAgICAgIFwiRWRpdCBpbXBvcnRhbnQgZGV0YWlscywgbGlrZSBkZXNjcmlwdGlvbiBhbmQgcHJpY2UsIGluIFwiLCBoKCdhJywge2hyZWY6IGBodHRwczovL2FwcC5rcmFrZW5lZHUuY29tL2NvdXJzZXMvJHtwcm9wcy5zbHVnfS8ke3Byb3BzLmlkfS9zZXR0aW5ncz90YWI9RGV0YWlsc2B9LCBcImNvdXJzZSBzZXR0aW5nc1wiKSwgXCIuXCJcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIGgoXCJzcGFuXCIsIFtcbiAgICAgICAgICAgICAgICBcIldyaXRlIGEgY29tcHJlaGVuc2l2ZSBjdXJyaWN1bHVtIGZvciB5b3VyIGNvdXJzZSwgYnkgZWRpdGluZyB0aGUgXCIsIGgoJ2EnLCB7aHJlZjogYCR7RElTQ09VUlNFX1VSTH0vc2Vzc2lvbi9zc28/cmV0dXJuX3BhdGg9L3QvJHtwcm9wcy5pZH1gfSwgXCJDdXJyaWN1bHVtIHRvcGljXCIpLCBcIiBpbiB0aGUgZm9ydW0uXCJcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIGgoXCJzcGFuXCIsIFtcbiAgICAgICAgICAgICAgICBcIkNyZWF0ZSBvciBlZGl0IFwiLCBoKCdhJywge2hyZWY6IGBodHRwczovL2FwcC5rcmFrZW5lZHUuY29tL2NvdXJzZXMvJHtwcm9wcy5zbHVnfS8ke3Byb3BzLmlkfS9zZXR0aW5ncz90YWI9VGVtcGxhdGVzYH0sIFwidGVtcGxhdGVzXCIpLCBcIiBmb3IgcmV1c2FibGUgZm9ydW0gdG9waWNzIHNvIHlvdSBkb24ndCBuZWVkIHRvIHJld3JpdGUgdGhlbSBmb3IgZXZlcnkgY29ob3J0IHlvdSBydW4gKG9yIHlvdSBjYW4gYWRkIHRoZXNlIGxhdGVyKS5cIlxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgaChcInNwYW5cIiwgW1xuICAgICAgICAgICAgICAgIFwiQ3JlYXRlIHlvdXIgZmlyc3QgY29ob3J0LCBpbiBcIiwgaCgnYScsIHtocmVmOiBgaHR0cHM6Ly9hcHAua3Jha2VuZWR1LmNvbS9jb3Vyc2VzLyR7cHJvcHMuc2x1Z30vJHtwcm9wcy5pZH0vc2V0dGluZ3M/dGFiPUNvaG9ydHNgfSwgXCJjb3Vyc2Ugc2V0dGluZ3NcIiksIFwiLiBJdCB3aWxsIGFsc28gYmUgYSBkcmFmdCB0aGF0IHlvdSBuZWVkIHRvIGVkaXQgYmVmb3JlIHB1Ymxpc2hpbmcuIFdlJ2xsIGd1aWRlIHlvdSB0aHJvdWdoIGl0IVwiXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfSlcbiAgICAgICAgXSksXG4gICAgICAgIGgoQWNjZW50SW1nLCB7aGVpZ2h0OjMyLCB3aWR0aDozNiwgc3JjOlwiaHR0cHM6Ly9oeXBlcmxpbmstZGF0YS5ueWMzLmNkbi5kaWdpdGFsb2NlYW5zcGFjZXMuY29tL2ljb25zL0Zsb3dlci5wbmdcIn0pLFxuICAgICAgICBoKEJveCwge2dhcDoxNn0sIFtcbiAgICAgICAgICBoKCdoNCcsIFwiT25jZSB5b3UncmUgcmVhZHksIHlvdSBjYW4gcHVibGlzaCBpdCBoZXJlIVwiKSxcbiAgICAgICAgICBoKE1hcmtDb3Vyc2VMaXZlLCBwcm9wcylcbiAgICAgICAgXSlcbiAgICAgIF1cbiAgICBdKSxcbiAgICBoKExpbmtCdXR0b24sIHtzdHlsZTp7anVzdGlmeVNlbGY6ICdyaWdodCcsIHRleHREZWNvcmF0aW9uOiAnbm9uZSd9LCBvbkNsaWNrOiAoKT0+c2V0RXhwYW5kZWQoIWV4cGFuZGVkKX0sIGV4cGFuZGVkID8gXCJoaWRlIGNoZWNrbGlzdFwiIDogXCJzaG93IGNoZWNrbGlzdFwiKVxuICBdKVxufVxuXG5leHBvcnQgY29uc3QgZ2V0U3RhdGljUHJvcHMgPSBhc3luYyAoY3R4OmFueSkgPT4ge1xuICBsZXQgaWQgPSBwYXJzZUludChjdHgucGFyYW1zPy5pZCBhcyBzdHJpbmcgfHwgJycgKVxuICBpZihOdW1iZXIuaXNOYU4oaWQpKSByZXR1cm4ge3Byb3BzOiB7bm90Rm91bmQ6IHRydWV9fSBhcyBjb25zdFxuXG4gIGxldCBkYXRhID0gYXdhaXQgY291cnNlRGF0YVF1ZXJ5KGlkKVxuICBpZighZGF0YSkgcmV0dXJuIHtwcm9wczp7bm90Rm91bmQ6IHRydWV9fSBhcyBjb25zdFxuICBsZXQgY29udGVudCA9IGF3YWl0IGdldFRhZ2dlZFBvc3QoZGF0YS5jYXRlZ29yeV9pZCwgJ2N1cnJpY3VsdW0nKVxuXG4gIHJldHVybiB7cHJvcHM6IHtub3RGb3VuZDogZmFsc2UsIGNvbnRlbnQsIGlkLCBjb3Vyc2U6IGRhdGF9LCByZXZhbGlkYXRlOiAxfSBhcyBjb25zdFxufVxuXG5leHBvcnQgY29uc3QgZ2V0U3RhdGljUGF0aHMgPSBhc3luYyAoKSA9PiB7XG5cbiAgbGV0IGNvdXJzZXMgPSBhd2FpdCBwcmlzbWEuY291cnNlcy5maW5kTWFueSh7c2VsZWN0OntpZDogdHJ1ZSwgc2x1ZzogdHJ1ZX19KVxuICByZXR1cm4ge3BhdGhzOmNvdXJzZXMubWFwKGNvdXJzZT0+e1xuICAgIHJldHVybiB7cGFyYW1zOiB7aWQ6IGNvdXJzZS5pZC50b1N0cmluZygpLCBzbHVnOiBjb3Vyc2Uuc2x1Z319XG4gIH0pLCBmYWxsYmFjazogdHJ1ZX1cbn1cblxuXG5jb25zdCBCYW5uZXJDb250ZW50ID0gc3R5bGVkKCdkaXYnKSBgXG5kaXNwbGF5OiBncmlkOyBcbmdyaWQtdGVtcGxhdGUtY29sdW1uczogbWluLWNvbnRlbnQgYXV0bztcbmdyaWQtY29sdW1uLWdhcDogMTZweDtcbmdyaWQtcm93LWdhcDogMzJweDtcbmBcbiJdfQ== */\",\n  toString: _EMOTION_STRINGIFIED_CSS_ERROR__\n});","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/pages/courses/[slug]/[id]/index.ts"],"names":["h","useState","Link","Box","Seperator","TwoColumn","Sidebar","Tabs","StickyWrapper","colors","Loader","PageLoader","Info","Pill","Enroll","Text","SmallCohortCard","TwoColumnBanner","Modal","Primary","Destructive","LinkButton","WatchCourse","DISCOURSE_URL","useUserData","useUserCohorts","useCourseData","callApi","cohortPrettyDate","ErrorPage","Head","useRouter","AccentImg","TodoList","cohortName","sortByDateAndName","COPY","curriculumTab","cohortTab","activeCohorts","settings","enrollButton","updateCurriculum","props","href","id","WrappedCoursePage","notFound","CoursePage","user","data","userCohorts","course","undefined","course_cohorts","filter","c","completed","cohort_facilitators","find","f","facilitator","people_in_cohorts","p","people","sort","enrolled","length","upcomingCohorts","Date","start_date","live","isMaintainer","course_maintainers","maintainer","invited","invited_courses","children","property","content","name","key","description","card_image","split","Banners","draft","status","slug","gap","padding","style","backgroundColor","accentPeach","flatMap","cohort","Cohort","facilitating","cohort_max_size","slice","grey95","map","facilitators","display_name","username","courses","tabs","source","text","Cohorts","cohorts","link","bio","width","EnrollStatus","courseId","courseSlug","inviteOnly","invite_only","loggedIn","upcoming","type","as","reduce","acc","push","pastCohorts","router","past","gridAutoColumns","borderOnly","red","textDecoration","color","textSecondary","alignItems","alignContent","justifySelf","textAlign","query","MarkCourseLive","mutate","state","setState","onClick","e","preventDefault","res","display","closeText","onExit","withComponent","TODOBanner","expanded","setExpanded","BannerContent","height","src","persistKey","items"],"mappings":"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","sourcesContent":["import h from 'react-hyperscript'\nimport { useState, ReactElement } from 'react'\nimport Link from 'next/link'\nimport { InferGetStaticPropsType } from 'next'\nimport styled from '@emotion/styled'\nimport prisma from \"lib/prisma\";\nimport { Box, Seperator, TwoColumn, Sidebar } from 'components/Layout'\nimport {Tabs, StickyWrapper} from 'components/Tabs'\nimport { colors } from 'components/Tokens'\nimport Loader, { PageLoader } from 'components/Loader'\nimport { Info } from 'components/Form'\nimport {Pill} from 'components/Pill'\nimport Enroll from 'components/Course/Enroll'\nimport Text from 'components/Text'\nimport {SmallCohortCard} from 'components/Cards/SmallCohortCard'\nimport {TwoColumnBanner} from 'components/Banner'\nimport {Modal} from 'components/Modal'\nimport { Primary, Destructive, LinkButton} from 'components/Button'\nimport {WatchCourse} from 'components/Course/WatchCourse'\n\nimport { getTaggedPost } from 'src/discourse'\nimport {DISCOURSE_URL} from 'src/constants'\nimport { useUserData, useUserCohorts, useCourseData, Course } from 'src/data'\nimport { UpdateCourseMsg, UpdateCourseResponse} from 'pages/api/courses/[id]'\nimport { callApi } from 'src/apiHelpers'\nimport { cohortPrettyDate } from 'components/Cards/CohortCard'\nimport ErrorPage from 'pages/404'\nimport { courseDataQuery } from 'pages/api/courses/[id]'\nimport Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport { AccentImg } from 'components/Images'\nimport { TodoList } from 'components/TodoList'\nimport { cohortName, sortByDateAndName } from 'src/utils'\n\nconst COPY = {\n  curriculumTab: \"Curriculum\",\n  cohortTab: \"All Cohorts\",\n  activeCohorts: \"Your Current Cohorts\",\n  settings: \"You can edit details, create new cohorts, and more.\",\n  enrollButton: \"Enroll in a cohort\",\n  updateCurriculum: (props: {id: string}) => h(Info, [\n    `💡 You can make changes to the curriculum by editing `,\n    h('a', {href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`}, `this topic`),\n    ` in the forum`\n  ])\n}\n\ntype Props = InferGetStaticPropsType<typeof getStaticProps>\n\nconst WrappedCoursePage = (props: Props)=>props.notFound ? h(ErrorPage) : h(CoursePage, props)\nexport default WrappedCoursePage\n\nconst CoursePage = (props:Extract<Props, {notFound: false}>) => {\n  let {data: user} = useUserData()\n  let {data:userCohorts} = useUserCohorts()\n  let {data: course} = useCourseData(props.id, props.course || undefined)\n\n  if(!course) return h(PageLoader)\n\n  let activeCohorts = course.course_cohorts\n    .filter(c => {\n      if(!user) return false\n      return c.completed === null && (!!c.cohort_facilitators.find(f=>user&&f.facilitator===user.id)\n        || c.people_in_cohorts\n          .find(p => p.people.id === (user ? user.id : undefined)))\n    })\n    .sort(sortByDateAndName)\n\n  let enrolled = activeCohorts.filter(c=>!c.cohort_facilitators.find(f=>user&&f.facilitator===user.id)).length > 0\n  let upcomingCohorts = course.course_cohorts.filter(c=> (new Date(c.start_date) > new Date()) && c.live).sort(sortByDateAndName)\n\n  let isMaintainer = !!(course?.course_maintainers.find(maintainer => user && maintainer.maintainer === user.id))\n  let invited = !!userCohorts?.invited_courses.find(course=>course.id === props.course.id )\n\n  //Setting up the layout for the course page\n  return h('div', [\n    h(Head, {children: [\n      h('meta', {property:\"og:title\", content:course.name, key:\"og:title\"}),\n      h('meta', {property: \"og:description\", content: course.description, key: \"og:description\"}),\n      h('meta', {property: \"og:image\", content: course.card_image.split(',')[0], key: \"og:image\"}),\n      h('meta', {property: \"twitter:card\", content: \"summary\", key:\"twitter:card\"})\n    ]}),\n    h(Banners, {draft: course.status === 'draft', id: props.id, isMaintainer, slug: course.slug}),\n    h(TwoColumn, [\n      h(Box, {gap: 32}, [\n        h(Box, {gap: 16}, [\n          h('h1', course?.name),\n        ]),\n        h('p.big', course?.description || ''),\n\n        upcomingCohorts.length > 0 && (activeCohorts.length === 0)\n          ? h(Box, {padding: 32, style: {backgroundColor: colors.accentPeach}},[\n            ...upcomingCohorts.flatMap(cohort=>{\n              return [\n                h(Cohort, {\n                  cohort,\n                  enrolled: false, facilitating: false,\n                  invited,\n                  slug: course?.slug || '',\n                  cohort_max_size: course?.cohort_max_size || 0\n                }),\n                h(Seperator)]\n            }).slice(0, -1)\n          ])\n          : activeCohorts.length === 0 ? null : h(Box, {padding: 32, style: {backgroundColor: colors.grey95}}, [\n            h('h3', COPY.activeCohorts),\n            ...activeCohorts.map(cohort=> h(SmallCohortCard, {\n              ...cohort,\n              facilitators: cohort.cohort_facilitators.map(f=>f.people.display_name || f.people.username),\n              courses: {\n                name: course?.name || '',\n                slug: course?.slug || '',\n              },\n              facilitating: !!cohort.cohort_facilitators.find(f=>user&&f.facilitator===user.id),\n              enrolled: !cohort.cohort_facilitators.find(f=>user&&f.facilitator===user.id)\n            }))\n          ]),\n      ]),\n      h(Tabs, {tabs: {\n        [COPY.curriculumTab]:  h(Box, [\n          isMaintainer ? h(COPY.updateCurriculum, {id: props.content.id}) : null,\n          h(Text, {source: props.content.text})\n        ]),\n        [COPY.cohortTab]: h(Cohorts,{cohorts: course.course_cohorts, slug: course.slug, user: user ? user.id : '', invited, cohort_max_size: course?.cohort_max_size || 0}),\n        Facilitators: h(Box, {gap:32}, course.course_maintainers.map(maintainer=>{\n          return h(Box, {}, [\n            h('h3', maintainer.people.display_name || maintainer.people.username),\n            !maintainer.people.link ? null : h('a', {href: maintainer.people.link}, h('b', maintainer.people.link)),\n            !maintainer.people.bio ? null : h(Box, {width: 640}, h(Text, {source: maintainer.people.bio}))\n          ])\n        }))\n      }}),\n      h(Sidebar, [\n        h(StickyWrapper, [\n          h(Enroll, {course}, [\n            h(Box, [\n              h(EnrollStatus, {\n                courseId: course.id,\n                courseSlug: course.slug,\n                draft:course.status==='draft',\n                maintainer: isMaintainer,\n                inviteOnly:course.invite_only,\n                invited,\n                loggedIn: !!user,\n                enrolled,\n                upcoming:upcomingCohorts.length !== 0,\n              }),\n              h(Seperator),\n              !isMaintainer ? h(WatchCourse, {id: course.id}) : h(Box, [\n                h(Box, {gap:8}, [\n                  h('h3', `You maintain this ${course.type}`),\n                  h('p.textSecondary', COPY.settings),\n                ]),\n                h(Link, {href:'/courses/[slug]/[id]/settings', as:`/courses/${course.slug}/${course.id}/settings`}, h(Destructive, 'Settings'))\n              ])\n            ])\n          ])]),\n      ])\n    ])\n  ])\n}\n\nfunction EnrollStatus (props: {\n  draft:boolean,\n  maintainer:boolean,\n  inviteOnly:boolean,\n  invited:boolean,\n  loggedIn:boolean,\n  enrolled:boolean;\n  upcoming:boolean;\n  courseId:number;\n  courseSlug:string\n}) {\n  if (props.draft) {\n    if (props.maintainer) return h('span.accentRed', \"Learners can't enroll in this course until you publish it!\")\n    return h('span.accentRed', \"This course is still a draft. You can enroll once the creator publishes it!\")\n  }\n\n  if (props.enrolled){\n    if (props.upcoming) return h('span.accentSuccess', \"You're enrolled in an upcoming cohort. Feel free to enroll in another one though!\")\n    return  h('span.accentSuccess', \"You're enrolled in an upcoming cohort\")\n  }\n\n  if (!props.upcoming) {\n    if(props.maintainer) return h('span.accentRed', [\n      \"Looks like there aren't any cohorts planned. Create one \", h(Link, {href: \"/courses/[slug]/[id]/settings\", as: `/courses/${props.courseSlug}/${props.courseId}/settings`}, h('a', 'here')), '.'\n    ])\n    return h('span.accentRed', \"Looks like there aren't any cohorts planned :(\")\n  }\n\n  if (props.inviteOnly) {\n    if (props.maintainer) return h('span.accentRed', [\n      \"Learners need to be invited to enroll. Invite someone \", h(Link, {href: `/courses/${props.courseSlug}/${props.courseId}/settings`}, h('a', 'here')), '.'])\n    if(props.invited) return h('span.accentSuccess', \"You're invited!\")\n    if(props.loggedIn) return h('div', {}, h('span.accentRed', \"This course is invite only. Reach out to the facilitators if you're interested!\"))\n    return h('div', {}, h('span.accentRed', \"This course is invite only. If you've been invited, please log in.\"))\n  }\n  return null\n}\n\n\nconst Cohorts = (props:{cohorts: Course['course_cohorts'], user: string, slug: string, cohort_max_size: number, invited:boolean}) => {\n  let [pastCohorts, upcomingCohorts] = props.cohorts\n  .filter(c=>{\n    if(c.live) return true\n    return !!c.cohort_facilitators.find(f=>f.facilitator===props.user)\n  }).sort(sortByDateAndName)\n    .reduce((acc, cohort)=>{\n      let enrolled = !!cohort.people_in_cohorts.find(p => p.people.id === props.user)\n      let facilitating = !!cohort.cohort_facilitators.find(f=>f.facilitator === props.user)\n      acc[new Date(cohort.start_date)< new Date() ? 0 : 1].push(\n        h(Cohort, {\n          cohort,\n          enrolled, facilitating,\n          slug: props.slug,\n          cohort_max_size: props.cohort_max_size,\n          invited: props.invited\n        })\n      )\n      return acc\n    },[[],[]] as Array<Array<ReactElement>>)\n\n  return h(Box, {gap:32}, [\n    upcomingCohorts.length === 0 ? null : h('h2', \"Upcoming Cohorts\"),\n    ...upcomingCohorts,\n    upcomingCohorts.length === 0 || pastCohorts.length === 0 ? null : h(Seperator),\n    pastCohorts.length === 0 ? null : h('h2', 'Ongoing and Past Cohorts'),\n    ...pastCohorts\n    ])\n}\n\nexport const Cohort = (props: {\n  cohort: Course['course_cohorts'][0],\n  facilitating?: boolean,\n  enrolled?: boolean,\n  slug:string,\n  cohort_max_size: number,\n  invited: boolean\n}) => {\n  let id= props.cohort.id\n  let router = useRouter()\n  let past = new Date(props.cohort.start_date) < new Date()\n\n  return h(Box, {h: true, style:{gridAutoColumns:'auto'}}, [\n    h(Box, {gap: 4}, [\n      !props.enrolled && !props.facilitating ? null : h('div', [\n        props.enrolled ? h(Pill, 'enrolled') : null,\n        ' ',\n        props.facilitating ? h(Pill, {borderOnly: true}, 'facilitating') : null,\n        ' ',\n        !props.cohort.live ? h(Pill, {borderOnly: true, red: true}, 'draft') : null,\n      ]),\n      h('h3', {}, h(Link, {\n        href:'/courses/[slug]/[id]/cohorts/[cohortId]',\n        as:  `/courses/${props.slug}/${props.cohort.course}/cohorts/${id}`\n      }, h('a', {style: {textDecoration: 'none'}}, cohortName(props.cohort.name)))),\n      h(Box, {style: {color: colors.textSecondary}, gap: 4}, [\n        h('strong', cohortPrettyDate(props.cohort.start_date, props.cohort.completed)),\n        h('div', [\n          `Facilitated by `,\n          ...props.cohort.cohort_facilitators.flatMap(f=>{\n            return [h(Link, {href:`/people/${f.people.username}`}, h('a', f.people.display_name || f.people.username)), ', ']\n          }).slice(0, -1)\n        ])\n      ]),\n      props.cohort_max_size === 0 || past ? null : props.cohort_max_size > props.cohort.people_in_cohorts.length\n        ? h('span.accentSuccess', `${props.cohort_max_size - props.cohort.people_in_cohorts.length} ${props.cohort_max_size - props.cohort.people_in_cohorts.length === 1 ? 'spot' : 'spots'} left!`)\n        : h('span.accentRed', `Sorry! This cohort is full.`)\n    ]),\n    past || props.enrolled || props.facilitating ? null : h(Box, {gap:8, style: {alignItems: 'center', alignContent: 'center', justifySelf: 'right', textAlign: 'right'}}, [\n      h(Link, {\n        href: `/courses/${router.query.slug}/${props.cohort.course}/cohorts/${props.cohort.id}`\n      }, h('a', {}, h(Primary, 'See schedule')))\n    ])\n  ])\n}\n//feature to add a new cohort to a course\nfunction MarkCourseLive(props: {id:number, slug: string}) {\n  let {data:course, mutate} = useCourseData(props.id)\n  let [state, setState] = useState<'normal'|'confirm'|'loading'|'complete'>('normal')\n\n  const onClick = async (e: React.MouseEvent)  =>{\n    e.preventDefault()\n    if(!course) return\n    setState('loading')\n    let res = await callApi<UpdateCourseMsg, UpdateCourseResponse>(`/api/courses/${props.id}`, {status: 'live'})\n    if(res.status===200){\n      setState('normal')\n      mutate({...course, status: 'live'})\n    }\n  }\n\n  if(state === 'confirm' || state === 'loading') return h(\n    Modal,\n    { display: true, closeText: \"nevermind\", onExit: () => setState(\"normal\") },\n    [\n      h(Box, { gap: 32 }, [\n        h(\"h2\", { style: { textAlign: \"center\" } }, \"Are you sure?\"),\n        h(Box, { gap: 16 }, [\n          \"Before going live please check that you've done these things\",\n          h(Box.withComponent(\"ul\"), { gap: 16 }, [\n            h(\"li\", [\n              \"Edit important details in \",\n              h(\n                \"a\",\n                {\n                  href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Details`,\n                },\n                \"course settings\"\n              ),\n              \".\",\n            ]),\n            h(\"li\", [\n              \"Written a \",\n              h(\n                \"a\",\n                {\n                  href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`,\n                },\n                \"curriculum\"\n              ),\n              \".\",\n            ]),\n          ]),\n          h(\n            Primary,\n            { style: { justifySelf: \"center\" }, onClick },\n            state === \"loading\" ? h(Loader) : \"Go Live!\"\n          ),\n        ]),\n      ]),\n    ]\n  );\n\n  return h(Primary, {onClick: async e => {\n    e.preventDefault()\n    setState('confirm')\n  }}, \"Publish!\")\n}\n\n// Feature to edit course detail (length, prereqs, one line description)\n\n\n\n// Define Banners\nconst Banners = (props:{draft: boolean, id: number, slug:string, isMaintainer: boolean}) => {\n  if(props.draft && props.isMaintainer) {\n    if(props.isMaintainer){\n      return h(TODOBanner, props)\n    }\n    return h(TwoColumnBanner, {red: true}, h(Box, {gap:16},[\n      h(Box, {gap:16}, [\n        h('h3', \"This course isn't live yet!\"),\n        h('p',[`The maintainer is still working on getting this course in shape. Let them know\nif you have any feedback!`])\n      ])\n    ]))\n  }\n  return null\n}\n\n// Draft Course ToDo Banner\nconst TODOBanner = (props:{\n  id:number\n  slug:string\n}) => {\n  let [expanded, setExpanded] = useState(false)\n\n  return h(TwoColumnBanner, {red: true}, [\n    h(BannerContent, [\n      h(AccentImg, {height:32, width:36, src:\"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Seedling.png\"}),\n      h(Box, {gap:8}, [\n        h('h4', \"This course is still a draft\"),\n        h('p', 'It’s hidden from public view. People can’t see this page until you publish it.')\n      ]),\n      ... !expanded ? [] : [\n        h(AccentImg, {height:32, width:36, src:\"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Bud.png\"}),\n        h(Box, {gap:16}, [\n          h('h4', \"Before you publish this course make sure that you ...  \"),\n          h(TodoList, {\n            persistKey: \"course-creation-todo\",\n            items: [\n              h(\"span\", [\n                \"Edit important details, like description and price, in \", h('a', {href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Details`}, \"course settings\"), \".\"\n              ]),\n              h(\"span\", [\n                \"Write a comprehensive curriculum for your course, by editing the \", h('a', {href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`}, \"Curriculum topic\"), \" in the forum.\"\n              ]),\n              h(\"span\", [\n                \"Create or edit \", h('a', {href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Templates`}, \"templates\"), \" for reusable forum topics so you don't need to rewrite them for every cohort you run (or you can add these later).\"\n              ]),\n              h(\"span\", [\n                \"Create your first cohort, in \", h('a', {href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Cohorts`}, \"course settings\"), \". It will also be a draft that you need to edit before publishing. We'll guide you through it!\"\n              ])\n            ]\n          })\n        ]),\n        h(AccentImg, {height:32, width:36, src:\"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Flower.png\"}),\n        h(Box, {gap:16}, [\n          h('h4', \"Once you're ready, you can publish it here!\"),\n          h(MarkCourseLive, props)\n        ])\n      ]\n    ]),\n    h(LinkButton, {style:{justifySelf: 'right', textDecoration: 'none'}, onClick: ()=>setExpanded(!expanded)}, expanded ? \"hide checklist\" : \"show checklist\")\n  ])\n}\n\nexport const getStaticProps = async (ctx:any) => {\n  let id = parseInt(ctx.params?.id as string || '' )\n  if(Number.isNaN(id)) return {props: {notFound: true}} as const\n\n  let data = await courseDataQuery(id)\n  if(!data) return {props:{notFound: true}} as const\n  let content = await getTaggedPost(data.category_id, 'curriculum')\n\n  return {props: {notFound: false, content, id, course: data}, revalidate: 1} as const\n}\n\nexport const getStaticPaths = async () => {\n\n  let courses = await prisma.courses.findMany({select:{id: true, slug: true}})\n  return {paths:courses.map(course=>{\n    return {params: {id: course.id.toString(), slug: course.slug}}\n  }), fallback: true}\n}\n\n\nconst BannerContent = styled('div') `\ndisplay: grid; \ngrid-template-columns: min-content auto;\ngrid-column-gap: 16px;\ngrid-row-gap: 32px;\n`\n"]},"metadata":{},"sourceType":"module"}