{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport h from 'react-hyperscript';\nimport { useRouter } from \"next/router\";\nimport { useEffect } from 'react';\nimport { getDiscounts, setDiscounts } from 'src/clientData';\nimport { Box } from 'components/Layout';\nimport Link from 'next/link';\nimport Head from 'next/head';\nimport { PageLoader } from 'components/Loader';\n\nvar DiscountPage = function DiscountPage(props) {\n  var router = useRouter();\n  var fullyRedeemed = !props.discount ? false : props.discount.max_redeems !== 0 && props.discount.max_redeems <= props.discount.redeems;\n  useEffect(function () {\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var discounts;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!props.discount || fullyRedeemed)) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              discounts = getDiscounts();\n              setDiscounts([].concat(_toConsumableArray(discounts.filter(function (d) {\n                return d.course !== props.discount.course;\n              })), [_objectSpread(_objectSpread({}, props.discount), {}, {\n                date_added: new Date().toISOString()\n              })]));\n\n              if (props.discount.courses.type === 'club') {\n                router.push(\"/courses/\".concat(props.discount.courses.slug, \"/\").concat(props.discount.courses.id, \"/cohorts/\").concat(props.discount.courses.course_cohorts[0].id));\n              } else {\n                router.push('/courses/[slug]/[id]', \"/courses/\".concat(props.discount.courses.slug, \"/\").concat(props.discount.courses.id));\n              }\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  }, [props.discount]);\n  if (!props.discount) return h(Box, {\n    style: {\n      textAlign: \"center\"\n    }\n  }, [h('h2', \"Sorry \"), h('p.big', 'That discount code is invalid'), h(Link, {\n    href: '/'\n  }, h('a', \"take me to the homepage\"))]);\n  return h('div', [h(Head, {\n    children: [h('meta', {\n      key: \"og:titile\",\n      property: \"og:title\",\n      content: props.discount.courses.name\n    }), h('meta', {\n      key: \"og:description\",\n      property: \"og:description\",\n      content: props.discount.courses.description\n    }), h('meta', {\n      key: \"og:image\",\n      property: \"og:image\",\n      content: props.discount.courses.card_image.split(',')[0]\n    }), h('meta', {\n      key: \"twitter:card\",\n      property: \"twitter:card\",\n      content: \"summary\"\n    })]\n  }), fullyRedeemed ? h(Box, {\n    style: {\n      textAlign: \"center\"\n    }\n  }, [h('h2', \"Sorry\"), h('p.big', 'That discount code has been fully used up'), h(Link, {\n    href: '/'\n  }, h('a', \"take me to the homepage\"))]) : h(PageLoader)]);\n};\n\nexport var __N_SSP = true;\nexport default DiscountPage;","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/pages/discount.ts"],"names":["h","useRouter","useEffect","getDiscounts","setDiscounts","Box","Link","Head","PageLoader","DiscountPage","props","router","fullyRedeemed","discount","max_redeems","redeems","discounts","filter","d","course","date_added","Date","toISOString","courses","type","push","slug","id","course_cohorts","style","textAlign","href","children","key","property","content","name","description","card_image","split"],"mappings":"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","sourcesContent":["import h from 'react-hyperscript'\nimport { useRouter } from \"next/router\"\nimport { useEffect } from 'react'\nimport {getDiscounts, setDiscounts} from 'src/clientData'\nimport { Box } from 'components/Layout'\nimport Link from 'next/link'\nimport Head from 'next/head'\nimport { InferGetServerSidePropsType } from 'next'\nimport { PageLoader } from 'components/Loader'\nimport { getDiscountQuery } from './api/discounts/[code]'\n\ntype Props = InferGetServerSidePropsType<typeof getServerSideProps>\nconst DiscountPage = (props:Props)=>{\n  let router= useRouter()\n  let fullyRedeemed = !props.discount ? false : props.discount.max_redeems !== 0 && props.discount.max_redeems <= props.discount.redeems\n  useEffect(()=>{\n    (async function(){\n      if(!props.discount || fullyRedeemed) return\n      let discounts = getDiscounts()\n      setDiscounts([...discounts.filter(d=> d.course !== props.discount.course), {\n        ...props.discount,\n        date_added: new Date().toISOString(),\n      }])\n      if(props.discount.courses.type==='club') {\n        router.push(`/courses/${props.discount.courses.slug}/${props.discount.courses.id}/cohorts/${props.discount.courses.course_cohorts[0].id}`)\n      }\n      else {\n        router.push('/courses/[slug]/[id]', `/courses/${props.discount.courses.slug}/${props.discount.courses.id}`)\n      }\n    })()\n  }, [props.discount])\n\n  if(!props.discount) return h(Box, {style: {textAlign:\"center\"}},[\n    h('h2', \"Sorry \"),\n    h('p.big', 'That discount code is invalid'),\n    h(Link, {href: '/'}, h('a', \"take me to the homepage\"))\n  ])\n\n  return  h('div', [\n    h(Head, {children: [\n      h('meta', {key:\"og:titile\", property:\"og:title\", content:props.discount.courses.name}),\n      h('meta', {key: \"og:description\", property: \"og:description\", content: props.discount.courses.description}),\n      h('meta', {key: \"og:image\",property: \"og:image\", content: props.discount.courses.card_image.split(',')[0]}),\n      h('meta', {key:\"twitter:card\", property: \"twitter:card\", content: \"summary\"})\n    ]}),\n    fullyRedeemed ? h(Box, {style: {textAlign: \"center\"}}, [\n      h('h2', \"Sorry\"),\n      h('p.big', 'That discount code has been fully used up'),\n      h(Link, {href: '/'}, h('a', \"take me to the homepage\"))\n    ]) : h(PageLoader),\n  ])\n}\nexport default DiscountPage\n\nexport const getServerSideProps = async (ctx:any) => {\n  let code = ctx.query.discount\n  let discount = await getDiscountQuery(code)\n  if(!discount || discount.deleted) return {props:{discount: undefined}} as const\n  return {props:{discount}} as const\n}\n"]},"metadata":{},"sourceType":"module"}