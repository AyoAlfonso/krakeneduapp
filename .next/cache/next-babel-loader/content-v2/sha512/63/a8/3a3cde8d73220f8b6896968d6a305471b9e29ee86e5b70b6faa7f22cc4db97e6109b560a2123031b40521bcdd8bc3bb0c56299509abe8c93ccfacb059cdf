{"ast":null,"code":"import _styled from \"@emotion/styled-base\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _EMOTION_STRINGIFIED_CSS_ERROR__() { return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\"; }\n\nimport h from 'react-hyperscript';\nimport { useRouter } from 'next/router';\nimport Link from 'next/link';\nimport { useState, useEffect, Fragment } from 'react';\nimport { Tabs } from 'components/Tabs';\nimport { useApi, callApi } from 'src/apiHelpers';\nimport { useCourseData, useUserData } from 'src/data';\nimport { PageLoader } from 'components/Loader';\nimport { Box, Seperator, LabelBox, FormBox } from 'components/Layout';\nimport { Info, Error, Select, Input, Textarea, CheckBox } from 'components/Form';\nimport { Primary, Destructive, Secondary, BackButton, IconButton } from 'components/Button';\nimport { Discounts } from 'components/pages/courses/settings/Discounts';\nimport ErrorPage from 'pages/404';\nimport { useDebouncedEffect, useFormData } from 'src/hooks';\nimport { courseDataQuery } from 'pages/api/courses/[id]';\nimport { Modal } from 'components/Modal';\nimport { getTaggedPost } from 'src/discourse';\nimport { Cohort } from '..';\nimport { IconPicker } from 'components/IconPicker';\nimport { Cross } from 'components/Icons';\nimport { Pill } from 'components/Pill';\nconst COPY = {\n  cancelCohort: h(\"p.textSecondary\", [`Contact us at `, h(\"a\", {\n    href: \"mailto:contact@krakenedu.com\"\n  }, `contact@krakenedu.com`), ` to cancel a cohort. Optionally,  let us know the reason youâ€™re cancelling (weâ€™re curious ðŸ¤“)`])\n};\n\nconst WrappedCourseSettingsPage = props => props.notFound ? h(ErrorPage) : h(CourseSettings, props);\n\nfunction CourseSettings(props) {\n  let {\n    data: course,\n    mutate\n  } = useCourseData(props.id, props.course || undefined);\n  let {\n    data: user\n  } = useUserData();\n  let router = useRouter();\n  useEffect(() => {\n    if (user === undefined) return;\n\n    if (course) {\n      let isMaintainer = !!course.course_maintainers.find(maintainer => user && maintainer.maintainer === user.id);\n      if (!isMaintainer) router.push('/');\n    }\n  }, [user, course]);\n  if (!course || !user) return h(PageLoader);\n  return h(Box, {\n    gap: 64,\n    width: 640\n  }, [h(Box, {\n    gap: 16\n  }, [h(BackButton, {\n    href: \"/courses/[slug]/[id]\",\n    as: `/courses/${router.query.slug}/${router.query.id}`\n  }, course.type === \"club\" ? \"Club\" : \"Course\"), h(\"h1\", \"Settings\"), h(\"p.big\", [`KrakenEdu is new and some things can only be done manually for now! To add a new maintainer, remove a cohort, or anything else you don't see here, please email `, h(\"a\", {\n    href: \"mailto:help@krakenedu.com\"\n  }, \"help@krakenedu.com\")])]), h(Tabs, {\n    tabs: {\n      Cohorts: h(CohortSettings, {\n        course,\n        mutate\n      }),\n      Details: h(EditDetails, {\n        course,\n        mutate\n      }),\n      Invites: h(Invites, {\n        course,\n        mutate\n      }),\n      Templates: h(CourseTemplates, {\n        course,\n        mutate\n      }),\n      Discounts: h(Discounts, {\n        course: course.id\n      })\n    }\n  })]);\n}\n\nexport default WrappedCourseSettingsPage;\n\nfunction CohortSettings(props) {\n  let {\n    data: user\n  } = useUserData();\n  return h(Box, {\n    gap: 32\n  }, [h(AddCohort, props), h(Seperator), h(Box, {\n    gap: 16\n  }, [h('h3', \"Cancel a Cohort\"), COPY.cancelCohort]), h(Box, [h('h3', \"All Cohorts\"), h(Box, {\n    gap: 32\n  }, props.course.course_cohorts.map(cohort => {\n    let facilitating = !!cohort.cohort_facilitators.find(f => user && f.facilitator === user.id);\n    return h(Cohort, {\n      cohort,\n      enrolled: false,\n      facilitating,\n      slug: props.course.slug,\n      cohort_max_size: props.course.cohort_max_size,\n      invited: true\n    });\n  }))])]);\n} //feature to add a new cohort to a course\n\n\nconst AddCohort = props => {\n  let {\n    0: newCohort,\n    1: setNewCohort\n  } = useState({\n    start_date: '',\n    start_time: '',\n    facilitators: []\n  });\n  let [status, callCreateCohort] = useApi([newCohort]);\n  let timezone = new Date().toLocaleDateString('en-us', {\n    timeZoneName: \"short\"\n  }).split(', ')[1];\n\n  const onSubmit = async e => {\n    e.preventDefault();\n    let date = newCohort.start_date.split('-').map(x => parseInt(x));\n    let time = newCohort.start_time.split(':').map(x => parseInt(x));\n    let start = new Date(date[0], date[1] - 1, date[2], time[0], time[1]);\n    let res = await callCreateCohort(`/api/cohorts`, {\n      courseId: props.course.id,\n      facilitators: newCohort.facilitators,\n      start: start.toISOString()\n    });\n    if (res.status === 200) props.mutate(_objectSpread(_objectSpread({}, props.course), {}, {\n      course_cohorts: [...props.course.course_cohorts, _objectSpread(_objectSpread({}, res.result), {}, {\n        people_in_cohorts: [],\n        courses: {\n          name: props.course.name\n        }\n      })]\n    }));\n  };\n\n  return h(FormBox, {\n    onSubmit,\n    gap: 32,\n    style: {\n      width: 400\n    }\n  }, [h('h2', 'Add a new Cohort'), status === 'error' ? h(Error, 'An error occured') : null, status === 'success' ? h(Info, 'Cohort created!') : null, h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Facilitator\"), h(Select, {\n    required: true,\n    onChange: e => setNewCohort(_objectSpread(_objectSpread({}, newCohort), {}, {\n      facilitators: [...newCohort.facilitators, e.currentTarget.value]\n    }))\n  }, [h('option', {\n    value: ''\n  }, \"Select a facilitator\"), ...(props.course.course_maintainers.map(maintainer => {\n    return h('option', {\n      value: maintainer.maintainer\n    }, maintainer.people.display_name || maintainer.people.username);\n  }) || [])]), h(Box, {\n    h: true\n  }, newCohort.facilitators.map(f => {\n    let facilitator = props.course.course_maintainers.find(m => m.maintainer === f);\n    if (!facilitator) return null;\n    return h(Pill, {}, h(Box, {\n      h: true,\n      gap: 4\n    }, [h('p', facilitator.people.display_name || facilitator.people.username), h(IconButton, {\n      onClick: e => {\n        e.preventDefault();\n        setNewCohort(_objectSpread(_objectSpread({}, newCohort), {}, {\n          facilitators: newCohort.facilitators.filter(f2 => f2 !== f)\n        }));\n      }\n    }, h(Cross, {\n      width: 10,\n      height: 10\n    }))]));\n  }))]), h(Box, {\n    h: true,\n    gap: 32\n  }, [h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Start Date'), h(Input, {\n    type: 'date',\n    placeholder: 'yyyy-mm-dd',\n    required: true,\n    value: newCohort.start_date,\n    onChange: e => setNewCohort(_objectSpread(_objectSpread({}, newCohort), {}, {\n      start_date: e.currentTarget.value\n    }))\n  })]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', `Start time (${timezone})`), h(Input, {\n    type: 'time',\n    placeholder: '23:59',\n    required: true,\n    value: newCohort.start_time,\n    onChange: e => setNewCohort(_objectSpread(_objectSpread({}, newCohort), {}, {\n      start_time: e.currentTarget.value\n    }))\n  })])]), h(Primary, {\n    style: {\n      justifySelf: 'right'\n    },\n    status,\n    type: 'submit',\n    success: status === 'success',\n    disabled: !newCohort.start_date || newCohort.facilitators.length === 0\n  }, 'Add a new Cohort')]);\n};\n\nconst Invites = props => {\n  let {\n    0: emailOrUsername,\n    1: setEmailOrUsername\n  } = useState('');\n  let {\n    0: invite_only,\n    1: setInviteOnly\n  } = useState(props.course.invite_only);\n  let {\n    0: valid,\n    1: setValid\n  } = useState(null);\n  let [status, callInviteToCourse] = useApi([emailOrUsername], () => setEmailOrUsername(''));\n  let [updateStatus, callUpdateCourse] = useApi([]);\n  useDebouncedEffect(async () => {\n    if (emailOrUsername.includes('@') || emailOrUsername === '') return setValid(null);\n    let res = await callApi('/api/get/username/' + emailOrUsername);\n    if (res.status === 404) setValid(false);else setValid(true);\n  }, 500, [emailOrUsername]);\n  useEffect(() => setValid(null), [emailOrUsername]);\n\n  let onSubmitInvite = async e => {\n    e.preventDefault();\n    let x = emailOrUsername.includes('@') ? {\n      email: emailOrUsername\n    } : {\n      username: emailOrUsername\n    };\n    callInviteToCourse(`/api/courses/${props.course.id}/invite`, _objectSpread({}, x));\n  };\n\n  let onSubmitToggleInviteOnly = async e => {\n    e.preventDefault();\n    let res = await callUpdateCourse(`/api/courses/${props.course.id}`, {\n      invite_only\n    });\n    if (res.status === 200) props.mutate(_objectSpread(_objectSpread({}, props.course), res.result));\n  };\n\n  return h(Box, {\n    gap: 16,\n    width: 400\n  }, [h(\"h2\", \"Invites\"), h(Box, {\n    gap: 32\n  }, [h(FormBox, {\n    onSubmit: onSubmitToggleInviteOnly\n  }, [h(LabelBox, {\n    gap: 8,\n    width: 400\n  }, [h(\"div\", [h(\"h4\", \"Invite Only\"), h(\"small.textSecondary\", `Learners cannot enroll in an invite only course unless you have sent them an\ninvite. The invite allows them enroll in any cohort and does not expire.`)]), h(CheckBox, [h(Input, {\n    type: \"checkbox\",\n    checked: invite_only,\n    onChange: e => setInviteOnly(e.currentTarget.checked)\n  }), \"Make this course invite only\"])]), h(Primary, {\n    style: {\n      justifySelf: \"right\"\n    },\n    status: updateStatus,\n    type: \"submit\",\n    disabled: props.course.invite_only === invite_only\n  }, \"Change\")]), !props.course.invite_only ? null : h(FormBox, {\n    onSubmit: onSubmitInvite,\n    gap: 32,\n    width: 400\n  }, [h(LabelBox, {\n    gap: 8\n  }, [h(\"h4\", \"Invite someone to enroll\"), h(\"small.textSecondary\", `Invite someone with their username or email. Invitee does not need a KrakenEdu account to be invited, but they will need an account to enroll.`), h(Input, {\n    type: emailOrUsername.includes(\"@\") ? \"email\" : \"text\",\n    value: emailOrUsername,\n    onChange: e => setEmailOrUsername(e.currentTarget.value)\n  }), valid === null ? null : valid ? h(\"span.accentSuccess\", \"Great, found @\" + emailOrUsername) : h(\"span.accentRed\", \"We can't find a user with that username\")]), h(Primary, {\n    style: {\n      justifySelf: \"right\"\n    },\n    status,\n    type: \"submit\",\n    disabled: !emailOrUsername.includes(\"@\") && valid !== true\n  }, \"Invite\")])])]);\n};\n\nconst EditDetails = props => {\n  let {\n    state,\n    form,\n    changed,\n    reset,\n    setState\n  } = useFormData({\n    name: props.course.name,\n    card_image: props.course.card_image,\n    cohort_max_size: props.course.cohort_max_size,\n    description: props.course.description,\n    prerequisites: props.course.prerequisites,\n    cost: props.course.cost,\n    duration: props.course.duration\n  }, [props.course]);\n  let [status, callUpdateCourse] = useApi([]);\n\n  const onSubmit = async e => {\n    e.preventDefault();\n    let res = await callUpdateCourse(`/api/courses/${props.course.id}`, _objectSpread({}, state));\n    if (res.status === 200) props.mutate(_objectSpread(_objectSpread({}, props.course), res.result));\n  };\n\n  return h(FormBox, {\n    onSubmit,\n    gap: 32,\n    style: {\n      width: 400\n    }\n  }, [h('h2', 'Edit Details'), h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Name'), h(Input, _objectSpread({\n    type: 'text',\n    maxLength: 50\n  }, form.name))]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Cost (USD)'), h(Input, _objectSpread({\n    type: 'number'\n  }, form.cost))]), props.course.type === 'course' ? null : h(Box, [h(\"div\", [h('h4', \"Emojis\"), h('small.textSecondary', \"Select three emojis to describe your club! Repeats ok.\")]), h(IconPicker, {\n    icons: state.card_image.split(','),\n    setIcons: icons => {\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        card_image: icons.join(',')\n      }));\n    }\n  })]), h(LabelBox, {\n    gap: 8\n  }, [h('div', [h('h4', \"Cohort Size\"), h('small.textSecondary', \"How many learners can enroll in a cohort. Set to 0 for no limit.\")]), h(Input, _objectSpread({\n    type: 'number',\n    required: true\n  }, form.cohort_max_size))]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Description'), h(Textarea, _objectSpread({\n    maxLength: 200\n  }, form.description))]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Prerequisites'), h(Textarea, form.prerequisites)]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Duration'), h(Input, form.duration)]), h(SubmitButtons, [h(Destructive, {\n    disabled: !changed,\n    onClick: e => {\n      e.preventDefault();\n      reset();\n    }\n  }, \"Discard Changes\"), h(Primary, {\n    type: 'submit',\n    disabled: !changed,\n    status\n  }, 'Save Changes')]), h(Maintainers, props)]);\n};\n\nfunction Maintainers(props) {\n  let {\n    0: newMaintainer,\n    1: setNewMaintainer\n  } = useState('');\n  return h(Box, [h('h3', \"Maintainers\"), ...props.course.course_maintainers.map(m => {\n    return m.people.display_name || m.people.username;\n  }), h('h4', \"Add a maintainer\"), h(FormBox, [h(Input, {\n    value: newMaintainer,\n    onChange: e => setNewMaintainer(e.currentTarget.value)\n  }), h(Primary, {\n    type: 'submit'\n  }, \"Add\")])]);\n}\n\nfunction CourseTemplates(props) {\n  return h(Box, {\n    gap: 32\n  }, [h(Box, [h('p', `Each cohort comes with its own community space, and templates to help you populate its structure with topics.`), h('ul', {\n    style: {\n      'margin': 'auto 0'\n    }\n  }, [h('li', [h('b', 'Prepopulated'), h('span', ' topics are automatically posted when each new cohort is created')]), h('li', [h('b', 'Triggered'), h('span', ' topics can be posted by the facilitator from the cohort settings (editable before publishing, so useful for creating multiple topics from one template)')])]), h('p', `You can edit the default templates we've provided below, or add new ones!`), h(Link, {\n    href: '/courses/[slug]/[id]/settings/templates/[templateId]',\n    as: `/courses/${props.course.slug}/${props.course.id}/settings/templates/new`\n  }, h('a', {}, h(Primary, \"+ Add A New Template\")))]), h(Box, {}, props.course.course_templates.sort((a, b) => a.name > b.name ? 1 : -1).sort(a => a.required ? -1 : 1).flatMap(template => {\n    return [h(Box, {\n      h: true,\n      style: {\n        gridAutoColumns: 'auto'\n      }\n    }, [h('div', [h('h3', template.name), h('span.textSecondary', template.type === 'prepopulated' ? \"Prepopulated for all cohorts\" : \"Manually published by facilitator\")]), h(Box, {\n      h: true,\n      style: {\n        justifySelf: 'end',\n        alignItems: 'center'\n      }\n    }, [template.required ? null : h(DeleteTemplate, {\n      course: props.course,\n      mutate: props.mutate,\n      templateName: template.name\n    }), h(Link, {\n      href: '/courses/[slug]/[id]/settings/templates/[templateId]',\n      as: `/courses/${props.course.slug}/${props.course.id}/settings/templates/${template.name}`\n    }, h('a', {}, h(Secondary, 'Edit')))])]), h(Seperator)];\n  }).slice(0, -1))]);\n}\n\nfunction DeleteTemplate(props) {\n  let {\n    0: state,\n    1: setState\n  } = useState('normal');\n  let [status, callDelete] = useApi([props]);\n  return h(Fragment, [h(Destructive, {\n    onClick: () => setState('confirm')\n  }, 'Delete'), h(Modal, {\n    display: state !== 'normal',\n    closeText: \"nevermind\",\n    onExit: () => setState('normal')\n  }, [h(Box, {\n    gap: 32,\n    style: {\n      textAlign: 'center'\n    }\n  }, [h('h3', \"Are you sure?\"), h('p', \"You can't undo this action!\"), h(Primary, {\n    style: {\n      justifySelf: \"center\"\n    },\n    status,\n    onClick: async () => {\n      let res = await callDelete(`/api/courses/${props.course.id}/templates/${props.templateName}`, null, \"DELETE\");\n\n      if (res.status === 200) {\n        props.mutate(_objectSpread(_objectSpread({}, props.course), {}, {\n          course_templates: props.course.course_templates.filter(t => t.name !== props.templateName)\n        }));\n        setState('normal');\n      }\n    }\n  }, \"Yup delete it\")])])]);\n}\n\nconst SubmitButtons = /*#__PURE__*/_styled('div', {\n  target: \"efhwjq20\"\n})(true ? {\n  name: \"1mxcumu\",\n  styles: \"justify-self:right;display:grid;grid-template-columns:auto auto;grid-gap:16px;\"\n} : {\n  name: \"1mxcumu\",\n  styles: \"justify-self:right;display:grid;grid-template-columns:auto auto;grid-gap:16px;\",\n  map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9heW9vbHV3YWFsZm9uc28vY29kZS9rcmFrZW5lZHVhcHAvcGFnZXMvY291cnNlcy9bc2x1Z10vW2lkXS9zZXR0aW5ncy9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF3Y21DIiwiZmlsZSI6Ii9Vc2Vycy9heW9vbHV3YWFsZm9uc28vY29kZS9rcmFrZW5lZHVhcHAvcGFnZXMvY291cnNlcy9bc2x1Z10vW2lkXS9zZXR0aW5ncy9pbmRleC50cyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBoIGZyb20gJ3JlYWN0LWh5cGVyc2NyaXB0J1xuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAnbmV4dC9yb3V0ZXInXG5pbXBvcnQgTGluayBmcm9tICduZXh0L2xpbmsnXG5pbXBvcnQgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0LCBGcmFnbWVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgSW5mZXJHZXRTdGF0aWNQcm9wc1R5cGUgfSBmcm9tICduZXh0J1xuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnXG5cbmltcG9ydCB7IFRhYnMgfSBmcm9tICdjb21wb25lbnRzL1RhYnMnXG5pbXBvcnQgeyB1c2VBcGksIGNhbGxBcGkgfSBmcm9tICdzcmMvYXBpSGVscGVycydcbmltcG9ydCB7IENvdXJzZSwgdXNlQ291cnNlRGF0YSwgdXNlVXNlckRhdGEgfSBmcm9tICdzcmMvZGF0YSdcbmltcG9ydCB7IFBhZ2VMb2FkZXIgfSBmcm9tICdjb21wb25lbnRzL0xvYWRlcidcbmltcG9ydCB7IEJveCwgU2VwZXJhdG9yLCBMYWJlbEJveCwgRm9ybUJveCB9IGZyb20gJ2NvbXBvbmVudHMvTGF5b3V0J1xuaW1wb3J0IHsgSW5mbywgRXJyb3IsIFNlbGVjdCwgSW5wdXQsIFRleHRhcmVhLCBDaGVja0JveCB9IGZyb20gJ2NvbXBvbmVudHMvRm9ybSdcbmltcG9ydCB7IFByaW1hcnksIERlc3RydWN0aXZlLCBTZWNvbmRhcnksIEJhY2tCdXR0b24sIEljb25CdXR0b24gfSBmcm9tICdjb21wb25lbnRzL0J1dHRvbidcbmltcG9ydCB7RGlzY291bnRzfSBmcm9tICdjb21wb25lbnRzL3BhZ2VzL2NvdXJzZXMvc2V0dGluZ3MvRGlzY291bnRzJ1xuaW1wb3J0IEVycm9yUGFnZSBmcm9tICdwYWdlcy80MDQnXG5pbXBvcnQgeyB1c2VEZWJvdW5jZWRFZmZlY3QsIHVzZUZvcm1EYXRhIH0gZnJvbSAnc3JjL2hvb2tzJ1xuaW1wb3J0IHsgY291cnNlRGF0YVF1ZXJ5LCBVcGRhdGVDb3Vyc2VNc2csIFVwZGF0ZUNvdXJzZVJlc3BvbnNlIH0gZnJvbSAncGFnZXMvYXBpL2NvdXJzZXMvW2lkXSdcbmltcG9ydCB7IENoZWNrVXNlcm5hbWVSZXN1bHQgfSBmcm9tICdwYWdlcy9hcGkvZ2V0L1suLi5pdGVtXSdcbmltcG9ydCB7IENyZWF0ZUNvaG9ydE1zZywgQ3JlYXRlQ29ob3J0UmVzcG9uc2UgfSBmcm9tICdwYWdlcy9hcGkvY29ob3J0cydcbmltcG9ydCB7IEludml0ZVRvQ291cnNlTXNnLCBJbnZpdGVUb0NvdXJzZVJlc3BvbnNlIH0gZnJvbSAncGFnZXMvYXBpL2NvdXJzZXMvW2lkXS9pbnZpdGUnXG5pbXBvcnQgeyBNb2RhbCB9IGZyb20gJ2NvbXBvbmVudHMvTW9kYWwnXG5pbXBvcnQgeyBEZWxldGVUZW1wbGF0ZVJlc3VsdCB9IGZyb20gJ3BhZ2VzL2FwaS9jb3Vyc2VzL1tpZF0vdGVtcGxhdGVzL1t0ZW1wbGF0ZUlkXSdcbmltcG9ydCB7IGdldFRhZ2dlZFBvc3QgfSBmcm9tICdzcmMvZGlzY291cnNlJ1xuaW1wb3J0IHsgQ29ob3J0IH0gZnJvbSAnLi4nXG5pbXBvcnQgeyBJY29uUGlja2VyIH0gZnJvbSAnY29tcG9uZW50cy9JY29uUGlja2VyJ1xuaW1wb3J0IHsgQ3Jvc3MgfSBmcm9tICdjb21wb25lbnRzL0ljb25zJ1xuaW1wb3J0IHsgUGlsbCB9IGZyb20gJ2NvbXBvbmVudHMvUGlsbCdcblxuY29uc3QgQ09QWSA9IHtcbiAgY2FuY2VsQ29ob3J0OiBoKFwicC50ZXh0U2Vjb25kYXJ5XCIsIFtcbiAgICBgQ29udGFjdCB1cyBhdCBgLFxuICAgIGgoXCJhXCIsIHsgaHJlZjogXCJtYWlsdG86Y29udGFjdEBrcmFrZW5lZHUuY29tXCIgfSwgYGNvbnRhY3RAa3Jha2VuZWR1LmNvbWApLFxuICAgIGAgdG8gY2FuY2VsIGEgY29ob3J0LiBPcHRpb25hbGx5LCAgbGV0IHVzIGtub3cgdGhlIHJlYXNvbiB5b3XigJlyZSBjYW5jZWxsaW5nICh3ZeKAmXJlIGN1cmlvdXMg8J+kkylgLFxuICBdKSxcbn07XG5cbnR5cGUgUHJvcHMgPSBJbmZlckdldFN0YXRpY1Byb3BzVHlwZTx0eXBlb2YgZ2V0U3RhdGljUHJvcHM+XG5jb25zdCBXcmFwcGVkQ291cnNlU2V0dGluZ3NQYWdlID0gKHByb3BzOiBQcm9wcyk9PnByb3BzLm5vdEZvdW5kID8gaChFcnJvclBhZ2UpIDogaChDb3Vyc2VTZXR0aW5ncywgcHJvcHMpXG5mdW5jdGlvbiBDb3Vyc2VTZXR0aW5ncyhwcm9wczpFeHRyYWN0PFByb3BzLCB7bm90Rm91bmQ6ZmFsc2V9Pil7XG4gIGxldCB7ZGF0YTogY291cnNlLCBtdXRhdGV9ID0gdXNlQ291cnNlRGF0YShwcm9wcy5pZCwgcHJvcHMuY291cnNlIHx8IHVuZGVmaW5lZClcbiAgbGV0IHtkYXRhOiB1c2VyfSA9IHVzZVVzZXJEYXRhKClcbiAgbGV0IHJvdXRlciA9IHVzZVJvdXRlcigpXG5cbiAgdXNlRWZmZWN0KCgpPT57XG4gICAgaWYodXNlciA9PT0gdW5kZWZpbmVkKSByZXR1cm5cbiAgICBpZihjb3Vyc2UpIHtcbiAgICAgIGxldCBpc01haW50YWluZXIgPSAhIShjb3Vyc2UuY291cnNlX21haW50YWluZXJzLmZpbmQobWFpbnRhaW5lciA9PiB1c2VyICYmIG1haW50YWluZXIubWFpbnRhaW5lciA9PT0gdXNlci5pZCkpXG4gICAgICBpZighaXNNYWludGFpbmVyKSByb3V0ZXIucHVzaCgnLycpXG4gICAgfVxuICB9LCBbdXNlciwgY291cnNlXSlcbiAgaWYoIWNvdXJzZSB8fCAhdXNlcikgcmV0dXJuIGgoUGFnZUxvYWRlcilcblxuICByZXR1cm4gaChCb3gsIHsgZ2FwOiA2NCwgd2lkdGg6IDY0MCB9LCBbXG4gICAgaChCb3gsIHsgZ2FwOiAxNiB9LCBbXG4gICAgICBoKFxuICAgICAgICBCYWNrQnV0dG9uLFxuICAgICAgICB7XG4gICAgICAgICAgaHJlZjogXCIvY291cnNlcy9bc2x1Z10vW2lkXVwiLFxuICAgICAgICAgIGFzOiBgL2NvdXJzZXMvJHtyb3V0ZXIucXVlcnkuc2x1Z30vJHtyb3V0ZXIucXVlcnkuaWR9YCxcbiAgICAgICAgfSxcbiAgICAgICAgY291cnNlLnR5cGUgPT09IFwiY2x1YlwiID8gXCJDbHViXCIgOiBcIkNvdXJzZVwiXG4gICAgICApLFxuICAgICAgaChcImgxXCIsIFwiU2V0dGluZ3NcIiksXG4gICAgICBoKFwicC5iaWdcIiwgW1xuICAgICAgICBgS3Jha2VuRWR1IGlzIG5ldyBhbmQgc29tZSB0aGluZ3MgY2FuIG9ubHkgYmUgZG9uZSBtYW51YWxseSBmb3Igbm93ISBUbyBhZGQgYSBuZXcgbWFpbnRhaW5lciwgcmVtb3ZlIGEgY29ob3J0LCBvciBhbnl0aGluZyBlbHNlIHlvdSBkb24ndCBzZWUgaGVyZSwgcGxlYXNlIGVtYWlsIGAsXG4gICAgICAgIGgoXCJhXCIsIHsgaHJlZjogXCJtYWlsdG86aGVscEBrcmFrZW5lZHUuY29tXCIgfSwgXCJoZWxwQGtyYWtlbmVkdS5jb21cIiksXG4gICAgICBdKSxcbiAgICBdKSxcbiAgICBoKFRhYnMsIHtcbiAgICAgIHRhYnM6IHtcbiAgICAgICAgQ29ob3J0czogaChDb2hvcnRTZXR0aW5ncywgeyBjb3Vyc2UsIG11dGF0ZSB9KSxcbiAgICAgICAgRGV0YWlsczogaChFZGl0RGV0YWlscywgeyBjb3Vyc2UsIG11dGF0ZSB9KSxcbiAgICAgICAgSW52aXRlczogaChJbnZpdGVzLCB7IGNvdXJzZSwgbXV0YXRlIH0pLFxuICAgICAgICBUZW1wbGF0ZXM6IGgoQ291cnNlVGVtcGxhdGVzLCB7IGNvdXJzZSwgbXV0YXRlIH0pLFxuICAgICAgICBEaXNjb3VudHM6IGgoRGlzY291bnRzLCB7IGNvdXJzZTogY291cnNlLmlkIH0pLFxuICAgICAgfSxcbiAgICB9KSxcbiAgXSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IFdyYXBwZWRDb3Vyc2VTZXR0aW5nc1BhZ2VcblxuXG5mdW5jdGlvbiBDb2hvcnRTZXR0aW5ncyhwcm9wczp7Y291cnNlOkNvdXJzZSwgbXV0YXRlOiAoY291cnNlOkNvdXJzZSk9PnZvaWR9KSB7XG4gIGxldCB7ZGF0YTogdXNlcn0gPSB1c2VVc2VyRGF0YSgpXG4gIHJldHVybiBoKEJveCwge2dhcDogMzJ9LCBbXG4gICAgaChBZGRDb2hvcnQsIHByb3BzKSxcbiAgICBoKFNlcGVyYXRvciksXG4gICAgaChCb3gsIHtnYXA6IDE2fSwgW1xuICAgICAgaCgnaDMnLCBcIkNhbmNlbCBhIENvaG9ydFwiKSxcbiAgICAgIENPUFkuY2FuY2VsQ29ob3J0XG4gICAgXSksXG4gICAgaChCb3gsIFtcbiAgICAgIGgoJ2gzJywgXCJBbGwgQ29ob3J0c1wiKSxcbiAgICAgIGgoQm94LCB7Z2FwOjMyfSwgcHJvcHMuY291cnNlLmNvdXJzZV9jb2hvcnRzLm1hcCgoY29ob3J0KT0+e1xuICAgICAgICBsZXQgZmFjaWxpdGF0aW5nID0gISFjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PnVzZXImJmYuZmFjaWxpdGF0b3IgPT09IHVzZXIuaWQpXG4gICAgICAgIHJldHVybiBoKENvaG9ydCwge1xuICAgICAgICAgIGNvaG9ydCxcbiAgICAgICAgICBlbnJvbGxlZDogZmFsc2UsXG4gICAgICAgICAgZmFjaWxpdGF0aW5nLFxuICAgICAgICAgIHNsdWc6IHByb3BzLmNvdXJzZS5zbHVnLFxuICAgICAgICAgIGNvaG9ydF9tYXhfc2l6ZTogcHJvcHMuY291cnNlLmNvaG9ydF9tYXhfc2l6ZSxcbiAgICAgICAgICBpbnZpdGVkOiB0cnVlXG4gICAgICAgIH0pXG4gICAgICB9KSksXG4gICAgXSlcbiAgXSlcbn1cblxuLy9mZWF0dXJlIHRvIGFkZCBhIG5ldyBjb2hvcnQgdG8gYSBjb3Vyc2VcbmNvbnN0IEFkZENvaG9ydCA9IChwcm9wczp7Y291cnNlOkNvdXJzZSwgbXV0YXRlOihjOkNvdXJzZSk9PnZvaWR9KT0+IHtcbiAgbGV0IFtuZXdDb2hvcnQsIHNldE5ld0NvaG9ydF0gPSB1c2VTdGF0ZSh7c3RhcnRfZGF0ZTogJycsIHN0YXJ0X3RpbWU6ICcnLCBmYWNpbGl0YXRvcnM6IFtdIGFzIHN0cmluZ1tdfSlcbiAgbGV0IFtzdGF0dXMsIGNhbGxDcmVhdGVDb2hvcnRdID0gdXNlQXBpPENyZWF0ZUNvaG9ydE1zZywgQ3JlYXRlQ29ob3J0UmVzcG9uc2U+KFtuZXdDb2hvcnRdKVxuXG4gIGxldCB0aW1lem9uZSA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi11cycse3RpbWVab25lTmFtZTpcInNob3J0XCJ9KS5zcGxpdCgnLCAnKVsxXVxuXG4gIGNvbnN0IG9uU3VibWl0ID0gYXN5bmMgKGU6UmVhY3QuRm9ybUV2ZW50KSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICBsZXQgZGF0ZSA9IG5ld0NvaG9ydC5zdGFydF9kYXRlLnNwbGl0KCctJykubWFwKHg9PnBhcnNlSW50KHgpKVxuICAgIGxldCB0aW1lID0gbmV3Q29ob3J0LnN0YXJ0X3RpbWUuc3BsaXQoJzonKS5tYXAoeD0+cGFyc2VJbnQoeCkpXG4gICAgbGV0IHN0YXJ0ID0gbmV3IERhdGUoZGF0ZVswXSwgZGF0ZVsxXSAtMSwgZGF0ZVsyXSwgdGltZVswXSwgdGltZVsxXSlcblxuICAgIGxldCByZXMgPSBhd2FpdCBjYWxsQ3JlYXRlQ29ob3J0KGAvYXBpL2NvaG9ydHNgLCB7Y291cnNlSWQ6IHByb3BzLmNvdXJzZS5pZCwgZmFjaWxpdGF0b3JzOm5ld0NvaG9ydC5mYWNpbGl0YXRvcnMsIHN0YXJ0OiBzdGFydC50b0lTT1N0cmluZygpfSlcbiAgICBpZihyZXMuc3RhdHVzID09PSAyMDApIHByb3BzLm11dGF0ZSh7XG4gICAgICAgIC4uLnByb3BzLmNvdXJzZSxcbiAgICAgICAgY291cnNlX2NvaG9ydHM6IFsuLi5wcm9wcy5jb3Vyc2UuY291cnNlX2NvaG9ydHMsIHsuLi5yZXMucmVzdWx0LCBwZW9wbGVfaW5fY29ob3J0czpbXSwgY291cnNlczoge25hbWU6IHByb3BzLmNvdXJzZS5uYW1lfX1dXG4gICAgICB9KVxuICB9XG5cbiAgcmV0dXJuIGgoRm9ybUJveCwge29uU3VibWl0LCBnYXA6IDMyLCBzdHlsZToge3dpZHRoOiA0MDB9fSwgW1xuICAgIGgoJ2gyJywgJ0FkZCBhIG5ldyBDb2hvcnQnKSxcbiAgICBzdGF0dXMgPT09ICdlcnJvcicgPyBoKEVycm9yLCAnQW4gZXJyb3Igb2NjdXJlZCcpIDogbnVsbCxcbiAgICBzdGF0dXMgPT09ICdzdWNjZXNzJyA/IGgoSW5mbywgJ0NvaG9ydCBjcmVhdGVkIScpIDogbnVsbCxcbiAgICBoKExhYmVsQm94LCB7Z2FwOjh9LCBbXG4gICAgICBoKCdoNCcsIFwiRmFjaWxpdGF0b3JcIiksXG4gICAgICBoKFNlbGVjdCwge1xuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgb25DaGFuZ2U6IChlOlJlYWN0LkNoYW5nZUV2ZW50PEhUTUxTZWxlY3RFbGVtZW50Pik9PiBzZXROZXdDb2hvcnQoey4uLm5ld0NvaG9ydCwgZmFjaWxpdGF0b3JzOiBbLi4ubmV3Q29ob3J0LmZhY2lsaXRhdG9ycywgZS5jdXJyZW50VGFyZ2V0LnZhbHVlXX0pXG4gICAgICB9LCBbXG4gICAgICAgIGgoJ29wdGlvbicsIHt2YWx1ZTogJyd9LCBcIlNlbGVjdCBhIGZhY2lsaXRhdG9yXCIpLFxuICAgICAgICAuLi4ocHJvcHMuY291cnNlLmNvdXJzZV9tYWludGFpbmVycy5tYXAobWFpbnRhaW5lciA9PiB7XG4gICAgICAgICAgcmV0dXJuIGgoJ29wdGlvbicsIHt2YWx1ZTogbWFpbnRhaW5lci5tYWludGFpbmVyfSwgbWFpbnRhaW5lci5wZW9wbGUuZGlzcGxheV9uYW1lIHx8IG1haW50YWluZXIucGVvcGxlLnVzZXJuYW1lKVxuICAgICAgICB9KXx8W10pXG4gICAgICBdKSxcbiAgICAgIGgoQm94LCB7aDp0cnVlfSwgbmV3Q29ob3J0LmZhY2lsaXRhdG9ycy5tYXAoZj0+e1xuICAgICAgICBsZXQgZmFjaWxpdGF0b3IgPSBwcm9wcy5jb3Vyc2UuY291cnNlX21haW50YWluZXJzLmZpbmQobT0+bS5tYWludGFpbmVyID09PSBmKVxuICAgICAgICBpZighZmFjaWxpdGF0b3IpIHJldHVybiBudWxsXG4gICAgICAgIHJldHVybiBoKFBpbGwsIHt9LCBoKEJveCwge2g6dHJ1ZSwgZ2FwOjR9LCBbXG4gICAgICAgICAgaCgncCcsIGZhY2lsaXRhdG9yLnBlb3BsZS5kaXNwbGF5X25hbWUgfHwgZmFjaWxpdGF0b3IucGVvcGxlLnVzZXJuYW1lKSxcbiAgICAgICAgICBoKEljb25CdXR0b24sIHtvbkNsaWNrOmU9PntcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgc2V0TmV3Q29ob3J0KHsuLi5uZXdDb2hvcnQsIGZhY2lsaXRhdG9yczpuZXdDb2hvcnQuZmFjaWxpdGF0b3JzLmZpbHRlcihmMj0+ZjIhPT1mKX0pXG4gICAgICAgICAgfX0sIGgoQ3Jvc3MsIHt3aWR0aDogMTAsIGhlaWdodDoxMH0pKVxuICAgICAgICBdKSlcbiAgICAgIH0pKVxuICAgIF0pLFxuICAgIGgoQm94LCB7aDogdHJ1ZSwgZ2FwOiAzMn0sIFtcbiAgICBoKExhYmVsQm94LCB7Z2FwOjh9LCBbXG4gICAgICBoKCdoNCcsICdTdGFydCBEYXRlJyksXG4gICAgICBoKElucHV0LCB7XG4gICAgICAgIHR5cGU6ICdkYXRlJyxcbiAgICAgICAgcGxhY2Vob2xkZXI6ICd5eXl5LW1tLWRkJyxcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIHZhbHVlOiBuZXdDb2hvcnQuc3RhcnRfZGF0ZSxcbiAgICAgICAgb25DaGFuZ2U6IGUgPT4gc2V0TmV3Q29ob3J0KHsuLi5uZXdDb2hvcnQsIHN0YXJ0X2RhdGU6IGUuY3VycmVudFRhcmdldC52YWx1ZX0pXG4gICAgICB9KVxuICAgIF0pLFxuICAgIGgoTGFiZWxCb3gsIHtnYXA6OH0sIFtcbiAgICAgIGgoJ2g0JywgYFN0YXJ0IHRpbWUgKCR7dGltZXpvbmV9KWApLFxuICAgICAgaChJbnB1dCwge1xuICAgICAgICB0eXBlOiAndGltZScsXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnMjM6NTknLFxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgdmFsdWU6IG5ld0NvaG9ydC5zdGFydF90aW1lLFxuICAgICAgICBvbkNoYW5nZTogZSA9PiBzZXROZXdDb2hvcnQoey4uLm5ld0NvaG9ydCwgc3RhcnRfdGltZTogZS5jdXJyZW50VGFyZ2V0LnZhbHVlfSlcbiAgICAgIH0pXG4gICAgXSksXG4gICAgXSksXG4gICAgaChQcmltYXJ5LCB7XG4gICAgICBzdHlsZToge2p1c3RpZnlTZWxmOiAncmlnaHQnfSxcbiAgICAgIHN0YXR1cyxcbiAgICAgIHR5cGU6ICdzdWJtaXQnLFxuICAgICAgc3VjY2Vzczogc3RhdHVzID09PSAnc3VjY2VzcycsXG4gICAgICBkaXNhYmxlZDogIW5ld0NvaG9ydC5zdGFydF9kYXRlIHx8IG5ld0NvaG9ydC5mYWNpbGl0YXRvcnMubGVuZ3RoPT09MFxuICAgIH0sICdBZGQgYSBuZXcgQ29ob3J0JyksXG4gIF0pXG59XG5cbmNvbnN0IEludml0ZXMgPSAocHJvcHM6e2NvdXJzZTpDb3Vyc2UsIG11dGF0ZTogKGM6Q291cnNlKSA9PiB2b2lkfSk9PiB7XG4gIGxldCBbZW1haWxPclVzZXJuYW1lLCBzZXRFbWFpbE9yVXNlcm5hbWVdID0gdXNlU3RhdGUoJycpXG4gIGxldCBbaW52aXRlX29ubHksIHNldEludml0ZU9ubHldID0gdXNlU3RhdGUocHJvcHMuY291cnNlLmludml0ZV9vbmx5KVxuICBsZXQgW3ZhbGlkLCBzZXRWYWxpZF0gPSB1c2VTdGF0ZTxudWxsIHwgYm9vbGVhbj4obnVsbClcbiAgbGV0IFtzdGF0dXMsIGNhbGxJbnZpdGVUb0NvdXJzZV0gPSB1c2VBcGk8SW52aXRlVG9Db3Vyc2VNc2csIEludml0ZVRvQ291cnNlUmVzcG9uc2U+KFtlbWFpbE9yVXNlcm5hbWVdLCAoKT0+c2V0RW1haWxPclVzZXJuYW1lKCcnKSlcbiAgbGV0IFt1cGRhdGVTdGF0dXMsIGNhbGxVcGRhdGVDb3Vyc2VdID0gdXNlQXBpPFVwZGF0ZUNvdXJzZU1zZywgVXBkYXRlQ291cnNlUmVzcG9uc2U+KFtdKVxuXG4gIHVzZURlYm91bmNlZEVmZmVjdChhc3luYyAoKT0+e1xuICAgIGlmKGVtYWlsT3JVc2VybmFtZS5pbmNsdWRlcygnQCcpIHx8IGVtYWlsT3JVc2VybmFtZSA9PT0gJycpIHJldHVybiBzZXRWYWxpZChudWxsKVxuICAgIGxldCByZXMgPSBhd2FpdCBjYWxsQXBpPG51bGwsIENoZWNrVXNlcm5hbWVSZXN1bHQ+KCcvYXBpL2dldC91c2VybmFtZS8nK2VtYWlsT3JVc2VybmFtZSlcbiAgICBpZihyZXMuc3RhdHVzPT09NDA0KSBzZXRWYWxpZChmYWxzZSlcbiAgICBlbHNlIHNldFZhbGlkKHRydWUpXG4gIH0sIDUwMCwgW2VtYWlsT3JVc2VybmFtZV0pXG4gIHVzZUVmZmVjdCgoKT0+c2V0VmFsaWQobnVsbCksW2VtYWlsT3JVc2VybmFtZV0pXG5cbiAgbGV0IG9uU3VibWl0SW52aXRlID0gYXN5bmMgKGU6IFJlYWN0LkZvcm1FdmVudCk9PntcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBsZXQgeCA9IGVtYWlsT3JVc2VybmFtZS5pbmNsdWRlcygnQCcpID8ge2VtYWlsOiBlbWFpbE9yVXNlcm5hbWV9IDoge3VzZXJuYW1lOiBlbWFpbE9yVXNlcm5hbWV9XG4gICAgY2FsbEludml0ZVRvQ291cnNlKGAvYXBpL2NvdXJzZXMvJHtwcm9wcy5jb3Vyc2UuaWR9L2ludml0ZWAsIHsuLi54fSlcbiAgfVxuXG4gIGxldCBvblN1Ym1pdFRvZ2dsZUludml0ZU9ubHkgPSBhc3luYyAoZTpSZWFjdC5Gb3JtRXZlbnQpPT57XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgbGV0IHJlcyA9IGF3YWl0IGNhbGxVcGRhdGVDb3Vyc2UoYC9hcGkvY291cnNlcy8ke3Byb3BzLmNvdXJzZS5pZH1gLCB7aW52aXRlX29ubHl9KVxuICAgIGlmKHJlcy5zdGF0dXMgPT09IDIwMCkgcHJvcHMubXV0YXRlKHsuLi5wcm9wcy5jb3Vyc2UsIC4uLnJlcy5yZXN1bHR9KVxuICB9XG5cbiAgcmV0dXJuIGgoQm94LCB7IGdhcDogMTYsIHdpZHRoOiA0MDAgfSwgW1xuICAgIGgoXCJoMlwiLCBcIkludml0ZXNcIiksXG4gICAgaChCb3gsIHsgZ2FwOiAzMiB9LCBbXG4gICAgICBoKEZvcm1Cb3gsIHsgb25TdWJtaXQ6IG9uU3VibWl0VG9nZ2xlSW52aXRlT25seSB9LCBbXG4gICAgICAgIGgoTGFiZWxCb3gsIHsgZ2FwOiA4LCB3aWR0aDogNDAwIH0sIFtcbiAgICAgICAgICBoKFwiZGl2XCIsIFtcbiAgICAgICAgICAgIGgoXCJoNFwiLCBcIkludml0ZSBPbmx5XCIpLFxuICAgICAgICAgICAgaChcbiAgICAgICAgICAgICAgXCJzbWFsbC50ZXh0U2Vjb25kYXJ5XCIsXG4gICAgICAgICAgICAgIGBMZWFybmVycyBjYW5ub3QgZW5yb2xsIGluIGFuIGludml0ZSBvbmx5IGNvdXJzZSB1bmxlc3MgeW91IGhhdmUgc2VudCB0aGVtIGFuXG5pbnZpdGUuIFRoZSBpbnZpdGUgYWxsb3dzIHRoZW0gZW5yb2xsIGluIGFueSBjb2hvcnQgYW5kIGRvZXMgbm90IGV4cGlyZS5gXG4gICAgICAgICAgICApLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGgoQ2hlY2tCb3gsIFtcbiAgICAgICAgICAgIGgoSW5wdXQsIHtcbiAgICAgICAgICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgICAgICAgICBjaGVja2VkOiBpbnZpdGVfb25seSxcbiAgICAgICAgICAgICAgb25DaGFuZ2U6IChlKSA9PiBzZXRJbnZpdGVPbmx5KGUuY3VycmVudFRhcmdldC5jaGVja2VkKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgXCJNYWtlIHRoaXMgY291cnNlIGludml0ZSBvbmx5XCIsXG4gICAgICAgICAgXSksXG4gICAgICAgIF0pLFxuICAgICAgICBoKFxuICAgICAgICAgIFByaW1hcnksXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3R5bGU6IHsganVzdGlmeVNlbGY6IFwicmlnaHRcIiB9LFxuICAgICAgICAgICAgc3RhdHVzOiB1cGRhdGVTdGF0dXMsXG4gICAgICAgICAgICB0eXBlOiBcInN1Ym1pdFwiLFxuICAgICAgICAgICAgZGlzYWJsZWQ6IHByb3BzLmNvdXJzZS5pbnZpdGVfb25seSA9PT0gaW52aXRlX29ubHksXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIkNoYW5nZVwiXG4gICAgICAgICksXG4gICAgICBdKSxcbiAgICAgICFwcm9wcy5jb3Vyc2UuaW52aXRlX29ubHlcbiAgICAgICAgPyBudWxsXG4gICAgICAgIDogaChGb3JtQm94LCB7IG9uU3VibWl0OiBvblN1Ym1pdEludml0ZSwgZ2FwOiAzMiwgd2lkdGg6IDQwMCB9LCBbXG4gICAgICAgICAgICBoKExhYmVsQm94LCB7IGdhcDogOCB9LCBbXG4gICAgICAgICAgICAgIGgoXCJoNFwiLCBcIkludml0ZSBzb21lb25lIHRvIGVucm9sbFwiKSxcbiAgICAgICAgICAgICAgaChcbiAgICAgICAgICAgICAgICBcInNtYWxsLnRleHRTZWNvbmRhcnlcIixcbiAgICAgICAgICAgICAgICBgSW52aXRlIHNvbWVvbmUgd2l0aCB0aGVpciB1c2VybmFtZSBvciBlbWFpbC4gSW52aXRlZSBkb2VzIG5vdCBuZWVkIGEgS3Jha2VuRWR1IGFjY291bnQgdG8gYmUgaW52aXRlZCwgYnV0IHRoZXkgd2lsbCBuZWVkIGFuIGFjY291bnQgdG8gZW5yb2xsLmBcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgaChJbnB1dCwge1xuICAgICAgICAgICAgICAgIHR5cGU6IGVtYWlsT3JVc2VybmFtZS5pbmNsdWRlcyhcIkBcIikgPyBcImVtYWlsXCIgOiBcInRleHRcIixcbiAgICAgICAgICAgICAgICB2YWx1ZTogZW1haWxPclVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiAoZSkgPT4gc2V0RW1haWxPclVzZXJuYW1lKGUuY3VycmVudFRhcmdldC52YWx1ZSksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICB2YWxpZCA9PT0gbnVsbFxuICAgICAgICAgICAgICAgID8gbnVsbFxuICAgICAgICAgICAgICAgIDogdmFsaWRcbiAgICAgICAgICAgICAgICA/IGgoXCJzcGFuLmFjY2VudFN1Y2Nlc3NcIiwgXCJHcmVhdCwgZm91bmQgQFwiICsgZW1haWxPclVzZXJuYW1lKVxuICAgICAgICAgICAgICAgIDogaChcbiAgICAgICAgICAgICAgICAgICAgXCJzcGFuLmFjY2VudFJlZFwiLFxuICAgICAgICAgICAgICAgICAgICBcIldlIGNhbid0IGZpbmQgYSB1c2VyIHdpdGggdGhhdCB1c2VybmFtZVwiXG4gICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBoKFxuICAgICAgICAgICAgICBQcmltYXJ5LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc3R5bGU6IHsganVzdGlmeVNlbGY6IFwicmlnaHRcIiB9LFxuICAgICAgICAgICAgICAgIHN0YXR1cyxcbiAgICAgICAgICAgICAgICB0eXBlOiBcInN1Ym1pdFwiLFxuICAgICAgICAgICAgICAgIGRpc2FibGVkOiAhZW1haWxPclVzZXJuYW1lLmluY2x1ZGVzKFwiQFwiKSAmJiB2YWxpZCAhPT0gdHJ1ZSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXCJJbnZpdGVcIlxuICAgICAgICAgICAgKSxcbiAgICAgICAgICBdKSxcbiAgICBdKSxcbiAgXSk7XG59XG5cbmNvbnN0IEVkaXREZXRhaWxzID0gKHByb3BzOiB7Y291cnNlOiBDb3Vyc2UsIG11dGF0ZTooY291cnNlOkNvdXJzZSk9PnZvaWR9KSA9PiB7XG4gIGxldCB7c3RhdGUsIGZvcm0sIGNoYW5nZWQsIHJlc2V0LCBzZXRTdGF0ZX0gPSB1c2VGb3JtRGF0YSh7XG4gICAgbmFtZTogcHJvcHMuY291cnNlLm5hbWUsXG4gICAgY2FyZF9pbWFnZTogcHJvcHMuY291cnNlLmNhcmRfaW1hZ2UsXG4gICAgY29ob3J0X21heF9zaXplOiBwcm9wcy5jb3Vyc2UuY29ob3J0X21heF9zaXplLFxuICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5jb3Vyc2UuZGVzY3JpcHRpb24sXG4gICAgcHJlcmVxdWlzaXRlczogcHJvcHMuY291cnNlLnByZXJlcXVpc2l0ZXMsXG4gICAgY29zdDogcHJvcHMuY291cnNlLmNvc3QsXG4gICAgZHVyYXRpb246IHByb3BzLmNvdXJzZS5kdXJhdGlvblxuICB9LCBbcHJvcHMuY291cnNlXSlcbiAgbGV0IFtzdGF0dXMsIGNhbGxVcGRhdGVDb3Vyc2VdID0gdXNlQXBpPFVwZGF0ZUNvdXJzZU1zZywgVXBkYXRlQ291cnNlUmVzcG9uc2U+KFtdKVxuXG4gIGNvbnN0IG9uU3VibWl0ID0gYXN5bmMgKGU6IFJlYWN0LkZvcm1FdmVudCkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGxldCByZXMgPSBhd2FpdCBjYWxsVXBkYXRlQ291cnNlKGAvYXBpL2NvdXJzZXMvJHtwcm9wcy5jb3Vyc2UuaWR9YCwgey4uLnN0YXRlfSlcbiAgICBpZihyZXMuc3RhdHVzID09PSAyMDApIHByb3BzLm11dGF0ZSh7Li4ucHJvcHMuY291cnNlLCAuLi5yZXMucmVzdWx0fSlcbiAgfVxuXG4gIHJldHVybiBoKEZvcm1Cb3gsIHtvblN1Ym1pdCwgZ2FwOjMyLCBzdHlsZTp7d2lkdGg6IDQwMH19LCBbXG4gICAgaCgnaDInLCAnRWRpdCBEZXRhaWxzJyksXG4gICAgaChMYWJlbEJveCwge2dhcDo4fSwgW1xuICAgICAgaCgnaDQnLCAnTmFtZScpLFxuICAgICAgaChJbnB1dCwge1xuICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgIG1heExlbmd0aDogNTAsXG4gICAgICAgIC4uLmZvcm0ubmFtZVxuICAgICAgfSksXG4gICAgXSksXG4gICAgaChMYWJlbEJveCwge2dhcDo4fSwgW1xuICAgICAgaCgnaDQnLCAnQ29zdCAoVVNEKScpLFxuICAgICAgaChJbnB1dCwge1xuICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgLi4uZm9ybS5jb3N0XG4gICAgICB9KVxuICAgIF0pLFxuICAgIHByb3BzLmNvdXJzZS50eXBlID09PSAnY291cnNlJyA/IG51bGwgOiBoKEJveCwgIFtcbiAgICAgIGgoXCJkaXZcIiwgW1xuICAgICAgICBoKCdoNCcsIFwiRW1vamlzXCIpLFxuICAgICAgICBoKCdzbWFsbC50ZXh0U2Vjb25kYXJ5JywgXCJTZWxlY3QgdGhyZWUgZW1vamlzIHRvIGRlc2NyaWJlIHlvdXIgY2x1YiEgUmVwZWF0cyBvay5cIilcbiAgICAgIF0pLFxuICAgICAgaChJY29uUGlja2VyLCB7XG4gICAgICAgIGljb25zOiBzdGF0ZS5jYXJkX2ltYWdlLnNwbGl0KCcsJyksXG4gICAgICAgIHNldEljb25zOiAoaWNvbnM6c3RyaW5nW10pID0+IHtcbiAgICAgICAgICBzZXRTdGF0ZSh7Li4uc3RhdGUsIGNhcmRfaW1hZ2U6IGljb25zLmpvaW4oJywnKX0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgXSksXG4gICAgaChMYWJlbEJveCwge2dhcDo4fSwgW1xuICAgICAgaCgnZGl2JywgW1xuICAgICAgICBoKCdoNCcsIFwiQ29ob3J0IFNpemVcIiksXG4gICAgICAgIGgoJ3NtYWxsLnRleHRTZWNvbmRhcnknLCBcIkhvdyBtYW55IGxlYXJuZXJzIGNhbiBlbnJvbGwgaW4gYSBjb2hvcnQuIFNldCB0byAwIGZvciBubyBsaW1pdC5cIilcbiAgICAgIF0pLFxuICAgICAgaChJbnB1dCwge1xuICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIC4uLmZvcm0uY29ob3J0X21heF9zaXplXG4gICAgICB9KVxuICAgIF0pLFxuICAgIGgoTGFiZWxCb3gsIHtnYXA6OH0sIFtcbiAgICAgIGgoJ2g0JywgJ0Rlc2NyaXB0aW9uJyksXG4gICAgICBoKFRleHRhcmVhLCB7XG4gICAgICAgIG1heExlbmd0aDogMjAwLFxuICAgICAgICAuLi5mb3JtLmRlc2NyaXB0aW9uXG4gICAgICAgIH0pLFxuICAgIF0pLFxuICAgIGgoTGFiZWxCb3gsIHtnYXA6OH0sIFtcbiAgICAgIGgoJ2g0JywgJ1ByZXJlcXVpc2l0ZXMnKSxcbiAgICAgIGgoVGV4dGFyZWEsIGZvcm0ucHJlcmVxdWlzaXRlcylcbiAgICBdKSxcbiAgICBoKExhYmVsQm94LCB7Z2FwOjh9LCBbXG4gICAgICBoKCdoNCcsICdEdXJhdGlvbicpLFxuICAgICAgaChJbnB1dCwgZm9ybS5kdXJhdGlvbilcbiAgICBdKSxcbiAgICBoKFN1Ym1pdEJ1dHRvbnMsIFtcbiAgICAgIGgoRGVzdHJ1Y3RpdmUsIHtkaXNhYmxlZDogIWNoYW5nZWQsIG9uQ2xpY2s6IChlKT0+e1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgcmVzZXQoKVxuICAgICAgfX0sIFwiRGlzY2FyZCBDaGFuZ2VzXCIpLFxuICAgICAgICBoKFByaW1hcnksIHt0eXBlOiAnc3VibWl0JywgZGlzYWJsZWQ6ICFjaGFuZ2VkLCBzdGF0dXN9LCAnU2F2ZSBDaGFuZ2VzJylcbiAgICBdKSxcbiAgICBoKE1haW50YWluZXJzLCBwcm9wcylcbiAgXSlcbn1cblxuZnVuY3Rpb24gTWFpbnRhaW5lcnMgKHByb3BzOiB7Y291cnNlOiBDb3Vyc2UsIG11dGF0ZTogKGM6IENvdXJzZSk9PnZvaWR9KSB7XG4gIGxldCBbbmV3TWFpbnRhaW5lciwgc2V0TmV3TWFpbnRhaW5lcl0gPSB1c2VTdGF0ZSgnJylcbiAgcmV0dXJuIGgoQm94LCBbXG4gICAgaCgnaDMnLCBcIk1haW50YWluZXJzXCIpLFxuICAgIC4uLnByb3BzLmNvdXJzZS5jb3Vyc2VfbWFpbnRhaW5lcnMubWFwKG09PntcbiAgICAgIHJldHVybiBtLnBlb3BsZS5kaXNwbGF5X25hbWUgfHwgbS5wZW9wbGUudXNlcm5hbWVcbiAgICB9KSxcbiAgICBoKCdoNCcsIFwiQWRkIGEgbWFpbnRhaW5lclwiKSxcbiAgICBoKEZvcm1Cb3gsIFtcbiAgICAgIGgoSW5wdXQsIHt2YWx1ZTogbmV3TWFpbnRhaW5lciwgb25DaGFuZ2U6KGUpPT5zZXROZXdNYWludGFpbmVyKGUuY3VycmVudFRhcmdldC52YWx1ZSl9KSxcbiAgICAgIGgoUHJpbWFyeSwge3R5cGU6J3N1Ym1pdCd9LCBcIkFkZFwiKVxuICAgIF0pXG4gIF0pXG59XG5cbmZ1bmN0aW9uIENvdXJzZVRlbXBsYXRlcyAocHJvcHM6IHtjb3Vyc2U6IENvdXJzZSwgbXV0YXRlOiAoYzpDb3Vyc2UpPT52b2lkfSkge1xuICByZXR1cm4gaChCb3gsIHtnYXA6IDMyfSwgW1xuICAgIGgoQm94LCBbXG4gICAgICBoKCdwJywgYEVhY2ggY29ob3J0IGNvbWVzIHdpdGggaXRzIG93biBjb21tdW5pdHkgc3BhY2UsIGFuZCB0ZW1wbGF0ZXMgdG8gaGVscCB5b3UgcG9wdWxhdGUgaXRzIHN0cnVjdHVyZSB3aXRoIHRvcGljcy5gKSxcbiAgICAgIGgoJ3VsJywge3N0eWxlOiB7J21hcmdpbic6ICdhdXRvIDAnfX0sIFtcbiAgICAgICAgaCgnbGknLCBbXG4gICAgICAgICAgaCgnYicsICdQcmVwb3B1bGF0ZWQnKSwgXG4gICAgICAgICAgaCgnc3BhbicsICcgdG9waWNzIGFyZSBhdXRvbWF0aWNhbGx5IHBvc3RlZCB3aGVuIGVhY2ggbmV3IGNvaG9ydCBpcyBjcmVhdGVkJylcbiAgICAgICAgXSksXG4gICAgICAgIGgoJ2xpJywgW1xuICAgICAgICAgIGgoJ2InLCAnVHJpZ2dlcmVkJyksIFxuICAgICAgICAgIGgoJ3NwYW4nLCAnIHRvcGljcyBjYW4gYmUgcG9zdGVkIGJ5IHRoZSBmYWNpbGl0YXRvciBmcm9tIHRoZSBjb2hvcnQgc2V0dGluZ3MgKGVkaXRhYmxlIGJlZm9yZSBwdWJsaXNoaW5nLCBzbyB1c2VmdWwgZm9yIGNyZWF0aW5nIG11bHRpcGxlIHRvcGljcyBmcm9tIG9uZSB0ZW1wbGF0ZSknKVxuICAgICAgICBdKVxuICAgICAgXSksXG4gICAgICBoKCdwJywgYFlvdSBjYW4gZWRpdCB0aGUgZGVmYXVsdCB0ZW1wbGF0ZXMgd2UndmUgcHJvdmlkZWQgYmVsb3csIG9yIGFkZCBuZXcgb25lcyFgKSxcbiAgICAgIGgoTGluaywge1xuICAgICAgICBocmVmOiAnL2NvdXJzZXMvW3NsdWddL1tpZF0vc2V0dGluZ3MvdGVtcGxhdGVzL1t0ZW1wbGF0ZUlkXScsXG4gICAgICAgIGFzOmAvY291cnNlcy8ke3Byb3BzLmNvdXJzZS5zbHVnfS8ke3Byb3BzLmNvdXJzZS5pZH0vc2V0dGluZ3MvdGVtcGxhdGVzL25ld2BcbiAgICAgIH0sIGgoJ2EnLCB7fSwgaChQcmltYXJ5LCBcIisgQWRkIEEgTmV3IFRlbXBsYXRlXCIpKSksXG4gICAgXSksXG4gICAgaChCb3gsIHt9LCBwcm9wcy5jb3Vyc2UuY291cnNlX3RlbXBsYXRlc1xuICAgICAgLnNvcnQoKGEsIGIpPT4gIGEubmFtZSA+IGIubmFtZSA/IDEgOiAtMSlcbiAgICAgIC5zb3J0KChhKT0+IGEucmVxdWlyZWQgPyAtMSA6IDEpXG4gICAgICAuZmxhdE1hcCh0ZW1wbGF0ZSA9PiB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgaChCb3gsIHtoOiB0cnVlLCBzdHlsZToge2dyaWRBdXRvQ29sdW1uczogJ2F1dG8nfX0sW1xuICAgICAgICAgICAgaCgnZGl2JywgW1xuICAgICAgICAgICAgICBoKCdoMycsIHRlbXBsYXRlLm5hbWUpLFxuICAgICAgICAgICAgICBoKCdzcGFuLnRleHRTZWNvbmRhcnknLCB0ZW1wbGF0ZS50eXBlID09PSdwcmVwb3B1bGF0ZWQnID8gXCJQcmVwb3B1bGF0ZWQgZm9yIGFsbCBjb2hvcnRzXCIgOiBcIk1hbnVhbGx5IHB1Ymxpc2hlZCBieSBmYWNpbGl0YXRvclwiKVxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBoKEJveCwge2g6IHRydWUsIHN0eWxlOntqdXN0aWZ5U2VsZjogJ2VuZCcsIGFsaWduSXRlbXM6ICdjZW50ZXInfX0sIFtcbiAgICAgICAgICAgICAgdGVtcGxhdGUucmVxdWlyZWQgPyBudWxsIDogaChEZWxldGVUZW1wbGF0ZSwge2NvdXJzZTogcHJvcHMuY291cnNlLCBtdXRhdGU6IHByb3BzLm11dGF0ZSwgdGVtcGxhdGVOYW1lOiB0ZW1wbGF0ZS5uYW1lfSksXG4gICAgICAgICAgICAgIGgoTGluaywge1xuICAgICAgICAgICAgICAgIGhyZWY6ICcvY291cnNlcy9bc2x1Z10vW2lkXS9zZXR0aW5ncy90ZW1wbGF0ZXMvW3RlbXBsYXRlSWRdJyxcbiAgICAgICAgICAgICAgICBhczogYC9jb3Vyc2VzLyR7cHJvcHMuY291cnNlLnNsdWd9LyR7cHJvcHMuY291cnNlLmlkfS9zZXR0aW5ncy90ZW1wbGF0ZXMvJHt0ZW1wbGF0ZS5uYW1lfWBcbiAgICAgICAgICAgICAgfSwgaCgnYScsIHt9LCBoKFNlY29uZGFyeSwgJ0VkaXQnKSkpXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGgoU2VwZXJhdG9yKVxuICAgICAgICBdfSkuc2xpY2UoMCwgLTEpKVxuICBdKVxufVxuXG5mdW5jdGlvbiBEZWxldGVUZW1wbGF0ZShwcm9wczp7dGVtcGxhdGVOYW1lOnN0cmluZywgY291cnNlOkNvdXJzZSwgbXV0YXRlOihjOkNvdXJzZSk9PnZvaWR9KSB7XG4gIGxldCBbc3RhdGUsIHNldFN0YXRlXSA9IHVzZVN0YXRlPCdub3JtYWwnIHwgJ2NvbmZpcm0nPignbm9ybWFsJylcbiAgbGV0IFtzdGF0dXMsIGNhbGxEZWxldGVdID0gdXNlQXBpPG51bGwsIERlbGV0ZVRlbXBsYXRlUmVzdWx0PihbcHJvcHNdKVxuICByZXR1cm4gaChGcmFnbWVudCwgW1xuICAgIGgoRGVzdHJ1Y3RpdmUsIHtvbkNsaWNrOiAoKT0+c2V0U3RhdGUoJ2NvbmZpcm0nKX0sICdEZWxldGUnKSxcbiAgICBoKE1vZGFsLCB7ZGlzcGxheTogc3RhdGUgIT09ICdub3JtYWwnLCBjbG9zZVRleHQ6XCJuZXZlcm1pbmRcIiwgb25FeGl0OiAoKT0+c2V0U3RhdGUoJ25vcm1hbCcpfSwgW1xuICAgICAgaChCb3gsIHtnYXA6MzIsIHN0eWxlOiB7dGV4dEFsaWduOiAnY2VudGVyJ319LCBbXG4gICAgICAgIGgoJ2gzJywgXCJBcmUgeW91IHN1cmU/XCIpLFxuICAgICAgICBoKCdwJywgXCJZb3UgY2FuJ3QgdW5kbyB0aGlzIGFjdGlvbiFcIiksXG4gICAgICAgIGgoUHJpbWFyeSwge3N0eWxlOiB7anVzdGlmeVNlbGY6XCJjZW50ZXJcIn0sIHN0YXR1cywgb25DbGljazphc3luYyAoKT0+e1xuICAgICAgICAgIGxldCByZXMgPSBhd2FpdCBjYWxsRGVsZXRlKGAvYXBpL2NvdXJzZXMvJHtwcm9wcy5jb3Vyc2UuaWR9L3RlbXBsYXRlcy8ke3Byb3BzLnRlbXBsYXRlTmFtZX1gLCBudWxsLCBcIkRFTEVURVwiKVxuICAgICAgICAgIGlmKHJlcy5zdGF0dXMgPT09MjAwKSB7XG4gICAgICAgICAgICBwcm9wcy5tdXRhdGUoe1xuICAgICAgICAgICAgICAuLi5wcm9wcy5jb3Vyc2UsXG4gICAgICAgICAgICAgIGNvdXJzZV90ZW1wbGF0ZXM6IHByb3BzLmNvdXJzZS5jb3Vyc2VfdGVtcGxhdGVzXG4gICAgICAgICAgICAgICAgLmZpbHRlcih0PT50Lm5hbWUhPT1wcm9wcy50ZW1wbGF0ZU5hbWUpXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgc2V0U3RhdGUoJ25vcm1hbCcpXG4gICAgICAgICAgfVxuICAgICAgICB9fSwgXCJZdXAgZGVsZXRlIGl0XCIpLFxuICAgICAgXSlcbiAgICBdKVxuICBdKVxufVxuXG5cbmNvbnN0IFN1Ym1pdEJ1dHRvbnMgPSBzdHlsZWQoJ2RpdicpYFxuanVzdGlmeS1zZWxmOiByaWdodDtcbmRpc3BsYXk6IGdyaWQ7XG5ncmlkLXRlbXBsYXRlLWNvbHVtbnM6IGF1dG8gYXV0bztcbmdyaWQtZ2FwOiAxNnB4O1xuYFxuXG5leHBvcnQgY29uc3QgZ2V0U3RhdGljUHJvcHMgPSBhc3luYyAoY3R4OmFueSkgPT4ge1xuICBsZXQgaWQgPSBwYXJzZUludChjdHgucGFyYW1zPy5pZCBhcyBzdHJpbmcgfHwgJycgKVxuICBpZihOdW1iZXIuaXNOYU4oaWQpKSByZXR1cm4ge3Byb3BzOiB7bm90Rm91bmQ6IHRydWV9fSBhcyBjb25zdFxuXG4gIGxldCBkYXRhID0gYXdhaXQgY291cnNlRGF0YVF1ZXJ5KGlkKVxuICBpZighZGF0YSkgcmV0dXJuIHtwcm9wczp7bm90Rm91bmQ6IHRydWV9fSBhcyBjb25zdFxuICBsZXQgY29udGVudCA9IGF3YWl0IGdldFRhZ2dlZFBvc3QoZGF0YS5jYXRlZ29yeV9pZCwgJ2N1cnJpY3VsdW0nKVxuXG4gIHJldHVybiB7cHJvcHM6IHtub3RGb3VuZDogZmFsc2UsIGlkLCBjb3Vyc2U6IGRhdGEsIGNvbnRlbnR9LCByZXZhbGlkYXRlOiAxfSBhcyBjb25zdFxufVxuXG5leHBvcnQgY29uc3QgZ2V0U3RhdGljUGF0aHMgPSAoKSA9PiB7XG4gIHJldHVybiB7cGF0aHM6W10sIGZhbGxiYWNrOiB0cnVlfVxufVxuIl19 */\",\n  toString: _EMOTION_STRINGIFIED_CSS_ERROR__\n});\n\nexport const getStaticProps = async ctx => {\n  var _ctx$params;\n\n  let id = parseInt(((_ctx$params = ctx.params) === null || _ctx$params === void 0 ? void 0 : _ctx$params.id) || '');\n  if (Number.isNaN(id)) return {\n    props: {\n      notFound: true\n    }\n  };\n  let data = await courseDataQuery(id);\n  if (!data) return {\n    props: {\n      notFound: true\n    }\n  };\n  let content = await getTaggedPost(data.category_id, 'curriculum');\n  return {\n    props: {\n      notFound: false,\n      id,\n      course: data,\n      content\n    },\n    revalidate: 1\n  };\n};\nexport const getStaticPaths = () => {\n  return {\n    paths: [],\n    fallback: true\n  };\n};","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/pages/courses/[slug]/[id]/settings/index.ts"],"names":["h","useRouter","Link","useState","useEffect","Fragment","Tabs","useApi","callApi","useCourseData","useUserData","PageLoader","Box","Seperator","LabelBox","FormBox","Info","Error","Select","Input","Textarea","CheckBox","Primary","Destructive","Secondary","BackButton","IconButton","Discounts","ErrorPage","useDebouncedEffect","useFormData","courseDataQuery","Modal","getTaggedPost","Cohort","IconPicker","Cross","Pill","COPY","cancelCohort","href","WrappedCourseSettingsPage","props","notFound","CourseSettings","data","course","mutate","id","undefined","user","router","isMaintainer","course_maintainers","find","maintainer","push","gap","width","as","query","slug","type","tabs","Cohorts","CohortSettings","Details","EditDetails","Invites","Templates","CourseTemplates","AddCohort","course_cohorts","map","cohort","facilitating","cohort_facilitators","f","facilitator","enrolled","cohort_max_size","invited","newCohort","setNewCohort","start_date","start_time","facilitators","status","callCreateCohort","timezone","Date","toLocaleDateString","timeZoneName","split","onSubmit","e","preventDefault","date","x","parseInt","time","start","res","courseId","toISOString","result","people_in_cohorts","courses","name","style","required","onChange","currentTarget","value","people","display_name","username","m","onClick","filter","f2","height","placeholder","justifySelf","success","disabled","length","emailOrUsername","setEmailOrUsername","invite_only","setInviteOnly","valid","setValid","callInviteToCourse","updateStatus","callUpdateCourse","includes","onSubmitInvite","email","onSubmitToggleInviteOnly","checked","state","form","changed","reset","setState","card_image","description","prerequisites","cost","duration","maxLength","icons","setIcons","join","SubmitButtons","Maintainers","newMaintainer","setNewMaintainer","course_templates","sort","a","b","flatMap","template","gridAutoColumns","alignItems","DeleteTemplate","templateName","slice","callDelete","display","closeText","onExit","textAlign","t","getStaticProps","ctx","params","Number","isNaN","content","category_id","revalidate","getStaticPaths","paths","fallback"],"mappings":"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","sourcesContent":["import h from 'react-hyperscript'\nimport { useRouter } from 'next/router'\nimport Link from 'next/link'\nimport { useState, useEffect, Fragment } from 'react'\nimport { InferGetStaticPropsType } from 'next'\nimport styled from '@emotion/styled'\n\nimport { Tabs } from 'components/Tabs'\nimport { useApi, callApi } from 'src/apiHelpers'\nimport { Course, useCourseData, useUserData } from 'src/data'\nimport { PageLoader } from 'components/Loader'\nimport { Box, Seperator, LabelBox, FormBox } from 'components/Layout'\nimport { Info, Error, Select, Input, Textarea, CheckBox } from 'components/Form'\nimport { Primary, Destructive, Secondary, BackButton, IconButton } from 'components/Button'\nimport {Discounts} from 'components/pages/courses/settings/Discounts'\nimport ErrorPage from 'pages/404'\nimport { useDebouncedEffect, useFormData } from 'src/hooks'\nimport { courseDataQuery, UpdateCourseMsg, UpdateCourseResponse } from 'pages/api/courses/[id]'\nimport { CheckUsernameResult } from 'pages/api/get/[...item]'\nimport { CreateCohortMsg, CreateCohortResponse } from 'pages/api/cohorts'\nimport { InviteToCourseMsg, InviteToCourseResponse } from 'pages/api/courses/[id]/invite'\nimport { Modal } from 'components/Modal'\nimport { DeleteTemplateResult } from 'pages/api/courses/[id]/templates/[templateId]'\nimport { getTaggedPost } from 'src/discourse'\nimport { Cohort } from '..'\nimport { IconPicker } from 'components/IconPicker'\nimport { Cross } from 'components/Icons'\nimport { Pill } from 'components/Pill'\n\nconst COPY = {\n  cancelCohort: h(\"p.textSecondary\", [\n    `Contact us at `,\n    h(\"a\", { href: \"mailto:contact@krakenedu.com\" }, `contact@krakenedu.com`),\n    ` to cancel a cohort. Optionally,  let us know the reason youâ€™re cancelling (weâ€™re curious ðŸ¤“)`,\n  ]),\n};\n\ntype Props = InferGetStaticPropsType<typeof getStaticProps>\nconst WrappedCourseSettingsPage = (props: Props)=>props.notFound ? h(ErrorPage) : h(CourseSettings, props)\nfunction CourseSettings(props:Extract<Props, {notFound:false}>){\n  let {data: course, mutate} = useCourseData(props.id, props.course || undefined)\n  let {data: user} = useUserData()\n  let router = useRouter()\n\n  useEffect(()=>{\n    if(user === undefined) return\n    if(course) {\n      let isMaintainer = !!(course.course_maintainers.find(maintainer => user && maintainer.maintainer === user.id))\n      if(!isMaintainer) router.push('/')\n    }\n  }, [user, course])\n  if(!course || !user) return h(PageLoader)\n\n  return h(Box, { gap: 64, width: 640 }, [\n    h(Box, { gap: 16 }, [\n      h(\n        BackButton,\n        {\n          href: \"/courses/[slug]/[id]\",\n          as: `/courses/${router.query.slug}/${router.query.id}`,\n        },\n        course.type === \"club\" ? \"Club\" : \"Course\"\n      ),\n      h(\"h1\", \"Settings\"),\n      h(\"p.big\", [\n        `KrakenEdu is new and some things can only be done manually for now! To add a new maintainer, remove a cohort, or anything else you don't see here, please email `,\n        h(\"a\", { href: \"mailto:help@krakenedu.com\" }, \"help@krakenedu.com\"),\n      ]),\n    ]),\n    h(Tabs, {\n      tabs: {\n        Cohorts: h(CohortSettings, { course, mutate }),\n        Details: h(EditDetails, { course, mutate }),\n        Invites: h(Invites, { course, mutate }),\n        Templates: h(CourseTemplates, { course, mutate }),\n        Discounts: h(Discounts, { course: course.id }),\n      },\n    }),\n  ]);\n}\n\nexport default WrappedCourseSettingsPage\n\n\nfunction CohortSettings(props:{course:Course, mutate: (course:Course)=>void}) {\n  let {data: user} = useUserData()\n  return h(Box, {gap: 32}, [\n    h(AddCohort, props),\n    h(Seperator),\n    h(Box, {gap: 16}, [\n      h('h3', \"Cancel a Cohort\"),\n      COPY.cancelCohort\n    ]),\n    h(Box, [\n      h('h3', \"All Cohorts\"),\n      h(Box, {gap:32}, props.course.course_cohorts.map((cohort)=>{\n        let facilitating = !!cohort.cohort_facilitators.find(f=>user&&f.facilitator === user.id)\n        return h(Cohort, {\n          cohort,\n          enrolled: false,\n          facilitating,\n          slug: props.course.slug,\n          cohort_max_size: props.course.cohort_max_size,\n          invited: true\n        })\n      })),\n    ])\n  ])\n}\n\n//feature to add a new cohort to a course\nconst AddCohort = (props:{course:Course, mutate:(c:Course)=>void})=> {\n  let [newCohort, setNewCohort] = useState({start_date: '', start_time: '', facilitators: [] as string[]})\n  let [status, callCreateCohort] = useApi<CreateCohortMsg, CreateCohortResponse>([newCohort])\n\n  let timezone = new Date().toLocaleDateString('en-us',{timeZoneName:\"short\"}).split(', ')[1]\n\n  const onSubmit = async (e:React.FormEvent) => {\n    e.preventDefault()\n\n    let date = newCohort.start_date.split('-').map(x=>parseInt(x))\n    let time = newCohort.start_time.split(':').map(x=>parseInt(x))\n    let start = new Date(date[0], date[1] -1, date[2], time[0], time[1])\n\n    let res = await callCreateCohort(`/api/cohorts`, {courseId: props.course.id, facilitators:newCohort.facilitators, start: start.toISOString()})\n    if(res.status === 200) props.mutate({\n        ...props.course,\n        course_cohorts: [...props.course.course_cohorts, {...res.result, people_in_cohorts:[], courses: {name: props.course.name}}]\n      })\n  }\n\n  return h(FormBox, {onSubmit, gap: 32, style: {width: 400}}, [\n    h('h2', 'Add a new Cohort'),\n    status === 'error' ? h(Error, 'An error occured') : null,\n    status === 'success' ? h(Info, 'Cohort created!') : null,\n    h(LabelBox, {gap:8}, [\n      h('h4', \"Facilitator\"),\n      h(Select, {\n        required: true,\n        onChange: (e:React.ChangeEvent<HTMLSelectElement>)=> setNewCohort({...newCohort, facilitators: [...newCohort.facilitators, e.currentTarget.value]})\n      }, [\n        h('option', {value: ''}, \"Select a facilitator\"),\n        ...(props.course.course_maintainers.map(maintainer => {\n          return h('option', {value: maintainer.maintainer}, maintainer.people.display_name || maintainer.people.username)\n        })||[])\n      ]),\n      h(Box, {h:true}, newCohort.facilitators.map(f=>{\n        let facilitator = props.course.course_maintainers.find(m=>m.maintainer === f)\n        if(!facilitator) return null\n        return h(Pill, {}, h(Box, {h:true, gap:4}, [\n          h('p', facilitator.people.display_name || facilitator.people.username),\n          h(IconButton, {onClick:e=>{\n            e.preventDefault()\n            setNewCohort({...newCohort, facilitators:newCohort.facilitators.filter(f2=>f2!==f)})\n          }}, h(Cross, {width: 10, height:10}))\n        ]))\n      }))\n    ]),\n    h(Box, {h: true, gap: 32}, [\n    h(LabelBox, {gap:8}, [\n      h('h4', 'Start Date'),\n      h(Input, {\n        type: 'date',\n        placeholder: 'yyyy-mm-dd',\n        required: true,\n        value: newCohort.start_date,\n        onChange: e => setNewCohort({...newCohort, start_date: e.currentTarget.value})\n      })\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('h4', `Start time (${timezone})`),\n      h(Input, {\n        type: 'time',\n        placeholder: '23:59',\n        required: true,\n        value: newCohort.start_time,\n        onChange: e => setNewCohort({...newCohort, start_time: e.currentTarget.value})\n      })\n    ]),\n    ]),\n    h(Primary, {\n      style: {justifySelf: 'right'},\n      status,\n      type: 'submit',\n      success: status === 'success',\n      disabled: !newCohort.start_date || newCohort.facilitators.length===0\n    }, 'Add a new Cohort'),\n  ])\n}\n\nconst Invites = (props:{course:Course, mutate: (c:Course) => void})=> {\n  let [emailOrUsername, setEmailOrUsername] = useState('')\n  let [invite_only, setInviteOnly] = useState(props.course.invite_only)\n  let [valid, setValid] = useState<null | boolean>(null)\n  let [status, callInviteToCourse] = useApi<InviteToCourseMsg, InviteToCourseResponse>([emailOrUsername], ()=>setEmailOrUsername(''))\n  let [updateStatus, callUpdateCourse] = useApi<UpdateCourseMsg, UpdateCourseResponse>([])\n\n  useDebouncedEffect(async ()=>{\n    if(emailOrUsername.includes('@') || emailOrUsername === '') return setValid(null)\n    let res = await callApi<null, CheckUsernameResult>('/api/get/username/'+emailOrUsername)\n    if(res.status===404) setValid(false)\n    else setValid(true)\n  }, 500, [emailOrUsername])\n  useEffect(()=>setValid(null),[emailOrUsername])\n\n  let onSubmitInvite = async (e: React.FormEvent)=>{\n    e.preventDefault()\n    let x = emailOrUsername.includes('@') ? {email: emailOrUsername} : {username: emailOrUsername}\n    callInviteToCourse(`/api/courses/${props.course.id}/invite`, {...x})\n  }\n\n  let onSubmitToggleInviteOnly = async (e:React.FormEvent)=>{\n    e.preventDefault()\n    let res = await callUpdateCourse(`/api/courses/${props.course.id}`, {invite_only})\n    if(res.status === 200) props.mutate({...props.course, ...res.result})\n  }\n\n  return h(Box, { gap: 16, width: 400 }, [\n    h(\"h2\", \"Invites\"),\n    h(Box, { gap: 32 }, [\n      h(FormBox, { onSubmit: onSubmitToggleInviteOnly }, [\n        h(LabelBox, { gap: 8, width: 400 }, [\n          h(\"div\", [\n            h(\"h4\", \"Invite Only\"),\n            h(\n              \"small.textSecondary\",\n              `Learners cannot enroll in an invite only course unless you have sent them an\ninvite. The invite allows them enroll in any cohort and does not expire.`\n            ),\n          ]),\n          h(CheckBox, [\n            h(Input, {\n              type: \"checkbox\",\n              checked: invite_only,\n              onChange: (e) => setInviteOnly(e.currentTarget.checked),\n            }),\n            \"Make this course invite only\",\n          ]),\n        ]),\n        h(\n          Primary,\n          {\n            style: { justifySelf: \"right\" },\n            status: updateStatus,\n            type: \"submit\",\n            disabled: props.course.invite_only === invite_only,\n          },\n          \"Change\"\n        ),\n      ]),\n      !props.course.invite_only\n        ? null\n        : h(FormBox, { onSubmit: onSubmitInvite, gap: 32, width: 400 }, [\n            h(LabelBox, { gap: 8 }, [\n              h(\"h4\", \"Invite someone to enroll\"),\n              h(\n                \"small.textSecondary\",\n                `Invite someone with their username or email. Invitee does not need a KrakenEdu account to be invited, but they will need an account to enroll.`\n              ),\n              h(Input, {\n                type: emailOrUsername.includes(\"@\") ? \"email\" : \"text\",\n                value: emailOrUsername,\n                onChange: (e) => setEmailOrUsername(e.currentTarget.value),\n              }),\n              valid === null\n                ? null\n                : valid\n                ? h(\"span.accentSuccess\", \"Great, found @\" + emailOrUsername)\n                : h(\n                    \"span.accentRed\",\n                    \"We can't find a user with that username\"\n                  ),\n            ]),\n            h(\n              Primary,\n              {\n                style: { justifySelf: \"right\" },\n                status,\n                type: \"submit\",\n                disabled: !emailOrUsername.includes(\"@\") && valid !== true,\n              },\n              \"Invite\"\n            ),\n          ]),\n    ]),\n  ]);\n}\n\nconst EditDetails = (props: {course: Course, mutate:(course:Course)=>void}) => {\n  let {state, form, changed, reset, setState} = useFormData({\n    name: props.course.name,\n    card_image: props.course.card_image,\n    cohort_max_size: props.course.cohort_max_size,\n    description: props.course.description,\n    prerequisites: props.course.prerequisites,\n    cost: props.course.cost,\n    duration: props.course.duration\n  }, [props.course])\n  let [status, callUpdateCourse] = useApi<UpdateCourseMsg, UpdateCourseResponse>([])\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    let res = await callUpdateCourse(`/api/courses/${props.course.id}`, {...state})\n    if(res.status === 200) props.mutate({...props.course, ...res.result})\n  }\n\n  return h(FormBox, {onSubmit, gap:32, style:{width: 400}}, [\n    h('h2', 'Edit Details'),\n    h(LabelBox, {gap:8}, [\n      h('h4', 'Name'),\n      h(Input, {\n        type: 'text',\n        maxLength: 50,\n        ...form.name\n      }),\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('h4', 'Cost (USD)'),\n      h(Input, {\n        type: 'number',\n        ...form.cost\n      })\n    ]),\n    props.course.type === 'course' ? null : h(Box,  [\n      h(\"div\", [\n        h('h4', \"Emojis\"),\n        h('small.textSecondary', \"Select three emojis to describe your club! Repeats ok.\")\n      ]),\n      h(IconPicker, {\n        icons: state.card_image.split(','),\n        setIcons: (icons:string[]) => {\n          setState({...state, card_image: icons.join(',')})\n        }\n      })\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('div', [\n        h('h4', \"Cohort Size\"),\n        h('small.textSecondary', \"How many learners can enroll in a cohort. Set to 0 for no limit.\")\n      ]),\n      h(Input, {\n        type: 'number',\n        required: true,\n        ...form.cohort_max_size\n      })\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('h4', 'Description'),\n      h(Textarea, {\n        maxLength: 200,\n        ...form.description\n        }),\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('h4', 'Prerequisites'),\n      h(Textarea, form.prerequisites)\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('h4', 'Duration'),\n      h(Input, form.duration)\n    ]),\n    h(SubmitButtons, [\n      h(Destructive, {disabled: !changed, onClick: (e)=>{\n        e.preventDefault()\n        reset()\n      }}, \"Discard Changes\"),\n        h(Primary, {type: 'submit', disabled: !changed, status}, 'Save Changes')\n    ]),\n    h(Maintainers, props)\n  ])\n}\n\nfunction Maintainers (props: {course: Course, mutate: (c: Course)=>void}) {\n  let [newMaintainer, setNewMaintainer] = useState('')\n  return h(Box, [\n    h('h3', \"Maintainers\"),\n    ...props.course.course_maintainers.map(m=>{\n      return m.people.display_name || m.people.username\n    }),\n    h('h4', \"Add a maintainer\"),\n    h(FormBox, [\n      h(Input, {value: newMaintainer, onChange:(e)=>setNewMaintainer(e.currentTarget.value)}),\n      h(Primary, {type:'submit'}, \"Add\")\n    ])\n  ])\n}\n\nfunction CourseTemplates (props: {course: Course, mutate: (c:Course)=>void}) {\n  return h(Box, {gap: 32}, [\n    h(Box, [\n      h('p', `Each cohort comes with its own community space, and templates to help you populate its structure with topics.`),\n      h('ul', {style: {'margin': 'auto 0'}}, [\n        h('li', [\n          h('b', 'Prepopulated'), \n          h('span', ' topics are automatically posted when each new cohort is created')\n        ]),\n        h('li', [\n          h('b', 'Triggered'), \n          h('span', ' topics can be posted by the facilitator from the cohort settings (editable before publishing, so useful for creating multiple topics from one template)')\n        ])\n      ]),\n      h('p', `You can edit the default templates we've provided below, or add new ones!`),\n      h(Link, {\n        href: '/courses/[slug]/[id]/settings/templates/[templateId]',\n        as:`/courses/${props.course.slug}/${props.course.id}/settings/templates/new`\n      }, h('a', {}, h(Primary, \"+ Add A New Template\"))),\n    ]),\n    h(Box, {}, props.course.course_templates\n      .sort((a, b)=>  a.name > b.name ? 1 : -1)\n      .sort((a)=> a.required ? -1 : 1)\n      .flatMap(template => {\n        return [\n          h(Box, {h: true, style: {gridAutoColumns: 'auto'}},[\n            h('div', [\n              h('h3', template.name),\n              h('span.textSecondary', template.type ==='prepopulated' ? \"Prepopulated for all cohorts\" : \"Manually published by facilitator\")\n            ]),\n            h(Box, {h: true, style:{justifySelf: 'end', alignItems: 'center'}}, [\n              template.required ? null : h(DeleteTemplate, {course: props.course, mutate: props.mutate, templateName: template.name}),\n              h(Link, {\n                href: '/courses/[slug]/[id]/settings/templates/[templateId]',\n                as: `/courses/${props.course.slug}/${props.course.id}/settings/templates/${template.name}`\n              }, h('a', {}, h(Secondary, 'Edit')))\n            ])\n          ]),\n          h(Seperator)\n        ]}).slice(0, -1))\n  ])\n}\n\nfunction DeleteTemplate(props:{templateName:string, course:Course, mutate:(c:Course)=>void}) {\n  let [state, setState] = useState<'normal' | 'confirm'>('normal')\n  let [status, callDelete] = useApi<null, DeleteTemplateResult>([props])\n  return h(Fragment, [\n    h(Destructive, {onClick: ()=>setState('confirm')}, 'Delete'),\n    h(Modal, {display: state !== 'normal', closeText:\"nevermind\", onExit: ()=>setState('normal')}, [\n      h(Box, {gap:32, style: {textAlign: 'center'}}, [\n        h('h3', \"Are you sure?\"),\n        h('p', \"You can't undo this action!\"),\n        h(Primary, {style: {justifySelf:\"center\"}, status, onClick:async ()=>{\n          let res = await callDelete(`/api/courses/${props.course.id}/templates/${props.templateName}`, null, \"DELETE\")\n          if(res.status ===200) {\n            props.mutate({\n              ...props.course,\n              course_templates: props.course.course_templates\n                .filter(t=>t.name!==props.templateName)\n            })\n            setState('normal')\n          }\n        }}, \"Yup delete it\"),\n      ])\n    ])\n  ])\n}\n\n\nconst SubmitButtons = styled('div')`\njustify-self: right;\ndisplay: grid;\ngrid-template-columns: auto auto;\ngrid-gap: 16px;\n`\n\nexport const getStaticProps = async (ctx:any) => {\n  let id = parseInt(ctx.params?.id as string || '' )\n  if(Number.isNaN(id)) return {props: {notFound: true}} as const\n\n  let data = await courseDataQuery(id)\n  if(!data) return {props:{notFound: true}} as const\n  let content = await getTaggedPost(data.category_id, 'curriculum')\n\n  return {props: {notFound: false, id, course: data, content}, revalidate: 1} as const\n}\n\nexport const getStaticPaths = () => {\n  return {paths:[], fallback: true}\n}\n"]},"metadata":{},"sourceType":"module"}