{"ast":null,"code":"function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport h from 'react-hyperscript';\nimport { eventDataQuery } from \"pages/api/events/[id]\";\nimport ErrorPage from 'pages/404';\nimport { dateFromDateAndTimeInputs, getStripe, prettyDate, formHelper } from 'src/utils';\nimport { Box, FormBox, Seperator, Sidebar, TwoColumn } from 'components/Layout';\nimport { colors } from 'components/Tokens';\nimport Text from 'components/Text';\nimport { Primary, Secondary, Destructive } from 'components/Button';\nimport { useEventData, useUserData } from 'src/data';\nimport { PageLoader } from 'components/Loader';\nimport { useEffect, useState } from 'react';\nimport { EventForm } from 'pages/events/create';\nimport { Input } from 'components/Form';\nimport { useApi } from 'src/apiHelpers';\nimport { useRouter } from 'next/router';\nimport { StickyWrapper } from 'components/Tabs';\nimport Link from 'next/link';\nimport { TwoColumnBanner } from 'components/Banner';\nimport Head from 'next/head';\n\nconst EventPage = props => props.notFound ? h(ErrorPage) : h(EditableEvent, props);\n\nexport default EventPage;\n\nconst EditableEvent = props => {\n  var _props$standalone_eve, _props$standalone_eve2;\n\n  let {\n    data: user\n  } = useUserData();\n  let {\n    data: event,\n    mutate\n  } = useEventData(props.id);\n  let {\n    0: editting,\n    1: setEditting\n  } = useState(false);\n  let start_date = new Date(props.start_date);\n  let end_date = new Date(props.end_date);\n  let {\n    0: edittedEvent,\n    1: setEdittedEvent\n  } = useState({\n    name: props.name,\n    cost: ((_props$standalone_eve = props.standalone_events) === null || _props$standalone_eve === void 0 ? void 0 : _props$standalone_eve.cost) || 0,\n    max_attendees: ((_props$standalone_eve2 = props.standalone_events) === null || _props$standalone_eve2 === void 0 ? void 0 : _props$standalone_eve2.max_attendees) || 0,\n    description: props.description,\n    start_date: `${start_date.getFullYear()}-${('0' + (start_date.getMonth() + 1)).slice(-2)}-${('0' + start_date.getDate()).slice(-2)}`,\n    start_time: start_date.toLocaleTimeString([], {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      hour12: false\n    }),\n    end_time: end_date.toLocaleTimeString([], {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      hour12: false\n    }),\n    location: props.location\n  });\n  useEffect(() => {\n    var _event$standalone_eve, _event$standalone_eve2;\n\n    if (!event) return;\n    let start_date = new Date(event.start_date);\n    let end_date = new Date(event.end_date);\n    setEdittedEvent({\n      name: event.name,\n      cost: ((_event$standalone_eve = event.standalone_events) === null || _event$standalone_eve === void 0 ? void 0 : _event$standalone_eve.cost) || 0,\n      max_attendees: ((_event$standalone_eve2 = event.standalone_events) === null || _event$standalone_eve2 === void 0 ? void 0 : _event$standalone_eve2.max_attendees) || 0,\n      description: event.description,\n      start_date: `${start_date.getFullYear()}-${('0' + (start_date.getMonth() + 1)).slice(-2)}-${('0' + start_date.getDate()).slice(-2)}`,\n      start_time: start_date.toLocaleTimeString([], {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n      }),\n      end_time: end_date.toLocaleTimeString([], {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n      }),\n      location: event.location\n    });\n  }, [event]);\n  let [status, callUpdateEvent] = useApi([]);\n  if (props === undefined || !event) return h(PageLoader);\n  if (!props.standalone_events) return h(ErrorPage);\n\n  const onSubmit = async e => {\n    e.preventDefault();\n    let start_date = dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.start_time).toISOString();\n    let end_date = dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.end_time).toISOString();\n    let res = await callUpdateEvent('/api/events/' + props.id, {\n      data: _objectSpread(_objectSpread({}, edittedEvent), {}, {\n        start_date,\n        end_date\n      }),\n      type: 'standalone'\n    });\n\n    if (res.status === 200 && res.result.type === 'standalone') {\n      let _res$result$data = res.result.data,\n          {\n        events\n      } = _res$result$data,\n          standalone_events = _objectWithoutProperties(_res$result$data, [\"events\"]);\n\n      mutate(_objectSpread(_objectSpread({}, events), {}, {\n        standalone_events,\n        cohort_events: []\n      }));\n      setEditting(false);\n    }\n  };\n\n  if (editting) return h(FormBox, {\n    onSubmit\n  }, [h('h1', \"Edit Event\"), h(EventForm, {\n    onChange: setEdittedEvent,\n    state: edittedEvent\n  }), h('div', {\n    style: {\n      backgroundColor: colors.appBackground,\n      position: 'sticky',\n      bottom: '0',\n      padding: '16px 0',\n      margin: '-16px 0',\n      width: '100%'\n    }\n  }, [h(Box, {\n    h: true,\n    style: {\n      justifyContent: 'right'\n    }\n  }, [h(Destructive, {\n    onClick: () => setEditting(false)\n  }, \"Cancel\"), h(Primary, {\n    type: 'submit',\n    status\n  }, \"Submit\")])])]);\n  return h(\"div\", [user && props.people.id === user.id ? h(Banner, {\n    start_date: props.start_date,\n    setEditting\n  }) : null, h(Head, {\n    children: [h(\"title\", {\n      key: \"title\"\n    }, event.name), h(\"meta\", {\n      property: \"og:title\",\n      content: event.name,\n      key: \"og:title\"\n    }), h(\"meta\", {\n      property: \"og:description\",\n      content: event.description.slice(0, 140) + \"...\",\n      key: \"og:description\"\n    }), h(\"meta\", {\n      property: \"og:image\",\n      content: \"https://app.krakenedu.com/img/favicon.png\",\n      key: \"og:image\"\n    }), h(\"meta\", {\n      property: \"twitter:card\",\n      content: \"summary\",\n      key: \"twitter:card\"\n    })]\n  }), h(Event, _objectSpread(_objectSpread({\n    notFound: false\n  }, event), {}, {\n    facilitating: !!user && props.people.id === user.id,\n    rsvpd: !!event.people_in_events.find(p => user && p.person === user.id),\n    mutate\n  }))]);\n};\n\nconst Event = props => {\n  if (!props.standalone_events) return h(ErrorPage);\n  let emails = props.people_in_events.map(p => p.people.email).concat(props.no_account_rsvps.map(p => p.email));\n  return h(TwoColumn, [h(Box, {\n    gap: 32,\n    width: 640\n  }, [h('h1', props.name)]), h(Box, {\n    gap: 32\n  }, [h(Text, {\n    source: props.description\n  }), h(Seperator), h(Box, {}, [h('h2', `Facilitated by ${props.people.display_name || props.people.username}`), h(Text, {\n    source: props.people.bio || ''\n  }), h(Box, {\n    h: true\n  }, [h('h4', [`Attending `, h('span.textSecondary', props.standalone_events.max_attendees !== 0 ? `(${props.people_in_events.length + props.no_account_rsvps.length}/${props.standalone_events.max_attendees})` : `(${props.people_in_events.length + props.no_account_rsvps.length})`)]), !props.facilitating ? null : h('a', {\n    href: `mailto:?bcc=${emails.join(',')}`\n  }, 'email everyone')]), ...props.people_in_events.map(person => h(Box, {\n    h: true,\n    gap: 4\n  }, [h(Link, {\n    href: '/people/[id]',\n    as: `/people/${person.people.username}`\n  }, [h('a', {\n    className: 'notBlue'\n  }, person.people.display_name || person.people.username)]), person.people.pronouns ? h('span.textSecondary', {}, ` (${person.people.pronouns})`) : null])), ...props.no_account_rsvps.map(person => h(Box, {\n    h: true,\n    gap: 4\n  }, [person.name]))])]), h(Sidebar, [h(StickyWrapper, [h(Box, [h(Details, _objectSpread(_objectSpread({}, props.standalone_events), {}, {\n    attendees: props.people_in_events.length + props.no_account_rsvps.length,\n    facilitating: props.facilitating,\n    id: props.id,\n    start_date: props.start_date,\n    end_date: props.end_date,\n    mutate: props.mutate,\n    rsvpd: props.rsvpd,\n    location: props.location\n  }))])])])]);\n};\n\nconst Banner = props => {\n  let start_date = new Date(props.start_date);\n  if (start_date > new Date()) return h(TwoColumnBanner, {\n    red: true\n  }, [h('span', {\n    style: {\n      alignSelf: 'center'\n    }\n  }, \"You're facilitating this event\"), h(Secondary, {\n    onClick: () => props.setEditting(true)\n  }, \"Edit Event\")]);\n  return h(TwoColumnBanner, {\n    red: true\n  }, [h('span', {\n    style: {\n      alignSelf: 'center'\n    }\n  }, `Congrats! You hosted this event on ${prettyDate(props.start_date)}. You can edit the description to add any artifacts.`), h(Secondary, {\n    onClick: () => props.setEditting(true)\n  }, \"Edit Event\")]);\n};\n\nconst Details = props => {\n  let start_date = new Date(props.start_date);\n  let end_date = new Date(props.end_date);\n  let start = start_date.toLocaleTimeString([], {\n    hour12: true,\n    minute: '2-digit',\n    hour: 'numeric'\n  });\n  let end = end_date.toLocaleTimeString([], {\n    hour12: true,\n    minute: '2-digit',\n    hour: 'numeric',\n    timeZoneName: \"short\"\n  });\n  return h(Box, {\n    style: {\n      alignSelf: 'center'\n    }\n  }, [h('div', {\n    style: {\n      alignSelf: 'center'\n    }\n  }, [h('h1', props.cost !== 0 ? `$${props.cost}` : \"FREE\"), h('h3', `${start_date.toLocaleDateString([], {\n    weekday: 'short'\n  })} ${prettyDate(props.start_date)}`), h('h4.textSecondary', `@ ${start} - ${end}`)]), h(JoinButton, props), !props.rsvpd && props.max_attendees ? h('b', `${props.attendees}/${props.max_attendees} spots filled`) : null]);\n};\n\nconst JoinButton = props => {\n  let [status, callRSVP] = useApi([]);\n  let {\n    data: user\n  } = useUserData();\n  let router = useRouter();\n  let {\n    0: formState,\n    1: setFormState\n  } = useState({\n    email: '',\n    name: ''\n  });\n  let form = formHelper(formState, setFormState);\n  if (new Date(props.end_date) < new Date()) return h('p.big', \"This event has concluded\");\n  if (props.max_attendees && props.attendees >= props.max_attendees) return h('p.big', \"Sorry, this event is full!\");\n  if (props.rsvpd || props.facilitating) return h('a', {\n    href: props.location\n  }, h(Primary, \"Join Event\"));\n\n  if (props.cost === 0 && !user) {\n    if (status === 'success') return h('p.accentSuccess', \"You're RSVP'd! Check your email for an event invite, and any updates\");\n    return h(FormBox, {\n      onSubmit: async e => {\n        e.preventDefault();\n        let result = await callRSVP(`/api/events/${props.id}/rsvp`, {\n          email: form.email.value,\n          name: form.name.value\n        });\n        if (result.status === 200) props.mutate(data => {\n          if (!data || !user) return data;\n          return _objectSpread(_objectSpread({}, data), {}, {\n            no_accounts_rsvps: [...data.no_account_rsvps, {\n              name: form.name.value,\n              email: ''\n            }]\n          });\n        });\n      }\n    }, [h(Input, _objectSpread({\n      placeholder: \"Your email\",\n      type: 'email'\n    }, form.email)), h(Input, _objectSpread({\n      placeholder: \"Your name\"\n    }, form.name)), h(Box, {\n      gap: 4,\n      style: {\n        justifySelf: 'right',\n        textAlign: 'right'\n      }\n    }, [h(Primary, {\n      status,\n      type: 'submit'\n    }, \"RSVP\"), h(Link, {\n      href: `/login?redirect=${encodeURIComponent(router.asPath)}`\n    }, h('a', 'or sign in'))])]);\n  }\n\n  return h(Primary, {\n    onClick: async () => {\n      if (user === false) router.push('/login?redirect=' + encodeURIComponent(router.asPath));else {\n        let result = await callRSVP(`/api/events/${props.id}/rsvp`);\n\n        if (result.status === 200) {\n          if (result.result.enrolled) props.mutate(data => {\n            if (!data || !user) return data;\n            return _objectSpread(_objectSpread({}, data), {}, {\n              people_in_events: [{\n                person: user.id,\n                event: props.id,\n                people: {\n                  username: user.username,\n                  display_name: user.display_name || '',\n                  pronouns: '',\n                  email: ''\n                }\n              }]\n            });\n          });else {\n            let stripe = await getStripe();\n            stripe === null || stripe === void 0 ? void 0 : stripe.redirectToCheckout({\n              sessionId: result.result.sessionId\n            });\n          }\n        }\n      }\n    },\n    status\n  }, \"RSVP\");\n};\n\nexport const getStaticProps = async ctx => {\n  var _ctx$params;\n\n  let eventID = parseInt((_ctx$params = ctx.params) === null || _ctx$params === void 0 ? void 0 : _ctx$params.id);\n  if (Number.isNaN(eventID)) return {\n    props: {\n      notFound: true\n    }\n  };\n  let data = await eventDataQuery(eventID);\n  if (!data || data.standalone_events === null) return {\n    props: {\n      notFound: true\n    }\n  };\n  return {\n    props: _objectSpread({\n      notFound: false\n    }, data),\n    revalidate: 1\n  };\n};\nexport const getStaticPaths = async () => {\n  return {\n    paths: [],\n    fallback: true\n  };\n};","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/pages/events/[id].ts"],"names":["h","eventDataQuery","ErrorPage","dateFromDateAndTimeInputs","getStripe","prettyDate","formHelper","Box","FormBox","Seperator","Sidebar","TwoColumn","colors","Text","Primary","Secondary","Destructive","useEventData","useUserData","PageLoader","useEffect","useState","EventForm","Input","useApi","useRouter","StickyWrapper","Link","TwoColumnBanner","Head","EventPage","props","notFound","EditableEvent","data","user","event","mutate","id","editting","setEditting","start_date","Date","end_date","edittedEvent","setEdittedEvent","name","cost","standalone_events","max_attendees","description","getFullYear","getMonth","slice","getDate","start_time","toLocaleTimeString","hour","minute","hour12","end_time","location","status","callUpdateEvent","undefined","onSubmit","e","preventDefault","toISOString","res","type","result","events","cohort_events","onChange","state","style","backgroundColor","appBackground","position","bottom","padding","margin","width","justifyContent","onClick","people","Banner","children","key","property","content","Event","facilitating","rsvpd","people_in_events","find","p","person","emails","map","email","concat","no_account_rsvps","gap","source","display_name","username","bio","length","href","join","as","className","pronouns","Details","attendees","red","alignSelf","start","end","timeZoneName","toLocaleDateString","weekday","JoinButton","callRSVP","router","formState","setFormState","form","value","no_accounts_rsvps","placeholder","justifySelf","textAlign","encodeURIComponent","asPath","push","enrolled","stripe","redirectToCheckout","sessionId","getStaticProps","ctx","eventID","parseInt","params","Number","isNaN","revalidate","getStaticPaths","paths","fallback"],"mappings":"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","sourcesContent":["import h from 'react-hyperscript'\nimport { eventDataQuery, UpdateEventMsg, UpdateEventResult } from \"pages/api/events/[id]\"\nimport ErrorPage from 'pages/404'\nimport { InferGetStaticPropsType } from \"next\"\nimport { dateFromDateAndTimeInputs, getStripe, prettyDate, formHelper } from 'src/utils'\nimport { Box, FormBox, Seperator, Sidebar, TwoColumn } from 'components/Layout'\nimport {colors} from 'components/Tokens'\nimport Text from 'components/Text'\nimport { Primary, Secondary, Destructive } from 'components/Button'\nimport { useEventData, useUserData } from 'src/data'\nimport { PageLoader } from 'components/Loader'\nimport { useEffect, useState } from 'react'\nimport { EventForm } from 'pages/events/create'\nimport { Input } from 'components/Form'\nimport { useApi } from 'src/apiHelpers'\nimport { EventRSVPResult, EventRSVPMessage } from 'pages/api/events/[id]/rsvp'\nimport { useRouter } from 'next/router'\nimport { StickyWrapper } from 'components/Tabs'\nimport Link from 'next/link'\nimport { TwoColumnBanner } from 'components/Banner'\nimport Head from 'next/head'\n\ntype Props = InferGetStaticPropsType<typeof getStaticProps>\nconst EventPage = (props: Props)=> props.notFound ? h(ErrorPage) : h(EditableEvent, props)\nexport default EventPage\n\nconst EditableEvent = (props: Extract<Props, {notFound: false}>) => {\n  let {data: user} = useUserData()\n  let {data: event, mutate} = useEventData(props.id)\n  let [editting, setEditting] = useState(false)\n\n  let start_date = new Date(props.start_date)\n  let end_date = new Date(props.end_date)\n\n  let [edittedEvent, setEdittedEvent] =  useState({\n    name: props.name,\n    cost: props.standalone_events?.cost || 0,\n    max_attendees: props.standalone_events?.max_attendees || 0,\n    description: props.description,\n    start_date: `${start_date.getFullYear()}-${('0'+(start_date.getMonth()+1)).slice(-2)}-${('0'+start_date.getDate()).slice(-2)}`,\n    start_time: start_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n    end_time: end_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n    location: props.location,\n  })\n  useEffect(()=>{\n    if(!event) return\n    let start_date = new Date(event.start_date)\n    let end_date = new Date(event.end_date)\n    setEdittedEvent({\n      name: event.name,\n      cost: event.standalone_events?.cost || 0,\n      max_attendees: event.standalone_events?.max_attendees || 0,\n      description: event.description,\n      start_date: `${start_date.getFullYear()}-${('0'+(start_date.getMonth()+1)).slice(-2)}-${('0'+start_date.getDate()).slice(-2)}`,\n      start_time: start_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n      end_time: end_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n      location: event.location,\n  })\n  }, [event])\n  let [status, callUpdateEvent] = useApi<UpdateEventMsg, UpdateEventResult>([])\n\n  if(props === undefined|| !event) return h(PageLoader)\n  if(!props.standalone_events) return h(ErrorPage)\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    let start_date = dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.start_time).toISOString()\n    let end_date =dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.end_time).toISOString()\n\n    let res = await callUpdateEvent('/api/events/'+props.id, {data:{...edittedEvent, start_date, end_date}, type: 'standalone', })\n    if(res.status===200 && res.result.type === 'standalone') {\n      let {events, ...standalone_events} = res.result.data\n      mutate({\n        ...events,\n        standalone_events,\n        cohort_events: [],\n      })\n      setEditting(false)\n    }\n  }\n\n  if(editting) return h(FormBox, {onSubmit}, [\n    h('h1', \"Edit Event\"),\n    h(EventForm, {onChange: setEdittedEvent, state:edittedEvent}),\n    h('div', {style:{\n      backgroundColor: colors.appBackground,\n      position: 'sticky',\n      bottom: '0',\n      padding: '16px 0',\n      margin: '-16px 0',\n      width: '100%'\n    }},[\n      h(Box, {h:true, style:{justifyContent: 'right'}}, [\n        h(Destructive, {onClick: ()=>setEditting(false)}, \"Cancel\"),\n        h(Primary, {type: 'submit' ,status}, \"Submit\")\n      ])\n    ])\n  ])\n  return h(\"div\", [\n    user && props.people.id === user.id\n      ? h(Banner, { start_date: props.start_date, setEditting })\n      : null,\n    h(Head, {\n      children: [\n        h(\"title\", { key: \"title\" }, event.name),\n        h(\"meta\", {\n          property: \"og:title\",\n          content: event.name,\n          key: \"og:title\",\n        }),\n        h(\"meta\", {\n          property: \"og:description\",\n          content: event.description.slice(0, 140) + \"...\",\n          key: \"og:description\",\n        }),\n        h(\"meta\", {\n          property: \"og:image\",\n          content: \"https://app.krakenedu.com/img/favicon.png\",\n          key: \"og:image\",\n        }),\n        h(\"meta\", {\n          property: \"twitter:card\",\n          content: \"summary\",\n          key: \"twitter:card\",\n        }),\n      ],\n    }),\n    h(Event, {\n      notFound: false as false,\n      ...event,\n      facilitating: !!user && props.people.id === user.id,\n      rsvpd: !!event.people_in_events.find((p) => user && p.person === user.id),\n      mutate,\n    }),\n  ]);\n}\n\n\nconst Event = (props: Extract<Props, {notFound: false}> & {facilitating: boolean, rsvpd: boolean, mutate: ReturnType<typeof useEventData>[\"mutate\"]}) => {\n  if(!props.standalone_events) return h(ErrorPage)\n\n  let emails = props.people_in_events\n    .map(p=>p.people.email)\n    .concat(props.no_account_rsvps.map(p=>p.email))\n\n  return h(TwoColumn, [\n    h(Box, {gap:32, width: 640}, [\n      h('h1', props.name),\n    ]),\n    h(Box, {gap:32}, [\n      h(Text, {source: props.description}),\n      h(Seperator),\n      h(Box, {}, [\n        h('h2', `Facilitated by ${props.people.display_name || props.people.username}`),\n        h(Text, {source: props.people.bio || ''}),\n\n        h(Box, {h:true}, [\n          h('h4', [`Attending `, h('span.textSecondary', props.standalone_events.max_attendees !== 0 ?\n            `(${props.people_in_events.length + props.no_account_rsvps.length}/${props.standalone_events.max_attendees})` :\n            `(${props.people_in_events.length + props.no_account_rsvps.length})`)]),\n          !props.facilitating ? null : h('a', {\n            href:`mailto:?bcc=${emails.join(',')}`\n          }, 'email everyone')\n        ]),\n        ...props.people_in_events.map(person=>h(Box, {h:true, gap:4}, [\n          h(Link, {\n            href: '/people/[id]',\n            as: `/people/${person.people.username}`\n          }, [\n            h('a', {className: 'notBlue'}, person.people.display_name || person.people.username),\n          ]),\n          person.people.pronouns ? h('span.textSecondary', {}, ` (${person.people.pronouns})`) : null\n        ])),\n        ...props.no_account_rsvps.map(person=>h(Box, {h:true, gap:4}, [\n          person.name\n        ]))\n      ]),\n    ]),\n\n    h(Sidebar, [\n      h(StickyWrapper, [\n        h(Box, [\n          h(Details, {\n            ...props.standalone_events,\n            attendees: props.people_in_events.length + props.no_account_rsvps.length,\n            facilitating: props.facilitating,\n            id: props.id,\n            start_date: props.start_date,\n            end_date: props.end_date,\n            mutate: props.mutate,\n            rsvpd: props.rsvpd,\n            location: props.location\n          }),\n        ])\n      ])\n    ])\n  ])\n}\n\nconst Banner = (props:{start_date: string, setEditting: (b:boolean)=>void})=>{\n  let start_date = new Date(props.start_date)\n  if(start_date > new Date()) return h(TwoColumnBanner, {red: true}, [\n    h('span', {style:{alignSelf: 'center'}}, \"You're facilitating this event\"),\n    h(Secondary, {onClick: ()=>props.setEditting(true)}, \"Edit Event\")\n  ])\n\n  return h(TwoColumnBanner, {red: true}, [\n    h('span', {style:{alignSelf: 'center'}}, `Congrats! You hosted this event on ${prettyDate(props.start_date)}. You can edit the description to add any artifacts.`),\n    h(Secondary, {onClick: ()=>props.setEditting(true)}, \"Edit Event\")\n  ])\n}\n\ntype DetailsProps = {\n  start_date: string,\n  end_date: string,\n  attendees: number,\n  cost:number,\n  mutate: ReturnType<typeof useEventData>['mutate'],\n  max_attendees:number|null,\n  id: number,\n  rsvpd: boolean,\n  location: string,\n  facilitating: boolean,\n}\nconst Details = (props:DetailsProps)=>{\n  let start_date = new Date(props.start_date)\n  let end_date = new Date(props.end_date)\n\n  let start = start_date.toLocaleTimeString([], {hour12: true, minute: '2-digit', hour:'numeric'})\n  let end = end_date.toLocaleTimeString([], {hour12: true, minute: '2-digit', hour:'numeric', timeZoneName: \"short\"})\n  return h(Box,{style:{alignSelf: 'center'}}, [\n    h('div', {style:{alignSelf:'center'}}, [\n      h('h1', props.cost !== 0 ? `$${props.cost}` : \"FREE\"),\n      h('h3',  `${start_date.toLocaleDateString([], {weekday: 'short'})} ${prettyDate(props.start_date)}`),\n      h('h4.textSecondary', `@ ${start} - ${end}`),\n    ]),\n    h(JoinButton, props),\n    !(props.rsvpd) && props.max_attendees ? h('b', `${props.attendees}/${props.max_attendees} spots filled`) : null,\n  ])\n}\n\nconst JoinButton = (props:DetailsProps)=>{\n  let [status, callRSVP] = useApi<EventRSVPMessage, EventRSVPResult>([])\n  let {data: user} = useUserData()\n  let router=useRouter()\n\n  let [formState, setFormState] = useState({email: '', name: ''})\n  let form = formHelper(formState, setFormState)\n\n  if(new Date(props.end_date) < new Date()) return h('p.big', \"This event has concluded\")\n  if(props.max_attendees && props.attendees >= props.max_attendees) return h('p.big', \"Sorry, this event is full!\")\n\n  if(props.rsvpd || props.facilitating) return h('a', {href: props.location}, h(Primary, \"Join Event\"))\n\n  if(props.cost === 0 && !user) {\n    if(status === 'success') return h('p.accentSuccess', \"You're RSVP'd! Check your email for an event invite, and any updates\")\n    return h(FormBox, {onSubmit: async (e) => {\n        e.preventDefault()\n        let result = await callRSVP(`/api/events/${props.id}/rsvp`, {\n          email: form.email.value,\n          name: form.name.value\n        })\n        if(result.status === 200) props.mutate((data)=>{\n          if(!data || !user) return data\n          return {\n            ...data,\n            no_accounts_rsvps: [...data.no_account_rsvps, {name: form.name.value, email:''}]\n          }\n        })\n      }}, [\n        h(Input, {placeholder: \"Your email\", type: 'email', ...form.email}),\n        h(Input, {placeholder: \"Your name\", ...form.name}),\n        h(Box, {gap: 4, style:{justifySelf: 'right', textAlign: 'right'}}, [\n        h(Primary, {\n          status,\n          type: 'submit',\n        }, \"RSVP\"),\n          h(Link, {href: `/login?redirect=${encodeURIComponent(router.asPath)}`}, h('a', 'or sign in'))\n        ])\n      ])\n  }\n\n  return h(Primary, {\n      onClick: async ()=> {\n        if(user === false) router.push('/login?redirect=' + encodeURIComponent(router.asPath))\n        else {\n          let result = await callRSVP(`/api/events/${props.id}/rsvp`)\n          if(result.status===200) {\n            if(result.result.enrolled) props.mutate((data)=>{\n              if(!data || !user) return data\n              return {...data, people_in_events:[{person: user.id, event: props.id, people:{username: user.username, display_name: user.display_name || '', pronouns: '', email:''}}]}\n\n            })\n            else  {\n              let stripe = await getStripe()\n              stripe?.redirectToCheckout({sessionId: result.result.sessionId})\n            }\n          }\n        }\n      }, status}, \"RSVP\")\n}\n\nexport const getStaticProps = async (ctx:any)=>{\n  let eventID = parseInt(ctx.params?.id as string)\n  if(Number.isNaN(eventID)) return {props:{notFound:true}} as const\n  let data = await eventDataQuery(eventID)\n\n  if(!data || data.standalone_events===null) return {props: {notFound: true}} as const\n\n  return {props: {notFound: false, ...data}, revalidate:1} as const\n}\n\nexport const getStaticPaths = async ()=>{\n  return {paths:[], fallback: true}\n}\n"]},"metadata":{},"sourceType":"module"}