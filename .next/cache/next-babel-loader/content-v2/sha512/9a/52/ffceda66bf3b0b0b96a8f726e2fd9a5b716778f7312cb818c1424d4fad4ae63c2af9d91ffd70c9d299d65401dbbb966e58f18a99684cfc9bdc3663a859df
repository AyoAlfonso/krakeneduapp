{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport h from \"react-hyperscript\";\nimport { useUserData } from \"src/data\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useApi } from \"src/apiHelpers\";\nimport { getDiscounts, setDiscounts } from \"src/clientData\";\nimport { Box } from \"components/Layout\";\nimport { Modal } from \"components/Modal\";\nimport { Primary } from \"components/Button\";\nimport compress from \"src/paystack/compress-data\";\nimport toast from \"react-hot-toast\"; // import {PaystackProps} from 'src/paystack/types';\n// import Toast from 'light-toast';\n\nvar errorNotify = function errorNotify(msg) {\n  return toast.error(msg, {\n    icon: \"ðŸ˜Ÿ\"\n  });\n};\n\nvar successNotify = function successNotify(msg) {\n  return toast.success(msg, {\n    icon: \"ðŸ‘\"\n  });\n};\n\nvar defaultConfig = {\n  publicKey: process.env.NEXT_PUBLIC_PAYSTACK_KEY\n};\n\nvar onSuccess = function onSuccess() {\n  successNotify(\"Your payment was successful!\");\n};\n\nvar onClose = function onClose() {\n  errorNotify(\"Your payment failed, try again?\");\n};\n\nvar paystackHook = function paystackHook(config) {\n  try {\n    var initializePayment = compress(config, defaultConfig); // @ts-ignore\n\n    initializePayment(onSuccess, onClose)();\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nexport var SubEnrollButton = function SubEnrollButton(props) {\n  var _useUserData = useUserData(),\n      user = _useUserData.data;\n\n  var router = useRouter();\n\n  var _useState = useState(false),\n      error = _useState[0],\n      setError = _useState[1];\n\n  var _useApi = useApi([], /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(res) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!res.zeroCost) {\n                _context.next = 3;\n                break;\n              }\n\n              _context.next = 3;\n              return router.push(\"/courses/[slug]/[id]/cohorts/[cohortId]\", \"/courses/\".concat(router.query.slug, \"/\").concat(props.course, \"/cohorts/\").concat(props.id, \"?welcome\"));\n\n            case 3:\n              paystackHook(res);\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }()),\n      _useApi2 = _slicedToArray(_useApi, 2),\n      status = _useApi2[0],\n      callEnroll = _useApi2[1];\n\n  var onClick = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var discount, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!(user === false)) {\n                _context2.next = 4;\n                break;\n              }\n\n              _context2.next = 4;\n              return router.push(\"/login?redirect=\" + encodeURIComponent(router.asPath));\n\n            case 4:\n              if (props.id) {\n                _context2.next = 6;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 6:\n              discount = getDiscounts().find(function (d) {\n                return d.course === props.course;\n              });\n              _context2.next = 9;\n              return callEnroll(\"/api/cohorts/\".concat(props.id, \"/enroll\"), {\n                discount: discount === null || discount === void 0 ? void 0 : discount.code,\n                paystack: true\n              });\n\n            case 9:\n              res = _context2.sent;\n\n              if (res.status === 403) {\n                setError(true);\n                setDiscounts(getDiscounts().filter(function (d) {\n                  return res.status === 403 && d.code !== res.result.discount;\n                }));\n              }\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onClick(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return h(Box, {\n    gap: 4,\n    style: {\n      alignItems: \"center\"\n    }\n  }, [h(Modal, {\n    display: error\n  }, [h(\"h3\", \"Sorry, the discount code you're using is no longer valid\")]), h(Primary, {\n    onClick: onClick,\n    status: status,\n    disabled: !props.invited || props.max_size !== 0 && props.max_size === props.learners\n  }, props.children)]);\n};","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/components/Course/SubEnrollButton.ts"],"names":["h","useUserData","useRouter","useState","useApi","getDiscounts","setDiscounts","Box","Modal","Primary","compress","toast","errorNotify","msg","error","icon","successNotify","success","defaultConfig","publicKey","process","env","NEXT_PUBLIC_PAYSTACK_KEY","onSuccess","onClose","paystackHook","config","initializePayment","console","log","SubEnrollButton","props","user","data","router","setError","res","zeroCost","push","query","slug","course","id","status","callEnroll","onClick","e","preventDefault","encodeURIComponent","asPath","discount","find","d","code","paystack","filter","result","gap","style","alignItems","display","disabled","invited","max_size","learners","children"],"mappings":"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","sourcesContent":["import h from \"react-hyperscript\";\nimport { useUserData } from \"src/data\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useApi } from \"src/apiHelpers\";\nimport { EnrollMsg, EnrollResponse } from \"pages/api/cohorts/[cohortId]/enroll\";\nimport { getDiscounts, setDiscounts } from \"src/clientData\";\nimport { Box } from \"components/Layout\";\nimport { Modal } from \"components/Modal\";\nimport { Primary } from \"components/Button\";\nimport compress from \"src/paystack/compress-data\"\nimport toast from \"react-hot-toast\";\n// import {PaystackProps} from 'src/paystack/types';\n// import Toast from 'light-toast';\n\nconst errorNotify = (msg: string) =>\n  toast.error(msg, {\n    icon: \"ðŸ˜Ÿ\",\n  });\n\nconst successNotify = (msg: string) =>\n  toast.success(msg, {\n    icon: \"ðŸ‘\",\n  });\n\nconst defaultConfig = {\n  publicKey: process.env.NEXT_PUBLIC_PAYSTACK_KEY,\n};\n\nconst onSuccess = () => {\n  successNotify(\"Your payment was successful!\");\n};\n\nconst onClose = () => {\n  errorNotify(\"Your payment failed, try again?\");\n};\n\nconst paystackHook = (config:{}) => {\n  try {\n    let initializePayment = compress(config, defaultConfig)\n    // @ts-ignore\n    initializePayment(onSuccess, onClose)();\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nexport const SubEnrollButton: React.FC<{\n  id: number;\n  course: number;\n  max_size: number;\n  learners: number;\n  invited: boolean;\n}> = (props) => {\n  let { data: user } = useUserData();\n  let router = useRouter();\n  let [error, setError] = useState(false);\n  let [status, callEnroll] = useApi<EnrollMsg, EnrollResponse>(\n    [],\n    async (res) => {\n    \n      if (res.zeroCost)\n        await router.push(\n          \"/courses/[slug]/[id]/cohorts/[cohortId]\",\n          `/courses/${router.query.slug}/${props.course}/cohorts/${props.id}?welcome`\n        );\n      paystackHook(res);\n    }\n  );\n\n  let onClick = async (e: React.MouseEvent) => {\n    e.preventDefault();\n    if (user === false)\n      await router.push(\"/login?redirect=\" + encodeURIComponent(router.asPath));\n    if (!props.id) return;\n    let discount = getDiscounts().find((d) => d.course === props.course);\n    let res = await callEnroll(`/api/cohorts/${props.id}/enroll`, {\n      discount: discount?.code,\n      paystack: true,\n    });\n\n    if (res.status === 403) {\n      setError(true);\n      setDiscounts(\n        getDiscounts().filter(\n          (d) => res.status === 403 && d.code !== res.result.discount\n        )\n      );\n    }\n  };\n\n  return h(Box, { gap: 4, style: { alignItems: \"center\" } }, [\n    h(Modal, { display: error }, [\n      h(\"h3\", \"Sorry, the discount code you're using is no longer valid\"),\n    ]),\n    h(\n      Primary,\n      {\n        onClick,\n        status,\n        disabled:\n          !props.invited ||\n          (props.max_size !== 0 && props.max_size === props.learners),\n      },\n      props.children as React.ReactElement\n    ),\n  ]);\n};\n"]},"metadata":{},"sourceType":"module"}