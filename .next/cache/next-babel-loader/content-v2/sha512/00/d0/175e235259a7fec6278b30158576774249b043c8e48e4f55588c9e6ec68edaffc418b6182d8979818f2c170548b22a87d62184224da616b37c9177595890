{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useRef } from \"react\";\nimport h from 'react-hyperscript';\nimport { useDiscounts } from \"src/data\";\nimport { useApi } from \"src/apiHelpers\";\nimport { Box, FormBox, LabelBox } from \"components/Layout\";\nimport { Input, Radio } from \"components/Form\";\nimport { PageLoader } from \"components/Loader\";\nimport { Primary, Secondary, Destructive } from \"components/Button\";\nimport { colors } from \"components/Tokens\";\nexport function Discounts(props) {\n  let {\n    data: discounts,\n    mutate\n  } = useDiscounts(props.course);\n  let {\n    0: newDiscount,\n    1: setNewDiscount\n  } = useState({\n    name: '',\n    type: \"absolute\",\n    limited_uses: false,\n    amount: 0,\n    max_redeems: undefined\n  });\n  let [status, callCreateDiscount] = useApi([newDiscount, mutate], res => {\n    if (!discounts) return;\n    mutate(discounts.concat([res]));\n  });\n\n  let onSubmit = e => {\n    e.preventDefault();\n    callCreateDiscount(`/api/courses/${props.course}/discounts`, newDiscount);\n  };\n\n  return h(Box, {\n    gap: 32\n  }, [h(Box, {\n    width: 640,\n    padding: 32,\n    style: {\n      backgroundColor: colors.accentPeach\n    }\n  }, [h(FormBox, {\n    gap: 32,\n    onSubmit,\n    width: 400\n  }, [h('h3', \"Add a New Discount\"), h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Discount Name\"), h(Input, {\n    type: 'text',\n    required: true,\n    value: newDiscount.name,\n    onChange: e => setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n      name: e.currentTarget.value\n    }))\n  })]), h(Box, {\n    h: true,\n    gap: 64\n  }, [h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Type\"), h('div', {\n    style: {\n      alignSelf: 'center',\n      padding: '13px 0px'\n    }\n  }, [h(Radio, {\n    h: true,\n    name: 'type',\n    selected: newDiscount.type,\n    onChange: value => {\n      setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        type: value\n      }));\n    },\n    items: [{\n      value: \"percentage\",\n      component: h('span', '%')\n    }, {\n      value: 'absolute',\n      component: h('span', \"$\")\n    }]\n  })])]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Amount Off\"), h(Input, {\n    type: 'number',\n    value: newDiscount.amount,\n    onChange: e => setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n      amount: parseInt(e.currentTarget.value)\n    }))\n  })])]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Usage Restrictions\"), h(Radio, {\n    name: \"usage-restrictions\",\n    selected: newDiscount.limited_uses ? 'limited' : 'unlimited',\n    onChange: value => {\n      setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        limited_uses: value === 'limited'\n      }));\n    },\n    items: [{\n      value: 'unlimited',\n      component: h('p', `Unlimited uses. Discount is valid until you cancel it`)\n    }, {\n      value: 'limited',\n      component: h('p', `Limited uses. Discount is only valid for a number of uses`)\n    }]\n  })]), newDiscount.limited_uses ? h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Max uses'), h(Input, {\n    type: 'number',\n    value: newDiscount.max_redeems,\n    onChange: e => {\n      setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        max_redeems: parseInt(e.currentTarget.value)\n      }));\n    }\n  })]) : null, h(Primary, {\n    type: 'submit',\n    status\n  }, \"Create New Discount\")])]), h('h2', \"Discounts\"), h('p', `Copy the Share Links below and send them to people to offer them a discounted rate on your course!)`), !discounts ? h(PageLoader) : h(Box, {\n    gap: 32\n  }, discounts.map(discount => h('div', [h(DiscountItem, {\n    discount,\n    delete: () => {\n      if (!discounts) return;\n      mutate(discounts.filter(d => d.code !== discount.code));\n    }\n  })])))]);\n}\n\nfunction DiscountItem(props) {\n  let ref = useRef(null);\n  let [status, callDelete] = useApi([props], props.delete);\n  return h(Box, {\n    gap: 8\n  }, [h(\"h3\", props.discount.name), h(\"div\", [h(\"span.textSecondary\", `${props.discount.type === \"absolute\" ? \"$\" + props.discount.amount : props.discount.amount + \"%\"} off`), h(\"span.textSecondary\", ` | Redeemed ${props.discount.max_redeems === 0 ? props.discount.redeems : `${props.discount.redeems}/${props.discount.max_redeems}`} times`)]), h(Box, {\n    h: true,\n    style: {\n      alignItems: \"center\"\n    }\n  }, [h(Input, {\n    onFocus: e => {\n      e.currentTarget.selectionEnd = e.currentTarget.value.length;\n    },\n    style: {\n      width: \"360px\",\n      textDecoration: \"underline\",\n      color: \"blue\"\n    },\n    readOnly: true,\n    value: `https://app.krakenedu.com/discount?discount=${props.discount.code}`,\n    ref: ref\n  }), h(Secondary, {\n    disabled: props.discount.max_redeems !== 0 && props.discount.max_redeems <= props.discount.redeems,\n    onClick: e => {\n      e.preventDefault();\n      if (!ref.current) return;\n      ref.current.select();\n      document.execCommand(\"copy\");\n      ref.current.selectionEnd = ref.current.selectionStart;\n      ref.current.blur();\n    }\n  }, \"Copy\"), h(Destructive, {\n    status,\n    onClick: e => {\n      e.preventDefault();\n      callDelete(\"/api/discounts/\" + props.discount.code, null, \"DELETE\");\n    }\n  }, \"Delete\")])]);\n}","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/components/pages/courses/settings/Discounts.ts"],"names":["useState","useRef","h","useDiscounts","useApi","Box","FormBox","LabelBox","Input","Radio","PageLoader","Primary","Secondary","Destructive","colors","Discounts","props","data","discounts","mutate","course","newDiscount","setNewDiscount","name","type","limited_uses","amount","max_redeems","undefined","status","callCreateDiscount","res","concat","onSubmit","e","preventDefault","gap","width","padding","style","backgroundColor","accentPeach","required","value","onChange","currentTarget","alignSelf","selected","items","component","parseInt","map","discount","DiscountItem","delete","filter","d","code","ref","callDelete","redeems","alignItems","onFocus","selectionEnd","length","textDecoration","color","readOnly","disabled","onClick","current","select","document","execCommand","selectionStart","blur"],"mappings":"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","sourcesContent":["import { useState, useRef } from \"react\"\nimport h from 'react-hyperscript'\nimport { useDiscounts } from \"src/data\"\nimport { CreateDiscountMsg, CreateDiscountResult } from \"pages/api/courses/[id]/discounts\"\nimport { useApi } from \"src/apiHelpers\"\nimport { Box, FormBox, LabelBox } from \"components/Layout\"\nimport { Input, Radio } from \"components/Form\"\nimport { PageLoader } from \"components/Loader\"\nimport { Primary, Secondary, Destructive } from \"components/Button\"\nimport { course_discounts } from \"@prisma/client\"\nimport { DeleteDiscountResult } from \"pages/api/discounts/[code]\"\nimport { colors } from \"components/Tokens\"\n\nexport function Discounts(props: {course:number}) {\n  let {data: discounts, mutate} = useDiscounts(props.course)\n  let [newDiscount, setNewDiscount] = useState<CreateDiscountMsg & {limited_uses: boolean}>({\n    name: '',\n    type: \"absolute\",\n    limited_uses: false,\n    amount: 0,\n    max_redeems: undefined\n  })\n  let [status, callCreateDiscount] = useApi<CreateDiscountMsg, CreateDiscountResult>([newDiscount, mutate], (res)=>{\n    if(!discounts) return\n    mutate(discounts.concat([res]))\n  })\n  let onSubmit = (e:React.FormEvent) => {\n    e.preventDefault()\n    callCreateDiscount(`/api/courses/${props.course}/discounts`, newDiscount)\n  }\n  return h(Box, {gap:32}, [\n    h(Box, {width: 640, padding: 32, style:{backgroundColor: colors.accentPeach}}, [\n    h(FormBox, {gap:32, onSubmit, width: 400}, [\n      h('h3', \"Add a New Discount\"),\n      h(LabelBox, {gap:8}, [\n        h('h4', \"Discount Name\"),\n        h(Input, {\n          type: 'text',\n          required: true,\n          value: newDiscount.name,\n          onChange:e =>setNewDiscount({...newDiscount, name: e.currentTarget.value})\n        })\n      ]),\n      h(Box, {h: true, gap:64}, [\n        h(LabelBox, {gap:8}, [\n          h('h4', \"Type\"),\n          h('div', {style: {alignSelf: 'center', padding: '13px 0px'}}, [\n            h(Radio, {\n              h: true,\n              name: 'type',\n              selected: newDiscount.type,\n              onChange: (value) => {\n                setNewDiscount({...newDiscount, type: value as typeof newDiscount.type})\n              },\n              items: [\n                {value: \"percentage\", component: h('span', '%')},\n                {value: 'absolute', component: h('span', \"$\")}\n              ]\n            })\n          ])\n        ]),\n        h(LabelBox, {gap:8}, [\n          h('h4', \"Amount Off\"),\n          h(Input, {\n            type: 'number',\n            value: newDiscount.amount,\n            onChange: e=>setNewDiscount({...newDiscount, amount: parseInt(e.currentTarget.value)})\n          })\n        ])\n      ]),\n      h(LabelBox, {gap:8}, [\n        h('h4', \"Usage Restrictions\"),\n        h(Radio, {\n          name:\"usage-restrictions\",\n          selected: newDiscount.limited_uses ? 'limited' : 'unlimited',\n          onChange: (value) => {\n            setNewDiscount({...newDiscount, limited_uses: value === 'limited'})\n          },\n          items: [\n            {value: 'unlimited', component: h('p', `Unlimited uses. Discount is valid until you cancel it`)},\n            {value: 'limited', component: h('p', `Limited uses. Discount is only valid for a number of uses`)}\n          ]\n        })\n      ]),\n      newDiscount.limited_uses ? h(LabelBox,  {gap: 8}, [\n        h('h4', 'Max uses'),\n        h(Input, {\n          type: 'number',\n          value: newDiscount.max_redeems,\n          onChange: e=> {\n            setNewDiscount({...newDiscount, max_redeems: parseInt(e.currentTarget.value)})\n          }\n        })\n      ]) : null,\n      h(Primary, {type: 'submit', status}, \"Create New Discount\")\n    ]),\n    ]),\n    h('h2', \"Discounts\"),\n    h('p', `Copy the Share Links below and send them to people to offer them a discounted rate on your course!)`),\n    !discounts\n      ? h(PageLoader)\n      : h(Box, {gap: 32}, discounts.map(discount => h('div', [\n        h(DiscountItem, {discount, delete:()=>{\n          if(!discounts) return\n          mutate(discounts.filter(d=>d.code !== discount.code))\n        }})\n      ])))\n  ])\n}\n\nfunction DiscountItem(props: {discount: course_discounts, delete: ()=>void}) {\n  let ref = useRef<HTMLInputElement | null>(null)\n  let [status, callDelete] = useApi<null, DeleteDiscountResult>([props], props.delete)\n  return h(Box, { gap: 8 }, [\n    h(\"h3\", props.discount.name),\n    h(\"div\", [\n      h(\n        \"span.textSecondary\",\n        `${\n          props.discount.type === \"absolute\"\n            ? \"$\" + props.discount.amount\n            : props.discount.amount + \"%\"\n        } off`\n      ),\n      h(\n        \"span.textSecondary\",\n        ` | Redeemed ${\n          props.discount.max_redeems === 0\n            ? props.discount.redeems\n            : `${props.discount.redeems}/${props.discount.max_redeems}`\n        } times`\n      ),\n    ]),\n    h(Box, { h: true, style: { alignItems: \"center\" } }, [\n      h(Input, {\n        onFocus: (e) => {\n          e.currentTarget.selectionEnd = e.currentTarget.value.length;\n        },\n        style: { width: \"360px\", textDecoration: \"underline\", color: \"blue\" },\n        readOnly: true,\n        value: `https://app.krakenedu.com/discount?discount=${props.discount.code}`,\n        ref: ref,\n      }),\n      h(\n        Secondary,\n        {\n          disabled:\n            props.discount.max_redeems !== 0 &&\n            props.discount.max_redeems <= props.discount.redeems,\n          onClick: (e) => {\n            e.preventDefault();\n            if (!ref.current) return;\n            ref.current.select();\n            document.execCommand(\"copy\");\n            ref.current.selectionEnd = ref.current.selectionStart;\n            ref.current.blur();\n          },\n        },\n        \"Copy\"\n      ),\n      h(\n        Destructive,\n        {\n          status,\n          onClick: (e) => {\n            e.preventDefault();\n            callDelete(\"/api/discounts/\" + props.discount.code, null, \"DELETE\");\n          },\n        },\n        \"Delete\"\n      ),\n    ]),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}