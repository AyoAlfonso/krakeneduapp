{"ast":null,"code":"import h from 'react-hyperscript';\nimport { useUserData } from \"src/data\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useApi } from \"src/apiHelpers\";\nimport { getDiscounts, setDiscounts } from \"src/clientData\";\nimport { Box } from \"components/Layout\";\nimport { Modal } from \"components/Modal\";\nimport { Primary } from \"components/Button\";\nimport { getStripe } from 'src/utils';\nexport const EnrollButton = props => {\n  let {\n    data: user\n  } = useUserData();\n  let router = useRouter();\n  let {\n    0: error,\n    1: setError\n  } = useState(false);\n  let [status, callEnroll] = useApi([], async res => {\n    let stripe = await getStripe();\n    if (res.zeroCost) await router.push('/courses/[slug]/[id]/cohorts/[cohortId]', `/courses/${router.query.slug}/${props.course}/cohorts/${props.id}?welcome`);else await (stripe === null || stripe === void 0 ? void 0 : stripe.redirectToCheckout({\n      sessionId: res.sessionId\n    }));\n  });\n\n  let onClick = async e => {\n    e.preventDefault();\n    if (user === false) await router.push('/login?redirect=' + encodeURIComponent(router.asPath));\n    if (!props.id) return;\n    let discount = getDiscounts().find(d => d.course === props.course);\n    let res = await callEnroll(`/api/cohorts/${props.id}/enroll`, {\n      discount: discount === null || discount === void 0 ? void 0 : discount.code,\n      paystack: undefined\n    });\n\n    if (res.status === 403) {\n      setError(true);\n      setDiscounts(getDiscounts().filter(d => res.status === 403 && d.code !== res.result.discount));\n    }\n  };\n\n  return h(Box, {\n    gap: 4,\n    style: {\n      alignItems: 'center'\n    }\n  }, [h(Modal, {\n    display: error\n  }, [h('h3', \"Sorry, the discount code you're using is no longer valid\")]), h(Primary, {\n    onClick,\n    status,\n    disabled: !props.invited || props.max_size !== 0 && props.max_size === props.learners\n  }, props.children), props.max_size === 0 ? null : props.max_size > props.learners ? h('span.accentSuccess', `${props.max_size - props.learners} ${props.max_size - props.learners === 1 ? 'spot' : 'spots'} left!`) : h('span.accentRed', `Sorry! This cohort is full.`)]);\n};","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/components/Course/EnrollButton.ts"],"names":["h","useUserData","useRouter","useState","useApi","getDiscounts","setDiscounts","Box","Modal","Primary","getStripe","EnrollButton","props","data","user","router","error","setError","status","callEnroll","res","stripe","zeroCost","push","query","slug","course","id","redirectToCheckout","sessionId","onClick","e","preventDefault","encodeURIComponent","asPath","discount","find","d","code","paystack","undefined","filter","result","gap","style","alignItems","display","disabled","invited","max_size","learners","children"],"mappings":"AAAA,OAAOA,CAAP,MAAc,mBAAd;AACA,SAASC,WAAT,QAA4B,UAA5B;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,QAAT,QAAyB,OAAzB;AACA,SAASC,MAAT,QAAuB,gBAAvB;AAEA,SAASC,YAAT,EAAuBC,YAAvB,QAA2C,gBAA3C;AACA,SAASC,GAAT,QAAoB,mBAApB;AACA,SAASC,KAAT,QAAsB,kBAAtB;AACA,SAASC,OAAT,QAAwB,mBAAxB;AACA,SAASC,SAAT,QAA0B,WAA1B;AAEA,OAAO,MAAMC,YAMX,GAAIC,KAAD,IAAW;AACd,MAAI;AAACC,IAAAA,IAAI,EAAEC;AAAP,MAAeb,WAAW,EAA9B;AACA,MAAIc,MAAM,GAAGb,SAAS,EAAtB;AACA,MAAI;AAAA,OAACc,KAAD;AAAA,OAAQC;AAAR,MAAoBd,QAAQ,CAAC,KAAD,CAAhC;AACA,MAAI,CAACe,MAAD,EAASC,UAAT,IAAuBf,MAAM,CAA4B,EAA5B,EAAgC,MAAOgB,GAAP,IAAa;AAC5E,QAAIC,MAAM,GAAG,MAAMX,SAAS,EAA5B;AACA,QAAGU,GAAG,CAACE,QAAP,EAAiB,MAAMP,MAAM,CAACQ,IAAP,CAAY,yCAAZ,EAAwD,YAAWR,MAAM,CAACS,KAAP,CAAaC,IAAK,IAAGb,KAAK,CAACc,MAAO,YAAWd,KAAK,CAACe,EAAG,UAAzH,CAAN,CAAjB,KACK,OAAMN,MAAN,aAAMA,MAAN,uBAAMA,MAAM,CAAEO,kBAAR,CAA2B;AAACC,MAAAA,SAAS,EAAET,GAAG,CAACS;AAAhB,KAA3B,CAAN;AACN,GAJgC,CAAjC;;AAMA,MAAIC,OAAO,GAAE,MAAOC,CAAP,IAA6B;AACxCA,IAAAA,CAAC,CAACC,cAAF;AACA,QAAGlB,IAAI,KAAK,KAAZ,EAAmB,MAAMC,MAAM,CAACQ,IAAP,CAAY,qBAAqBU,kBAAkB,CAAClB,MAAM,CAACmB,MAAR,CAAnD,CAAN;AACnB,QAAG,CAACtB,KAAK,CAACe,EAAV,EAAc;AACd,QAAIQ,QAAQ,GAAG9B,YAAY,GAAG+B,IAAf,CAAoBC,CAAC,IAAEA,CAAC,CAACX,MAAF,KAAad,KAAK,CAACc,MAA1C,CAAf;AACA,QAAIN,GAAG,GAAG,MAAMD,UAAU,CAAE,gBAAeP,KAAK,CAACe,EAAG,SAA1B,EAAoC;AAACQ,MAAAA,QAAQ,EAAEA,QAAF,aAAEA,QAAF,uBAAEA,QAAQ,CAAEG,IAArB;AAAiDC,MAAAA,QAAQ,EAAEC;AAA3D,KAApC,CAA1B;;AACA,QAAGpB,GAAG,CAACF,MAAJ,KAAe,GAAlB,EAAuB;AACrBD,MAAAA,QAAQ,CAAC,IAAD,CAAR;AACAX,MAAAA,YAAY,CAACD,YAAY,GAAGoC,MAAf,CAAsBJ,CAAC,IAAEjB,GAAG,CAACF,MAAJ,KAAe,GAAf,IAAsBmB,CAAC,CAACC,IAAF,KAAWlB,GAAG,CAACsB,MAAJ,CAAWP,QAArE,CAAD,CAAZ;AACD;AACF,GAVD;;AAYA,SAAQnC,CAAC,CAACO,GAAD,EAAM;AAACoC,IAAAA,GAAG,EAAE,CAAN;AAASC,IAAAA,KAAK,EAAC;AAACC,MAAAA,UAAU,EAAE;AAAb;AAAf,GAAN,EAA8C,CACrD7C,CAAC,CAACQ,KAAD,EAAQ;AAACsC,IAAAA,OAAO,EAAE9B;AAAV,GAAR,EAA0B,CACzBhB,CAAC,CAAC,IAAD,EAAO,0DAAP,CADwB,CAA1B,CADoD,EAIrDA,CAAC,CAACS,OAAD,EAAU;AAACqB,IAAAA,OAAD;AAAUZ,IAAAA,MAAV;AAAkB6B,IAAAA,QAAQ,EAAE,CAACnC,KAAK,CAACoC,OAAP,IAAmBpC,KAAK,CAACqC,QAAN,KAAkB,CAAlB,IAAuBrC,KAAK,CAACqC,QAAN,KAAmBrC,KAAK,CAACsC;AAA/F,GAAV,EACCtC,KAAK,CAACuC,QADP,CAJoD,EAMrDvC,KAAK,CAACqC,QAAN,KAAmB,CAAnB,GAAuB,IAAvB,GAA8BrC,KAAK,CAACqC,QAAN,GAAiBrC,KAAK,CAACsC,QAAvB,GAC1BlD,CAAC,CAAC,oBAAD,EAAwB,GAAEY,KAAK,CAACqC,QAAN,GAAiBrC,KAAK,CAACsC,QAAS,IAAGtC,KAAK,CAACqC,QAAN,GAAiBrC,KAAK,CAACsC,QAAvB,KAAoC,CAApC,GAAwC,MAAxC,GAAiD,OAAQ,QAAtH,CADyB,GAE1BlD,CAAC,CAAC,gBAAD,EAAoB,6BAApB,CARgD,CAA9C,CAAT;AAUD,CAtCM","sourcesContent":["import h from 'react-hyperscript'\nimport { useUserData } from \"src/data\"\nimport { useRouter } from \"next/router\"\nimport { useState } from \"react\"\nimport { useApi } from \"src/apiHelpers\"\nimport { EnrollMsg, EnrollResponse } from \"pages/api/cohorts/[cohortId]/enroll\"\nimport { getDiscounts, setDiscounts } from \"src/clientData\"\nimport { Box } from \"components/Layout\"\nimport { Modal } from \"components/Modal\"\nimport { Primary } from \"components/Button\"\nimport { getStripe } from 'src/utils'\n\nexport const EnrollButton:React.FC<{\n  id:number,\n  course: number,\n  max_size: number,\n  learners: number,\n  invited: boolean\n}> = (props) => {\n  let {data: user} = useUserData()\n  let router = useRouter()\n  let [error, setError] = useState(false)\n  let [status, callEnroll] = useApi<EnrollMsg, EnrollResponse>([], async (res)=>{\n    let stripe = await getStripe()\n    if(res.zeroCost) await router.push('/courses/[slug]/[id]/cohorts/[cohortId]', `/courses/${router.query.slug}/${props.course}/cohorts/${props.id}?welcome`)\n    else await stripe?.redirectToCheckout({sessionId: res.sessionId})\n  })\n\n  let onClick= async (e:React.MouseEvent)=> {\n    e.preventDefault()\n    if(user === false) await router.push('/login?redirect=' + encodeURIComponent(router.asPath))\n    if(!props.id) return\n    let discount = getDiscounts().find(d=>d.course === props.course)\n    let res = await callEnroll(`/api/cohorts/${props.id}/enroll`, {discount: discount?.code as string | undefined, paystack: undefined})\n    if(res.status === 403) {\n      setError(true)\n      setDiscounts(getDiscounts().filter(d=>res.status === 403 && d.code !== res.result.discount))\n    }\n  }\n\n  return  h(Box, {gap: 4, style:{alignItems: 'center'}}, [\n    h(Modal, {display: error}, [\n      h('h3', \"Sorry, the discount code you're using is no longer valid\")\n    ]),\n    h(Primary, {onClick, status, disabled: !props.invited || (props.max_size !==0 && props.max_size === props.learners)},\n      props.children as React.ReactElement),\n    props.max_size === 0 ? null : props.max_size > props.learners\n      ? h('span.accentSuccess', `${props.max_size - props.learners} ${props.max_size - props.learners === 1 ? 'spot' : 'spots'} left!`)\n      : h('span.accentRed', `Sorry! This cohort is full.`)\n  ])\n}\n"]},"metadata":{},"sourceType":"module"}