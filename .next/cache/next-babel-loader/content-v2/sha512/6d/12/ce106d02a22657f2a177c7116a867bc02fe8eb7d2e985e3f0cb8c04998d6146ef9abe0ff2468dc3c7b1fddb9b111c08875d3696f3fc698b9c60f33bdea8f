{"ast":null,"code":"import _defineProperty from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useRef } from \"react\";\nimport h from 'react-hyperscript';\nimport { useDiscounts } from \"src/data\";\nimport { useApi } from \"src/apiHelpers\";\nimport { Box, FormBox, LabelBox } from \"components/Layout\";\nimport { Input, Radio } from \"components/Form\";\nimport { PageLoader } from \"components/Loader\";\nimport { Primary, Secondary, Destructive } from \"components/Button\";\nimport { colors } from \"components/Tokens\";\nexport function Discounts(props) {\n  var _useDiscounts = useDiscounts(props.course),\n      discounts = _useDiscounts.data,\n      mutate = _useDiscounts.mutate;\n\n  var _useState = useState({\n    name: '',\n    type: \"absolute\",\n    limited_uses: false,\n    amount: 0,\n    max_redeems: undefined\n  }),\n      newDiscount = _useState[0],\n      setNewDiscount = _useState[1];\n\n  var _useApi = useApi([newDiscount, mutate], function (res) {\n    if (!discounts) return;\n    mutate(discounts.concat([res]));\n  }),\n      _useApi2 = _slicedToArray(_useApi, 2),\n      status = _useApi2[0],\n      callCreateDiscount = _useApi2[1];\n\n  var onSubmit = function onSubmit(e) {\n    e.preventDefault();\n    callCreateDiscount(\"/api/courses/\".concat(props.course, \"/discounts\"), newDiscount);\n  };\n\n  return h(Box, {\n    gap: 32\n  }, [h(Box, {\n    width: 640,\n    padding: 32,\n    style: {\n      backgroundColor: colors.accentPeach\n    }\n  }, [h(FormBox, {\n    gap: 32,\n    onSubmit: onSubmit,\n    width: 400\n  }, [h('h3', \"Add a New Discount\"), h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Discount Name\"), h(Input, {\n    type: 'text',\n    required: true,\n    value: newDiscount.name,\n    onChange: function onChange(e) {\n      return setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        name: e.currentTarget.value\n      }));\n    }\n  })]), h(Box, {\n    h: true,\n    gap: 64\n  }, [h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Type\"), h('div', {\n    style: {\n      alignSelf: 'center',\n      padding: '13px 0px'\n    }\n  }, [h(Radio, {\n    h: true,\n    name: 'type',\n    selected: newDiscount.type,\n    onChange: function onChange(value) {\n      setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        type: value\n      }));\n    },\n    items: [{\n      value: \"percentage\",\n      component: h('span', '%')\n    }, {\n      value: 'absolute',\n      component: h('span', \"$\")\n    }]\n  })])]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Amount Off\"), h(Input, {\n    type: 'number',\n    value: newDiscount.amount,\n    onChange: function onChange(e) {\n      return setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        amount: parseInt(e.currentTarget.value)\n      }));\n    }\n  })])]), h(LabelBox, {\n    gap: 8\n  }, [h('h4', \"Usage Restrictions\"), h(Radio, {\n    name: \"usage-restrictions\",\n    selected: newDiscount.limited_uses ? 'limited' : 'unlimited',\n    onChange: function onChange(value) {\n      setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        limited_uses: value === 'limited'\n      }));\n    },\n    items: [{\n      value: 'unlimited',\n      component: h('p', \"Unlimited uses. Discount is valid until you cancel it\")\n    }, {\n      value: 'limited',\n      component: h('p', \"Limited uses. Discount is only valid for a number of uses\")\n    }]\n  })]), newDiscount.limited_uses ? h(LabelBox, {\n    gap: 8\n  }, [h('h4', 'Max uses'), h(Input, {\n    type: 'number',\n    value: newDiscount.max_redeems,\n    onChange: function onChange(e) {\n      setNewDiscount(_objectSpread(_objectSpread({}, newDiscount), {}, {\n        max_redeems: parseInt(e.currentTarget.value)\n      }));\n    }\n  })]) : null, h(Primary, {\n    type: 'submit',\n    status: status\n  }, \"Create New Discount\")])]), h('h2', \"Discounts\"), h('p', \"Copy the Share Links below and send them to people to offer them a discounted rate on your course!)\"), !discounts ? h(PageLoader) : h(Box, {\n    gap: 32\n  }, discounts.map(function (discount) {\n    return h('div', [h(DiscountItem, {\n      discount: discount,\n      \"delete\": function _delete() {\n        if (!discounts) return;\n        mutate(discounts.filter(function (d) {\n          return d.code !== discount.code;\n        }));\n      }\n    })]);\n  }))]);\n}\n\nfunction DiscountItem(props) {\n  var ref = useRef(null);\n\n  var _useApi3 = useApi([props], props[\"delete\"]),\n      _useApi4 = _slicedToArray(_useApi3, 2),\n      status = _useApi4[0],\n      callDelete = _useApi4[1];\n\n  return h(Box, {\n    gap: 8\n  }, [h(\"h3\", props.discount.name), h(\"div\", [h(\"span.textSecondary\", \"\".concat(props.discount.type === \"absolute\" ? \"$\" + props.discount.amount : props.discount.amount + \"%\", \" off\")), h(\"span.textSecondary\", \" | Redeemed \".concat(props.discount.max_redeems === 0 ? props.discount.redeems : \"\".concat(props.discount.redeems, \"/\").concat(props.discount.max_redeems), \" times\"))]), h(Box, {\n    h: true,\n    style: {\n      alignItems: \"center\"\n    }\n  }, [h(Input, {\n    onFocus: function onFocus(e) {\n      e.currentTarget.selectionEnd = e.currentTarget.value.length;\n    },\n    style: {\n      width: \"360px\",\n      textDecoration: \"underline\",\n      color: \"blue\"\n    },\n    readOnly: true,\n    value: \"https://app.krakenedu.com/discount?discount=\".concat(props.discount.code),\n    ref: ref\n  }), h(Secondary, {\n    disabled: props.discount.max_redeems !== 0 && props.discount.max_redeems <= props.discount.redeems,\n    onClick: function onClick(e) {\n      e.preventDefault();\n      if (!ref.current) return;\n      ref.current.select();\n      document.execCommand(\"copy\");\n      ref.current.selectionEnd = ref.current.selectionStart;\n      ref.current.blur();\n    }\n  }, \"Copy\"), h(Destructive, {\n    status: status,\n    onClick: function onClick(e) {\n      e.preventDefault();\n      callDelete(\"/api/discounts/\" + props.discount.code, null, \"DELETE\");\n    }\n  }, \"Delete\")])]);\n}","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/components/pages/courses/settings/Discounts.ts"],"names":["useState","useRef","h","useDiscounts","useApi","Box","FormBox","LabelBox","Input","Radio","PageLoader","Primary","Secondary","Destructive","colors","Discounts","props","course","discounts","data","mutate","name","type","limited_uses","amount","max_redeems","undefined","newDiscount","setNewDiscount","res","concat","status","callCreateDiscount","onSubmit","e","preventDefault","gap","width","padding","style","backgroundColor","accentPeach","required","value","onChange","currentTarget","alignSelf","selected","items","component","parseInt","map","discount","DiscountItem","filter","d","code","ref","callDelete","redeems","alignItems","onFocus","selectionEnd","length","textDecoration","color","readOnly","disabled","onClick","current","select","document","execCommand","selectionStart","blur"],"mappings":"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","sourcesContent":["import { useState, useRef } from \"react\"\nimport h from 'react-hyperscript'\nimport { useDiscounts } from \"src/data\"\nimport { CreateDiscountMsg, CreateDiscountResult } from \"pages/api/courses/[id]/discounts\"\nimport { useApi } from \"src/apiHelpers\"\nimport { Box, FormBox, LabelBox } from \"components/Layout\"\nimport { Input, Radio } from \"components/Form\"\nimport { PageLoader } from \"components/Loader\"\nimport { Primary, Secondary, Destructive } from \"components/Button\"\nimport { course_discounts } from \"@prisma/client\"\nimport { DeleteDiscountResult } from \"pages/api/discounts/[code]\"\nimport { colors } from \"components/Tokens\"\n\nexport function Discounts(props: {course:number}) {\n  let {data: discounts, mutate} = useDiscounts(props.course)\n  let [newDiscount, setNewDiscount] = useState<CreateDiscountMsg & {limited_uses: boolean}>({\n    name: '',\n    type: \"absolute\",\n    limited_uses: false,\n    amount: 0,\n    max_redeems: undefined\n  })\n  let [status, callCreateDiscount] = useApi<CreateDiscountMsg, CreateDiscountResult>([newDiscount, mutate], (res)=>{\n    if(!discounts) return\n    mutate(discounts.concat([res]))\n  })\n  let onSubmit = (e:React.FormEvent) => {\n    e.preventDefault()\n    callCreateDiscount(`/api/courses/${props.course}/discounts`, newDiscount)\n  }\n  return h(Box, {gap:32}, [\n    h(Box, {width: 640, padding: 32, style:{backgroundColor: colors.accentPeach}}, [\n    h(FormBox, {gap:32, onSubmit, width: 400}, [\n      h('h3', \"Add a New Discount\"),\n      h(LabelBox, {gap:8}, [\n        h('h4', \"Discount Name\"),\n        h(Input, {\n          type: 'text',\n          required: true,\n          value: newDiscount.name,\n          onChange:e =>setNewDiscount({...newDiscount, name: e.currentTarget.value})\n        })\n      ]),\n      h(Box, {h: true, gap:64}, [\n        h(LabelBox, {gap:8}, [\n          h('h4', \"Type\"),\n          h('div', {style: {alignSelf: 'center', padding: '13px 0px'}}, [\n            h(Radio, {\n              h: true,\n              name: 'type',\n              selected: newDiscount.type,\n              onChange: (value) => {\n                setNewDiscount({...newDiscount, type: value as typeof newDiscount.type})\n              },\n              items: [\n                {value: \"percentage\", component: h('span', '%')},\n                {value: 'absolute', component: h('span', \"$\")}\n              ]\n            })\n          ])\n        ]),\n        h(LabelBox, {gap:8}, [\n          h('h4', \"Amount Off\"),\n          h(Input, {\n            type: 'number',\n            value: newDiscount.amount,\n            onChange: e=>setNewDiscount({...newDiscount, amount: parseInt(e.currentTarget.value)})\n          })\n        ])\n      ]),\n      h(LabelBox, {gap:8}, [\n        h('h4', \"Usage Restrictions\"),\n        h(Radio, {\n          name:\"usage-restrictions\",\n          selected: newDiscount.limited_uses ? 'limited' : 'unlimited',\n          onChange: (value) => {\n            setNewDiscount({...newDiscount, limited_uses: value === 'limited'})\n          },\n          items: [\n            {value: 'unlimited', component: h('p', `Unlimited uses. Discount is valid until you cancel it`)},\n            {value: 'limited', component: h('p', `Limited uses. Discount is only valid for a number of uses`)}\n          ]\n        })\n      ]),\n      newDiscount.limited_uses ? h(LabelBox,  {gap: 8}, [\n        h('h4', 'Max uses'),\n        h(Input, {\n          type: 'number',\n          value: newDiscount.max_redeems,\n          onChange: e=> {\n            setNewDiscount({...newDiscount, max_redeems: parseInt(e.currentTarget.value)})\n          }\n        })\n      ]) : null,\n      h(Primary, {type: 'submit', status}, \"Create New Discount\")\n    ]),\n    ]),\n    h('h2', \"Discounts\"),\n    h('p', `Copy the Share Links below and send them to people to offer them a discounted rate on your course!)`),\n    !discounts\n      ? h(PageLoader)\n      : h(Box, {gap: 32}, discounts.map(discount => h('div', [\n        h(DiscountItem, {discount, delete:()=>{\n          if(!discounts) return\n          mutate(discounts.filter(d=>d.code !== discount.code))\n        }})\n      ])))\n  ])\n}\n\nfunction DiscountItem(props: {discount: course_discounts, delete: ()=>void}) {\n  let ref = useRef<HTMLInputElement | null>(null)\n  let [status, callDelete] = useApi<null, DeleteDiscountResult>([props], props.delete)\n  return h(Box, { gap: 8 }, [\n    h(\"h3\", props.discount.name),\n    h(\"div\", [\n      h(\n        \"span.textSecondary\",\n        `${\n          props.discount.type === \"absolute\"\n            ? \"$\" + props.discount.amount\n            : props.discount.amount + \"%\"\n        } off`\n      ),\n      h(\n        \"span.textSecondary\",\n        ` | Redeemed ${\n          props.discount.max_redeems === 0\n            ? props.discount.redeems\n            : `${props.discount.redeems}/${props.discount.max_redeems}`\n        } times`\n      ),\n    ]),\n    h(Box, { h: true, style: { alignItems: \"center\" } }, [\n      h(Input, {\n        onFocus: (e) => {\n          e.currentTarget.selectionEnd = e.currentTarget.value.length;\n        },\n        style: { width: \"360px\", textDecoration: \"underline\", color: \"blue\" },\n        readOnly: true,\n        value: `https://app.krakenedu.com/discount?discount=${props.discount.code}`,\n        ref: ref,\n      }),\n      h(\n        Secondary,\n        {\n          disabled:\n            props.discount.max_redeems !== 0 &&\n            props.discount.max_redeems <= props.discount.redeems,\n          onClick: (e) => {\n            e.preventDefault();\n            if (!ref.current) return;\n            ref.current.select();\n            document.execCommand(\"copy\");\n            ref.current.selectionEnd = ref.current.selectionStart;\n            ref.current.blur();\n          },\n        },\n        \"Copy\"\n      ),\n      h(\n        Destructive,\n        {\n          status,\n          onClick: (e) => {\n            e.preventDefault();\n            callDelete(\"/api/discounts/\" + props.discount.code, null, \"DELETE\");\n          },\n        },\n        \"Delete\"\n      ),\n    ]),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}