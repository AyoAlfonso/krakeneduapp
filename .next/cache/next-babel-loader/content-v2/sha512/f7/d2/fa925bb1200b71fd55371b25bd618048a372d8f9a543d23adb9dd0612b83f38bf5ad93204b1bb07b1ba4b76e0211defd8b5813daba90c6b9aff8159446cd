{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport h from 'react-hyperscript';\nimport { useUserData } from \"src/data\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useApi } from \"src/apiHelpers\";\nimport { getDiscounts, setDiscounts } from \"src/clientData\";\nimport { Box } from \"components/Layout\";\nimport { Modal } from \"components/Modal\";\nimport { Primary } from \"components/Button\";\nimport { getStripe } from 'src/utils';\nexport var EnrollButton = function EnrollButton(props) {\n  var _useUserData = useUserData(),\n      user = _useUserData.data;\n\n  var router = useRouter();\n\n  var _useState = useState(false),\n      error = _useState[0],\n      setError = _useState[1];\n\n  var _useApi = useApi([], /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(res) {\n      var stripe;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getStripe();\n\n            case 2:\n              stripe = _context.sent;\n\n              if (!res.zeroCost) {\n                _context.next = 8;\n                break;\n              }\n\n              _context.next = 6;\n              return router.push('/courses/[slug]/[id]/cohorts/[cohortId]', \"/courses/\".concat(router.query.slug, \"/\").concat(props.course, \"/cohorts/\").concat(props.id, \"?welcome\"));\n\n            case 6:\n              _context.next = 10;\n              break;\n\n            case 8:\n              _context.next = 10;\n              return stripe === null || stripe === void 0 ? void 0 : stripe.redirectToCheckout({\n                sessionId: res.sessionId\n              });\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }()),\n      _useApi2 = _slicedToArray(_useApi, 2),\n      status = _useApi2[0],\n      callEnroll = _useApi2[1];\n\n  var onClick = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var discount, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!(user === false)) {\n                _context2.next = 4;\n                break;\n              }\n\n              _context2.next = 4;\n              return router.push('/login?redirect=' + encodeURIComponent(router.asPath));\n\n            case 4:\n              if (props.id) {\n                _context2.next = 6;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 6:\n              discount = getDiscounts().find(function (d) {\n                return d.course === props.course;\n              });\n              _context2.next = 9;\n              return callEnroll(\"/api/cohorts/\".concat(props.id, \"/enroll\"), {\n                discount: discount === null || discount === void 0 ? void 0 : discount.code,\n                paystack: undefined\n              });\n\n            case 9:\n              res = _context2.sent;\n\n              if (res.status === 403) {\n                setError(true);\n                setDiscounts(getDiscounts().filter(function (d) {\n                  return res.status === 403 && d.code !== res.result.discount;\n                }));\n              }\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onClick(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return h(Box, {\n    gap: 4,\n    style: {\n      alignItems: 'center'\n    }\n  }, [h(Modal, {\n    display: error\n  }, [h('h3', \"Sorry, the discount code you're using is no longer valid\")]), h(Primary, {\n    onClick: onClick,\n    status: status,\n    disabled: !props.invited || props.max_size !== 0 && props.max_size === props.learners\n  }, props.children), props.max_size === 0 ? null : props.max_size > props.learners ? h('span.accentSuccess', \"\".concat(props.max_size - props.learners, \" \").concat(props.max_size - props.learners === 1 ? 'spot' : 'spots', \" left!\")) : h('span.accentRed', \"Sorry! This cohort is full.\")]);\n};","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/components/Course/EnrollButton.ts"],"names":["h","useUserData","useRouter","useState","useApi","getDiscounts","setDiscounts","Box","Modal","Primary","getStripe","EnrollButton","props","user","data","router","error","setError","res","stripe","zeroCost","push","query","slug","course","id","redirectToCheckout","sessionId","status","callEnroll","onClick","e","preventDefault","encodeURIComponent","asPath","discount","find","d","code","paystack","undefined","filter","result","gap","style","alignItems","display","disabled","invited","max_size","learners","children"],"mappings":";;;AAAA,OAAOA,CAAP,MAAc,mBAAd;AACA,SAASC,WAAT,QAA4B,UAA5B;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,QAAT,QAAyB,OAAzB;AACA,SAASC,MAAT,QAAuB,gBAAvB;AAEA,SAASC,YAAT,EAAuBC,YAAvB,QAA2C,gBAA3C;AACA,SAASC,GAAT,QAAoB,mBAApB;AACA,SAASC,KAAT,QAAsB,kBAAtB;AACA,SAASC,OAAT,QAAwB,mBAAxB;AACA,SAASC,SAAT,QAA0B,WAA1B;AAEA,OAAO,IAAMC,YAMX,GAAG,SANQA,YAMR,CAACC,KAAD,EAAW;AAAA,qBACKX,WAAW,EADhB;AAAA,MACHY,IADG,gBACTC,IADS;;AAEd,MAAIC,MAAM,GAAGb,SAAS,EAAtB;;AAFc,kBAGUC,QAAQ,CAAC,KAAD,CAHlB;AAAA,MAGTa,KAHS;AAAA,MAGFC,QAHE;;AAAA,gBAIab,MAAM,CAA4B,EAA5B;AAAA,wEAAgC,iBAAOc,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAC5CR,SAAS,EADmC;;AAAA;AAC3DS,cAAAA,MAD2D;;AAAA,mBAE5DD,GAAG,CAACE,QAFwD;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAExCL,MAAM,CAACM,IAAP,CAAY,yCAAZ,qBAAmEN,MAAM,CAACO,KAAP,CAAaC,IAAhF,cAAwFX,KAAK,CAACY,MAA9F,sBAAgHZ,KAAK,CAACa,EAAtH,cAFwC;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,qBAGpDN,MAHoD,aAGpDA,MAHoD,uBAGpDA,MAAM,CAAEO,kBAAR,CAA2B;AAACC,gBAAAA,SAAS,EAAET,GAAG,CAACS;AAAhB,eAA3B,CAHoD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAhC;;AAAA;AAAA;AAAA;AAAA,MAJnB;AAAA;AAAA,MAITC,MAJS;AAAA,MAIDC,UAJC;;AAUd,MAAIC,OAAO;AAAA,yEAAE,kBAAOC,CAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACXA,cAAAA,CAAC,CAACC,cAAF;;AADW,oBAERnB,IAAI,KAAK,KAFD;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAEcE,MAAM,CAACM,IAAP,CAAY,qBAAqBY,kBAAkB,CAAClB,MAAM,CAACmB,MAAR,CAAnD,CAFd;;AAAA;AAAA,kBAGPtB,KAAK,CAACa,EAHC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAIPU,cAAAA,QAJO,GAII9B,YAAY,GAAG+B,IAAf,CAAoB,UAAAC,CAAC;AAAA,uBAAEA,CAAC,CAACb,MAAF,KAAaZ,KAAK,CAACY,MAArB;AAAA,eAArB,CAJJ;AAAA;AAAA,qBAKKK,UAAU,wBAAiBjB,KAAK,CAACa,EAAvB,cAAoC;AAACU,gBAAAA,QAAQ,EAAEA,QAAF,aAAEA,QAAF,uBAAEA,QAAQ,CAAEG,IAArB;AAAiDC,gBAAAA,QAAQ,EAAEC;AAA3D,eAApC,CALf;;AAAA;AAKPtB,cAAAA,GALO;;AAMX,kBAAGA,GAAG,CAACU,MAAJ,KAAe,GAAlB,EAAuB;AACrBX,gBAAAA,QAAQ,CAAC,IAAD,CAAR;AACAX,gBAAAA,YAAY,CAACD,YAAY,GAAGoC,MAAf,CAAsB,UAAAJ,CAAC;AAAA,yBAAEnB,GAAG,CAACU,MAAJ,KAAe,GAAf,IAAsBS,CAAC,CAACC,IAAF,KAAWpB,GAAG,CAACwB,MAAJ,CAAWP,QAA9C;AAAA,iBAAvB,CAAD,CAAZ;AACD;;AATU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAF;;AAAA,oBAAPL,OAAO;AAAA;AAAA;AAAA,KAAX;;AAYA,SAAQ9B,CAAC,CAACO,GAAD,EAAM;AAACoC,IAAAA,GAAG,EAAE,CAAN;AAASC,IAAAA,KAAK,EAAC;AAACC,MAAAA,UAAU,EAAE;AAAb;AAAf,GAAN,EAA8C,CACrD7C,CAAC,CAACQ,KAAD,EAAQ;AAACsC,IAAAA,OAAO,EAAE9B;AAAV,GAAR,EAA0B,CACzBhB,CAAC,CAAC,IAAD,EAAO,0DAAP,CADwB,CAA1B,CADoD,EAIrDA,CAAC,CAACS,OAAD,EAAU;AAACqB,IAAAA,OAAO,EAAPA,OAAD;AAAUF,IAAAA,MAAM,EAANA,MAAV;AAAkBmB,IAAAA,QAAQ,EAAE,CAACnC,KAAK,CAACoC,OAAP,IAAmBpC,KAAK,CAACqC,QAAN,KAAkB,CAAlB,IAAuBrC,KAAK,CAACqC,QAAN,KAAmBrC,KAAK,CAACsC;AAA/F,GAAV,EACCtC,KAAK,CAACuC,QADP,CAJoD,EAMrDvC,KAAK,CAACqC,QAAN,KAAmB,CAAnB,GAAuB,IAAvB,GAA8BrC,KAAK,CAACqC,QAAN,GAAiBrC,KAAK,CAACsC,QAAvB,GAC1BlD,CAAC,CAAC,oBAAD,YAA0BY,KAAK,CAACqC,QAAN,GAAiBrC,KAAK,CAACsC,QAAjD,cAA6DtC,KAAK,CAACqC,QAAN,GAAiBrC,KAAK,CAACsC,QAAvB,KAAoC,CAApC,GAAwC,MAAxC,GAAiD,OAA9G,YADyB,GAE1BlD,CAAC,CAAC,gBAAD,gCARgD,CAA9C,CAAT;AAUD,CAtCM","sourcesContent":["import h from 'react-hyperscript'\nimport { useUserData } from \"src/data\"\nimport { useRouter } from \"next/router\"\nimport { useState } from \"react\"\nimport { useApi } from \"src/apiHelpers\"\nimport { EnrollMsg, EnrollResponse } from \"pages/api/cohorts/[cohortId]/enroll\"\nimport { getDiscounts, setDiscounts } from \"src/clientData\"\nimport { Box } from \"components/Layout\"\nimport { Modal } from \"components/Modal\"\nimport { Primary } from \"components/Button\"\nimport { getStripe } from 'src/utils'\n\nexport const EnrollButton:React.FC<{\n  id:number,\n  course: number,\n  max_size: number,\n  learners: number,\n  invited: boolean\n}> = (props) => {\n  let {data: user} = useUserData()\n  let router = useRouter()\n  let [error, setError] = useState(false)\n  let [status, callEnroll] = useApi<EnrollMsg, EnrollResponse>([], async (res)=>{\n    let stripe = await getStripe()\n    if(res.zeroCost) await router.push('/courses/[slug]/[id]/cohorts/[cohortId]', `/courses/${router.query.slug}/${props.course}/cohorts/${props.id}?welcome`)\n    else await stripe?.redirectToCheckout({sessionId: res.sessionId})\n  })\n\n  let onClick= async (e:React.MouseEvent)=> {\n    e.preventDefault()\n    if(user === false) await router.push('/login?redirect=' + encodeURIComponent(router.asPath))\n    if(!props.id) return\n    let discount = getDiscounts().find(d=>d.course === props.course)\n    let res = await callEnroll(`/api/cohorts/${props.id}/enroll`, {discount: discount?.code as string | undefined, paystack: undefined})\n    if(res.status === 403) {\n      setError(true)\n      setDiscounts(getDiscounts().filter(d=>res.status === 403 && d.code !== res.result.discount))\n    }\n  }\n\n  return  h(Box, {gap: 4, style:{alignItems: 'center'}}, [\n    h(Modal, {display: error}, [\n      h('h3', \"Sorry, the discount code you're using is no longer valid\")\n    ]),\n    h(Primary, {onClick, status, disabled: !props.invited || (props.max_size !==0 && props.max_size === props.learners)},\n      props.children as React.ReactElement),\n    props.max_size === 0 ? null : props.max_size > props.learners\n      ? h('span.accentSuccess', `${props.max_size - props.learners} ${props.max_size - props.learners === 1 ? 'spot' : 'spots'} left!`)\n      : h('span.accentRed', `Sorry! This cohort is full.`)\n  ])\n}\n"]},"metadata":{},"sourceType":"module"}