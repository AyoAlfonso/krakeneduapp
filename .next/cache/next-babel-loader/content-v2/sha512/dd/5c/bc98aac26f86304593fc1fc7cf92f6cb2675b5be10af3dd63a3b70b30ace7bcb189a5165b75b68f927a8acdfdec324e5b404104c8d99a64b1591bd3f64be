{"ast":null,"code":"import _styled from \"@emotion/styled-base\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _EMOTION_STRINGIFIED_CSS_ERROR__() { return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\"; }\n\nimport h from 'react-hyperscript';\nimport { useState } from 'react';\nimport Link from 'next/link';\nimport prisma from \"lib/prisma\";\nimport { Box, Seperator, TwoColumn, Sidebar } from 'components/Layout';\nimport { Tabs, StickyWrapper } from 'components/Tabs';\nimport { colors } from 'components/Tokens';\nimport Loader, { PageLoader } from 'components/Loader';\nimport { Info } from 'components/Form';\nimport { Pill } from 'components/Pill';\nimport Enroll from 'components/Course/Enroll';\nimport Text from 'components/Text';\nimport { SmallCohortCard } from 'components/Cards/SmallCohortCard';\nimport { TwoColumnBanner } from 'components/Banner';\nimport { Modal } from 'components/Modal';\nimport { Primary, Destructive, LinkButton } from 'components/Button';\nimport { WatchCourse } from 'components/Course/WatchCourse';\nimport { getTaggedPost } from 'src/discourse';\nimport { DISCOURSE_URL } from 'src/constants';\nimport { useUserData, useUserCohorts, useCourseData } from 'src/data';\nimport { callApi } from 'src/apiHelpers';\nimport { cohortPrettyDate } from 'components/Cards/CohortCard';\nimport ErrorPage from 'pages/404';\nimport { courseDataQuery } from 'pages/api/courses/[id]';\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport { AccentImg } from 'components/Images';\nimport { TodoList } from 'components/TodoList';\nimport { cohortName, sortByDateAndName } from 'src/utils';\nconst COPY = {\n  curriculumTab: \"Curriculum\",\n  cohortTab: \"All Cohorts\",\n  activeCohorts: \"Your Current Cohorts\",\n  settings: \"You can edit details, create new cohorts, and more.\",\n  enrollButton: \"Enroll in a cohort\",\n  updateCurriculum: props => h(Info, [`ðŸ’¡ You can make changes to the curriculum by editing `, h('a', {\n    href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`\n  }, `this topic`), ` in the forum`])\n};\n\nconst WrappedCoursePage = props => props.notFound ? h(ErrorPage) : h(CoursePage, props);\n\nexport default WrappedCoursePage;\n\nconst CoursePage = props => {\n  let {\n    data: user\n  } = useUserData();\n  let {\n    data: userCohorts\n  } = useUserCohorts();\n  let {\n    data: course\n  } = useCourseData(props.id, props.course || undefined);\n  if (!course) return h(PageLoader);\n  let activeCohorts = course.course_cohorts.filter(c => {\n    if (!user) return false;\n    return c.completed === null && (!!c.cohort_facilitators.find(f => user && f.facilitator === user.id) || c.people_in_cohorts.find(p => p.people.id === (user ? user.id : undefined)));\n  }).sort(sortByDateAndName);\n  let enrolled = activeCohorts.filter(c => !c.cohort_facilitators.find(f => user && f.facilitator === user.id)).length > 0;\n  let upcomingCohorts = course.course_cohorts.filter(c => new Date(c.start_date) > new Date() && c.live).sort(sortByDateAndName);\n  let isMaintainer = !!(course !== null && course !== void 0 && course.course_maintainers.find(maintainer => user && maintainer.maintainer === user.id));\n  let invited = !!(userCohorts !== null && userCohorts !== void 0 && userCohorts.invited_courses.find(course => course.id === props.course.id)); //Setting up the layout for the course page\n\n  return h('div', [h(Head, {\n    children: [h('meta', {\n      property: \"og:title\",\n      content: course.name,\n      key: \"og:title\"\n    }), h('meta', {\n      property: \"og:description\",\n      content: course.description,\n      key: \"og:description\"\n    }), h('meta', {\n      property: \"og:image\",\n      content: course.card_image.split(',')[0],\n      key: \"og:image\"\n    }), h('meta', {\n      property: \"twitter:card\",\n      content: \"summary\",\n      key: \"twitter:card\"\n    })]\n  }), h(Banners, {\n    draft: course.status === 'draft',\n    id: props.id,\n    isMaintainer,\n    slug: course.slug\n  }), h(TwoColumn, [h(Box, {\n    gap: 32\n  }, [h(Box, {\n    gap: 16\n  }, [h('h1', course === null || course === void 0 ? void 0 : course.name)]), h('p.big', (course === null || course === void 0 ? void 0 : course.description) || ''), upcomingCohorts.length > 0 && activeCohorts.length === 0 ? h(Box, {\n    padding: 32,\n    style: {\n      backgroundColor: colors.accentPeach\n    }\n  }, [...upcomingCohorts.flatMap(cohort => {\n    return [h(Cohort, {\n      cohort,\n      enrolled: false,\n      facilitating: false,\n      invited,\n      slug: (course === null || course === void 0 ? void 0 : course.slug) || '',\n      cohort_max_size: (course === null || course === void 0 ? void 0 : course.cohort_max_size) || 0\n    }), h(Seperator)];\n  }).slice(0, -1)]) : activeCohorts.length === 0 ? null : h(Box, {\n    padding: 32,\n    style: {\n      backgroundColor: colors.grey95\n    }\n  }, [h('h3', COPY.activeCohorts), ...activeCohorts.map(cohort => h(SmallCohortCard, _objectSpread(_objectSpread({}, cohort), {}, {\n    facilitators: cohort.cohort_facilitators.map(f => f.people.display_name || f.people.username),\n    courses: {\n      name: (course === null || course === void 0 ? void 0 : course.name) || '',\n      slug: (course === null || course === void 0 ? void 0 : course.slug) || ''\n    },\n    facilitating: !!cohort.cohort_facilitators.find(f => user && f.facilitator === user.id),\n    enrolled: !cohort.cohort_facilitators.find(f => user && f.facilitator === user.id)\n  })))])]), h(Tabs, {\n    tabs: {\n      [COPY.curriculumTab]: h(Box, [isMaintainer ? h(COPY.updateCurriculum, {\n        id: props.content.id\n      }) : null, h(Text, {\n        source: props.content.text\n      })]),\n      [COPY.cohortTab]: h(Cohorts, {\n        cohorts: course.course_cohorts,\n        slug: course.slug,\n        user: user ? user.id : '',\n        invited,\n        cohort_max_size: (course === null || course === void 0 ? void 0 : course.cohort_max_size) || 0\n      }),\n      Facilitators: h(Box, {\n        gap: 32\n      }, course.course_maintainers.map(maintainer => {\n        return h(Box, {}, [h('h3', maintainer.people.display_name || maintainer.people.username), !maintainer.people.link ? null : h('a', {\n          href: maintainer.people.link\n        }, h('b', maintainer.people.link)), !maintainer.people.bio ? null : h(Box, {\n          width: 640\n        }, h(Text, {\n          source: maintainer.people.bio\n        }))]);\n      }))\n    }\n  }), h(Sidebar, [h(StickyWrapper, [h(Enroll, {\n    course\n  }, [h(Box, [h(EnrollStatus, {\n    courseId: course.id,\n    courseSlug: course.slug,\n    draft: course.status === 'draft',\n    maintainer: isMaintainer,\n    inviteOnly: course.invite_only,\n    invited,\n    loggedIn: !!user,\n    enrolled,\n    upcoming: upcomingCohorts.length !== 0\n  }), h(Seperator), !isMaintainer ? h(WatchCourse, {\n    id: course.id\n  }) : h(Box, [h(Box, {\n    gap: 8\n  }, [h('h3', `You maintain this ${course.type}`), h('p.textSecondary', COPY.settings)]), h(Link, {\n    href: '/courses/[slug]/[id]/settings',\n    as: `/courses/${course.slug}/${course.id}/settings`\n  }, h(Destructive, 'Settings'))])])])])])])]);\n};\n\nfunction EnrollStatus(props) {\n  if (props.draft) {\n    if (props.maintainer) return h('span.accentRed', \"Learners can't enroll in this course until you publish it!\");\n    return h('span.accentRed', \"This course is still a draft. You can enroll once the creator publishes it!\");\n  }\n\n  if (props.enrolled) {\n    if (props.upcoming) return h('span.accentSuccess', \"You're enrolled in an upcoming cohort. Feel free to enroll in another one though!\");\n    return h('span.accentSuccess', \"You're enrolled in an upcoming cohort\");\n  }\n\n  if (!props.upcoming) {\n    if (props.maintainer) return h('span.accentRed', [\"Looks like there aren't any cohorts planned. Create one \", h(Link, {\n      href: \"/courses/[slug]/[id]/settings\",\n      as: `/courses/${props.courseSlug}/${props.courseId}/settings`\n    }, h('a', 'here')), '.']);\n    return h('span.accentRed', \"Looks like there aren't any cohorts planned :(\");\n  }\n\n  if (props.inviteOnly) {\n    if (props.maintainer) return h('span.accentRed', [\"Learners need to be invited to enroll. Invite someone \", h(Link, {\n      href: `/courses/${props.courseSlug}/${props.courseId}/settings`\n    }, h('a', 'here')), '.']);\n    if (props.invited) return h('span.accentSuccess', \"You're invited!\");\n    if (props.loggedIn) return h('div', {}, h('span.accentRed', \"This course is invite only. Reach out to the facilitators if you're interested!\"));\n    return h('div', {}, h('span.accentRed', \"This course is invite only. If you've been invited, please log in.\"));\n  }\n\n  return null;\n}\n\nconst Cohorts = props => {\n  let [pastCohorts, upcomingCohorts] = props.cohorts.filter(c => {\n    if (c.live) return true;\n    return !!c.cohort_facilitators.find(f => f.facilitator === props.user);\n  }).sort(sortByDateAndName).reduce((acc, cohort) => {\n    let enrolled = !!cohort.people_in_cohorts.find(p => p.people.id === props.user);\n    let facilitating = !!cohort.cohort_facilitators.find(f => f.facilitator === props.user);\n    acc[new Date(cohort.start_date) < new Date() ? 0 : 1].push(h(Cohort, {\n      cohort,\n      enrolled,\n      facilitating,\n      slug: props.slug,\n      cohort_max_size: props.cohort_max_size,\n      invited: props.invited\n    }));\n    return acc;\n  }, [[], []]);\n  return h(Box, {\n    gap: 32\n  }, [upcomingCohorts.length === 0 ? null : h('h2', \"Upcoming Cohorts\"), ...upcomingCohorts, upcomingCohorts.length === 0 || pastCohorts.length === 0 ? null : h(Seperator), pastCohorts.length === 0 ? null : h('h2', 'Ongoing and Past Cohorts'), ...pastCohorts]);\n};\n\nexport const Cohort = props => {\n  let id = props.cohort.id;\n  let router = useRouter();\n  let past = new Date(props.cohort.start_date) < new Date();\n  return h(Box, {\n    h: true,\n    style: {\n      gridAutoColumns: 'auto'\n    }\n  }, [h(Box, {\n    gap: 4\n  }, [!props.enrolled && !props.facilitating ? null : h('div', [props.enrolled ? h(Pill, 'enrolled') : null, ' ', props.facilitating ? h(Pill, {\n    borderOnly: true\n  }, 'facilitating') : null, ' ', !props.cohort.live ? h(Pill, {\n    borderOnly: true,\n    red: true\n  }, 'draft') : null]), h('h3', {}, h(Link, {\n    href: '/courses/[slug]/[id]/cohorts/[cohortId]',\n    as: `/courses/${props.slug}/${props.cohort.course}/cohorts/${id}`\n  }, h('a', {\n    style: {\n      textDecoration: 'none'\n    }\n  }, cohortName(props.cohort.name)))), h(Box, {\n    style: {\n      color: colors.textSecondary\n    },\n    gap: 4\n  }, [h('strong', cohortPrettyDate(props.cohort.start_date, props.cohort.completed)), h('div', [`Facilitated by `, ...props.cohort.cohort_facilitators.flatMap(f => {\n    return [h(Link, {\n      href: `/people/${f.people.username}`\n    }, h('a', f.people.display_name || f.people.username)), ', '];\n  }).slice(0, -1)])]), props.cohort_max_size === 0 || past ? null : props.cohort_max_size > props.cohort.people_in_cohorts.length ? h('span.accentSuccess', `${props.cohort_max_size - props.cohort.people_in_cohorts.length} ${props.cohort_max_size - props.cohort.people_in_cohorts.length === 1 ? 'spot' : 'spots'} left!`) : h('span.accentRed', `Sorry! This cohort is full.`)]), past || props.enrolled || props.facilitating ? null : h(Box, {\n    gap: 8,\n    style: {\n      alignItems: 'center',\n      alignContent: 'center',\n      justifySelf: 'right',\n      textAlign: 'right'\n    }\n  }, [h(Link, {\n    href: `/courses/${router.query.slug}/${props.cohort.course}/cohorts/${props.cohort.id}`\n  }, h('a', {}, h(Primary, 'See schedule')))])]);\n}; //feature to add a new cohort to a course\n\nfunction MarkCourseLive(props) {\n  let {\n    data: course,\n    mutate\n  } = useCourseData(props.id);\n  let {\n    0: state,\n    1: setState\n  } = useState('normal');\n\n  const onClick = async e => {\n    e.preventDefault();\n    if (!course) return;\n    setState('loading');\n    let res = await callApi(`/api/courses/${props.id}`, {\n      status: 'live'\n    });\n\n    if (res.status === 200) {\n      setState('normal');\n      mutate(_objectSpread(_objectSpread({}, course), {}, {\n        status: 'live'\n      }));\n    }\n  };\n\n  if (state === 'confirm' || state === 'loading') return h(Modal, {\n    display: true,\n    closeText: \"nevermind\",\n    onExit: () => setState(\"normal\")\n  }, [h(Box, {\n    gap: 32\n  }, [h(\"h2\", {\n    style: {\n      textAlign: \"center\"\n    }\n  }, \"Are you sure?\"), h(Box, {\n    gap: 16\n  }, [\"Before going live please check that you've done these things\", h(Box.withComponent(\"ul\", {\n    target: \"e1iqf50g1\"\n  }), {\n    gap: 16\n  }, [h(\"li\", [\"Edit important details in \", h(\"a\", {\n    href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Details`\n  }, \"course settings\"), \".\"]), h(\"li\", [\"Written a \", h(\"a\", {\n    href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`\n  }, \"curriculum\"), \".\"])]), h(Primary, {\n    style: {\n      justifySelf: \"center\"\n    },\n    onClick\n  }, state === \"loading\" ? h(Loader) : \"Go Live!\")])])]);\n  return h(Primary, {\n    onClick: async e => {\n      e.preventDefault();\n      setState('confirm');\n    }\n  }, \"Publish!\");\n} // Feature to edit course detail (length, prereqs, one line description)\n// Define Banners\n\n\nconst Banners = props => {\n  if (props.draft && props.isMaintainer) {\n    if (props.isMaintainer) {\n      return h(TODOBanner, props);\n    }\n\n    return h(TwoColumnBanner, {\n      red: true\n    }, h(Box, {\n      gap: 16\n    }, [h(Box, {\n      gap: 16\n    }, [h('h3', \"This course isn't live yet!\"), h('p', [`The maintainer is still working on getting this course in shape. Let them know\nif you have any feedback!`])])]));\n  }\n\n  return null;\n}; // Draft Course ToDo Banner\n\n\nconst TODOBanner = props => {\n  let {\n    0: expanded,\n    1: setExpanded\n  } = useState(false);\n  return h(TwoColumnBanner, {\n    red: true\n  }, [h(BannerContent, [h(AccentImg, {\n    height: 32,\n    width: 36,\n    src: \"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Seedling.png\"\n  }), h(Box, {\n    gap: 8\n  }, [h('h4', \"This course is still a draft\"), h('p', 'Itâ€™s hidden from public view. People canâ€™t see this page until you publish it.')]), ...(!expanded ? [] : [h(AccentImg, {\n    height: 32,\n    width: 36,\n    src: \"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Bud.png\"\n  }), h(Box, {\n    gap: 16\n  }, [h('h4', \"Before you publish this course make sure that you ...  \"), h(TodoList, {\n    persistKey: \"course-creation-todo\",\n    items: [h(\"span\", [\"Edit important details, like description and price, in \", h('a', {\n      href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Details`\n    }, \"course settings\"), \".\"]), h(\"span\", [\"Write a comprehensive curriculum for your course, by editing the \", h('a', {\n      href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`\n    }, \"Curriculum topic\"), \" in the forum.\"]), h(\"span\", [\"Create or edit \", h('a', {\n      href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Templates`\n    }, \"templates\"), \" for reusable forum topics so you don't need to rewrite them for every cohort you run (or you can add these later).\"]), h(\"span\", [\"Create your first cohort, in \", h('a', {\n      href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Cohorts`\n    }, \"course settings\"), \". It will also be a draft that you need to edit before publishing. We'll guide you through it!\"])]\n  })]), h(AccentImg, {\n    height: 32,\n    width: 36,\n    src: \"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Flower.png\"\n  }), h(Box, {\n    gap: 16\n  }, [h('h4', \"Once you're ready, you can publish it here!\"), h(MarkCourseLive, props)])])]), h(LinkButton, {\n    style: {\n      justifySelf: 'right',\n      textDecoration: 'none'\n    },\n    onClick: () => setExpanded(!expanded)\n  }, expanded ? \"hide checklist\" : \"show checklist\")]);\n};\n\nexport const getStaticProps = async ctx => {\n  var _ctx$params;\n\n  let id = parseInt(((_ctx$params = ctx.params) === null || _ctx$params === void 0 ? void 0 : _ctx$params.id) || '');\n  if (Number.isNaN(id)) return {\n    props: {\n      notFound: true\n    }\n  };\n  let data = await courseDataQuery(id);\n  if (!data) return {\n    props: {\n      notFound: true\n    }\n  };\n  let content = await getTaggedPost(data.category_id, 'curriculum');\n  return {\n    props: {\n      notFound: false,\n      content,\n      id,\n      course: data\n    },\n    revalidate: 1\n  };\n};\nexport const getStaticPaths = async () => {\n  let courses = await prisma.courses.findMany({\n    select: {\n      id: true,\n      slug: true\n    }\n  });\n  return {\n    paths: courses.map(course => {\n      return {\n        params: {\n          id: course.id.toString(),\n          slug: course.slug\n        }\n      };\n    }),\n    fallback: true\n  };\n};\n\nconst BannerContent = /*#__PURE__*/_styled('div', {\n  target: \"e1iqf50g0\"\n})(true ? {\n  name: \"12gnjoo\",\n  styles: \"display:grid;grid-template-columns:min-content auto;grid-column-gap:16px;grid-row-gap:32px;\"\n} : {\n  name: \"12gnjoo\",\n  styles: \"display:grid;grid-template-columns:min-content auto;grid-column-gap:16px;grid-row-gap:32px;\",\n  map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9heW9vbHV3YWFsZm9uc28vY29kZS9rcmFrZW5lZHVhcHAvcGFnZXMvY291cnNlcy9bc2x1Z10vW2lkXS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0YW9DIiwiZmlsZSI6Ii9Vc2Vycy9heW9vbHV3YWFsZm9uc28vY29kZS9rcmFrZW5lZHVhcHAvcGFnZXMvY291cnNlcy9bc2x1Z10vW2lkXS9pbmRleC50cyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBoIGZyb20gJ3JlYWN0LWh5cGVyc2NyaXB0J1xuaW1wb3J0IHsgdXNlU3RhdGUsIFJlYWN0RWxlbWVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IExpbmsgZnJvbSAnbmV4dC9saW5rJ1xuaW1wb3J0IHsgSW5mZXJHZXRTdGF0aWNQcm9wc1R5cGUgfSBmcm9tICduZXh0J1xuaW1wb3J0IHN0eWxlZCBmcm9tICdAZW1vdGlvbi9zdHlsZWQnXG5pbXBvcnQgcHJpc21hIGZyb20gXCJsaWIvcHJpc21hXCI7XG5pbXBvcnQgeyBCb3gsIFNlcGVyYXRvciwgVHdvQ29sdW1uLCBTaWRlYmFyIH0gZnJvbSAnY29tcG9uZW50cy9MYXlvdXQnXG5pbXBvcnQge1RhYnMsIFN0aWNreVdyYXBwZXJ9IGZyb20gJ2NvbXBvbmVudHMvVGFicydcbmltcG9ydCB7IGNvbG9ycyB9IGZyb20gJ2NvbXBvbmVudHMvVG9rZW5zJ1xuaW1wb3J0IExvYWRlciwgeyBQYWdlTG9hZGVyIH0gZnJvbSAnY29tcG9uZW50cy9Mb2FkZXInXG5pbXBvcnQgeyBJbmZvIH0gZnJvbSAnY29tcG9uZW50cy9Gb3JtJ1xuaW1wb3J0IHtQaWxsfSBmcm9tICdjb21wb25lbnRzL1BpbGwnXG5pbXBvcnQgRW5yb2xsIGZyb20gJ2NvbXBvbmVudHMvQ291cnNlL0Vucm9sbCdcbmltcG9ydCBUZXh0IGZyb20gJ2NvbXBvbmVudHMvVGV4dCdcbmltcG9ydCB7U21hbGxDb2hvcnRDYXJkfSBmcm9tICdjb21wb25lbnRzL0NhcmRzL1NtYWxsQ29ob3J0Q2FyZCdcbmltcG9ydCB7VHdvQ29sdW1uQmFubmVyfSBmcm9tICdjb21wb25lbnRzL0Jhbm5lcidcbmltcG9ydCB7TW9kYWx9IGZyb20gJ2NvbXBvbmVudHMvTW9kYWwnXG5pbXBvcnQgeyBQcmltYXJ5LCBEZXN0cnVjdGl2ZSwgTGlua0J1dHRvbn0gZnJvbSAnY29tcG9uZW50cy9CdXR0b24nXG5pbXBvcnQge1dhdGNoQ291cnNlfSBmcm9tICdjb21wb25lbnRzL0NvdXJzZS9XYXRjaENvdXJzZSdcblxuaW1wb3J0IHsgZ2V0VGFnZ2VkUG9zdCB9IGZyb20gJ3NyYy9kaXNjb3Vyc2UnXG5pbXBvcnQge0RJU0NPVVJTRV9VUkx9IGZyb20gJ3NyYy9jb25zdGFudHMnXG5pbXBvcnQgeyB1c2VVc2VyRGF0YSwgdXNlVXNlckNvaG9ydHMsIHVzZUNvdXJzZURhdGEsIENvdXJzZSB9IGZyb20gJ3NyYy9kYXRhJ1xuaW1wb3J0IHsgVXBkYXRlQ291cnNlTXNnLCBVcGRhdGVDb3Vyc2VSZXNwb25zZX0gZnJvbSAncGFnZXMvYXBpL2NvdXJzZXMvW2lkXSdcbmltcG9ydCB7IGNhbGxBcGkgfSBmcm9tICdzcmMvYXBpSGVscGVycydcbmltcG9ydCB7IGNvaG9ydFByZXR0eURhdGUgfSBmcm9tICdjb21wb25lbnRzL0NhcmRzL0NvaG9ydENhcmQnXG5pbXBvcnQgRXJyb3JQYWdlIGZyb20gJ3BhZ2VzLzQwNCdcbmltcG9ydCB7IGNvdXJzZURhdGFRdWVyeSB9IGZyb20gJ3BhZ2VzL2FwaS9jb3Vyc2VzL1tpZF0nXG5pbXBvcnQgSGVhZCBmcm9tICduZXh0L2hlYWQnXG5pbXBvcnQgeyB1c2VSb3V0ZXIgfSBmcm9tICduZXh0L3JvdXRlcidcbmltcG9ydCB7IEFjY2VudEltZyB9IGZyb20gJ2NvbXBvbmVudHMvSW1hZ2VzJ1xuaW1wb3J0IHsgVG9kb0xpc3QgfSBmcm9tICdjb21wb25lbnRzL1RvZG9MaXN0J1xuaW1wb3J0IHsgY29ob3J0TmFtZSwgc29ydEJ5RGF0ZUFuZE5hbWUgfSBmcm9tICdzcmMvdXRpbHMnXG5cbmNvbnN0IENPUFkgPSB7XG4gIGN1cnJpY3VsdW1UYWI6IFwiQ3VycmljdWx1bVwiLFxuICBjb2hvcnRUYWI6IFwiQWxsIENvaG9ydHNcIixcbiAgYWN0aXZlQ29ob3J0czogXCJZb3VyIEN1cnJlbnQgQ29ob3J0c1wiLFxuICBzZXR0aW5nczogXCJZb3UgY2FuIGVkaXQgZGV0YWlscywgY3JlYXRlIG5ldyBjb2hvcnRzLCBhbmQgbW9yZS5cIixcbiAgZW5yb2xsQnV0dG9uOiBcIkVucm9sbCBpbiBhIGNvaG9ydFwiLFxuICB1cGRhdGVDdXJyaWN1bHVtOiAocHJvcHM6IHtpZDogc3RyaW5nfSkgPT4gaChJbmZvLCBbXG4gICAgYPCfkqEgWW91IGNhbiBtYWtlIGNoYW5nZXMgdG8gdGhlIGN1cnJpY3VsdW0gYnkgZWRpdGluZyBgLFxuICAgIGgoJ2EnLCB7aHJlZjogYCR7RElTQ09VUlNFX1VSTH0vc2Vzc2lvbi9zc28/cmV0dXJuX3BhdGg9L3QvJHtwcm9wcy5pZH1gfSwgYHRoaXMgdG9waWNgKSxcbiAgICBgIGluIHRoZSBmb3J1bWBcbiAgXSlcbn1cblxudHlwZSBQcm9wcyA9IEluZmVyR2V0U3RhdGljUHJvcHNUeXBlPHR5cGVvZiBnZXRTdGF0aWNQcm9wcz5cblxuY29uc3QgV3JhcHBlZENvdXJzZVBhZ2UgPSAocHJvcHM6IFByb3BzKT0+cHJvcHMubm90Rm91bmQgPyBoKEVycm9yUGFnZSkgOiBoKENvdXJzZVBhZ2UsIHByb3BzKVxuZXhwb3J0IGRlZmF1bHQgV3JhcHBlZENvdXJzZVBhZ2VcblxuY29uc3QgQ291cnNlUGFnZSA9IChwcm9wczpFeHRyYWN0PFByb3BzLCB7bm90Rm91bmQ6IGZhbHNlfT4pID0+IHtcbiAgbGV0IHtkYXRhOiB1c2VyfSA9IHVzZVVzZXJEYXRhKClcbiAgbGV0IHtkYXRhOnVzZXJDb2hvcnRzfSA9IHVzZVVzZXJDb2hvcnRzKClcbiAgbGV0IHtkYXRhOiBjb3Vyc2V9ID0gdXNlQ291cnNlRGF0YShwcm9wcy5pZCwgcHJvcHMuY291cnNlIHx8IHVuZGVmaW5lZClcblxuICBpZighY291cnNlKSByZXR1cm4gaChQYWdlTG9hZGVyKVxuXG4gIGxldCBhY3RpdmVDb2hvcnRzID0gY291cnNlLmNvdXJzZV9jb2hvcnRzXG4gICAgLmZpbHRlcihjID0+IHtcbiAgICAgIGlmKCF1c2VyKSByZXR1cm4gZmFsc2VcbiAgICAgIHJldHVybiBjLmNvbXBsZXRlZCA9PT0gbnVsbCAmJiAoISFjLmNvaG9ydF9mYWNpbGl0YXRvcnMuZmluZChmPT51c2VyJiZmLmZhY2lsaXRhdG9yPT09dXNlci5pZClcbiAgICAgICAgfHwgYy5wZW9wbGVfaW5fY29ob3J0c1xuICAgICAgICAgIC5maW5kKHAgPT4gcC5wZW9wbGUuaWQgPT09ICh1c2VyID8gdXNlci5pZCA6IHVuZGVmaW5lZCkpKVxuICAgIH0pXG4gICAgLnNvcnQoc29ydEJ5RGF0ZUFuZE5hbWUpXG5cbiAgbGV0IGVucm9sbGVkID0gYWN0aXZlQ29ob3J0cy5maWx0ZXIoYz0+IWMuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PnVzZXImJmYuZmFjaWxpdGF0b3I9PT11c2VyLmlkKSkubGVuZ3RoID4gMFxuICBsZXQgdXBjb21pbmdDb2hvcnRzID0gY291cnNlLmNvdXJzZV9jb2hvcnRzLmZpbHRlcihjPT4gKG5ldyBEYXRlKGMuc3RhcnRfZGF0ZSkgPiBuZXcgRGF0ZSgpKSAmJiBjLmxpdmUpLnNvcnQoc29ydEJ5RGF0ZUFuZE5hbWUpXG5cbiAgbGV0IGlzTWFpbnRhaW5lciA9ICEhKGNvdXJzZT8uY291cnNlX21haW50YWluZXJzLmZpbmQobWFpbnRhaW5lciA9PiB1c2VyICYmIG1haW50YWluZXIubWFpbnRhaW5lciA9PT0gdXNlci5pZCkpXG4gIGxldCBpbnZpdGVkID0gISF1c2VyQ29ob3J0cz8uaW52aXRlZF9jb3Vyc2VzLmZpbmQoY291cnNlPT5jb3Vyc2UuaWQgPT09IHByb3BzLmNvdXJzZS5pZCApXG5cbiAgLy9TZXR0aW5nIHVwIHRoZSBsYXlvdXQgZm9yIHRoZSBjb3Vyc2UgcGFnZVxuICByZXR1cm4gaCgnZGl2JywgW1xuICAgIGgoSGVhZCwge2NoaWxkcmVuOiBbXG4gICAgICBoKCdtZXRhJywge3Byb3BlcnR5Olwib2c6dGl0bGVcIiwgY29udGVudDpjb3Vyc2UubmFtZSwga2V5Olwib2c6dGl0bGVcIn0pLFxuICAgICAgaCgnbWV0YScsIHtwcm9wZXJ0eTogXCJvZzpkZXNjcmlwdGlvblwiLCBjb250ZW50OiBjb3Vyc2UuZGVzY3JpcHRpb24sIGtleTogXCJvZzpkZXNjcmlwdGlvblwifSksXG4gICAgICBoKCdtZXRhJywge3Byb3BlcnR5OiBcIm9nOmltYWdlXCIsIGNvbnRlbnQ6IGNvdXJzZS5jYXJkX2ltYWdlLnNwbGl0KCcsJylbMF0sIGtleTogXCJvZzppbWFnZVwifSksXG4gICAgICBoKCdtZXRhJywge3Byb3BlcnR5OiBcInR3aXR0ZXI6Y2FyZFwiLCBjb250ZW50OiBcInN1bW1hcnlcIiwga2V5OlwidHdpdHRlcjpjYXJkXCJ9KVxuICAgIF19KSxcbiAgICBoKEJhbm5lcnMsIHtkcmFmdDogY291cnNlLnN0YXR1cyA9PT0gJ2RyYWZ0JywgaWQ6IHByb3BzLmlkLCBpc01haW50YWluZXIsIHNsdWc6IGNvdXJzZS5zbHVnfSksXG4gICAgaChUd29Db2x1bW4sIFtcbiAgICAgIGgoQm94LCB7Z2FwOiAzMn0sIFtcbiAgICAgICAgaChCb3gsIHtnYXA6IDE2fSwgW1xuICAgICAgICAgIGgoJ2gxJywgY291cnNlPy5uYW1lKSxcbiAgICAgICAgXSksXG4gICAgICAgIGgoJ3AuYmlnJywgY291cnNlPy5kZXNjcmlwdGlvbiB8fCAnJyksXG5cbiAgICAgICAgdXBjb21pbmdDb2hvcnRzLmxlbmd0aCA+IDAgJiYgKGFjdGl2ZUNvaG9ydHMubGVuZ3RoID09PSAwKVxuICAgICAgICAgID8gaChCb3gsIHtwYWRkaW5nOiAzMiwgc3R5bGU6IHtiYWNrZ3JvdW5kQ29sb3I6IGNvbG9ycy5hY2NlbnRQZWFjaH19LFtcbiAgICAgICAgICAgIC4uLnVwY29taW5nQ29ob3J0cy5mbGF0TWFwKGNvaG9ydD0+e1xuICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIGgoQ29ob3J0LCB7XG4gICAgICAgICAgICAgICAgICBjb2hvcnQsXG4gICAgICAgICAgICAgICAgICBlbnJvbGxlZDogZmFsc2UsIGZhY2lsaXRhdGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICBpbnZpdGVkLFxuICAgICAgICAgICAgICAgICAgc2x1ZzogY291cnNlPy5zbHVnIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgY29ob3J0X21heF9zaXplOiBjb3Vyc2U/LmNvaG9ydF9tYXhfc2l6ZSB8fCAwXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgaChTZXBlcmF0b3IpXVxuICAgICAgICAgICAgfSkuc2xpY2UoMCwgLTEpXG4gICAgICAgICAgXSlcbiAgICAgICAgICA6IGFjdGl2ZUNvaG9ydHMubGVuZ3RoID09PSAwID8gbnVsbCA6IGgoQm94LCB7cGFkZGluZzogMzIsIHN0eWxlOiB7YmFja2dyb3VuZENvbG9yOiBjb2xvcnMuZ3JleTk1fX0sIFtcbiAgICAgICAgICAgIGgoJ2gzJywgQ09QWS5hY3RpdmVDb2hvcnRzKSxcbiAgICAgICAgICAgIC4uLmFjdGl2ZUNvaG9ydHMubWFwKGNvaG9ydD0+IGgoU21hbGxDb2hvcnRDYXJkLCB7XG4gICAgICAgICAgICAgIC4uLmNvaG9ydCxcbiAgICAgICAgICAgICAgZmFjaWxpdGF0b3JzOiBjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5tYXAoZj0+Zi5wZW9wbGUuZGlzcGxheV9uYW1lIHx8IGYucGVvcGxlLnVzZXJuYW1lKSxcbiAgICAgICAgICAgICAgY291cnNlczoge1xuICAgICAgICAgICAgICAgIG5hbWU6IGNvdXJzZT8ubmFtZSB8fCAnJyxcbiAgICAgICAgICAgICAgICBzbHVnOiBjb3Vyc2U/LnNsdWcgfHwgJycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZhY2lsaXRhdGluZzogISFjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PnVzZXImJmYuZmFjaWxpdGF0b3I9PT11c2VyLmlkKSxcbiAgICAgICAgICAgICAgZW5yb2xsZWQ6ICFjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PnVzZXImJmYuZmFjaWxpdGF0b3I9PT11c2VyLmlkKVxuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgXSksXG4gICAgICBdKSxcbiAgICAgIGgoVGFicywge3RhYnM6IHtcbiAgICAgICAgW0NPUFkuY3VycmljdWx1bVRhYl06ICBoKEJveCwgW1xuICAgICAgICAgIGlzTWFpbnRhaW5lciA/IGgoQ09QWS51cGRhdGVDdXJyaWN1bHVtLCB7aWQ6IHByb3BzLmNvbnRlbnQuaWR9KSA6IG51bGwsXG4gICAgICAgICAgaChUZXh0LCB7c291cmNlOiBwcm9wcy5jb250ZW50LnRleHR9KVxuICAgICAgICBdKSxcbiAgICAgICAgW0NPUFkuY29ob3J0VGFiXTogaChDb2hvcnRzLHtjb2hvcnRzOiBjb3Vyc2UuY291cnNlX2NvaG9ydHMsIHNsdWc6IGNvdXJzZS5zbHVnLCB1c2VyOiB1c2VyID8gdXNlci5pZCA6ICcnLCBpbnZpdGVkLCBjb2hvcnRfbWF4X3NpemU6IGNvdXJzZT8uY29ob3J0X21heF9zaXplIHx8IDB9KSxcbiAgICAgICAgRmFjaWxpdGF0b3JzOiBoKEJveCwge2dhcDozMn0sIGNvdXJzZS5jb3Vyc2VfbWFpbnRhaW5lcnMubWFwKG1haW50YWluZXI9PntcbiAgICAgICAgICByZXR1cm4gaChCb3gsIHt9LCBbXG4gICAgICAgICAgICBoKCdoMycsIG1haW50YWluZXIucGVvcGxlLmRpc3BsYXlfbmFtZSB8fCBtYWludGFpbmVyLnBlb3BsZS51c2VybmFtZSksXG4gICAgICAgICAgICAhbWFpbnRhaW5lci5wZW9wbGUubGluayA/IG51bGwgOiBoKCdhJywge2hyZWY6IG1haW50YWluZXIucGVvcGxlLmxpbmt9LCBoKCdiJywgbWFpbnRhaW5lci5wZW9wbGUubGluaykpLFxuICAgICAgICAgICAgIW1haW50YWluZXIucGVvcGxlLmJpbyA/IG51bGwgOiBoKEJveCwge3dpZHRoOiA2NDB9LCBoKFRleHQsIHtzb3VyY2U6IG1haW50YWluZXIucGVvcGxlLmJpb30pKVxuICAgICAgICAgIF0pXG4gICAgICAgIH0pKVxuICAgICAgfX0pLFxuICAgICAgaChTaWRlYmFyLCBbXG4gICAgICAgIGgoU3RpY2t5V3JhcHBlciwgW1xuICAgICAgICAgIGgoRW5yb2xsLCB7Y291cnNlfSwgW1xuICAgICAgICAgICAgaChCb3gsIFtcbiAgICAgICAgICAgICAgaChFbnJvbGxTdGF0dXMsIHtcbiAgICAgICAgICAgICAgICBjb3Vyc2VJZDogY291cnNlLmlkLFxuICAgICAgICAgICAgICAgIGNvdXJzZVNsdWc6IGNvdXJzZS5zbHVnLFxuICAgICAgICAgICAgICAgIGRyYWZ0OmNvdXJzZS5zdGF0dXM9PT0nZHJhZnQnLFxuICAgICAgICAgICAgICAgIG1haW50YWluZXI6IGlzTWFpbnRhaW5lcixcbiAgICAgICAgICAgICAgICBpbnZpdGVPbmx5OmNvdXJzZS5pbnZpdGVfb25seSxcbiAgICAgICAgICAgICAgICBpbnZpdGVkLFxuICAgICAgICAgICAgICAgIGxvZ2dlZEluOiAhIXVzZXIsXG4gICAgICAgICAgICAgICAgZW5yb2xsZWQsXG4gICAgICAgICAgICAgICAgdXBjb21pbmc6dXBjb21pbmdDb2hvcnRzLmxlbmd0aCAhPT0gMCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIGgoU2VwZXJhdG9yKSxcbiAgICAgICAgICAgICAgIWlzTWFpbnRhaW5lciA/IGgoV2F0Y2hDb3Vyc2UsIHtpZDogY291cnNlLmlkfSkgOiBoKEJveCwgW1xuICAgICAgICAgICAgICAgIGgoQm94LCB7Z2FwOjh9LCBbXG4gICAgICAgICAgICAgICAgICBoKCdoMycsIGBZb3UgbWFpbnRhaW4gdGhpcyAke2NvdXJzZS50eXBlfWApLFxuICAgICAgICAgICAgICAgICAgaCgncC50ZXh0U2Vjb25kYXJ5JywgQ09QWS5zZXR0aW5ncyksXG4gICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgaChMaW5rLCB7aHJlZjonL2NvdXJzZXMvW3NsdWddL1tpZF0vc2V0dGluZ3MnLCBhczpgL2NvdXJzZXMvJHtjb3Vyc2Uuc2x1Z30vJHtjb3Vyc2UuaWR9L3NldHRpbmdzYH0sIGgoRGVzdHJ1Y3RpdmUsICdTZXR0aW5ncycpKVxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgXSlcbiAgICAgICAgICBdKV0pLFxuICAgICAgXSlcbiAgICBdKVxuICBdKVxufVxuXG5mdW5jdGlvbiBFbnJvbGxTdGF0dXMgKHByb3BzOiB7XG4gIGRyYWZ0OmJvb2xlYW4sXG4gIG1haW50YWluZXI6Ym9vbGVhbixcbiAgaW52aXRlT25seTpib29sZWFuLFxuICBpbnZpdGVkOmJvb2xlYW4sXG4gIGxvZ2dlZEluOmJvb2xlYW4sXG4gIGVucm9sbGVkOmJvb2xlYW47XG4gIHVwY29taW5nOmJvb2xlYW47XG4gIGNvdXJzZUlkOm51bWJlcjtcbiAgY291cnNlU2x1ZzpzdHJpbmdcbn0pIHtcbiAgaWYgKHByb3BzLmRyYWZ0KSB7XG4gICAgaWYgKHByb3BzLm1haW50YWluZXIpIHJldHVybiBoKCdzcGFuLmFjY2VudFJlZCcsIFwiTGVhcm5lcnMgY2FuJ3QgZW5yb2xsIGluIHRoaXMgY291cnNlIHVudGlsIHlvdSBwdWJsaXNoIGl0IVwiKVxuICAgIHJldHVybiBoKCdzcGFuLmFjY2VudFJlZCcsIFwiVGhpcyBjb3Vyc2UgaXMgc3RpbGwgYSBkcmFmdC4gWW91IGNhbiBlbnJvbGwgb25jZSB0aGUgY3JlYXRvciBwdWJsaXNoZXMgaXQhXCIpXG4gIH1cblxuICBpZiAocHJvcHMuZW5yb2xsZWQpe1xuICAgIGlmIChwcm9wcy51cGNvbWluZykgcmV0dXJuIGgoJ3NwYW4uYWNjZW50U3VjY2VzcycsIFwiWW91J3JlIGVucm9sbGVkIGluIGFuIHVwY29taW5nIGNvaG9ydC4gRmVlbCBmcmVlIHRvIGVucm9sbCBpbiBhbm90aGVyIG9uZSB0aG91Z2ghXCIpXG4gICAgcmV0dXJuICBoKCdzcGFuLmFjY2VudFN1Y2Nlc3MnLCBcIllvdSdyZSBlbnJvbGxlZCBpbiBhbiB1cGNvbWluZyBjb2hvcnRcIilcbiAgfVxuXG4gIGlmICghcHJvcHMudXBjb21pbmcpIHtcbiAgICBpZihwcm9wcy5tYWludGFpbmVyKSByZXR1cm4gaCgnc3Bhbi5hY2NlbnRSZWQnLCBbXG4gICAgICBcIkxvb2tzIGxpa2UgdGhlcmUgYXJlbid0IGFueSBjb2hvcnRzIHBsYW5uZWQuIENyZWF0ZSBvbmUgXCIsIGgoTGluaywge2hyZWY6IFwiL2NvdXJzZXMvW3NsdWddL1tpZF0vc2V0dGluZ3NcIiwgYXM6IGAvY291cnNlcy8ke3Byb3BzLmNvdXJzZVNsdWd9LyR7cHJvcHMuY291cnNlSWR9L3NldHRpbmdzYH0sIGgoJ2EnLCAnaGVyZScpKSwgJy4nXG4gICAgXSlcbiAgICByZXR1cm4gaCgnc3Bhbi5hY2NlbnRSZWQnLCBcIkxvb2tzIGxpa2UgdGhlcmUgYXJlbid0IGFueSBjb2hvcnRzIHBsYW5uZWQgOihcIilcbiAgfVxuXG4gIGlmIChwcm9wcy5pbnZpdGVPbmx5KSB7XG4gICAgaWYgKHByb3BzLm1haW50YWluZXIpIHJldHVybiBoKCdzcGFuLmFjY2VudFJlZCcsIFtcbiAgICAgIFwiTGVhcm5lcnMgbmVlZCB0byBiZSBpbnZpdGVkIHRvIGVucm9sbC4gSW52aXRlIHNvbWVvbmUgXCIsIGgoTGluaywge2hyZWY6IGAvY291cnNlcy8ke3Byb3BzLmNvdXJzZVNsdWd9LyR7cHJvcHMuY291cnNlSWR9L3NldHRpbmdzYH0sIGgoJ2EnLCAnaGVyZScpKSwgJy4nXSlcbiAgICBpZihwcm9wcy5pbnZpdGVkKSByZXR1cm4gaCgnc3Bhbi5hY2NlbnRTdWNjZXNzJywgXCJZb3UncmUgaW52aXRlZCFcIilcbiAgICBpZihwcm9wcy5sb2dnZWRJbikgcmV0dXJuIGgoJ2RpdicsIHt9LCBoKCdzcGFuLmFjY2VudFJlZCcsIFwiVGhpcyBjb3Vyc2UgaXMgaW52aXRlIG9ubHkuIFJlYWNoIG91dCB0byB0aGUgZmFjaWxpdGF0b3JzIGlmIHlvdSdyZSBpbnRlcmVzdGVkIVwiKSlcbiAgICByZXR1cm4gaCgnZGl2Jywge30sIGgoJ3NwYW4uYWNjZW50UmVkJywgXCJUaGlzIGNvdXJzZSBpcyBpbnZpdGUgb25seS4gSWYgeW91J3ZlIGJlZW4gaW52aXRlZCwgcGxlYXNlIGxvZyBpbi5cIikpXG4gIH1cbiAgcmV0dXJuIG51bGxcbn1cblxuXG5jb25zdCBDb2hvcnRzID0gKHByb3BzOntjb2hvcnRzOiBDb3Vyc2VbJ2NvdXJzZV9jb2hvcnRzJ10sIHVzZXI6IHN0cmluZywgc2x1Zzogc3RyaW5nLCBjb2hvcnRfbWF4X3NpemU6IG51bWJlciwgaW52aXRlZDpib29sZWFufSkgPT4ge1xuICBsZXQgW3Bhc3RDb2hvcnRzLCB1cGNvbWluZ0NvaG9ydHNdID0gcHJvcHMuY29ob3J0c1xuICAuZmlsdGVyKGM9PntcbiAgICBpZihjLmxpdmUpIHJldHVybiB0cnVlXG4gICAgcmV0dXJuICEhYy5jb2hvcnRfZmFjaWxpdGF0b3JzLmZpbmQoZj0+Zi5mYWNpbGl0YXRvcj09PXByb3BzLnVzZXIpXG4gIH0pLnNvcnQoc29ydEJ5RGF0ZUFuZE5hbWUpXG4gICAgLnJlZHVjZSgoYWNjLCBjb2hvcnQpPT57XG4gICAgICBsZXQgZW5yb2xsZWQgPSAhIWNvaG9ydC5wZW9wbGVfaW5fY29ob3J0cy5maW5kKHAgPT4gcC5wZW9wbGUuaWQgPT09IHByb3BzLnVzZXIpXG4gICAgICBsZXQgZmFjaWxpdGF0aW5nID0gISFjb2hvcnQuY29ob3J0X2ZhY2lsaXRhdG9ycy5maW5kKGY9PmYuZmFjaWxpdGF0b3IgPT09IHByb3BzLnVzZXIpXG4gICAgICBhY2NbbmV3IERhdGUoY29ob3J0LnN0YXJ0X2RhdGUpPCBuZXcgRGF0ZSgpID8gMCA6IDFdLnB1c2goXG4gICAgICAgIGgoQ29ob3J0LCB7XG4gICAgICAgICAgY29ob3J0LFxuICAgICAgICAgIGVucm9sbGVkLCBmYWNpbGl0YXRpbmcsXG4gICAgICAgICAgc2x1ZzogcHJvcHMuc2x1ZyxcbiAgICAgICAgICBjb2hvcnRfbWF4X3NpemU6IHByb3BzLmNvaG9ydF9tYXhfc2l6ZSxcbiAgICAgICAgICBpbnZpdGVkOiBwcm9wcy5pbnZpdGVkXG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICByZXR1cm4gYWNjXG4gICAgfSxbW10sW11dIGFzIEFycmF5PEFycmF5PFJlYWN0RWxlbWVudD4+KVxuXG4gIHJldHVybiBoKEJveCwge2dhcDozMn0sIFtcbiAgICB1cGNvbWluZ0NvaG9ydHMubGVuZ3RoID09PSAwID8gbnVsbCA6IGgoJ2gyJywgXCJVcGNvbWluZyBDb2hvcnRzXCIpLFxuICAgIC4uLnVwY29taW5nQ29ob3J0cyxcbiAgICB1cGNvbWluZ0NvaG9ydHMubGVuZ3RoID09PSAwIHx8IHBhc3RDb2hvcnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBoKFNlcGVyYXRvciksXG4gICAgcGFzdENvaG9ydHMubGVuZ3RoID09PSAwID8gbnVsbCA6IGgoJ2gyJywgJ09uZ29pbmcgYW5kIFBhc3QgQ29ob3J0cycpLFxuICAgIC4uLnBhc3RDb2hvcnRzXG4gICAgXSlcbn1cblxuZXhwb3J0IGNvbnN0IENvaG9ydCA9IChwcm9wczoge1xuICBjb2hvcnQ6IENvdXJzZVsnY291cnNlX2NvaG9ydHMnXVswXSxcbiAgZmFjaWxpdGF0aW5nPzogYm9vbGVhbixcbiAgZW5yb2xsZWQ/OiBib29sZWFuLFxuICBzbHVnOnN0cmluZyxcbiAgY29ob3J0X21heF9zaXplOiBudW1iZXIsXG4gIGludml0ZWQ6IGJvb2xlYW5cbn0pID0+IHtcbiAgbGV0IGlkPSBwcm9wcy5jb2hvcnQuaWRcbiAgbGV0IHJvdXRlciA9IHVzZVJvdXRlcigpXG4gIGxldCBwYXN0ID0gbmV3IERhdGUocHJvcHMuY29ob3J0LnN0YXJ0X2RhdGUpIDwgbmV3IERhdGUoKVxuXG4gIHJldHVybiBoKEJveCwge2g6IHRydWUsIHN0eWxlOntncmlkQXV0b0NvbHVtbnM6J2F1dG8nfX0sIFtcbiAgICBoKEJveCwge2dhcDogNH0sIFtcbiAgICAgICFwcm9wcy5lbnJvbGxlZCAmJiAhcHJvcHMuZmFjaWxpdGF0aW5nID8gbnVsbCA6IGgoJ2RpdicsIFtcbiAgICAgICAgcHJvcHMuZW5yb2xsZWQgPyBoKFBpbGwsICdlbnJvbGxlZCcpIDogbnVsbCxcbiAgICAgICAgJyAnLFxuICAgICAgICBwcm9wcy5mYWNpbGl0YXRpbmcgPyBoKFBpbGwsIHtib3JkZXJPbmx5OiB0cnVlfSwgJ2ZhY2lsaXRhdGluZycpIDogbnVsbCxcbiAgICAgICAgJyAnLFxuICAgICAgICAhcHJvcHMuY29ob3J0LmxpdmUgPyBoKFBpbGwsIHtib3JkZXJPbmx5OiB0cnVlLCByZWQ6IHRydWV9LCAnZHJhZnQnKSA6IG51bGwsXG4gICAgICBdKSxcbiAgICAgIGgoJ2gzJywge30sIGgoTGluaywge1xuICAgICAgICBocmVmOicvY291cnNlcy9bc2x1Z10vW2lkXS9jb2hvcnRzL1tjb2hvcnRJZF0nLFxuICAgICAgICBhczogIGAvY291cnNlcy8ke3Byb3BzLnNsdWd9LyR7cHJvcHMuY29ob3J0LmNvdXJzZX0vY29ob3J0cy8ke2lkfWBcbiAgICAgIH0sIGgoJ2EnLCB7c3R5bGU6IHt0ZXh0RGVjb3JhdGlvbjogJ25vbmUnfX0sIGNvaG9ydE5hbWUocHJvcHMuY29ob3J0Lm5hbWUpKSkpLFxuICAgICAgaChCb3gsIHtzdHlsZToge2NvbG9yOiBjb2xvcnMudGV4dFNlY29uZGFyeX0sIGdhcDogNH0sIFtcbiAgICAgICAgaCgnc3Ryb25nJywgY29ob3J0UHJldHR5RGF0ZShwcm9wcy5jb2hvcnQuc3RhcnRfZGF0ZSwgcHJvcHMuY29ob3J0LmNvbXBsZXRlZCkpLFxuICAgICAgICBoKCdkaXYnLCBbXG4gICAgICAgICAgYEZhY2lsaXRhdGVkIGJ5IGAsXG4gICAgICAgICAgLi4ucHJvcHMuY29ob3J0LmNvaG9ydF9mYWNpbGl0YXRvcnMuZmxhdE1hcChmPT57XG4gICAgICAgICAgICByZXR1cm4gW2goTGluaywge2hyZWY6YC9wZW9wbGUvJHtmLnBlb3BsZS51c2VybmFtZX1gfSwgaCgnYScsIGYucGVvcGxlLmRpc3BsYXlfbmFtZSB8fCBmLnBlb3BsZS51c2VybmFtZSkpLCAnLCAnXVxuICAgICAgICAgIH0pLnNsaWNlKDAsIC0xKVxuICAgICAgICBdKVxuICAgICAgXSksXG4gICAgICBwcm9wcy5jb2hvcnRfbWF4X3NpemUgPT09IDAgfHwgcGFzdCA/IG51bGwgOiBwcm9wcy5jb2hvcnRfbWF4X3NpemUgPiBwcm9wcy5jb2hvcnQucGVvcGxlX2luX2NvaG9ydHMubGVuZ3RoXG4gICAgICAgID8gaCgnc3Bhbi5hY2NlbnRTdWNjZXNzJywgYCR7cHJvcHMuY29ob3J0X21heF9zaXplIC0gcHJvcHMuY29ob3J0LnBlb3BsZV9pbl9jb2hvcnRzLmxlbmd0aH0gJHtwcm9wcy5jb2hvcnRfbWF4X3NpemUgLSBwcm9wcy5jb2hvcnQucGVvcGxlX2luX2NvaG9ydHMubGVuZ3RoID09PSAxID8gJ3Nwb3QnIDogJ3Nwb3RzJ30gbGVmdCFgKVxuICAgICAgICA6IGgoJ3NwYW4uYWNjZW50UmVkJywgYFNvcnJ5ISBUaGlzIGNvaG9ydCBpcyBmdWxsLmApXG4gICAgXSksXG4gICAgcGFzdCB8fCBwcm9wcy5lbnJvbGxlZCB8fCBwcm9wcy5mYWNpbGl0YXRpbmcgPyBudWxsIDogaChCb3gsIHtnYXA6OCwgc3R5bGU6IHthbGlnbkl0ZW1zOiAnY2VudGVyJywgYWxpZ25Db250ZW50OiAnY2VudGVyJywganVzdGlmeVNlbGY6ICdyaWdodCcsIHRleHRBbGlnbjogJ3JpZ2h0J319LCBbXG4gICAgICBoKExpbmssIHtcbiAgICAgICAgaHJlZjogYC9jb3Vyc2VzLyR7cm91dGVyLnF1ZXJ5LnNsdWd9LyR7cHJvcHMuY29ob3J0LmNvdXJzZX0vY29ob3J0cy8ke3Byb3BzLmNvaG9ydC5pZH1gXG4gICAgICB9LCBoKCdhJywge30sIGgoUHJpbWFyeSwgJ1NlZSBzY2hlZHVsZScpKSlcbiAgICBdKVxuICBdKVxufVxuLy9mZWF0dXJlIHRvIGFkZCBhIG5ldyBjb2hvcnQgdG8gYSBjb3Vyc2VcbmZ1bmN0aW9uIE1hcmtDb3Vyc2VMaXZlKHByb3BzOiB7aWQ6bnVtYmVyLCBzbHVnOiBzdHJpbmd9KSB7XG4gIGxldCB7ZGF0YTpjb3Vyc2UsIG11dGF0ZX0gPSB1c2VDb3Vyc2VEYXRhKHByb3BzLmlkKVxuICBsZXQgW3N0YXRlLCBzZXRTdGF0ZV0gPSB1c2VTdGF0ZTwnbm9ybWFsJ3wnY29uZmlybSd8J2xvYWRpbmcnfCdjb21wbGV0ZSc+KCdub3JtYWwnKVxuXG4gIGNvbnN0IG9uQ2xpY2sgPSBhc3luYyAoZTogUmVhY3QuTW91c2VFdmVudCkgID0+e1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGlmKCFjb3Vyc2UpIHJldHVyblxuICAgIHNldFN0YXRlKCdsb2FkaW5nJylcbiAgICBsZXQgcmVzID0gYXdhaXQgY2FsbEFwaTxVcGRhdGVDb3Vyc2VNc2csIFVwZGF0ZUNvdXJzZVJlc3BvbnNlPihgL2FwaS9jb3Vyc2VzLyR7cHJvcHMuaWR9YCwge3N0YXR1czogJ2xpdmUnfSlcbiAgICBpZihyZXMuc3RhdHVzPT09MjAwKXtcbiAgICAgIHNldFN0YXRlKCdub3JtYWwnKVxuICAgICAgbXV0YXRlKHsuLi5jb3Vyc2UsIHN0YXR1czogJ2xpdmUnfSlcbiAgICB9XG4gIH1cblxuICBpZihzdGF0ZSA9PT0gJ2NvbmZpcm0nIHx8IHN0YXRlID09PSAnbG9hZGluZycpIHJldHVybiBoKFxuICAgIE1vZGFsLFxuICAgIHsgZGlzcGxheTogdHJ1ZSwgY2xvc2VUZXh0OiBcIm5ldmVybWluZFwiLCBvbkV4aXQ6ICgpID0+IHNldFN0YXRlKFwibm9ybWFsXCIpIH0sXG4gICAgW1xuICAgICAgaChCb3gsIHsgZ2FwOiAzMiB9LCBbXG4gICAgICAgIGgoXCJoMlwiLCB7IHN0eWxlOiB7IHRleHRBbGlnbjogXCJjZW50ZXJcIiB9IH0sIFwiQXJlIHlvdSBzdXJlP1wiKSxcbiAgICAgICAgaChCb3gsIHsgZ2FwOiAxNiB9LCBbXG4gICAgICAgICAgXCJCZWZvcmUgZ29pbmcgbGl2ZSBwbGVhc2UgY2hlY2sgdGhhdCB5b3UndmUgZG9uZSB0aGVzZSB0aGluZ3NcIixcbiAgICAgICAgICBoKEJveC53aXRoQ29tcG9uZW50KFwidWxcIiksIHsgZ2FwOiAxNiB9LCBbXG4gICAgICAgICAgICBoKFwibGlcIiwgW1xuICAgICAgICAgICAgICBcIkVkaXQgaW1wb3J0YW50IGRldGFpbHMgaW4gXCIsXG4gICAgICAgICAgICAgIGgoXG4gICAgICAgICAgICAgICAgXCJhXCIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgaHJlZjogYGh0dHBzOi8vYXBwLmtyYWtlbmVkdS5jb20vY291cnNlcy8ke3Byb3BzLnNsdWd9LyR7cHJvcHMuaWR9L3NldHRpbmdzP3RhYj1EZXRhaWxzYCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwiY291cnNlIHNldHRpbmdzXCJcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgXCIuXCIsXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGgoXCJsaVwiLCBbXG4gICAgICAgICAgICAgIFwiV3JpdHRlbiBhIFwiLFxuICAgICAgICAgICAgICBoKFxuICAgICAgICAgICAgICAgIFwiYVwiLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGhyZWY6IGAke0RJU0NPVVJTRV9VUkx9L3Nlc3Npb24vc3NvP3JldHVybl9wYXRoPS90LyR7cHJvcHMuaWR9YCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwiY3VycmljdWx1bVwiXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIFwiLlwiLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgaChcbiAgICAgICAgICAgIFByaW1hcnksXG4gICAgICAgICAgICB7IHN0eWxlOiB7IGp1c3RpZnlTZWxmOiBcImNlbnRlclwiIH0sIG9uQ2xpY2sgfSxcbiAgICAgICAgICAgIHN0YXRlID09PSBcImxvYWRpbmdcIiA/IGgoTG9hZGVyKSA6IFwiR28gTGl2ZSFcIlxuICAgICAgICAgICksXG4gICAgICAgIF0pLFxuICAgICAgXSksXG4gICAgXVxuICApO1xuXG4gIHJldHVybiBoKFByaW1hcnksIHtvbkNsaWNrOiBhc3luYyBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBzZXRTdGF0ZSgnY29uZmlybScpXG4gIH19LCBcIlB1Ymxpc2ghXCIpXG59XG5cbi8vIEZlYXR1cmUgdG8gZWRpdCBjb3Vyc2UgZGV0YWlsIChsZW5ndGgsIHByZXJlcXMsIG9uZSBsaW5lIGRlc2NyaXB0aW9uKVxuXG5cblxuLy8gRGVmaW5lIEJhbm5lcnNcbmNvbnN0IEJhbm5lcnMgPSAocHJvcHM6e2RyYWZ0OiBib29sZWFuLCBpZDogbnVtYmVyLCBzbHVnOnN0cmluZywgaXNNYWludGFpbmVyOiBib29sZWFufSkgPT4ge1xuICBpZihwcm9wcy5kcmFmdCAmJiBwcm9wcy5pc01haW50YWluZXIpIHtcbiAgICBpZihwcm9wcy5pc01haW50YWluZXIpe1xuICAgICAgcmV0dXJuIGgoVE9ET0Jhbm5lciwgcHJvcHMpXG4gICAgfVxuICAgIHJldHVybiBoKFR3b0NvbHVtbkJhbm5lciwge3JlZDogdHJ1ZX0sIGgoQm94LCB7Z2FwOjE2fSxbXG4gICAgICBoKEJveCwge2dhcDoxNn0sIFtcbiAgICAgICAgaCgnaDMnLCBcIlRoaXMgY291cnNlIGlzbid0IGxpdmUgeWV0IVwiKSxcbiAgICAgICAgaCgncCcsW2BUaGUgbWFpbnRhaW5lciBpcyBzdGlsbCB3b3JraW5nIG9uIGdldHRpbmcgdGhpcyBjb3Vyc2UgaW4gc2hhcGUuIExldCB0aGVtIGtub3dcbmlmIHlvdSBoYXZlIGFueSBmZWVkYmFjayFgXSlcbiAgICAgIF0pXG4gICAgXSkpXG4gIH1cbiAgcmV0dXJuIG51bGxcbn1cblxuLy8gRHJhZnQgQ291cnNlIFRvRG8gQmFubmVyXG5jb25zdCBUT0RPQmFubmVyID0gKHByb3BzOntcbiAgaWQ6bnVtYmVyXG4gIHNsdWc6c3RyaW5nXG59KSA9PiB7XG4gIGxldCBbZXhwYW5kZWQsIHNldEV4cGFuZGVkXSA9IHVzZVN0YXRlKGZhbHNlKVxuXG4gIHJldHVybiBoKFR3b0NvbHVtbkJhbm5lciwge3JlZDogdHJ1ZX0sIFtcbiAgICBoKEJhbm5lckNvbnRlbnQsIFtcbiAgICAgIGgoQWNjZW50SW1nLCB7aGVpZ2h0OjMyLCB3aWR0aDozNiwgc3JjOlwiaHR0cHM6Ly9oeXBlcmxpbmstZGF0YS5ueWMzLmNkbi5kaWdpdGFsb2NlYW5zcGFjZXMuY29tL2ljb25zL1NlZWRsaW5nLnBuZ1wifSksXG4gICAgICBoKEJveCwge2dhcDo4fSwgW1xuICAgICAgICBoKCdoNCcsIFwiVGhpcyBjb3Vyc2UgaXMgc3RpbGwgYSBkcmFmdFwiKSxcbiAgICAgICAgaCgncCcsICdJdOKAmXMgaGlkZGVuIGZyb20gcHVibGljIHZpZXcuIFBlb3BsZSBjYW7igJl0IHNlZSB0aGlzIHBhZ2UgdW50aWwgeW91IHB1Ymxpc2ggaXQuJylcbiAgICAgIF0pLFxuICAgICAgLi4uICFleHBhbmRlZCA/IFtdIDogW1xuICAgICAgICBoKEFjY2VudEltZywge2hlaWdodDozMiwgd2lkdGg6MzYsIHNyYzpcImh0dHBzOi8vaHlwZXJsaW5rLWRhdGEubnljMy5jZG4uZGlnaXRhbG9jZWFuc3BhY2VzLmNvbS9pY29ucy9CdWQucG5nXCJ9KSxcbiAgICAgICAgaChCb3gsIHtnYXA6MTZ9LCBbXG4gICAgICAgICAgaCgnaDQnLCBcIkJlZm9yZSB5b3UgcHVibGlzaCB0aGlzIGNvdXJzZSBtYWtlIHN1cmUgdGhhdCB5b3UgLi4uICBcIiksXG4gICAgICAgICAgaChUb2RvTGlzdCwge1xuICAgICAgICAgICAgcGVyc2lzdEtleTogXCJjb3Vyc2UtY3JlYXRpb24tdG9kb1wiLFxuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgaChcInNwYW5cIiwgW1xuICAgICAgICAgICAgICAgIFwiRWRpdCBpbXBvcnRhbnQgZGV0YWlscywgbGlrZSBkZXNjcmlwdGlvbiBhbmQgcHJpY2UsIGluIFwiLCBoKCdhJywge2hyZWY6IGBodHRwczovL2FwcC5rcmFrZW5lZHUuY29tL2NvdXJzZXMvJHtwcm9wcy5zbHVnfS8ke3Byb3BzLmlkfS9zZXR0aW5ncz90YWI9RGV0YWlsc2B9LCBcImNvdXJzZSBzZXR0aW5nc1wiKSwgXCIuXCJcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIGgoXCJzcGFuXCIsIFtcbiAgICAgICAgICAgICAgICBcIldyaXRlIGEgY29tcHJlaGVuc2l2ZSBjdXJyaWN1bHVtIGZvciB5b3VyIGNvdXJzZSwgYnkgZWRpdGluZyB0aGUgXCIsIGgoJ2EnLCB7aHJlZjogYCR7RElTQ09VUlNFX1VSTH0vc2Vzc2lvbi9zc28/cmV0dXJuX3BhdGg9L3QvJHtwcm9wcy5pZH1gfSwgXCJDdXJyaWN1bHVtIHRvcGljXCIpLCBcIiBpbiB0aGUgZm9ydW0uXCJcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIGgoXCJzcGFuXCIsIFtcbiAgICAgICAgICAgICAgICBcIkNyZWF0ZSBvciBlZGl0IFwiLCBoKCdhJywge2hyZWY6IGBodHRwczovL2FwcC5rcmFrZW5lZHUuY29tL2NvdXJzZXMvJHtwcm9wcy5zbHVnfS8ke3Byb3BzLmlkfS9zZXR0aW5ncz90YWI9VGVtcGxhdGVzYH0sIFwidGVtcGxhdGVzXCIpLCBcIiBmb3IgcmV1c2FibGUgZm9ydW0gdG9waWNzIHNvIHlvdSBkb24ndCBuZWVkIHRvIHJld3JpdGUgdGhlbSBmb3IgZXZlcnkgY29ob3J0IHlvdSBydW4gKG9yIHlvdSBjYW4gYWRkIHRoZXNlIGxhdGVyKS5cIlxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgaChcInNwYW5cIiwgW1xuICAgICAgICAgICAgICAgIFwiQ3JlYXRlIHlvdXIgZmlyc3QgY29ob3J0LCBpbiBcIiwgaCgnYScsIHtocmVmOiBgaHR0cHM6Ly9hcHAua3Jha2VuZWR1LmNvbS9jb3Vyc2VzLyR7cHJvcHMuc2x1Z30vJHtwcm9wcy5pZH0vc2V0dGluZ3M/dGFiPUNvaG9ydHNgfSwgXCJjb3Vyc2Ugc2V0dGluZ3NcIiksIFwiLiBJdCB3aWxsIGFsc28gYmUgYSBkcmFmdCB0aGF0IHlvdSBuZWVkIHRvIGVkaXQgYmVmb3JlIHB1Ymxpc2hpbmcuIFdlJ2xsIGd1aWRlIHlvdSB0aHJvdWdoIGl0IVwiXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfSlcbiAgICAgICAgXSksXG4gICAgICAgIGgoQWNjZW50SW1nLCB7aGVpZ2h0OjMyLCB3aWR0aDozNiwgc3JjOlwiaHR0cHM6Ly9oeXBlcmxpbmstZGF0YS5ueWMzLmNkbi5kaWdpdGFsb2NlYW5zcGFjZXMuY29tL2ljb25zL0Zsb3dlci5wbmdcIn0pLFxuICAgICAgICBoKEJveCwge2dhcDoxNn0sIFtcbiAgICAgICAgICBoKCdoNCcsIFwiT25jZSB5b3UncmUgcmVhZHksIHlvdSBjYW4gcHVibGlzaCBpdCBoZXJlIVwiKSxcbiAgICAgICAgICBoKE1hcmtDb3Vyc2VMaXZlLCBwcm9wcylcbiAgICAgICAgXSlcbiAgICAgIF1cbiAgICBdKSxcbiAgICBoKExpbmtCdXR0b24sIHtzdHlsZTp7anVzdGlmeVNlbGY6ICdyaWdodCcsIHRleHREZWNvcmF0aW9uOiAnbm9uZSd9LCBvbkNsaWNrOiAoKT0+c2V0RXhwYW5kZWQoIWV4cGFuZGVkKX0sIGV4cGFuZGVkID8gXCJoaWRlIGNoZWNrbGlzdFwiIDogXCJzaG93IGNoZWNrbGlzdFwiKVxuICBdKVxufVxuXG5leHBvcnQgY29uc3QgZ2V0U3RhdGljUHJvcHMgPSBhc3luYyAoY3R4OmFueSkgPT4ge1xuICBsZXQgaWQgPSBwYXJzZUludChjdHgucGFyYW1zPy5pZCBhcyBzdHJpbmcgfHwgJycgKVxuICBpZihOdW1iZXIuaXNOYU4oaWQpKSByZXR1cm4ge3Byb3BzOiB7bm90Rm91bmQ6IHRydWV9fSBhcyBjb25zdFxuXG4gIGxldCBkYXRhID0gYXdhaXQgY291cnNlRGF0YVF1ZXJ5KGlkKVxuICBpZighZGF0YSkgcmV0dXJuIHtwcm9wczp7bm90Rm91bmQ6IHRydWV9fSBhcyBjb25zdFxuICBsZXQgY29udGVudCA9IGF3YWl0IGdldFRhZ2dlZFBvc3QoZGF0YS5jYXRlZ29yeV9pZCwgJ2N1cnJpY3VsdW0nKVxuXG4gIHJldHVybiB7cHJvcHM6IHtub3RGb3VuZDogZmFsc2UsIGNvbnRlbnQsIGlkLCBjb3Vyc2U6IGRhdGF9LCByZXZhbGlkYXRlOiAxfSBhcyBjb25zdFxufVxuXG5leHBvcnQgY29uc3QgZ2V0U3RhdGljUGF0aHMgPSBhc3luYyAoKSA9PiB7XG5cbiAgbGV0IGNvdXJzZXMgPSBhd2FpdCBwcmlzbWEuY291cnNlcy5maW5kTWFueSh7c2VsZWN0OntpZDogdHJ1ZSwgc2x1ZzogdHJ1ZX19KVxuICByZXR1cm4ge3BhdGhzOmNvdXJzZXMubWFwKGNvdXJzZT0+e1xuICAgIHJldHVybiB7cGFyYW1zOiB7aWQ6IGNvdXJzZS5pZC50b1N0cmluZygpLCBzbHVnOiBjb3Vyc2Uuc2x1Z319XG4gIH0pLCBmYWxsYmFjazogdHJ1ZX1cbn1cblxuXG5jb25zdCBCYW5uZXJDb250ZW50ID0gc3R5bGVkKCdkaXYnKSBgXG5kaXNwbGF5OiBncmlkOyBcbmdyaWQtdGVtcGxhdGUtY29sdW1uczogbWluLWNvbnRlbnQgYXV0bztcbmdyaWQtY29sdW1uLWdhcDogMTZweDtcbmdyaWQtcm93LWdhcDogMzJweDtcbmBcbiJdfQ== */\",\n  toString: _EMOTION_STRINGIFIED_CSS_ERROR__\n});","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/pages/courses/[slug]/[id]/index.ts"],"names":["h","useState","Link","prisma","Box","Seperator","TwoColumn","Sidebar","Tabs","StickyWrapper","colors","Loader","PageLoader","Info","Pill","Enroll","Text","SmallCohortCard","TwoColumnBanner","Modal","Primary","Destructive","LinkButton","WatchCourse","getTaggedPost","DISCOURSE_URL","useUserData","useUserCohorts","useCourseData","callApi","cohortPrettyDate","ErrorPage","courseDataQuery","Head","useRouter","AccentImg","TodoList","cohortName","sortByDateAndName","COPY","curriculumTab","cohortTab","activeCohorts","settings","enrollButton","updateCurriculum","props","href","id","WrappedCoursePage","notFound","CoursePage","data","user","userCohorts","course","undefined","course_cohorts","filter","c","completed","cohort_facilitators","find","f","facilitator","people_in_cohorts","p","people","sort","enrolled","length","upcomingCohorts","Date","start_date","live","isMaintainer","course_maintainers","maintainer","invited","invited_courses","children","property","content","name","key","description","card_image","split","Banners","draft","status","slug","gap","padding","style","backgroundColor","accentPeach","flatMap","cohort","Cohort","facilitating","cohort_max_size","slice","grey95","map","facilitators","display_name","username","courses","tabs","source","text","Cohorts","cohorts","Facilitators","link","bio","width","EnrollStatus","courseId","courseSlug","inviteOnly","invite_only","loggedIn","upcoming","type","as","pastCohorts","reduce","acc","push","router","past","gridAutoColumns","borderOnly","red","textDecoration","color","textSecondary","alignItems","alignContent","justifySelf","textAlign","query","MarkCourseLive","mutate","state","setState","onClick","e","preventDefault","res","display","closeText","onExit","withComponent","TODOBanner","expanded","setExpanded","BannerContent","height","src","persistKey","items","getStaticProps","ctx","parseInt","params","Number","isNaN","category_id","revalidate","getStaticPaths","findMany","select","paths","toString","fallback"],"mappings":"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","sourcesContent":["import h from 'react-hyperscript'\nimport { useState, ReactElement } from 'react'\nimport Link from 'next/link'\nimport { InferGetStaticPropsType } from 'next'\nimport styled from '@emotion/styled'\nimport prisma from \"lib/prisma\";\nimport { Box, Seperator, TwoColumn, Sidebar } from 'components/Layout'\nimport {Tabs, StickyWrapper} from 'components/Tabs'\nimport { colors } from 'components/Tokens'\nimport Loader, { PageLoader } from 'components/Loader'\nimport { Info } from 'components/Form'\nimport {Pill} from 'components/Pill'\nimport Enroll from 'components/Course/Enroll'\nimport Text from 'components/Text'\nimport {SmallCohortCard} from 'components/Cards/SmallCohortCard'\nimport {TwoColumnBanner} from 'components/Banner'\nimport {Modal} from 'components/Modal'\nimport { Primary, Destructive, LinkButton} from 'components/Button'\nimport {WatchCourse} from 'components/Course/WatchCourse'\n\nimport { getTaggedPost } from 'src/discourse'\nimport {DISCOURSE_URL} from 'src/constants'\nimport { useUserData, useUserCohorts, useCourseData, Course } from 'src/data'\nimport { UpdateCourseMsg, UpdateCourseResponse} from 'pages/api/courses/[id]'\nimport { callApi } from 'src/apiHelpers'\nimport { cohortPrettyDate } from 'components/Cards/CohortCard'\nimport ErrorPage from 'pages/404'\nimport { courseDataQuery } from 'pages/api/courses/[id]'\nimport Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport { AccentImg } from 'components/Images'\nimport { TodoList } from 'components/TodoList'\nimport { cohortName, sortByDateAndName } from 'src/utils'\n\nconst COPY = {\n  curriculumTab: \"Curriculum\",\n  cohortTab: \"All Cohorts\",\n  activeCohorts: \"Your Current Cohorts\",\n  settings: \"You can edit details, create new cohorts, and more.\",\n  enrollButton: \"Enroll in a cohort\",\n  updateCurriculum: (props: {id: string}) => h(Info, [\n    `ðŸ’¡ You can make changes to the curriculum by editing `,\n    h('a', {href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`}, `this topic`),\n    ` in the forum`\n  ])\n}\n\ntype Props = InferGetStaticPropsType<typeof getStaticProps>\n\nconst WrappedCoursePage = (props: Props)=>props.notFound ? h(ErrorPage) : h(CoursePage, props)\nexport default WrappedCoursePage\n\nconst CoursePage = (props:Extract<Props, {notFound: false}>) => {\n  let {data: user} = useUserData()\n  let {data:userCohorts} = useUserCohorts()\n  let {data: course} = useCourseData(props.id, props.course || undefined)\n\n  if(!course) return h(PageLoader)\n\n  let activeCohorts = course.course_cohorts\n    .filter(c => {\n      if(!user) return false\n      return c.completed === null && (!!c.cohort_facilitators.find(f=>user&&f.facilitator===user.id)\n        || c.people_in_cohorts\n          .find(p => p.people.id === (user ? user.id : undefined)))\n    })\n    .sort(sortByDateAndName)\n\n  let enrolled = activeCohorts.filter(c=>!c.cohort_facilitators.find(f=>user&&f.facilitator===user.id)).length > 0\n  let upcomingCohorts = course.course_cohorts.filter(c=> (new Date(c.start_date) > new Date()) && c.live).sort(sortByDateAndName)\n\n  let isMaintainer = !!(course?.course_maintainers.find(maintainer => user && maintainer.maintainer === user.id))\n  let invited = !!userCohorts?.invited_courses.find(course=>course.id === props.course.id )\n\n  //Setting up the layout for the course page\n  return h('div', [\n    h(Head, {children: [\n      h('meta', {property:\"og:title\", content:course.name, key:\"og:title\"}),\n      h('meta', {property: \"og:description\", content: course.description, key: \"og:description\"}),\n      h('meta', {property: \"og:image\", content: course.card_image.split(',')[0], key: \"og:image\"}),\n      h('meta', {property: \"twitter:card\", content: \"summary\", key:\"twitter:card\"})\n    ]}),\n    h(Banners, {draft: course.status === 'draft', id: props.id, isMaintainer, slug: course.slug}),\n    h(TwoColumn, [\n      h(Box, {gap: 32}, [\n        h(Box, {gap: 16}, [\n          h('h1', course?.name),\n        ]),\n        h('p.big', course?.description || ''),\n\n        upcomingCohorts.length > 0 && (activeCohorts.length === 0)\n          ? h(Box, {padding: 32, style: {backgroundColor: colors.accentPeach}},[\n            ...upcomingCohorts.flatMap(cohort=>{\n              return [\n                h(Cohort, {\n                  cohort,\n                  enrolled: false, facilitating: false,\n                  invited,\n                  slug: course?.slug || '',\n                  cohort_max_size: course?.cohort_max_size || 0\n                }),\n                h(Seperator)]\n            }).slice(0, -1)\n          ])\n          : activeCohorts.length === 0 ? null : h(Box, {padding: 32, style: {backgroundColor: colors.grey95}}, [\n            h('h3', COPY.activeCohorts),\n            ...activeCohorts.map(cohort=> h(SmallCohortCard, {\n              ...cohort,\n              facilitators: cohort.cohort_facilitators.map(f=>f.people.display_name || f.people.username),\n              courses: {\n                name: course?.name || '',\n                slug: course?.slug || '',\n              },\n              facilitating: !!cohort.cohort_facilitators.find(f=>user&&f.facilitator===user.id),\n              enrolled: !cohort.cohort_facilitators.find(f=>user&&f.facilitator===user.id)\n            }))\n          ]),\n      ]),\n      h(Tabs, {tabs: {\n        [COPY.curriculumTab]:  h(Box, [\n          isMaintainer ? h(COPY.updateCurriculum, {id: props.content.id}) : null,\n          h(Text, {source: props.content.text})\n        ]),\n        [COPY.cohortTab]: h(Cohorts,{cohorts: course.course_cohorts, slug: course.slug, user: user ? user.id : '', invited, cohort_max_size: course?.cohort_max_size || 0}),\n        Facilitators: h(Box, {gap:32}, course.course_maintainers.map(maintainer=>{\n          return h(Box, {}, [\n            h('h3', maintainer.people.display_name || maintainer.people.username),\n            !maintainer.people.link ? null : h('a', {href: maintainer.people.link}, h('b', maintainer.people.link)),\n            !maintainer.people.bio ? null : h(Box, {width: 640}, h(Text, {source: maintainer.people.bio}))\n          ])\n        }))\n      }}),\n      h(Sidebar, [\n        h(StickyWrapper, [\n          h(Enroll, {course}, [\n            h(Box, [\n              h(EnrollStatus, {\n                courseId: course.id,\n                courseSlug: course.slug,\n                draft:course.status==='draft',\n                maintainer: isMaintainer,\n                inviteOnly:course.invite_only,\n                invited,\n                loggedIn: !!user,\n                enrolled,\n                upcoming:upcomingCohorts.length !== 0,\n              }),\n              h(Seperator),\n              !isMaintainer ? h(WatchCourse, {id: course.id}) : h(Box, [\n                h(Box, {gap:8}, [\n                  h('h3', `You maintain this ${course.type}`),\n                  h('p.textSecondary', COPY.settings),\n                ]),\n                h(Link, {href:'/courses/[slug]/[id]/settings', as:`/courses/${course.slug}/${course.id}/settings`}, h(Destructive, 'Settings'))\n              ])\n            ])\n          ])]),\n      ])\n    ])\n  ])\n}\n\nfunction EnrollStatus (props: {\n  draft:boolean,\n  maintainer:boolean,\n  inviteOnly:boolean,\n  invited:boolean,\n  loggedIn:boolean,\n  enrolled:boolean;\n  upcoming:boolean;\n  courseId:number;\n  courseSlug:string\n}) {\n  if (props.draft) {\n    if (props.maintainer) return h('span.accentRed', \"Learners can't enroll in this course until you publish it!\")\n    return h('span.accentRed', \"This course is still a draft. You can enroll once the creator publishes it!\")\n  }\n\n  if (props.enrolled){\n    if (props.upcoming) return h('span.accentSuccess', \"You're enrolled in an upcoming cohort. Feel free to enroll in another one though!\")\n    return  h('span.accentSuccess', \"You're enrolled in an upcoming cohort\")\n  }\n\n  if (!props.upcoming) {\n    if(props.maintainer) return h('span.accentRed', [\n      \"Looks like there aren't any cohorts planned. Create one \", h(Link, {href: \"/courses/[slug]/[id]/settings\", as: `/courses/${props.courseSlug}/${props.courseId}/settings`}, h('a', 'here')), '.'\n    ])\n    return h('span.accentRed', \"Looks like there aren't any cohorts planned :(\")\n  }\n\n  if (props.inviteOnly) {\n    if (props.maintainer) return h('span.accentRed', [\n      \"Learners need to be invited to enroll. Invite someone \", h(Link, {href: `/courses/${props.courseSlug}/${props.courseId}/settings`}, h('a', 'here')), '.'])\n    if(props.invited) return h('span.accentSuccess', \"You're invited!\")\n    if(props.loggedIn) return h('div', {}, h('span.accentRed', \"This course is invite only. Reach out to the facilitators if you're interested!\"))\n    return h('div', {}, h('span.accentRed', \"This course is invite only. If you've been invited, please log in.\"))\n  }\n  return null\n}\n\n\nconst Cohorts = (props:{cohorts: Course['course_cohorts'], user: string, slug: string, cohort_max_size: number, invited:boolean}) => {\n  let [pastCohorts, upcomingCohorts] = props.cohorts\n  .filter(c=>{\n    if(c.live) return true\n    return !!c.cohort_facilitators.find(f=>f.facilitator===props.user)\n  }).sort(sortByDateAndName)\n    .reduce((acc, cohort)=>{\n      let enrolled = !!cohort.people_in_cohorts.find(p => p.people.id === props.user)\n      let facilitating = !!cohort.cohort_facilitators.find(f=>f.facilitator === props.user)\n      acc[new Date(cohort.start_date)< new Date() ? 0 : 1].push(\n        h(Cohort, {\n          cohort,\n          enrolled, facilitating,\n          slug: props.slug,\n          cohort_max_size: props.cohort_max_size,\n          invited: props.invited\n        })\n      )\n      return acc\n    },[[],[]] as Array<Array<ReactElement>>)\n\n  return h(Box, {gap:32}, [\n    upcomingCohorts.length === 0 ? null : h('h2', \"Upcoming Cohorts\"),\n    ...upcomingCohorts,\n    upcomingCohorts.length === 0 || pastCohorts.length === 0 ? null : h(Seperator),\n    pastCohorts.length === 0 ? null : h('h2', 'Ongoing and Past Cohorts'),\n    ...pastCohorts\n    ])\n}\n\nexport const Cohort = (props: {\n  cohort: Course['course_cohorts'][0],\n  facilitating?: boolean,\n  enrolled?: boolean,\n  slug:string,\n  cohort_max_size: number,\n  invited: boolean\n}) => {\n  let id= props.cohort.id\n  let router = useRouter()\n  let past = new Date(props.cohort.start_date) < new Date()\n\n  return h(Box, {h: true, style:{gridAutoColumns:'auto'}}, [\n    h(Box, {gap: 4}, [\n      !props.enrolled && !props.facilitating ? null : h('div', [\n        props.enrolled ? h(Pill, 'enrolled') : null,\n        ' ',\n        props.facilitating ? h(Pill, {borderOnly: true}, 'facilitating') : null,\n        ' ',\n        !props.cohort.live ? h(Pill, {borderOnly: true, red: true}, 'draft') : null,\n      ]),\n      h('h3', {}, h(Link, {\n        href:'/courses/[slug]/[id]/cohorts/[cohortId]',\n        as:  `/courses/${props.slug}/${props.cohort.course}/cohorts/${id}`\n      }, h('a', {style: {textDecoration: 'none'}}, cohortName(props.cohort.name)))),\n      h(Box, {style: {color: colors.textSecondary}, gap: 4}, [\n        h('strong', cohortPrettyDate(props.cohort.start_date, props.cohort.completed)),\n        h('div', [\n          `Facilitated by `,\n          ...props.cohort.cohort_facilitators.flatMap(f=>{\n            return [h(Link, {href:`/people/${f.people.username}`}, h('a', f.people.display_name || f.people.username)), ', ']\n          }).slice(0, -1)\n        ])\n      ]),\n      props.cohort_max_size === 0 || past ? null : props.cohort_max_size > props.cohort.people_in_cohorts.length\n        ? h('span.accentSuccess', `${props.cohort_max_size - props.cohort.people_in_cohorts.length} ${props.cohort_max_size - props.cohort.people_in_cohorts.length === 1 ? 'spot' : 'spots'} left!`)\n        : h('span.accentRed', `Sorry! This cohort is full.`)\n    ]),\n    past || props.enrolled || props.facilitating ? null : h(Box, {gap:8, style: {alignItems: 'center', alignContent: 'center', justifySelf: 'right', textAlign: 'right'}}, [\n      h(Link, {\n        href: `/courses/${router.query.slug}/${props.cohort.course}/cohorts/${props.cohort.id}`\n      }, h('a', {}, h(Primary, 'See schedule')))\n    ])\n  ])\n}\n//feature to add a new cohort to a course\nfunction MarkCourseLive(props: {id:number, slug: string}) {\n  let {data:course, mutate} = useCourseData(props.id)\n  let [state, setState] = useState<'normal'|'confirm'|'loading'|'complete'>('normal')\n\n  const onClick = async (e: React.MouseEvent)  =>{\n    e.preventDefault()\n    if(!course) return\n    setState('loading')\n    let res = await callApi<UpdateCourseMsg, UpdateCourseResponse>(`/api/courses/${props.id}`, {status: 'live'})\n    if(res.status===200){\n      setState('normal')\n      mutate({...course, status: 'live'})\n    }\n  }\n\n  if(state === 'confirm' || state === 'loading') return h(\n    Modal,\n    { display: true, closeText: \"nevermind\", onExit: () => setState(\"normal\") },\n    [\n      h(Box, { gap: 32 }, [\n        h(\"h2\", { style: { textAlign: \"center\" } }, \"Are you sure?\"),\n        h(Box, { gap: 16 }, [\n          \"Before going live please check that you've done these things\",\n          h(Box.withComponent(\"ul\"), { gap: 16 }, [\n            h(\"li\", [\n              \"Edit important details in \",\n              h(\n                \"a\",\n                {\n                  href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Details`,\n                },\n                \"course settings\"\n              ),\n              \".\",\n            ]),\n            h(\"li\", [\n              \"Written a \",\n              h(\n                \"a\",\n                {\n                  href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`,\n                },\n                \"curriculum\"\n              ),\n              \".\",\n            ]),\n          ]),\n          h(\n            Primary,\n            { style: { justifySelf: \"center\" }, onClick },\n            state === \"loading\" ? h(Loader) : \"Go Live!\"\n          ),\n        ]),\n      ]),\n    ]\n  );\n\n  return h(Primary, {onClick: async e => {\n    e.preventDefault()\n    setState('confirm')\n  }}, \"Publish!\")\n}\n\n// Feature to edit course detail (length, prereqs, one line description)\n\n\n\n// Define Banners\nconst Banners = (props:{draft: boolean, id: number, slug:string, isMaintainer: boolean}) => {\n  if(props.draft && props.isMaintainer) {\n    if(props.isMaintainer){\n      return h(TODOBanner, props)\n    }\n    return h(TwoColumnBanner, {red: true}, h(Box, {gap:16},[\n      h(Box, {gap:16}, [\n        h('h3', \"This course isn't live yet!\"),\n        h('p',[`The maintainer is still working on getting this course in shape. Let them know\nif you have any feedback!`])\n      ])\n    ]))\n  }\n  return null\n}\n\n// Draft Course ToDo Banner\nconst TODOBanner = (props:{\n  id:number\n  slug:string\n}) => {\n  let [expanded, setExpanded] = useState(false)\n\n  return h(TwoColumnBanner, {red: true}, [\n    h(BannerContent, [\n      h(AccentImg, {height:32, width:36, src:\"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Seedling.png\"}),\n      h(Box, {gap:8}, [\n        h('h4', \"This course is still a draft\"),\n        h('p', 'Itâ€™s hidden from public view. People canâ€™t see this page until you publish it.')\n      ]),\n      ... !expanded ? [] : [\n        h(AccentImg, {height:32, width:36, src:\"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Bud.png\"}),\n        h(Box, {gap:16}, [\n          h('h4', \"Before you publish this course make sure that you ...  \"),\n          h(TodoList, {\n            persistKey: \"course-creation-todo\",\n            items: [\n              h(\"span\", [\n                \"Edit important details, like description and price, in \", h('a', {href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Details`}, \"course settings\"), \".\"\n              ]),\n              h(\"span\", [\n                \"Write a comprehensive curriculum for your course, by editing the \", h('a', {href: `${DISCOURSE_URL}/session/sso?return_path=/t/${props.id}`}, \"Curriculum topic\"), \" in the forum.\"\n              ]),\n              h(\"span\", [\n                \"Create or edit \", h('a', {href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Templates`}, \"templates\"), \" for reusable forum topics so you don't need to rewrite them for every cohort you run (or you can add these later).\"\n              ]),\n              h(\"span\", [\n                \"Create your first cohort, in \", h('a', {href: `https://app.krakenedu.com/courses/${props.slug}/${props.id}/settings?tab=Cohorts`}, \"course settings\"), \". It will also be a draft that you need to edit before publishing. We'll guide you through it!\"\n              ])\n            ]\n          })\n        ]),\n        h(AccentImg, {height:32, width:36, src:\"https://hyperlink-data.nyc3.cdn.digitaloceanspaces.com/icons/Flower.png\"}),\n        h(Box, {gap:16}, [\n          h('h4', \"Once you're ready, you can publish it here!\"),\n          h(MarkCourseLive, props)\n        ])\n      ]\n    ]),\n    h(LinkButton, {style:{justifySelf: 'right', textDecoration: 'none'}, onClick: ()=>setExpanded(!expanded)}, expanded ? \"hide checklist\" : \"show checklist\")\n  ])\n}\n\nexport const getStaticProps = async (ctx:any) => {\n  let id = parseInt(ctx.params?.id as string || '' )\n  if(Number.isNaN(id)) return {props: {notFound: true}} as const\n\n  let data = await courseDataQuery(id)\n  if(!data) return {props:{notFound: true}} as const\n  let content = await getTaggedPost(data.category_id, 'curriculum')\n\n  return {props: {notFound: false, content, id, course: data}, revalidate: 1} as const\n}\n\nexport const getStaticPaths = async () => {\n\n  let courses = await prisma.courses.findMany({select:{id: true, slug: true}})\n  return {paths:courses.map(course=>{\n    return {params: {id: course.id.toString(), slug: course.slug}}\n  }), fallback: true}\n}\n\n\nconst BannerContent = styled('div') `\ndisplay: grid; \ngrid-template-columns: min-content auto;\ngrid-column-gap: 16px;\ngrid-row-gap: 32px;\n`\n"]},"metadata":{},"sourceType":"module"}