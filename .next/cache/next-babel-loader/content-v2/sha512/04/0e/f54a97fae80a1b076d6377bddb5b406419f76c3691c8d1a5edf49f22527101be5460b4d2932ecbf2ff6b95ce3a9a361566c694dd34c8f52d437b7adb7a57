{"ast":null,"code":"import _toConsumableArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _objectWithoutProperties from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _defineProperty from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/ayooluwaalfonso/code/krakeneduapp/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport h from 'react-hyperscript';\nimport ErrorPage from 'pages/404';\nimport { dateFromDateAndTimeInputs, getStripe, prettyDate, formHelper } from 'src/utils';\nimport { Box, FormBox, Seperator, Sidebar, TwoColumn } from 'components/Layout';\nimport { colors } from 'components/Tokens';\nimport Text from 'components/Text';\nimport { Primary, Secondary, Destructive } from 'components/Button';\nimport { useEventData, useUserData } from 'src/data';\nimport { PageLoader } from 'components/Loader';\nimport { useEffect, useState } from 'react';\nimport { EventForm } from 'pages/events/create';\nimport { Input } from 'components/Form';\nimport { useApi } from 'src/apiHelpers';\nimport { useRouter } from 'next/router';\nimport { StickyWrapper } from 'components/Tabs';\nimport Link from 'next/link';\nimport { TwoColumnBanner } from 'components/Banner';\nimport Head from 'next/head';\n\nvar EventPage = function EventPage(props) {\n  return props.notFound ? h(ErrorPage) : h(EditableEvent, props);\n};\n\nexport var __N_SSG = true;\nexport default EventPage;\n\nvar EditableEvent = function EditableEvent(props) {\n  var _props$standalone_eve, _props$standalone_eve2;\n\n  var _useUserData = useUserData(),\n      user = _useUserData.data;\n\n  var _useEventData = useEventData(props.id),\n      event = _useEventData.data,\n      mutate = _useEventData.mutate;\n\n  var _useState = useState(false),\n      editting = _useState[0],\n      setEditting = _useState[1];\n\n  var start_date = new Date(props.start_date);\n  var end_date = new Date(props.end_date);\n\n  var _useState2 = useState({\n    name: props.name,\n    cost: ((_props$standalone_eve = props.standalone_events) === null || _props$standalone_eve === void 0 ? void 0 : _props$standalone_eve.cost) || 0,\n    max_attendees: ((_props$standalone_eve2 = props.standalone_events) === null || _props$standalone_eve2 === void 0 ? void 0 : _props$standalone_eve2.max_attendees) || 0,\n    description: props.description,\n    start_date: \"\".concat(start_date.getFullYear(), \"-\").concat(('0' + (start_date.getMonth() + 1)).slice(-2), \"-\").concat(('0' + start_date.getDate()).slice(-2)),\n    start_time: start_date.toLocaleTimeString([], {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      hour12: false\n    }),\n    end_time: end_date.toLocaleTimeString([], {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      hour12: false\n    }),\n    location: props.location\n  }),\n      edittedEvent = _useState2[0],\n      setEdittedEvent = _useState2[1];\n\n  useEffect(function () {\n    var _event$standalone_eve, _event$standalone_eve2;\n\n    if (!event) return;\n    var start_date = new Date(event.start_date);\n    var end_date = new Date(event.end_date);\n    setEdittedEvent({\n      name: event.name,\n      cost: ((_event$standalone_eve = event.standalone_events) === null || _event$standalone_eve === void 0 ? void 0 : _event$standalone_eve.cost) || 0,\n      max_attendees: ((_event$standalone_eve2 = event.standalone_events) === null || _event$standalone_eve2 === void 0 ? void 0 : _event$standalone_eve2.max_attendees) || 0,\n      description: event.description,\n      start_date: \"\".concat(start_date.getFullYear(), \"-\").concat(('0' + (start_date.getMonth() + 1)).slice(-2), \"-\").concat(('0' + start_date.getDate()).slice(-2)),\n      start_time: start_date.toLocaleTimeString([], {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n      }),\n      end_time: end_date.toLocaleTimeString([], {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        hour12: false\n      }),\n      location: event.location\n    });\n  }, [event]);\n\n  var _useApi = useApi([]),\n      _useApi2 = _slicedToArray(_useApi, 2),\n      status = _useApi2[0],\n      callUpdateEvent = _useApi2[1];\n\n  if (props === undefined || !event) return h(PageLoader);\n  if (!props.standalone_events) return h(ErrorPage);\n\n  var onSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var start_date, end_date, res, _res$result$data, events, standalone_events;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              start_date = dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.start_time).toISOString();\n              end_date = dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.end_time).toISOString();\n              _context.next = 5;\n              return callUpdateEvent('/api/events/' + props.id, {\n                data: _objectSpread(_objectSpread({}, edittedEvent), {}, {\n                  start_date: start_date,\n                  end_date: end_date\n                }),\n                type: 'standalone'\n              });\n\n            case 5:\n              res = _context.sent;\n\n              if (res.status === 200 && res.result.type === 'standalone') {\n                _res$result$data = res.result.data, events = _res$result$data.events, standalone_events = _objectWithoutProperties(_res$result$data, [\"events\"]);\n                mutate(_objectSpread(_objectSpread({}, events), {}, {\n                  standalone_events: standalone_events,\n                  cohort_events: []\n                }));\n                setEditting(false);\n              }\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  if (editting) return h(FormBox, {\n    onSubmit: onSubmit\n  }, [h('h1', \"Edit Event\"), h(EventForm, {\n    onChange: setEdittedEvent,\n    state: edittedEvent\n  }), h('div', {\n    style: {\n      backgroundColor: colors.appBackground,\n      position: 'sticky',\n      bottom: '0',\n      padding: '16px 0',\n      margin: '-16px 0',\n      width: '100%'\n    }\n  }, [h(Box, {\n    h: true,\n    style: {\n      justifyContent: 'right'\n    }\n  }, [h(Destructive, {\n    onClick: function onClick() {\n      return setEditting(false);\n    }\n  }, \"Cancel\"), h(Primary, {\n    type: 'submit',\n    status: status\n  }, \"Submit\")])])]);\n  return h(\"div\", [user && props.people.id === user.id ? h(Banner, {\n    start_date: props.start_date,\n    setEditting: setEditting\n  }) : null, h(Head, {\n    children: [h(\"title\", {\n      key: \"title\"\n    }, event.name), h(\"meta\", {\n      property: \"og:title\",\n      content: event.name,\n      key: \"og:title\"\n    }), h(\"meta\", {\n      property: \"og:description\",\n      content: event.description.slice(0, 140) + \"...\",\n      key: \"og:description\"\n    }), h(\"meta\", {\n      property: \"og:image\",\n      content: \"https://app.krakenedu.com/img/favicon.png\",\n      key: \"og:image\"\n    }), h(\"meta\", {\n      property: \"twitter:card\",\n      content: \"summary\",\n      key: \"twitter:card\"\n    })]\n  }), h(Event, _objectSpread(_objectSpread({\n    notFound: false\n  }, event), {}, {\n    facilitating: !!user && props.people.id === user.id,\n    rsvpd: !!event.people_in_events.find(function (p) {\n      return user && p.person === user.id;\n    }),\n    mutate: mutate\n  }))]);\n};\n\nvar Event = function Event(props) {\n  if (!props.standalone_events) return h(ErrorPage);\n  var emails = props.people_in_events.map(function (p) {\n    return p.people.email;\n  }).concat(props.no_account_rsvps.map(function (p) {\n    return p.email;\n  }));\n  return h(TwoColumn, [h(Box, {\n    gap: 32,\n    width: 640\n  }, [h('h1', props.name)]), h(Box, {\n    gap: 32\n  }, [h(Text, {\n    source: props.description\n  }), h(Seperator), h(Box, {}, [h('h2', \"Facilitated by \".concat(props.people.display_name || props.people.username)), h(Text, {\n    source: props.people.bio || ''\n  }), h(Box, {\n    h: true\n  }, [h('h4', [\"Attending \", h('span.textSecondary', props.standalone_events.max_attendees !== 0 ? \"(\".concat(props.people_in_events.length + props.no_account_rsvps.length, \"/\").concat(props.standalone_events.max_attendees, \")\") : \"(\".concat(props.people_in_events.length + props.no_account_rsvps.length, \")\"))]), !props.facilitating ? null : h('a', {\n    href: \"mailto:?bcc=\".concat(emails.join(','))\n  }, 'email everyone')])].concat(_toConsumableArray(props.people_in_events.map(function (person) {\n    return h(Box, {\n      h: true,\n      gap: 4\n    }, [h(Link, {\n      href: '/people/[id]',\n      as: \"/people/\".concat(person.people.username)\n    }, [h('a', {\n      className: 'notBlue'\n    }, person.people.display_name || person.people.username)]), person.people.pronouns ? h('span.textSecondary', {}, \" (\".concat(person.people.pronouns, \")\")) : null]);\n  })), _toConsumableArray(props.no_account_rsvps.map(function (person) {\n    return h(Box, {\n      h: true,\n      gap: 4\n    }, [person.name]);\n  }))))]), h(Sidebar, [h(StickyWrapper, [h(Box, [h(Details, _objectSpread(_objectSpread({}, props.standalone_events), {}, {\n    attendees: props.people_in_events.length + props.no_account_rsvps.length,\n    facilitating: props.facilitating,\n    id: props.id,\n    start_date: props.start_date,\n    end_date: props.end_date,\n    mutate: props.mutate,\n    rsvpd: props.rsvpd,\n    location: props.location\n  }))])])])]);\n};\n\nvar Banner = function Banner(props) {\n  var start_date = new Date(props.start_date);\n  if (start_date > new Date()) return h(TwoColumnBanner, {\n    red: true\n  }, [h('span', {\n    style: {\n      alignSelf: 'center'\n    }\n  }, \"You're facilitating this event\"), h(Secondary, {\n    onClick: function onClick() {\n      return props.setEditting(true);\n    }\n  }, \"Edit Event\")]);\n  return h(TwoColumnBanner, {\n    red: true\n  }, [h('span', {\n    style: {\n      alignSelf: 'center'\n    }\n  }, \"Congrats! You hosted this event on \".concat(prettyDate(props.start_date), \". You can edit the description to add any artifacts.\")), h(Secondary, {\n    onClick: function onClick() {\n      return props.setEditting(true);\n    }\n  }, \"Edit Event\")]);\n};\n\nvar Details = function Details(props) {\n  var start_date = new Date(props.start_date);\n  var end_date = new Date(props.end_date);\n  var start = start_date.toLocaleTimeString([], {\n    hour12: true,\n    minute: '2-digit',\n    hour: 'numeric'\n  });\n  var end = end_date.toLocaleTimeString([], {\n    hour12: true,\n    minute: '2-digit',\n    hour: 'numeric',\n    timeZoneName: \"short\"\n  });\n  return h(Box, {\n    style: {\n      alignSelf: 'center'\n    }\n  }, [h('div', {\n    style: {\n      alignSelf: 'center'\n    }\n  }, [h('h1', props.cost !== 0 ? \"$\".concat(props.cost) : \"FREE\"), h('h3', \"\".concat(start_date.toLocaleDateString([], {\n    weekday: 'short'\n  }), \" \").concat(prettyDate(props.start_date))), h('h4.textSecondary', \"@ \".concat(start, \" - \").concat(end))]), h(JoinButton, props), !props.rsvpd && props.max_attendees ? h('b', \"\".concat(props.attendees, \"/\").concat(props.max_attendees, \" spots filled\")) : null]);\n};\n\nvar JoinButton = function JoinButton(props) {\n  var _useApi3 = useApi([]),\n      _useApi4 = _slicedToArray(_useApi3, 2),\n      status = _useApi4[0],\n      callRSVP = _useApi4[1];\n\n  var _useUserData2 = useUserData(),\n      user = _useUserData2.data;\n\n  var router = useRouter();\n\n  var _useState3 = useState({\n    email: '',\n    name: ''\n  }),\n      formState = _useState3[0],\n      setFormState = _useState3[1];\n\n  var form = formHelper(formState, setFormState);\n  if (new Date(props.end_date) < new Date()) return h('p.big', \"This event has concluded\");\n  if (props.max_attendees && props.attendees >= props.max_attendees) return h('p.big', \"Sorry, this event is full!\");\n  if (props.rsvpd || props.facilitating) return h('a', {\n    href: props.location\n  }, h(Primary, \"Join Event\"));\n\n  if (props.cost === 0 && !user) {\n    if (status === 'success') return h('p.accentSuccess', \"You're RSVP'd! Check your email for an event invite, and any updates\");\n    return h(FormBox, {\n      onSubmit: function () {\n        var _onSubmit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n          var result;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  e.preventDefault();\n                  _context2.next = 3;\n                  return callRSVP(\"/api/events/\".concat(props.id, \"/rsvp\"), {\n                    email: form.email.value,\n                    name: form.name.value\n                  });\n\n                case 3:\n                  result = _context2.sent;\n                  if (result.status === 200) props.mutate(function (data) {\n                    if (!data || !user) return data;\n                    return _objectSpread(_objectSpread({}, data), {}, {\n                      no_accounts_rsvps: [].concat(_toConsumableArray(data.no_account_rsvps), [{\n                        name: form.name.value,\n                        email: ''\n                      }])\n                    });\n                  });\n\n                case 5:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        function onSubmit(_x2) {\n          return _onSubmit.apply(this, arguments);\n        }\n\n        return onSubmit;\n      }()\n    }, [h(Input, _objectSpread({\n      placeholder: \"Your email\",\n      type: 'email'\n    }, form.email)), h(Input, _objectSpread({\n      placeholder: \"Your name\"\n    }, form.name)), h(Box, {\n      gap: 4,\n      style: {\n        justifySelf: 'right',\n        textAlign: 'right'\n      }\n    }, [h(Primary, {\n      status: status,\n      type: 'submit'\n    }, \"RSVP\"), h(Link, {\n      href: \"/login?redirect=\".concat(encodeURIComponent(router.asPath))\n    }, h('a', 'or sign in'))])]);\n  }\n\n  return h(Primary, {\n    onClick: function () {\n      var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var result, stripe;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(user === false)) {\n                  _context3.next = 4;\n                  break;\n                }\n\n                router.push('/login?redirect=' + encodeURIComponent(router.asPath));\n                _context3.next = 16;\n                break;\n\n              case 4:\n                _context3.next = 6;\n                return callRSVP(\"/api/events/\".concat(props.id, \"/rsvp\"));\n\n              case 6:\n                result = _context3.sent;\n\n                if (!(result.status === 200)) {\n                  _context3.next = 16;\n                  break;\n                }\n\n                if (!result.result.enrolled) {\n                  _context3.next = 12;\n                  break;\n                }\n\n                props.mutate(function (data) {\n                  if (!data || !user) return data;\n                  return _objectSpread(_objectSpread({}, data), {}, {\n                    people_in_events: [{\n                      person: user.id,\n                      event: props.id,\n                      people: {\n                        username: user.username,\n                        display_name: user.display_name || '',\n                        pronouns: '',\n                        email: ''\n                      }\n                    }]\n                  });\n                });\n                _context3.next = 16;\n                break;\n\n              case 12:\n                _context3.next = 14;\n                return getStripe();\n\n              case 14:\n                stripe = _context3.sent;\n                stripe === null || stripe === void 0 ? void 0 : stripe.redirectToCheckout({\n                  sessionId: result.result.sessionId\n                });\n\n              case 16:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function onClick() {\n        return _onClick.apply(this, arguments);\n      }\n\n      return onClick;\n    }(),\n    status: status\n  }, \"RSVP\");\n};","map":{"version":3,"sources":["/Users/ayooluwaalfonso/code/krakeneduapp/pages/events/[id].ts"],"names":["h","ErrorPage","dateFromDateAndTimeInputs","getStripe","prettyDate","formHelper","Box","FormBox","Seperator","Sidebar","TwoColumn","colors","Text","Primary","Secondary","Destructive","useEventData","useUserData","PageLoader","useEffect","useState","EventForm","Input","useApi","useRouter","StickyWrapper","Link","TwoColumnBanner","Head","EventPage","props","notFound","EditableEvent","user","data","id","event","mutate","editting","setEditting","start_date","Date","end_date","name","cost","standalone_events","max_attendees","description","getFullYear","getMonth","slice","getDate","start_time","toLocaleTimeString","hour","minute","hour12","end_time","location","edittedEvent","setEdittedEvent","status","callUpdateEvent","undefined","onSubmit","e","preventDefault","toISOString","type","res","result","events","cohort_events","onChange","state","style","backgroundColor","appBackground","position","bottom","padding","margin","width","justifyContent","onClick","people","Banner","children","key","property","content","Event","facilitating","rsvpd","people_in_events","find","p","person","emails","map","email","concat","no_account_rsvps","gap","source","display_name","username","bio","length","href","join","as","className","pronouns","Details","attendees","red","alignSelf","start","end","timeZoneName","toLocaleDateString","weekday","JoinButton","callRSVP","router","formState","setFormState","form","value","no_accounts_rsvps","placeholder","justifySelf","textAlign","encodeURIComponent","asPath","push","enrolled","stripe","redirectToCheckout","sessionId"],"mappings":"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","sourcesContent":["import h from 'react-hyperscript'\nimport { eventDataQuery, UpdateEventMsg, UpdateEventResult } from \"pages/api/events/[id]\"\nimport ErrorPage from 'pages/404'\nimport { InferGetStaticPropsType } from \"next\"\nimport { dateFromDateAndTimeInputs, getStripe, prettyDate, formHelper } from 'src/utils'\nimport { Box, FormBox, Seperator, Sidebar, TwoColumn } from 'components/Layout'\nimport {colors} from 'components/Tokens'\nimport Text from 'components/Text'\nimport { Primary, Secondary, Destructive } from 'components/Button'\nimport { useEventData, useUserData } from 'src/data'\nimport { PageLoader } from 'components/Loader'\nimport { useEffect, useState } from 'react'\nimport { EventForm } from 'pages/events/create'\nimport { Input } from 'components/Form'\nimport { useApi } from 'src/apiHelpers'\nimport { EventRSVPResult, EventRSVPMessage } from 'pages/api/events/[id]/rsvp'\nimport { useRouter } from 'next/router'\nimport { StickyWrapper } from 'components/Tabs'\nimport Link from 'next/link'\nimport { TwoColumnBanner } from 'components/Banner'\nimport Head from 'next/head'\n\ntype Props = InferGetStaticPropsType<typeof getStaticProps>\nconst EventPage = (props: Props)=> props.notFound ? h(ErrorPage) : h(EditableEvent, props)\nexport default EventPage\n\nconst EditableEvent = (props: Extract<Props, {notFound: false}>) => {\n  let {data: user} = useUserData()\n  let {data: event, mutate} = useEventData(props.id)\n  let [editting, setEditting] = useState(false)\n\n  let start_date = new Date(props.start_date)\n  let end_date = new Date(props.end_date)\n\n  let [edittedEvent, setEdittedEvent] =  useState({\n    name: props.name,\n    cost: props.standalone_events?.cost || 0,\n    max_attendees: props.standalone_events?.max_attendees || 0,\n    description: props.description,\n    start_date: `${start_date.getFullYear()}-${('0'+(start_date.getMonth()+1)).slice(-2)}-${('0'+start_date.getDate()).slice(-2)}`,\n    start_time: start_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n    end_time: end_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n    location: props.location,\n  })\n  useEffect(()=>{\n    if(!event) return\n    let start_date = new Date(event.start_date)\n    let end_date = new Date(event.end_date)\n    setEdittedEvent({\n      name: event.name,\n      cost: event.standalone_events?.cost || 0,\n      max_attendees: event.standalone_events?.max_attendees || 0,\n      description: event.description,\n      start_date: `${start_date.getFullYear()}-${('0'+(start_date.getMonth()+1)).slice(-2)}-${('0'+start_date.getDate()).slice(-2)}`,\n      start_time: start_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n      end_time: end_date.toLocaleTimeString([], {hour:\"2-digit\", minute: \"2-digit\", hour12: false}),\n      location: event.location,\n  })\n  }, [event])\n  let [status, callUpdateEvent] = useApi<UpdateEventMsg, UpdateEventResult>([])\n\n  if(props === undefined|| !event) return h(PageLoader)\n  if(!props.standalone_events) return h(ErrorPage)\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    let start_date = dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.start_time).toISOString()\n    let end_date =dateFromDateAndTimeInputs(edittedEvent.start_date, edittedEvent.end_time).toISOString()\n\n    let res = await callUpdateEvent('/api/events/'+props.id, {data:{...edittedEvent, start_date, end_date}, type: 'standalone', })\n    if(res.status===200 && res.result.type === 'standalone') {\n      let {events, ...standalone_events} = res.result.data\n      mutate({\n        ...events,\n        standalone_events,\n        cohort_events: [],\n      })\n      setEditting(false)\n    }\n  }\n\n  if(editting) return h(FormBox, {onSubmit}, [\n    h('h1', \"Edit Event\"),\n    h(EventForm, {onChange: setEdittedEvent, state:edittedEvent}),\n    h('div', {style:{\n      backgroundColor: colors.appBackground,\n      position: 'sticky',\n      bottom: '0',\n      padding: '16px 0',\n      margin: '-16px 0',\n      width: '100%'\n    }},[\n      h(Box, {h:true, style:{justifyContent: 'right'}}, [\n        h(Destructive, {onClick: ()=>setEditting(false)}, \"Cancel\"),\n        h(Primary, {type: 'submit' ,status}, \"Submit\")\n      ])\n    ])\n  ])\n  return h(\"div\", [\n    user && props.people.id === user.id\n      ? h(Banner, { start_date: props.start_date, setEditting })\n      : null,\n    h(Head, {\n      children: [\n        h(\"title\", { key: \"title\" }, event.name),\n        h(\"meta\", {\n          property: \"og:title\",\n          content: event.name,\n          key: \"og:title\",\n        }),\n        h(\"meta\", {\n          property: \"og:description\",\n          content: event.description.slice(0, 140) + \"...\",\n          key: \"og:description\",\n        }),\n        h(\"meta\", {\n          property: \"og:image\",\n          content: \"https://app.krakenedu.com/img/favicon.png\",\n          key: \"og:image\",\n        }),\n        h(\"meta\", {\n          property: \"twitter:card\",\n          content: \"summary\",\n          key: \"twitter:card\",\n        }),\n      ],\n    }),\n    h(Event, {\n      notFound: false as false,\n      ...event,\n      facilitating: !!user && props.people.id === user.id,\n      rsvpd: !!event.people_in_events.find((p) => user && p.person === user.id),\n      mutate,\n    }),\n  ]);\n}\n\n\nconst Event = (props: Extract<Props, {notFound: false}> & {facilitating: boolean, rsvpd: boolean, mutate: ReturnType<typeof useEventData>[\"mutate\"]}) => {\n  if(!props.standalone_events) return h(ErrorPage)\n\n  let emails = props.people_in_events\n    .map(p=>p.people.email)\n    .concat(props.no_account_rsvps.map(p=>p.email))\n\n  return h(TwoColumn, [\n    h(Box, {gap:32, width: 640}, [\n      h('h1', props.name),\n    ]),\n    h(Box, {gap:32}, [\n      h(Text, {source: props.description}),\n      h(Seperator),\n      h(Box, {}, [\n        h('h2', `Facilitated by ${props.people.display_name || props.people.username}`),\n        h(Text, {source: props.people.bio || ''}),\n\n        h(Box, {h:true}, [\n          h('h4', [`Attending `, h('span.textSecondary', props.standalone_events.max_attendees !== 0 ?\n            `(${props.people_in_events.length + props.no_account_rsvps.length}/${props.standalone_events.max_attendees})` :\n            `(${props.people_in_events.length + props.no_account_rsvps.length})`)]),\n          !props.facilitating ? null : h('a', {\n            href:`mailto:?bcc=${emails.join(',')}`\n          }, 'email everyone')\n        ]),\n        ...props.people_in_events.map(person=>h(Box, {h:true, gap:4}, [\n          h(Link, {\n            href: '/people/[id]',\n            as: `/people/${person.people.username}`\n          }, [\n            h('a', {className: 'notBlue'}, person.people.display_name || person.people.username),\n          ]),\n          person.people.pronouns ? h('span.textSecondary', {}, ` (${person.people.pronouns})`) : null\n        ])),\n        ...props.no_account_rsvps.map(person=>h(Box, {h:true, gap:4}, [\n          person.name\n        ]))\n      ]),\n    ]),\n\n    h(Sidebar, [\n      h(StickyWrapper, [\n        h(Box, [\n          h(Details, {\n            ...props.standalone_events,\n            attendees: props.people_in_events.length + props.no_account_rsvps.length,\n            facilitating: props.facilitating,\n            id: props.id,\n            start_date: props.start_date,\n            end_date: props.end_date,\n            mutate: props.mutate,\n            rsvpd: props.rsvpd,\n            location: props.location\n          }),\n        ])\n      ])\n    ])\n  ])\n}\n\nconst Banner = (props:{start_date: string, setEditting: (b:boolean)=>void})=>{\n  let start_date = new Date(props.start_date)\n  if(start_date > new Date()) return h(TwoColumnBanner, {red: true}, [\n    h('span', {style:{alignSelf: 'center'}}, \"You're facilitating this event\"),\n    h(Secondary, {onClick: ()=>props.setEditting(true)}, \"Edit Event\")\n  ])\n\n  return h(TwoColumnBanner, {red: true}, [\n    h('span', {style:{alignSelf: 'center'}}, `Congrats! You hosted this event on ${prettyDate(props.start_date)}. You can edit the description to add any artifacts.`),\n    h(Secondary, {onClick: ()=>props.setEditting(true)}, \"Edit Event\")\n  ])\n}\n\ntype DetailsProps = {\n  start_date: string,\n  end_date: string,\n  attendees: number,\n  cost:number,\n  mutate: ReturnType<typeof useEventData>['mutate'],\n  max_attendees:number|null,\n  id: number,\n  rsvpd: boolean,\n  location: string,\n  facilitating: boolean,\n}\nconst Details = (props:DetailsProps)=>{\n  let start_date = new Date(props.start_date)\n  let end_date = new Date(props.end_date)\n\n  let start = start_date.toLocaleTimeString([], {hour12: true, minute: '2-digit', hour:'numeric'})\n  let end = end_date.toLocaleTimeString([], {hour12: true, minute: '2-digit', hour:'numeric', timeZoneName: \"short\"})\n  return h(Box,{style:{alignSelf: 'center'}}, [\n    h('div', {style:{alignSelf:'center'}}, [\n      h('h1', props.cost !== 0 ? `$${props.cost}` : \"FREE\"),\n      h('h3',  `${start_date.toLocaleDateString([], {weekday: 'short'})} ${prettyDate(props.start_date)}`),\n      h('h4.textSecondary', `@ ${start} - ${end}`),\n    ]),\n    h(JoinButton, props),\n    !(props.rsvpd) && props.max_attendees ? h('b', `${props.attendees}/${props.max_attendees} spots filled`) : null,\n  ])\n}\n\nconst JoinButton = (props:DetailsProps)=>{\n  let [status, callRSVP] = useApi<EventRSVPMessage, EventRSVPResult>([])\n  let {data: user} = useUserData()\n  let router=useRouter()\n\n  let [formState, setFormState] = useState({email: '', name: ''})\n  let form = formHelper(formState, setFormState)\n\n  if(new Date(props.end_date) < new Date()) return h('p.big', \"This event has concluded\")\n  if(props.max_attendees && props.attendees >= props.max_attendees) return h('p.big', \"Sorry, this event is full!\")\n\n  if(props.rsvpd || props.facilitating) return h('a', {href: props.location}, h(Primary, \"Join Event\"))\n\n  if(props.cost === 0 && !user) {\n    if(status === 'success') return h('p.accentSuccess', \"You're RSVP'd! Check your email for an event invite, and any updates\")\n    return h(FormBox, {onSubmit: async (e) => {\n        e.preventDefault()\n        let result = await callRSVP(`/api/events/${props.id}/rsvp`, {\n          email: form.email.value,\n          name: form.name.value\n        })\n        if(result.status === 200) props.mutate((data)=>{\n          if(!data || !user) return data\n          return {\n            ...data,\n            no_accounts_rsvps: [...data.no_account_rsvps, {name: form.name.value, email:''}]\n          }\n        })\n      }}, [\n        h(Input, {placeholder: \"Your email\", type: 'email', ...form.email}),\n        h(Input, {placeholder: \"Your name\", ...form.name}),\n        h(Box, {gap: 4, style:{justifySelf: 'right', textAlign: 'right'}}, [\n        h(Primary, {\n          status,\n          type: 'submit',\n        }, \"RSVP\"),\n          h(Link, {href: `/login?redirect=${encodeURIComponent(router.asPath)}`}, h('a', 'or sign in'))\n        ])\n      ])\n  }\n\n  return h(Primary, {\n      onClick: async ()=> {\n        if(user === false) router.push('/login?redirect=' + encodeURIComponent(router.asPath))\n        else {\n          let result = await callRSVP(`/api/events/${props.id}/rsvp`)\n          if(result.status===200) {\n            if(result.result.enrolled) props.mutate((data)=>{\n              if(!data || !user) return data\n              return {...data, people_in_events:[{person: user.id, event: props.id, people:{username: user.username, display_name: user.display_name || '', pronouns: '', email:''}}]}\n\n            })\n            else  {\n              let stripe = await getStripe()\n              stripe?.redirectToCheckout({sessionId: result.result.sessionId})\n            }\n          }\n        }\n      }, status}, \"RSVP\")\n}\n\nexport const getStaticProps = async (ctx:any)=>{\n  let eventID = parseInt(ctx.params?.id as string)\n  if(Number.isNaN(eventID)) return {props:{notFound:true}} as const\n  let data = await eventDataQuery(eventID)\n\n  if(!data || data.standalone_events===null) return {props: {notFound: true}} as const\n\n  return {props: {notFound: false, ...data}, revalidate:1} as const\n}\n\nexport const getStaticPaths = async ()=>{\n  return {paths:[], fallback: true}\n}\n"]},"metadata":{},"sourceType":"module"}