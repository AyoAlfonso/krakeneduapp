{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/apiHelpers.ts","webpack:///external \"ical.js\"","webpack:///external \"@prisma/client\"","webpack:///./lib/prisma.ts","webpack:///./src/calendar.ts","webpack:///./emails/index.ts","webpack:///external \"runtypes\"","webpack:///external \"immer\"","webpack:///external \"@sentry/node\"","webpack:///./pages/api/events//index.ts","webpack:///external \"swr\"","webpack:///external \"react\"","webpack:///external \"postmark\"","webpack:///./src/token.ts","webpack:///external \"cookie\""],"names":["APIHandler","handler","process","env","NEXT_PUBLIC_SENTRY_DSN","Sentry","dsn","req","res","result","method","methodHandler","status","end","e","contexts","headers","console","log","header","Object","keys","setHeader","send","json","multiRouteHandler","query","handlers","route","callApi","endpoint","msg","fetch","body","JSON","stringify","get","includes","text","useApi","deps","successCallback","state","setState","useState","useEffect","call","path","useApiData","initialData","useSWR","globalAny","global","prisma","APP_ENV","PrismaClient","createEventInvite","props","calendar","ICAL","Component","updatePropertyWithValue","vevent","calEvent","Event","uid","id","description","summary","location","startDate","Time","fromJSDate","Date","start_date","endDate","end_date","addSubcomponent","client","postmark","POSTMARK_TOKEN","sendResetPasswordEmail","sendEmail","resetPasswordMetadata","sendVerificationEmail","verifiyEmailMetadata","sendCohortEnrollmentEmail","cohortEnrollmentMetadata","sendEventRSVPEmail","eventRSVPMetadata","sendEventRSVPNoAccountEmail","eventRSVPNoAccountMetadata","sendEventUpdateNoAccountEmail","sendBatchEmail","eventUpdateNoAccount","sendInviteToCourseEmail","inviteToCourseMetadata","sendEnrollNotificationEmaill","enrollNotificationMetada","sendWatchingNotificationEmail","watchingNotificationMetadata","sendUnenrollEmail","unenrollMetadata","meta","email","vars","data","NODE_ENVIRONMENT","sendEmailWithTemplate","From","To","TemplateAlias","Alias","TemplateModel","error","msgs","sendEmailBatchWithTemplates","filter","x","undefined","map","MessageStream","POST","updateEvent","DELETE","deleteEvent","GET","getEvent","UpdateEventValidator","t","name","String","type","cohort","people","cost","max_attendees","Number","eventDataQuery","userId","event","events","findUnique","where","include","select","display_name","username","bio","people_in_events","pronouns","no_account_rsvps","cohort_events","standalone_events","standalone_events_in_courses","person","produce","p","created_by","no_accounts_rsvps","find","user","getToken","eventId","parseInt","isNaN","check","toString","course_cohorts","cohort_facilitators","f","facilitator","newEvent","update","cohort_event","everyone","length","deleteMany","create","connect","Content","Buffer","from","rsvp","event_name","event_page_url","Attachments","Name","ContentType","ContentID","people_in_cohorts","delete","setTokenHeader","token","cookie","serialize","expires","now","httpOnly","sameSite","cookies","loginToken","parse","removeToken"],"mappings":"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","file":"pages/api/events/[id].js","sourcesContent":[" \t// The module cache\n \tvar installedModules = require('../../../ssr-module-cache.js');\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n","import { NextApiRequest, NextApiResponse} from 'next'\nimport * as Sentry from '@sentry/node'\nimport { useState, useEffect} from 'react'\nimport useSWR from 'swr'\n\nexport type ResultType<T extends (...args:any)=> any> = PromiseReturn<ReturnType<T>>\nexport type Request = NextApiRequest\nexport type Success<T extends Result> = Extract<T, {status: 200}>['result']\nexport type Errors<T extends Result> = Exclude<T, {status: 200}>\n\ntype Handler = (req:Request) => Promise<Result>\ntype PromiseReturn<T> = T extends PromiseLike<infer U> ? U : T\n\ntype Result = {\n  status: number,\n  result: string | object | null | boolean\n  headers?: {\n    [key: string]: string | number | string[]\n  }\n}\n\ntype Methods = \"POST\" | \"GET\" | \"PUT\" | \"DELETE\"\n\nexport const APIHandler = (handler: Handler | Partial<{POST: Handler, GET: Handler, PUT: Handler, DELETE: Handler}>) => {\n  if (process.env.NEXT_PUBLIC_SENTRY_DSN) {\n    Sentry.init({ dsn: process.env.NEXT_PUBLIC_SENTRY_DSN});\n  }\n  return async (req:NextApiRequest, res: NextApiResponse) => {\n    let result\n    try {\n      if(typeof handler === 'object') {\n        let method = req.method as Methods\n        let methodHandler = handler[method]\n        if(!methodHandler) {\n          res.status(404).end()\n          return\n        }\n        result = await methodHandler(req)\n      }\n      else {\n        result = await handler(req)\n      }\n    }\n    catch(e) {\n      if (process.env.NEXT_PUBLIC_SENTRY_DSN) {\n        Sentry.captureException(e, {contexts: {headers: req.headers}})\n        await Sentry.flush(2000)\n      }\n      console.log(e)\n      return res.status(500).end()\n    }\n\n    if(result.headers) {\n      for(let header of Object.keys(result.headers)) {\n        res.setHeader(header, result.headers[header])\n      }\n    }\n    if(result.status!==200) console.log(result.result)\n    if(typeof result.result !== 'object') return res.status(result.status).send(result.result)\n    return res.status(result.status).json(result.result)\n  }\n}\n\nexport const multiRouteHandler = (query:string, handlers:{[key:string]: Handler}) => {\n  return APIHandler(async (req) => {\n    let route = (typeof req.query[query] === 'string')\n                 ? req.query[query] as string\n                 : req.query[query][0]\n    return handlers[route](req)\n  })\n}\n\nexport async function callApi<Msg extends object | string | null, R extends Omit<Result, 'headers'>> (endpoint:string, msg?: Msg, method?: Methods){\n    let result = await fetch(endpoint, {\n      method: method ? method : msg ? \"POST\" : \"GET\",\n      headers: {\n        'Content-type': (typeof msg === 'object') ? 'application/json' : 'text/html'\n      },\n      body: (typeof msg === 'string') ? msg : JSON.stringify(msg)\n    })\n\n    return {\n      status: result.status,\n      result: result.headers.get('Content-type')?.includes('application/json')\n        ? await result.json()\n        : await result.text()\n    } as R\n}\n\nexport type Status = 'normal' | 'error' | 'loading' | 'success'\nexport function useApi<Msg extends object | string | null, R extends Omit<Result, 'headers'>>(deps: any[], successCallback?: (result: Extract<R, {status:200}>['result'])=> any) {\n  let [state, setState] = useState<Status>('normal')\n  useEffect(()=> setState('normal'), deps)\n  let call= async (path: string, msg?: Msg, method?: Methods) => {\n    setState('loading')\n    let res = await callApi<Msg, R>(path, msg, method)\n    if(res.status === 200) {\n      if(successCallback) await successCallback(res.result)\n      setState('success')\n    }\n    else setState('error')\n    return res\n  }\n  return [state, call, setState] as const\n}\n\nexport function useApiData<R extends Omit<Result, 'headers'>>(path?: string, initialData?:R) {\n  return useSWR<Success<R>, Errors<R>>(path ? path : null, async (path)=>{\n    let res = await callApi<null, R>(path)\n    if(res.status = 200) return res.result\n    return res\n  }, {initialData})\n}\n","module.exports = require(\"ical.js\");","module.exports = require(\"@prisma/client\");","const globalAny:any = global;\nimport { PrismaClient } from \"@prisma/client\";\n\nlet prisma: PrismaClient;\n\nif (process.env.APP_ENV === \"production\") {\n  prisma = new PrismaClient();\n} else {\n  if (!globalAny.prisma) {\n    globalAny.prisma = new PrismaClient();\n  }\n  prisma = globalAny.prisma;\n}\n\nexport default prisma;","import ICAL from 'ical.js'\nexport const createEventInvite = (props:{\n  id:number | string,\n  description: string,\n  summary: string,\n  start_date: string,\n  location: string,\n  end_date: string,\n})=> {\n\n  let calendar = new ICAL.Component(['vcalendar',[],[]])\n  calendar.updatePropertyWithValue('version', '2.0');\n  calendar.updatePropertyWithValue('prodid', 'app.krakenedu.com');\n  calendar.updatePropertyWithValue('method', \"REQUEST\")\n  calendar.updatePropertyWithValue('name', 'KrakenEdu Calendar')\n  calendar.updatePropertyWithValue('x-wr-calname', 'KrakenEdu Calendar')\n\n  let vevent = new ICAL.Component('vevent')\n  let calEvent = new ICAL.Event(vevent)\n  calEvent.uid = 'krakenedu-'+props.id\n  calEvent.description = props.description\n  calEvent.summary = props.summary\n  calEvent.location = props.location\n  calEvent.startDate = ICAL.Time.fromJSDate(new Date(props.start_date), true)\n  calEvent.endDate = ICAL.Time.fromJSDate(new Date(props.end_date), true)\n\n  calendar.addSubcomponent(vevent)\n  return calendar\n}\n","import * as postmark from 'postmark'\nimport cohortEnrollmentMetadata from './templates/cohort-enrollment/meta.json'\nimport verifiyEmailMetadata from './templates/welcome/meta.json'\nimport resetPasswordMetadata from './templates/password-reset/meta.json'\nimport inviteToCourseMetadata from './templates/invite-to-course/meta.json'\nimport enrollNotificationMetada from './templates/enroll-notification/meta.json'\nimport unenrollMetadata from './templates/cohort-unenroll/meta.json'\nimport watchingNotificationMetadata from './templates/watching-notification/meta.json'\nimport eventRSVPMetadata from './templates/event-rsvp/meta.json'\nimport eventRSVPNoAccountMetadata from './templates/event-rsvp-no-account/meta.json'\nimport eventUpdateNoAccount from './templates/event-update-no-account/meta.json'\n\nimport { Hash } from 'postmark/dist/client/models/client/SupportingTypes'\n\nvar client = new postmark.ServerClient(process.env.POSTMARK_TOKEN || '');\n\nexport const sendResetPasswordEmail = sendEmail(resetPasswordMetadata)\nexport const sendVerificationEmail = sendEmail(verifiyEmailMetadata)\nexport const sendCohortEnrollmentEmail = sendEmail(cohortEnrollmentMetadata)\nexport const sendEventRSVPEmail = sendEmail(eventRSVPMetadata)\nexport const sendEventRSVPNoAccountEmail = sendEmail(eventRSVPNoAccountMetadata)\nexport const sendEventUpdateNoAccountEmail = sendBatchEmail(eventUpdateNoAccount)\nexport const sendInviteToCourseEmail = sendEmail(inviteToCourseMetadata)\nexport const sendEnrollNotificationEmaill = sendEmail(enrollNotificationMetada)\nexport const sendWatchingNotificationEmail = sendBatchEmail(watchingNotificationMetadata)\nexport const sendUnenrollEmail = sendEmail(unenrollMetadata)\n\ntype EmailMetadata = {\n  Alias: string,\n  TestRenderModel: object\n}\nexport function sendEmail<T extends EmailMetadata>(meta:T) {\n  return async function(\n    email: string,\n    vars?: T[\"TestRenderModel\"], data?: Partial<{Metadata?:Hash<string>, Attachments: Array<{Name: string, Content: string, ContentType: string, ContentID: string | null}>}>) {\n    if(process.env.NODE_ENVIRONMENT === 'production') {\n      try {\n          return client.sendEmailWithTemplate({\n                  From: `wecare@krakenedu.com`,\n                  To: email,\n                  TemplateAlias: meta.Alias,\n                  TemplateModel: vars,\n                  ...data\n          })\n      } catch (error) {\n        console.log(error)\n      }\n    }\n  }\n}\nexport function sendBatchEmail<T extends EmailMetadata>(meta:T) {\n  return (msgs:Array<{email: string, vars: T[\"TestRenderModel\"],data?: Partial<{Metadata?:Hash<string>, Attachments: Array<{Name: string, Content: string, ContentType: string, ContentID: string | null}>}>} | undefined>) => {\n    if(process.env.NODE_ENVIRONMENT === 'production') return client.sendEmailBatchWithTemplates(msgs.filter(x=>x!== undefined).map(msg=>{\n      return {\n         From: `wecare@krakenedu.com`,\n        To: msg?.email || '',\n        TemplateAlias: meta.Alias,\n        TemplateModel: msg?.vars || {},\n        MessageStream: \"notifications\",\n        ...msg?.data\n      }\n    }))\n  }\n}\n","module.exports = require(\"runtypes\");","module.exports = require(\"immer\");","module.exports = require(\"@sentry/node\");","import { APIHandler, Request, ResultType } from \"src/apiHelpers\";\nimport prisma from \"lib/prisma\";\nimport { getToken } from \"src/token\";\nimport * as t from 'runtypes'\nimport produce from \"immer\";\nimport { sendEventUpdateNoAccountEmail } from \"emails\";\nimport { createEventInvite } from \"src/calendar\";\n\n\nexport default APIHandler({\n  POST: updateEvent,\n  DELETE: deleteEvent,\n  GET: getEvent\n})\nexport type UpdateEventMsg = t.Static<typeof UpdateEventValidator>\nexport type UpdateEventResult = ResultType<typeof updateEvent>\nexport type DeleteEventResult = ResultType<typeof deleteEvent>\nexport type GETEventResult = ResultType<typeof getEvent>\n\nlet UpdateEventValidator = t.Intersect(\n  t.Record({data: t.Partial({\n    start_date: t.String,\n    end_date: t.String,\n    description: t.String,\n    location: t.String,\n    name: t.String,\n  })}),\n  t.Union(\n    t.Record({\n      type: t.Literal('cohort'),\n      cohort: t.Number,\n      data: t.Partial({\n        people: t.Union(t.Undefined, t.Array(t.String))\n      })\n    }), t.Record({\n      type: t.Literal('standalone'),\n      data: t.Partial({\n        cost: t.Number,\n        max_attendees: t.Number\n      })\n    })\n  ))\n\nexport const eventDataQuery = async (id: number, userId?:string)=>{\n  let event = await prisma.events.findUnique({\n    where: {id},\n    include:{\n      people: {select:{display_name: true, username: true, bio: true, id: true}},\n      people_in_events: {include:{people:{select:{display_name: true, username: true, pronouns: true, email: true}}}},\n      no_account_rsvps: true,\n      cohort_events: true,\n      standalone_events: {\n        include: {\n          standalone_events_in_courses: true\n        }\n      }\n    }\n  })\n  if(!event) return\n  let people_in_events = event.people_in_events.map(person=>produce(person, p=>{if(event?.created_by!==userId)p.people.email=''}))\n  let no_accounts_rsvps = event.no_account_rsvps.map(person=>event?.created_by!==userId ? {...person, email:''} : person)\n\n  if(userId != event.created_by && !event.people_in_events.find(p=>p.person===userId)) {\n    return {...event, people_in_events, location: ''}\n  }\n  return {...event, people_in_events, no_accounts_rsvps}\n}\n\nasync function getEvent(req:Request) {\n  let user = getToken(req)\n  let eventId = parseInt(req.query.id as string)\n  if(Number.isNaN(eventId)) return {status: 400, result: \"ERROR: event id is not a number\"} as const\n  let event = await eventDataQuery(eventId, user?.id)\n  if(!event) return {status:404, result: 'ERROR: no event with id found'} as const\n  return {status:200, result: event} as const\n}\n\nasync function updateEvent(req:Request) {\n  let eventId = parseInt(req.query.id as string)\n  if(Number.isNaN(eventId)) return {status: 400, result: \"ERROR: event id is not a number\"} as const\n  let msg\n  try {msg = UpdateEventValidator.check(req.body)}\n  catch(e) {\n    return {status:400, result:e.toString()} as const\n  }\n\n  let user = getToken(req)\n  if(!user) return {status: 401 , result: \"ERROR: no user logged in\"} as const\n\n  let event = await prisma.events.findUnique({where:{id: eventId}, select:{id: true, created_by: true, no_account_rsvps: true, name: true}})\n  if(!event) return {status:404, result: 'ERROR: no event found'} as const\n\n  switch(msg.type){\n      case 'cohort': {\n        let cohort = await prisma.course_cohorts.findUnique({where: {id: msg.cohort}, select:{cohort_facilitators: true}})\n        if(!cohort) return {status: 404, result: `ERROR: no cohort with id ${msg.cohort} found`} as const\n\n        if(!cohort.cohort_facilitators.find(f=>user&&f.facilitator===user.id) && event.created_by!==user.id) return {status: 401, result: \"ERROR: user is not creator of event or a facilitator of the cohort\"} as const\n\n        let newEvent = await prisma.cohort_events.update({\n          where:{cohort_event:{cohort: msg.cohort, event: eventId}},\n          include: {\n            events: {\n              include: {\n                people_in_events: {select:{people:{select:{username: true, display_name: true, id: true}}}},\n              }\n            }\n          },\n          data:{\n            everyone: msg.data.people ? msg.data.people.length === 0 : undefined,\n            events:{\n              update:{\n                location: msg.data.location,\n                start_date: msg.data.start_date,\n                end_date: msg.data.end_date,\n                description: msg.data.description,\n                name: msg.data.name,\n                people_in_events: {\n                  deleteMany:{event: eventId},\n                  create: msg.data.people?.map(p=>{\n                    return {\n                      people:{connect:{username: p}}\n                    }\n                  })\n                }\n              }\n            }\n          }\n        })\n        return {status: 200, result: {type: 'cohort', data: newEvent}} as const\n      }\n      case 'standalone': {\n        if(event.created_by !== user.id) return {status: 401, result: \"ERROR: user is not a facilitator of the cohort\"} as const\n        let newEvent = await prisma.standalone_events.update({\n          where:{event:eventId},\n          include: {\n            standalone_events_in_courses: true,\n            events: {include: {\n              people: true,\n              no_account_rsvps: true,\n              people_in_events: {where: {person: user.id}, include:{people:{select:{display_name: true, username: true, pronouns: true, email: true}}}}\n            }},\n          },\n          data: {\n            cost: msg.data.cost,\n            max_attendees: msg.data.max_attendees,\n            events:{\n              update:{\n                start_date: msg.data.start_date,\n                end_date: msg.data.end_date,\n                description: msg.data.description,\n                name: msg.data.name,\n              }\n            }\n          }\n        })\n\n        if(msg.data.start_date || msg.data.end_date || msg.data.location || msg.data.location || msg.data.name) {\n          let Content = Buffer.from(createEventInvite({\n            id: newEvent.events.id,\n            description: newEvent.events.description,\n            start_date: newEvent.events.start_date,\n            end_date: newEvent.events.end_date,\n            summary: newEvent.events.name,\n            location: newEvent.events.location\n          }).toString()).toString('base64')\n\n          await sendEventUpdateNoAccountEmail(event.no_account_rsvps.map(rsvp=> {\n            return {\n              email: rsvp.email,\n              vars: {\n                name: rsvp.name,\n                event_name: event?.name || \"\",\n                event_page_url: `https://app.krakenedu.com/events/${event?.id}`,\n              },\n              data: {\n                Attachments: [\n                  {\n                    Name: \"event.ics\",\n                    ContentType: \"text/calender\",\n                    ContentID: null,\n                    Content,\n                  },\n                ],\n              },\n            };\n          }))\n        }\n\n        return {status: 200, result: {type: 'standalone', data: newEvent}} as const\n      }\n  }\n\n}\n\nasync function deleteEvent(req:Request) {\n  let eventId = parseInt(req.query.id as string)\n  if(Number.isNaN(eventId)) return {status: 400, result: \"ERROR: Cohort id is not a number\"} as const\n  let user = getToken(req)\n  if(!user) return {status: 401 , result: \"ERROR: no user logged in\"} as const\n\n  let event = await prisma.events.findUnique({\n    where: {id: eventId},\n    select: {\n      created_by: true,\n      cohort_events: {\n        select:{\n          course_cohorts: {\n            select:{cohort_facilitators: true, people_in_cohorts:{select:{people:{select: {username: true}}}}}\n          }\n        }\n      }\n    }\n  })\n\n  if(!event) return {status: 404, result: `ERROR: no event with id ${eventId} found`} as const\n\n  if(!event.cohort_events[0]?.course_cohorts.cohort_facilitators.find(f=>user&&f.facilitator===user.id) && user.id !== event.created_by) return {status: 401, result: \"ERROR: user is not a facilitator of the cohort this event is in\"} as const\n\n  await prisma.cohort_events.deleteMany({where: {event: eventId}}),\n  await prisma.people_in_events.deleteMany({where:{event: eventId}})\n  await prisma.events.delete({\n    where: {id: eventId}\n  })\n  return {status: 200, result: true}\n}\n","module.exports = require(\"swr\");","module.exports = require(\"react\");","module.exports = require(\"postmark\");","import { ServerResponse, IncomingMessage } from \"http\";\nimport cookie from 'cookie'\n\nexport type Token = {\n  email: string,\n  id: string,\n  username: string,\n  display_name?: string | null,\n  link?: string | null\n  bio?: string | null\n  admin?: boolean\n}\n\nexport function setTokenHeader(token:Token)  {\n  return {\n    'Set-Cookie':cookie.serialize('loginToken', JSON.stringify(token), {\n      path: '/',\n      expires: new Date(Date.now() + 1000 * 60 * 60 * 24 * 30), // 30 days\n      httpOnly: true,\n      sameSite: \"lax\"\n    })\n  }\n}\n\nexport function getToken(req:IncomingMessage) {\n  const cookies = req.headers.cookie\n  if (!cookies) return;\n\n  const { loginToken } = cookie.parse(cookies);\n  if(loginToken) return JSON.parse(loginToken) as Token;\n  return\n}\n\nexport function removeToken(res:ServerResponse) {\n  res.setHeader(\n      'Set-Cookie',\n      cookie.serialize('loginToken', '', {\n        path: '/',\n        expires: new Date(Date.now() - 1000),\n        httpOnly: false\n      })\n    );\n}\n","module.exports = require(\"cookie\");"],"sourceRoot":""}