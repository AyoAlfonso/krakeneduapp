{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/apiHelpers.ts","webpack:///external \"@prisma/client\"","webpack:///./lib/prisma.ts","webpack:///external \"runtypes\"","webpack:///external \"@sentry/node\"","webpack:///external \"swr\"","webpack:///external \"react\"","webpack:///./pages/api/events/index.ts","webpack:///./src/token.ts","webpack:///external \"cookie\""],"names":["APIHandler","handler","process","env","NEXT_PUBLIC_SENTRY_DSN","Sentry","dsn","req","res","result","method","methodHandler","status","end","e","contexts","headers","console","log","header","Object","keys","setHeader","send","json","multiRouteHandler","query","handlers","route","callApi","endpoint","msg","fetch","body","JSON","stringify","get","includes","text","useApi","deps","successCallback","state","setState","useState","useEffect","call","path","useApiData","initialData","useSWR","globalAny","global","prisma","APP_ENV","PrismaClient","POST","createEvent","GET","getPublicEvents","CreateEventValidator","t","start_date","end_date","description","location","name","String","type","cohort","people","cost","max_attendees","Number","getPublicEventsQuery","standalone_events","findMany","select","events","event","standalone_events_in_courses","check","toString","user","getToken","course_cohorts","findUnique","where","id","cohort_facilitators","include","username","people_in_cohorts","find","f","facilitator","p","cohort_events","create","people_in_events","display_name","data","everyone","length","connect","undefined","map","setTokenHeader","token","cookie","serialize","expires","Date","now","httpOnly","sameSite","cookies","loginToken","parse","removeToken"],"mappings":"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","file":"pages/api/events.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = require('../../ssr-module-cache.js');\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","import { NextApiRequest, NextApiResponse} from 'next'\nimport * as Sentry from '@sentry/node'\nimport { useState, useEffect} from 'react'\nimport useSWR from 'swr'\n\nexport type ResultType<T extends (...args:any)=> any> = PromiseReturn<ReturnType<T>>\nexport type Request = NextApiRequest\nexport type Success<T extends Result> = Extract<T, {status: 200}>['result']\nexport type Errors<T extends Result> = Exclude<T, {status: 200}>\n\ntype Handler = (req:Request) => Promise<Result>\ntype PromiseReturn<T> = T extends PromiseLike<infer U> ? U : T\n\ntype Result = {\n  status: number,\n  result: string | object | null | boolean\n  headers?: {\n    [key: string]: string | number | string[]\n  }\n}\n\ntype Methods = \"POST\" | \"GET\" | \"PUT\" | \"DELETE\"\n\nexport const APIHandler = (handler: Handler | Partial<{POST: Handler, GET: Handler, PUT: Handler, DELETE: Handler}>) => {\n  if (process.env.NEXT_PUBLIC_SENTRY_DSN) {\n    Sentry.init({ dsn: process.env.NEXT_PUBLIC_SENTRY_DSN});\n  }\n  return async (req:NextApiRequest, res: NextApiResponse) => {\n    let result\n    try {\n      if(typeof handler === 'object') {\n        let method = req.method as Methods\n        let methodHandler = handler[method]\n        if(!methodHandler) {\n          res.status(404).end()\n          return\n        }\n        result = await methodHandler(req)\n      }\n      else {\n        result = await handler(req)\n      }\n    }\n    catch(e) {\n      if (process.env.NEXT_PUBLIC_SENTRY_DSN) {\n        Sentry.captureException(e, {contexts: {headers: req.headers}})\n        await Sentry.flush(2000)\n      }\n      console.log(e)\n      return res.status(500).end()\n    }\n\n    if(result.headers) {\n      for(let header of Object.keys(result.headers)) {\n        res.setHeader(header, result.headers[header])\n      }\n    }\n    if(result.status!==200) console.log(result.result)\n    if(typeof result.result !== 'object') return res.status(result.status).send(result.result)\n    return res.status(result.status).json(result.result)\n  }\n}\n\nexport const multiRouteHandler = (query:string, handlers:{[key:string]: Handler}) => {\n  return APIHandler(async (req) => {\n    let route = (typeof req.query[query] === 'string')\n                 ? req.query[query] as string\n                 : req.query[query][0]\n    return handlers[route](req)\n  })\n}\n\nexport async function callApi<Msg extends object | string | null, R extends Omit<Result, 'headers'>> (endpoint:string, msg?: Msg, method?: Methods){\n    let result = await fetch(endpoint, {\n      method: method ? method : msg ? \"POST\" : \"GET\",\n      headers: {\n        'Content-type': (typeof msg === 'object') ? 'application/json' : 'text/html'\n      },\n      body: (typeof msg === 'string') ? msg : JSON.stringify(msg)\n    })\n\n    return {\n      status: result.status,\n      result: result.headers.get('Content-type')?.includes('application/json')\n        ? await result.json()\n        : await result.text()\n    } as R\n}\n\nexport type Status = 'normal' | 'error' | 'loading' | 'success'\nexport function useApi<Msg extends object | string | null, R extends Omit<Result, 'headers'>>(deps: any[], successCallback?: (result: Extract<R, {status:200}>['result'])=> any) {\n  let [state, setState] = useState<Status>('normal')\n  useEffect(()=> setState('normal'), deps)\n  let call= async (path: string, msg?: Msg, method?: Methods) => {\n    setState('loading')\n    let res = await callApi<Msg, R>(path, msg, method)\n    if(res.status === 200) {\n      if(successCallback) await successCallback(res.result)\n      setState('success')\n    }\n    else setState('error')\n    return res\n  }\n  return [state, call, setState] as const\n}\n\nexport function useApiData<R extends Omit<Result, 'headers'>>(path?: string, initialData?:R) {\n  return useSWR<Success<R>, Errors<R>>(path ? path : null, async (path)=>{\n    let res = await callApi<null, R>(path)\n    if(res.status = 200) return res.result\n    return res\n  }, {initialData})\n}\n","module.exports = require(\"@prisma/client\");","const globalAny:any = global;\nimport { PrismaClient } from \"@prisma/client\";\n\nlet prisma: PrismaClient;\n\nif (process.env.APP_ENV === \"production\") {\n  prisma = new PrismaClient();\n} else {\n  if (!globalAny.prisma) {\n    globalAny.prisma = new PrismaClient();\n  }\n  prisma = globalAny.prisma;\n}\n\nexport default prisma;","module.exports = require(\"runtypes\");","module.exports = require(\"@sentry/node\");","module.exports = require(\"swr\");","module.exports = require(\"react\");","import { ResultType, APIHandler, Request} from 'src/apiHelpers'\nimport * as t from 'runtypes'\nimport { getToken } from 'src/token'\nimport prisma from \"lib/prisma\";\n\nexport default APIHandler({POST: createEvent, GET: getPublicEvents})\nexport type CreateEventMsg = t.Static<typeof CreateEventValidator>\nexport type CreateEventResponse = ResultType<typeof createEvent>\nexport type GetEventsResponse = ResultType<typeof getPublicEvents>\n\nlet CreateEventValidator = t.Intersect(t.Record({\n  start_date: t.String,\n  end_date: t.String,\n  description: t.String,\n  location: t.String,\n  name: t.String,\n}), t.Union(t.Record({\n  type: t.Literal('cohort'),\n  cohort: t.Number,\n  people: t.Union(t.Undefined, t.Array(t.String))\n}), t.Record({\n  type: t.Literal('standalone'),\n  cost: t.Number,\n  max_attendees: t.Number\n})))\n\nexport const getPublicEventsQuery = ()=>prisma.standalone_events.findMany({\n  select:{\n    cost: true,\n    events: true,\n    event: true,\n    max_attendees: true,\n    standalone_events_in_courses: true\n  }\n})\n\nasync function getPublicEvents() {\n  let events = await getPublicEventsQuery()\n  return {status: 200, result: {events}} as const\n}\n\nasync function createEvent(req:Request) {\n  let msg\n  try {msg = CreateEventValidator.check(req.body)}\n  catch(e) {return {status:400, result:e.toString()} as const }\n\n  let user = getToken(req)\n  if(!user) return {status: 401 , result: \"ERROR: no user logged in\"} as const\n\n  switch(msg.type){\n      case 'cohort': {\n        let cohort = await prisma.course_cohorts.findUnique({\n          where: {id: msg.cohort},\n          select:{\n            cohort_facilitators: {include:{people: {select:{username:true}}}},\n            people_in_cohorts: {select:{people: {select: {username: true}}}}\n          }})\n        if(!cohort) return {status: 404, result: `ERROR: no cohort with id ${msg.cohort} found`} as const\n\n        if(!cohort.cohort_facilitators.find(f=> user&&f.facilitator ===user.id) &&\n          !cohort.people_in_cohorts.find(p=>user&&p.people.username===user.username)) return {status: 401, result: \"ERROR: user is not enrolled or a facilitator of the cohort\"} as const\n        if(msg.people){\n          for(let username of msg.people) {\n            if(!cohort.people_in_cohorts.find(p=>p.people.username === username) &&\n              cohort.cohort_facilitators.find(f=>f.people.username===username)) return {status:400, result: `ERROR: can't add person who is not part of the cohort or facilitator`} as const\n          }\n        }\n\n        let event = await prisma.cohort_events.create({\n          include: {\n            events: {\n              include: {\n                people_in_events: {select:{people:{select:{username: true, display_name: true, id: true}}}},\n              }\n            }\n          },\n          data: {\n            everyone: msg.people ? msg.people.length === 0 : true,\n            course_cohorts: {\n              connect: {\n                id: msg.cohort\n              }\n            },\n            events: {\n              create: {\n                people:{connect:{id: user.id}},\n                people_in_events: !msg.people ? undefined : {\n                  create: msg.people.map(p=>{\n                    return {people:{connect:{username: p}}}\n                  })\n                },\n                start_date: msg.start_date,\n                end_date: msg.end_date,\n                name: msg.name,\n                location: msg.location,\n                description: msg.description,\n              }\n            }\n          }\n        })\n        return  {status: 200, result: {type: 'cohort', event}} as const\n      }\n      case 'standalone': {\n        let event = await prisma.standalone_events.create({\n          include: {\n            events: {\n              include: {\n                people_in_events: {select:{people:{select:{username: true, display_name: true}}}},\n              }\n            }\n          },\n          data: {\n            cost: msg.cost,\n            max_attendees: msg.max_attendees,\n            events: {\n              create: {\n                people:{connect:{id: user.id}},\n                start_date: msg.start_date,\n                end_date: msg.end_date,\n                name: msg.name,\n                location: msg.location,\n                description: msg.description,\n              },\n            }\n          }\n        })\n        return {status: 200, result: {type: 'standalone', event}} as const\n      }\n  }\n}\n","import { ServerResponse, IncomingMessage } from \"http\";\nimport cookie from 'cookie'\n\nexport type Token = {\n  email: string,\n  id: string,\n  username: string,\n  display_name?: string | null,\n  link?: string | null\n  bio?: string | null\n  admin?: boolean\n}\n\nexport function setTokenHeader(token:Token)  {\n  return {\n    'Set-Cookie':cookie.serialize('loginToken', JSON.stringify(token), {\n      path: '/',\n      expires: new Date(Date.now() + 1000 * 60 * 60 * 24 * 30), // 30 days\n      httpOnly: true,\n      sameSite: \"lax\"\n    })\n  }\n}\n\nexport function getToken(req:IncomingMessage) {\n  const cookies = req.headers.cookie\n  if (!cookies) return;\n\n  const { loginToken } = cookie.parse(cookies);\n  if(loginToken) return JSON.parse(loginToken) as Token;\n  return\n}\n\nexport function removeToken(res:ServerResponse) {\n  res.setHeader(\n      'Set-Cookie',\n      cookie.serialize('loginToken', '', {\n        path: '/',\n        expires: new Date(Date.now() - 1000),\n        httpOnly: false\n      })\n    );\n}\n","module.exports = require(\"cookie\");"],"sourceRoot":""}