{"version":3,"sources":["webpack://_N_E/./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?05d7","webpack://_N_E/./pages/courses/[slug]//cohorts/[cohortId]/templates.ts","webpack://_N_E/./src/constants.ts","webpack://_N_E/./components/EditorWithPreview.ts"],"names":["window","__NEXT_P","push","TemplatePage","props","useFormData","template","form","changed","reset","useState","post","setPost","useApi","status","callPost","router","useRouter","onSubmit","e","a","preventDefault","query","cohortId","title","value","body","content","tags","res","result","topic","topic_id","h","Fragment","Modal","display","onExit","undefined","Box","gap","style","textAlign","justifySelf","href","DISCOURSE_URL","Primary","Link","slug","id","Secondary","FormBox","LabelBox","width","Input","type","name","EditorWithPreview","disabled","onClick","CohortTemplatesPages","templates","find","t","BackButton","shallow","as","filter","sort","b","flatMap","gridAutoColumns","alignItems","Seperator","slice","PageLoader","mobile","useMediaQuery","mode","setMode","LinkButton","Preview","Text","source","Editor","EditorPreviewContainer","height","colors","grey55","accentPeach"],"mappings":"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","file":"static/chunks/pages/courses/[slug]/[id]/cohorts/[cohortId]/templates-cb768915d64b874c8222.js","sourcesContent":["\n      (window.__NEXT_P = window.__NEXT_P || []).push([\n        \"/courses/[slug]/[id]/cohorts/[cohortId]/templates\",\n        function () {\n          return require(\"private-next-pages/courses/[slug]/[id]/cohorts/[cohortId]/templates.ts\");\n        }\n      ]);\n    ","import h from 'react-hyperscript'\nimport Link from 'next/link'\nimport { useRouter } from 'next/router'\nimport { getTemplatesQuery } from 'pages/api/courses/[id]/templates'\nimport { InferGetStaticPropsType } from 'next'\nimport { Box, Seperator, FormBox, LabelBox } from 'components/Layout'\nimport { Secondary, Primary, BackButton } from 'components/Button'\nimport { useState, Fragment } from 'react'\nimport { Input } from 'components/Form'\nimport EditorWithPreview from 'components/EditorWithPreview'\nimport { PageLoader } from 'components/Loader'\nimport { useApi } from 'src/apiHelpers'\nimport { PostTopicMsg, PostTopicResponse } from 'pages/api/cohorts/[cohortId]/postTopic'\nimport { Modal } from 'components/Modal'\nimport { DISCOURSE_URL } from 'src/constants'\nimport { useFormData } from 'src/hooks'\n\nexport default CohortTemplatesPages\ntype Props = InferGetStaticPropsType<typeof getStaticProps>\nfunction CohortTemplatesPages(props:Props) {\n  let router = useRouter()\n  let template = props.templates?.find(t=> t.name === router.query.template)\n  if(!props.templates) return h(PageLoader)\n\n  if(template) return h(Box, {gap: 64}, [\n    h(Box, {gap:16}, [\n      h(BackButton, {href: `/courses/${router.query.slug}/${router.query.id}/cohorts/${router.query.cohortId}/templates`, shallow:true}, 'Templates'),\n      h('h1', \"Post template\")\n    ]),\n    h(TemplatePage, {template})\n  ])\n\n  return h(Box, {width: 640, gap: 32},[\n    h(Box, {gap:16}, [\n      h(BackButton, {href: \"/courses/[slug]/[id]/cohorts/[cohortId]\", as: `/courses/${router.query.slug}/${router.query.id}/cohorts/${router.query.cohortId}`}, 'Cohort Details'),\n      h('h1', \"Templates\"),\n      h('p.big', [\n        `Use templates to easily post new topics in your cohort forum! You can create new templates in the `,\n        h(Link, {href: '/courses/[slug]/[id]/settings', as:`/courses/${router.query.slug}/${router.query.id}/settings`}, h('a', 'course settings')), `.`\n      ])\n    ]),\n    h(Box, {}, props.templates\n      ?.filter(t=>t.type === 'triggered')\n      .sort((a, b)=>  a.name > b.name ? 1 : -1)\n      .flatMap(template => {\n        return [\n          h(Box, {h: true, style: {gridAutoColumns: 'auto'}},[\n            h('div', [\n              h('h3', template.name),\n              h('span.textSecondary', template.type ==='prepopulated' ? \"Prepopulated for all cohorts\" : \"Manually published by facilitator\")\n            ]),\n            h(Box, {h: true, style:{justifySelf: 'end', alignItems: 'center'}}, [\n              h(Link, {\n                href: `/courses/${router.query.slug}/${router.query.id}/cohorts/${router.query.cohortId}/templates`+'?template='+template.name,\n                shallow: true,\n              }, h(Secondary, 'Use'))\n            ])\n          ]),\n          h(Seperator)\n        ]}).slice(0, -1))\n  ])\n}\n\nfunction TemplatePage(props: {template: Props['templates'][0]}) {\n  let {form, changed, reset} = useFormData(props.template)\n  let [post, setPost] = useState<number | undefined>()\n  let [status, callPost] = useApi<PostTopicMsg, PostTopicResponse>([])\n  let router = useRouter()\n\n  let onSubmit = async (e:React.FormEvent)=>{\n    e.preventDefault()\n    let res = await callPost(`/api/cohorts/${router.query.cohortId}/postTopic`, {title: form.title.value, body: form.content.value, tags:[]})\n    if(res.status===200) setPost(res.result.topic.topic_id)\n  }\n\n  return h(Fragment, [\n    post && status === 'success' ? h(Modal, {display: !!post, onExit: ()=>{setPost(undefined)}}, h(Box, {gap:32},[\n      h(Box, {gap:16, style:{textAlign: 'center'}}, [\n      h('h1', \"Cool!\"),\n        h('p', \"Your topic has been added\")\n      ]),\n      h(Box, [\n        h('a', {style:{justifySelf:\"center\"}, href: `${DISCOURSE_URL}/t/${post}`}, h(Primary, \"View it here\")),\n      h(Link, {\n        href: `/courses/${router.query.slug}/${router.query.id}/cohorts/${router.query.cohortId}/templates`\n      }, h('a', {style:{justifySelf:\"center\"}}, h(Secondary, 'Back to Templates')))\n      ])\n    ])) : null,\n    h(FormBox, {onSubmit, gap:32}, [\n      h(LabelBox, {width: 400}, [\n        h('h4', \"Title\"),\n        h(Input, {\n          type: 'text',\n          name: 'title',\n          ...form.title,\n        })\n      ]),\n      h(LabelBox, [\n        h('h4', \"Body\"),\n        h(EditorWithPreview, form.content)\n      ]),\n      h(Box, {h:true, style:{justifySelf: 'right'}}, [\n        h(Secondary, {disabled: !changed, onClick:()=>reset()}, \"Reset Template\"),\n        h(Primary, {type: 'submit', status}, \"Post to the forum\"),\n      ])\n    ])\n  ])\n}\n\nexport const getStaticProps = async (ctx:any)=>{\n  let cohortNum = (ctx.params?.cohortId || '' )as string\n  let courseId = parseInt(ctx.params?.id as string || '')\n\n  let templates = await getTemplatesQuery(courseId)\n  return {props: {templates, courseId, cohortNum}}\n}\n\nexport const getStaticPaths = async ()=>{\n  return {paths:[], fallback: true}\n}\n","export let DISCOURSE_URL = 'https://forum.krakenedu.com'\n","import h from 'react-hyperscript'\nimport styled from '@emotion/styled'\nimport Text from './Text'\nimport {colors} from './Tokens'\nimport { useMediaQuery } from 'src/hooks'\nimport { useState } from 'react'\nimport { Box } from './Layout'\nimport { LinkButton } from './Button'\n\nexport default function EditorWithPreview(props:{height?: number, value: string, onChange: (e:React.ChangeEvent<HTMLTextAreaElement>)=>void}) {\n  let mobile = useMediaQuery('(max-width:640px)')\n\n  let [mode, setMode] = useState<'edit'|'preview'>('edit')\n  if(mobile) return h(Box, {gap:4}, [\n    h('div', {style:{justifySelf: 'right'}}, [\n      mode === 'preview'\n        ? h(LinkButton, {onClick: ()=>setMode('edit')}, 'edit')\n        : h(LinkButton, {onClick: ()=>setMode('preview')}, 'preview'),\n    ]),\n    mode === 'preview'\n      ? h(Preview, {}, h(Text, {source: props.value}))\n      : h(Editor, props),\n  ])\n  return h(EditorPreviewContainer, [\n    h(Editor, props),\n    h(Preview, {height:props.height}, h(Text, {source: props.value}))\n  ])\n}\nlet EditorPreviewContainer = styled('div')`\ndisplay: grid;\nmax-width: 1200px;\ngrid-template-columns: 50% 50%;\n`\n\nlet Editor = styled('textarea')<{height?:number}>`\nbox-sizing: border-box;\nheight: ${props=>props.height ? props.height : 512}px;\npadding: 16px;\nfont-family: 'Lato', sans-serif;\nborder-color: ${colors.grey55} !important;\nborder: 1px solid;\nborder-radius: 2px 0 0 2px;\nresize: none;\nfont-size: inherit;\nline-height: inherit;\n`\n\nlet Preview = styled('div')<{height?:number}>`\noverflow: scroll;\nbox-sizing: border-box;\npadding: 16px;\nfont-size: 16px;\nheight: ${props=>props.height ? props.height : 512}px;\nbackground-color:${colors.accentPeach};\nborder-radius: 0 2px 2px 0;\n`\n"],"sourceRoot":""}