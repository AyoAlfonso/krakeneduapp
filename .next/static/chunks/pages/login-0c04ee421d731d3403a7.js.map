{"version":3,"sources":["webpack://_N_E/./components/Images.ts","webpack://_N_E/./pages/login.ts","webpack://_N_E/./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?3286"],"names":["AccentImg","props","height","width","HalfLoopImg","useState","looping","setLooping","imageRef","useRef","useEffect","current","complete","setTimeout","startLoop","h","src","src2","alt","ref","onLoad","src1","COPY","emailOrUsernameInput","passwordInput","resetPassword","loginHeader","wrongLogin","Link","href","loginButton","RESETCOPY","ResetPassword","email","setEmail","useApi","status","callResetPassword","setStatus","onSubmit","e","a","preventDefault","FormBox","ma","LabelBox","gap","Input","type","required","value","onChange","currentTarget","style","display","justifyItems","gridGap","Primary","Box","Info","onClick","Error","LoginHeader","Login","router","useRouter","emailOrUsername","password","formData","setFormData","redirect","query","reset","useUserData","data","mutate","result","startsWith","window","location","assign","push","callLogin","justifySelf","__NEXT_P"],"mappings":"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","file":"static/chunks/pages/login-0c04ee421d731d3403a7.js","sourcesContent":["import styled from '@emotion/styled'\nimport { useState, useEffect, useRef } from 'react'\nimport h from 'react-hyperscript'\n\nexport let TitleImg = styled('img')<{height?: number, width: number}>`\nimage-rendering: pixelated;\nimage-rendering: crisp-edges;\ndisplay: block;\nborder: 2px solid;\nheight: ${props=> props.height ? props.height +'px' : 'auto'};\nwidth: ${props=> props.width}px;\n`\n\nexport let AccentImg = styled('img')<{height?: number, width?: number}>`\nimage-rendering: pixelated;\nimage-rendering: -moz-crisp-edges;\nimage-rendering: crisp-edges;\ndisplay: block;\nborder: none;\nheight: ${props=> props.height ? props.height +'px' : '100px'};\nwidth: ${props=> props.width ? props.width +'px' : '100px'};\n`\n\nexport function HalfLoopImg(props:\n    {\n        src1:string,\n        src2:string,\n        alt:string,\n        startLoop:number,\n    }) {\n    let [looping, setLooping] = useState(false)\n    let imageRef = useRef<HTMLImageElement>(null)\n    useEffect(()=> {\n      if(imageRef.current?.complete && !looping) {\n        setTimeout(()=>setLooping(true), props.startLoop)\n      }\n    }, [])\n  \n    if(!looping) {\n      return h(AccentImg, {ref: imageRef, onLoad: () => {\n        setTimeout(()=>setLooping(true), props.startLoop)\n      }, src: props.src1, alt: props.alt })\n    }\n    return h(AccentImg, {src: props.src2, alt: props.alt })\n  }","import h from 'react-hyperscript'\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/router'\nimport Link from 'next/link'\n\nimport { Box, LabelBox, FormBox } from 'components/Layout'\nimport { Input, Error, Info } from 'components/Form'\nimport { Primary } from 'components/Button'\nimport {AccentImg, HalfLoopImg} from 'components/Images'\nimport { useApi } from 'src/apiHelpers'\nimport { Result, Msg } from 'pages/api/login'\nimport { RequestMsg, RequestResult } from 'pages/api/user/resetPassword/[action]'\nimport { useUserData } from 'src/data'\nimport styled from '@emotion/styled'\n\nconst COPY = {\n  emailOrUsernameInput: \"Email or Username\",\n  passwordInput: \"Password\",\n  resetPassword: \"Reset password\",\n  loginHeader: \"Log In\",\n  wrongLogin: h('div', [\n    \"The email/username and password don't match\", h('br'), \"If you want, you can \",\n    h(Link, { href: '/login?reset' }, h('a', 'reset your password here')),\n    '.'\n  ]),\n  loginButton: \"Log In\"\n}\n\nconst Login = () => {\n  let router = useRouter()\n  let [formData, setFormData] = useState({ emailOrUsername: '', password: '' })\n  let redirect = router.query.redirect as string | null\n  let { reset } = router.query\n  let { data, mutate } = useUserData()\n  let [status, callLogin] = useApi<Msg, Result>([formData], async (result)=> {\n    if (redirect) {\n      if (redirect[0] !== '/' || redirect.startsWith('/sso')) return window.location.assign(redirect)\n      await mutate(result)\n      await router.push(redirect as string)\n    }\n    else await router.push('/dashboard')\n  })\n\n  const onSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    callLogin('/api/login', formData)\n  }\n\n  useEffect(()=> {if (data) router.push(redirect as string || '/dashboard')},[data])\n  if (typeof reset !== 'undefined') return h(ResetPassword)\n\n  return h(FormBox, {onSubmit, width: 400, ma: true, gap: 32}, [\n    h(Box, [\n      h(LoginHeader, [\n        h('h1', COPY.loginHeader),\n\n        h(HalfLoopImg, {\n          src1: '/img/door-1.gif',\n          src2: '/img/door-2.gif',\n          alt: \"an animated gif of a entrance to the sparkle void\",\n          startLoop: 1200,\n        }),\n      ]),\n      h('p.textSecondary', ['Or ', h(Link, { href: '/signup' }, h('a', 'sign up')), ' for a new account'])\n    ]),\n\n    status === 'error' ? h(Error, {}, COPY.wrongLogin) : null,\n\n    h(LabelBox, {gap:8}, [\n      h('h4', COPY.emailOrUsernameInput),\n      h(Input, {\n        type: 'text',\n        value: formData.emailOrUsername,\n        required: true,\n        onChange: (e) => setFormData({ ...formData, emailOrUsername: e.currentTarget.value })\n      }),\n    ]),\n\n    h(LabelBox, {gap:8}, [\n      h('h4', COPY.passwordInput),\n      h(Input, {\n        type: 'password',\n        value: formData.password,\n        required: true,\n        onChange: (e) => setFormData({ ...formData, password: e.currentTarget.value })\n      }),\n      h(Link, { href: '/login?reset'}, h('a', {style:{justifySelf:\"right\"}}, COPY.resetPassword))\n    ]),\n    h(Primary, { type: 'submit',status, style:{justifySelf: \"right\"}}, COPY.loginButton),\n  ])\n}\n\nconst RESETCOPY = {\n  header: \"Reset Password\",\n  emailInput: \"Your account email\",\n  button: \"Reset Password\",\n  successHeader: \"Check your Email\"\n}\n\nconst ResetPassword = () => {\n  let [email, setEmail] = useState('')\n  let [status, callResetPassword, setStatus] = useApi<RequestMsg, RequestResult>([email])\n  const onSubmit = async (e:React.FormEvent) => {\n    e.preventDefault()\n    await callResetPassword('/api/user/resetPassword/request', { email })\n  }\n\n  switch (status) {\n    case 'normal':\n    case 'loading':\n      return h(FormBox, {onSubmit, width: 400, ma:true}, [\n        h('h1', RESETCOPY.header),\n        h(LabelBox, {gap:16}, [\n          h('h4', RESETCOPY.emailInput),\n          h(Input, {\n            type: 'email',\n            required: true,\n            value: email,\n            onChange: e => setEmail(e.currentTarget.value)\n          }),\n        ]),\n        h('div', { style: { display: 'grid', justifyItems: 'end', gridGap: '8px' } }, [\n          h(Primary, { type: 'submit', status}, RESETCOPY.button)\n        ])\n      ])\n    case 'success': return h(Box, { gap: 16, width: 400, ma: true }, [\n      h(AccentImg, {src: '/img/plane.gif', alt: \"an animated gif of a paper airplane taking off\"}),\n      h('h1', RESETCOPY.successHeader),\n      'We sent an email with a password reset link to',\n      h(Info, email),\n      'It expires in 30 minutes.',\n      h('br'),\n      h(Primary, {\n        style: { width: '100%' },\n        onClick: () => setStatus('normal')\n      }, 'Send another link')\n    ])\n    case 'error': return h(Box, {width: 400, ma: true}, [h(Error, 'something went wrong, please refresh and try again')])\n  }\n}\nexport const LoginHeader = styled('div') `\n  display:grid;\n  grid-gap:16px;\n  grid-template-columns: auto min-content;\n  align-items: end;\n`\nexport default Login\n","\n      (window.__NEXT_P = window.__NEXT_P || []).push([\n        \"/login\",\n        function () {\n          return require(\"private-next-pages/login.ts\");\n        }\n      ]);\n    "],"sourceRoot":""}