{"version":3,"sources":["webpack://_N_E/./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?8e88","webpack://_N_E/./pages/discount.ts"],"names":["window","__NEXT_P","push","DiscountPage","props","router","useRouter","fullyRedeemed","discount","max_redeems","redeems","useEffect","a","discounts","getDiscounts","setDiscounts","filter","d","course","date_added","Date","toISOString","courses","type","slug","id","course_cohorts","h","Head","children","key","property","content","name","description","card_image","split","Box","style","textAlign","Link","href","PageLoader"],"mappings":"+FACOA,OAAOC,SAAWD,OAAOC,UAAY,IAAIC,KAAK,CAC7C,YACA,WACE,OAAO,EAAQ,Y,k1BCQzB,I,KAwCeC,UAxCM,SAACC,GACpB,IAAIC,EAAQC,sBACRC,IAAiBH,EAAMI,WAAkD,IAA/BJ,EAAMI,SAASC,aAAqBL,EAAMI,SAASC,aAAeL,EAAMI,SAASE,SAkB/H,OAjBAC,qBAAU,WACR,sBAAC,4BAAAC,EAAA,yDACKR,EAAMI,WAAYD,EADvB,iDAEKM,EAAYC,cAChBC,YAAa,GAAD,mBAAKF,EAAUG,QAAO,SAAAC,GAAC,OAAGA,EAAEC,SAAWd,EAAMI,SAASU,WAAtD,QACPd,EAAMI,UADC,IAEVW,YAAY,IAAIC,MAAOC,mBAEQ,SAA9BjB,EAAMI,SAASc,QAAQC,KACxBlB,EAAOH,KAAP,mBAAwBE,EAAMI,SAASc,QAAQE,KAA/C,YAAuDpB,EAAMI,SAASc,QAAQG,GAA9E,oBAA4FrB,EAAMI,SAASc,QAAQI,eAAe,GAAGD,KAGrIpB,EAAOH,KAAK,uBAAZ,mBAAgDE,EAAMI,SAASc,QAAQE,KAAvE,YAA+EpB,EAAMI,SAASc,QAAQG,KAXzG,0CAAD,KAcC,CAACrB,EAAMI,WAENJ,EAAMI,SAMFmB,IAAE,MAAO,CACfA,IAAEC,IAAM,CAACC,SAAU,CACjBF,IAAE,OAAQ,CAACG,IAAI,YAAaC,SAAS,WAAYC,QAAQ5B,EAAMI,SAASc,QAAQW,OAChFN,IAAE,OAAQ,CAACG,IAAK,iBAAkBC,SAAU,iBAAkBC,QAAS5B,EAAMI,SAASc,QAAQY,cAC9FP,IAAE,OAAQ,CAACG,IAAK,WAAWC,SAAU,WAAYC,QAAS5B,EAAMI,SAASc,QAAQa,WAAWC,MAAM,KAAK,KACvGT,IAAE,OAAQ,CAACG,IAAI,eAAgBC,SAAU,eAAgBC,QAAS,eAEpEzB,EAAgBoB,IAAEU,IAAK,CAACC,MAAO,CAACC,UAAW,WAAY,CACrDZ,IAAE,KAAM,SACRA,IAAE,QAAS,6CACXA,IAAEa,IAAM,CAACC,KAAM,KAAMd,IAAE,IAAK,8BACzBA,IAAEe,OAjBkBf,IAAEU,IAAK,CAACC,MAAO,CAACC,UAAU,WAAW,CAC9DZ,IAAE,KAAM,UACRA,IAAE,QAAS,iCACXA,IAAEa,IAAM,CAACC,KAAM,KAAMd,IAAE,IAAK,iC","file":"static/chunks/pages/discount-e2398d463ba11b4650a3.js","sourcesContent":["\n      (window.__NEXT_P = window.__NEXT_P || []).push([\n        \"/discount\",\n        function () {\n          return require(\"private-next-pages/discount.ts\");\n        }\n      ]);\n    ","import h from 'react-hyperscript'\nimport { useRouter } from \"next/router\"\nimport { useEffect } from 'react'\nimport {getDiscounts, setDiscounts} from 'src/clientData'\nimport { Box } from 'components/Layout'\nimport Link from 'next/link'\nimport Head from 'next/head'\nimport { InferGetServerSidePropsType } from 'next'\nimport { PageLoader } from 'components/Loader'\nimport { getDiscountQuery } from './api/discounts/[code]'\n\ntype Props = InferGetServerSidePropsType<typeof getServerSideProps>\nconst DiscountPage = (props:Props)=>{\n  let router= useRouter()\n  let fullyRedeemed = !props.discount ? false : props.discount.max_redeems !== 0 && props.discount.max_redeems <= props.discount.redeems\n  useEffect(()=>{\n    (async function(){\n      if(!props.discount || fullyRedeemed) return\n      let discounts = getDiscounts()\n      setDiscounts([...discounts.filter(d=> d.course !== props.discount.course), {\n        ...props.discount,\n        date_added: new Date().toISOString(),\n      }])\n      if(props.discount.courses.type==='club') {\n        router.push(`/courses/${props.discount.courses.slug}/${props.discount.courses.id}/cohorts/${props.discount.courses.course_cohorts[0].id}`)\n      }\n      else {\n        router.push('/courses/[slug]/[id]', `/courses/${props.discount.courses.slug}/${props.discount.courses.id}`)\n      }\n    })()\n  }, [props.discount])\n\n  if(!props.discount) return h(Box, {style: {textAlign:\"center\"}},[\n    h('h2', \"Sorry \"),\n    h('p.big', 'That discount code is invalid'),\n    h(Link, {href: '/'}, h('a', \"take me to the homepage\"))\n  ])\n\n  return  h('div', [\n    h(Head, {children: [\n      h('meta', {key:\"og:titile\", property:\"og:title\", content:props.discount.courses.name}),\n      h('meta', {key: \"og:description\", property: \"og:description\", content: props.discount.courses.description}),\n      h('meta', {key: \"og:image\",property: \"og:image\", content: props.discount.courses.card_image.split(',')[0]}),\n      h('meta', {key:\"twitter:card\", property: \"twitter:card\", content: \"summary\"})\n    ]}),\n    fullyRedeemed ? h(Box, {style: {textAlign: \"center\"}}, [\n      h('h2', \"Sorry\"),\n      h('p.big', 'That discount code has been fully used up'),\n      h(Link, {href: '/'}, h('a', \"take me to the homepage\"))\n    ]) : h(PageLoader),\n  ])\n}\nexport default DiscountPage\n\nexport const getServerSideProps = async (ctx:any) => {\n  let code = ctx.query.discount\n  let discount = await getDiscountQuery(code)\n  if(!discount || discount.deleted) return {props:{discount: undefined}} as const\n  return {props:{discount}} as const\n}\n"],"sourceRoot":""}