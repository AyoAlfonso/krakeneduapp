{"version":3,"sources":["webpack://_N_E/./node_modules/react-hyperscript/parse-tag.js","webpack://_N_E/./node_modules/next/router.js","webpack://_N_E/./pages/sso.ts","webpack://_N_E/./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?10d4","webpack://_N_E/./node_modules/react-hyperscript/index.js"],"names":["classIdSplit","notClassId","module","exports","tag","props","classes","part","type","i","noId","tagParts","split","tagName","test","length","charAt","push","substring","id","className","join","toLowerCase","SSO","error","useRouter","query","sso","sig","h","window","__NEXT_P","React","parseTag","isChildren","x","Array","isArray","componentOrTag","properties","children","arguments","Fragment","Object","assign","dataset","keys","forEach","attrName","dashedAttr","replace","match","undefined","attributes","args","concat","createElement","apply"],"mappings":"2GAGA,IAAIA,EAAe,0BACfC,EAAa,QAEjBC,EAAOC,QAEP,SAAkBC,EAAKC,GACrB,IAAKD,EACH,MAAO,MAGT,IASIE,EACAC,EACAC,EACAC,EAZAC,IAAS,OAAQL,GAEjBM,EAAWP,EAAIQ,MAAMZ,GACrBa,EAAU,KAEVZ,EAAWa,KAAKH,EAAS,MAC3BE,EAAU,OAOZ,IAAKJ,EAAI,EAAGA,EAAIE,EAASI,OAAQN,KAC/BF,EAAOI,EAASF,MAMhBD,EAAOD,EAAKS,OAAO,GAEdH,EAEe,MAATL,GACTF,EAAUA,GAAW,IACbW,KAAKV,EAAKW,UAAU,EAAGX,EAAKQ,SAClB,MAATP,GAAgBE,IACzBL,EAAMc,GAAKZ,EAAKW,UAAU,EAAGX,EAAKQ,SALlCF,EAAUN,GASVD,IACED,EAAMe,WACRd,EAAQW,KAAKZ,EAAMe,WAGrBf,EAAMe,UAAYd,EAAQe,KAAK,MAGjC,OAAOR,EAAUA,EAAQS,cAAgB,Q,uBCrD3CpB,EAAOC,QAAU,EAAQ,S,kCCAzB,oF,KAsBeoB,UAXH,SAAC,GAAkB,IAAjBC,EAAiB,EAAjBA,MAAiB,EAChBC,sBACWC,MAAnBC,EAFwB,EAExBA,IAAKC,EAFmB,EAEnBA,IAEV,OAAID,GAAQC,EAETJ,EAAcK,IAAE,IAAK,0DAEjBA,IAAE,KAAM,iCAJSA,IAAE,MAAO,6B,wBCd5BC,OAAOC,SAAWD,OAAOC,UAAY,IAAId,KAAK,CAC7C,OACA,WACE,OAAO,EAAQ,Y,oCCHzB,IAAIe,EAAQ,EAAQ,QAEhBC,EAAW,EAAQ,QAmDvB,SAASC,EAAWC,GAClB,MAAoB,kBAANA,GAA+B,kBAANA,GAAkBC,MAAMC,QAAQF,GAlDzEjC,EAAOC,QAEP,SAAS0B,EAAES,EAAgBC,EAAYC,GAErC,GAAyB,IAArBC,UAAU1B,QAAgBqB,MAAMC,QAAQC,GACxC,OAAOT,EAAEG,EAAMU,SAAU,KAAMJ,IACvBE,GAAYN,EAAWK,IAEjCC,EAAWD,EACXA,EAAa,IACiB,IAArBE,UAAU1B,SAGnByB,EAAW,KAGbD,EAAaA,EAAaI,OAAOC,OAAO,GAAIL,GAAc,IAG3CM,UACbF,OAAOG,KAAKP,EAAWM,SAASE,SAAQ,SAAgBC,GACtD,IAAIC,EAAaD,EAASE,QAAQ,kBAAkB,SAAcC,GAChE,OAAOA,EAAM,GAAK,IAAMA,EAAM,GAAG7B,iBAEnCiB,EAAW,QAAUU,GAAcV,EAAWM,QAAQG,MAGxDT,EAAWM,aAAUO,GAInBb,EAAWc,aACbV,OAAOG,KAAKP,EAAWc,YAAYN,SAAQ,SAAgBC,GACzDT,EAAWS,GAAYT,EAAWc,WAAWL,MAG/CT,EAAWc,gBAAaD,GAII,kBAAnBd,IACTA,EAAiBL,EAASK,EAAgBC,IAI5C,IAAIe,EAAO,CAAChB,EAAgBC,GAAYgB,OAAOf,GAC/C,OAAOR,EAAMwB,cAAcC,MAAMzB,EAAOsB,M","file":"static/chunks/pages/sso-e36069b5597af0148b42.js","sourcesContent":["/* eslint-disable complexity, max-statements */\n'use strict';\n\nvar classIdSplit = /([\\.#]?[a-zA-Z0-9_:-]+)/;\nvar notClassId = /^\\.|#/;\n\nmodule.exports = parseTag;\n\nfunction parseTag(tag, props) {\n  if (!tag) {\n    return 'div';\n  }\n\n  var noId = !('id' in props);\n\n  var tagParts = tag.split(classIdSplit);\n  var tagName = null;\n\n  if (notClassId.test(tagParts[1])) {\n    tagName = 'div';\n  }\n\n  var classes;\n  var part;\n  var type;\n  var i;\n  for (i = 0; i < tagParts.length; i++) {\n    part = tagParts[i];\n\n    if (!part) {\n      continue;\n    }\n\n    type = part.charAt(0);\n\n    if (!tagName) {\n      tagName = part;\n    } else if (type === '.') {\n      classes = classes || [];\n      classes.push(part.substring(1, part.length));\n    } else if (type === '#' && noId) {\n      props.id = part.substring(1, part.length);\n    }\n  }\n\n  if (classes) {\n    if (props.className) {\n      classes.push(props.className);\n    }\n\n    props.className = classes.join(' ');\n  }\n\n  return tagName ? tagName.toLowerCase() : 'div';\n}\n","module.exports = require('./dist/client/router')\n","import h from 'react-hyperscript'\nimport querystring from 'querystring'\nimport crypto from 'crypto'\nimport {useRouter} from 'next/router'\nimport { GetServerSideProps } from 'next'\n\nimport {getToken} from 'src/token'\nimport {  makeSSOPayload } from 'src/discourse'\nimport {DISCOURSE_URL} from 'src/constants'\n\ntype Props = {error:boolean}\nconst SSO = ({error}:Props) => {\n  let router = useRouter()\n  let {sso, sig} = router.query\n\n  if(!sso || !sig) return h('div', 'Invalid SSO parameters!')\n\n  if(error) return h('p', 'An error occured, please check with the reffering site')\n\n  return h('h1', 'Logging you onto discourse...')\n}\n\nexport default SSO\n\nexport const getServerSideProps:GetServerSideProps = async ({req,res, query}) => {\n  let token = getToken(req)\n  if(!token) {\n    res.writeHead(301, {Location: '/login?redirect='+encodeURIComponent(req.url as string)})\n    res.end()\n    return {props:{}}\n  }\n  let {sso, sig} = query\n  if(typeof sso !== 'string') return {props: {error: true}}\n\n  const hmac1 = crypto.createHmac('sha256', process.env.DISCOURSE_SECRET || '');\n  hmac1.update(Buffer.from(sso))\n\n  let verifySig = hmac1.digest('hex')\n  if(verifySig !== sig) return  {props: {error: true}}\n\n  let {nonce} = querystring.parse(Buffer.from(sso as string, 'base64').toString())\n\n  res.writeHead(301, {\n    Location: `${DISCOURSE_URL}/session/sso_login?`\n      + makeSSOPayload({\n        nonce:nonce as string ,\n        email:token.email,\n        external_id: token.id\n      })\n  })\n  res.end()\n  return {props:{}}\n\n}\n","\n      (window.__NEXT_P = window.__NEXT_P || []).push([\n        \"/sso\",\n        function () {\n          return require(\"private-next-pages/sso.ts\");\n        }\n      ]);\n    ","'use strict';\nvar React = require('react');\n\nvar parseTag = require('./parse-tag');\n\nmodule.exports = h;\n\nfunction h(componentOrTag, properties, children) {\n  // if only one argument which is an array, wrap items with React.Fragment\n  if (arguments.length === 1 && Array.isArray(componentOrTag)) {\n      return h(React.Fragment, null, componentOrTag);\n  } else if (!children && isChildren(properties)) {\n    // If a child array or text node are passed as the second argument, shift them\n    children = properties;\n    properties = {};\n  } else if (arguments.length === 2) {\n    // If no children were passed, we don't want to pass \"undefined\"\n    // and potentially overwrite the `children` prop\n    children = [];\n  }\n\n  properties = properties ? Object.assign({}, properties) : {};\n\n  // Supported nested dataset attributes\n  if (properties.dataset) {\n    Object.keys(properties.dataset).forEach(function unnest(attrName) {\n      var dashedAttr = attrName.replace(/([a-z])([A-Z])/, function dash(match) {\n        return match[0] + '-' + match[1].toLowerCase();\n      });\n      properties['data-' + dashedAttr] = properties.dataset[attrName];\n    });\n\n    properties.dataset = undefined;\n  }\n\n  // Support nested attributes\n  if (properties.attributes) {\n    Object.keys(properties.attributes).forEach(function unnest(attrName) {\n      properties[attrName] = properties.attributes[attrName];\n    });\n\n    properties.attributes = undefined;\n  }\n\n  // When a selector, parse the tag name and fill out the properties object\n  if (typeof componentOrTag === 'string') {\n    componentOrTag = parseTag(componentOrTag, properties);\n  }\n\n  // Create the element\n  var args = [componentOrTag, properties].concat(children);\n  return React.createElement.apply(React, args);\n}\n\nfunction isChildren(x) {\n  return typeof x === 'string' || typeof x === 'number' || Array.isArray(x);\n}\n"],"sourceRoot":""}