{"version":3,"sources":["webpack://_N_E/./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?bdb1","webpack://_N_E/./components/Images.ts","webpack://_N_E/./pages/signup.ts"],"names":["window","__NEXT_P","push","AccentImg","props","height","width","HalfLoopImg","useState","looping","setLooping","imageRef","useRef","useEffect","current","complete","setTimeout","startLoop","h","src","src2","alt","ref","onLoad","src1","COPY","VerifyEmail","router","useRouter","key","setKey","useApi","status","callSignupVerify","onSubmit","e","a","preventDefault","query","verifyEmail","Box","ma","gap","Link","href","Primary","FormBox","email","Info","Input","spellCheck","type","value","onChange","currentTarget","trim","Error","style","justifySelf","SignUpHeader","Signup","username","password","newsletter","formData","setFormData","callSignupRequest","usernameValid","setUsernameValid","user","useUserData","data","useDebouncedEffect","usernameValidate","callApi","undefined","resendEmail","LabelBox","name","required","minLength","maxLength","setCustomValidity","length","PasswordInput","CheckBox","checked"],"mappings":"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","file":"static/chunks/pages/signup-cbf2f03f6dc86a960e23.js","sourcesContent":["\n      (window.__NEXT_P = window.__NEXT_P || []).push([\n        \"/signup\",\n        function () {\n          return require(\"private-next-pages/signup.ts\");\n        }\n      ]);\n    ","import styled from '@emotion/styled'\nimport { useState, useEffect, useRef } from 'react'\nimport h from 'react-hyperscript'\n\nexport let TitleImg = styled('img')<{height?: number, width: number}>`\nimage-rendering: pixelated;\nimage-rendering: crisp-edges;\ndisplay: block;\nborder: 2px solid;\nheight: ${props=> props.height ? props.height +'px' : 'auto'};\nwidth: ${props=> props.width}px;\n`\n\nexport let AccentImg = styled('img')<{height?: number, width?: number}>`\nimage-rendering: pixelated;\nimage-rendering: -moz-crisp-edges;\nimage-rendering: crisp-edges;\ndisplay: block;\nborder: none;\nheight: ${props=> props.height ? props.height +'px' : '100px'};\nwidth: ${props=> props.width ? props.width +'px' : '100px'};\n`\n\nexport function HalfLoopImg(props:\n    {\n        src1:string,\n        src2:string,\n        alt:string,\n        startLoop:number,\n    }) {\n    let [looping, setLooping] = useState(false)\n    let imageRef = useRef<HTMLImageElement>(null)\n    useEffect(()=> {\n      if(imageRef.current?.complete && !looping) {\n        setTimeout(()=>setLooping(true), props.startLoop)\n      }\n    }, [])\n  \n    if(!looping) {\n      return h(AccentImg, {ref: imageRef, onLoad: () => {\n        setTimeout(()=>setLooping(true), props.startLoop)\n      }, src: props.src1, alt: props.alt })\n    }\n    return h(AccentImg, {src: props.src2, alt: props.alt })\n  }","import h from 'react-hyperscript'\nimport { useState, useEffect } from 'react'\nimport {useRouter} from 'next/router'\nimport Link from 'next/link'\n\nimport { Box, LabelBox, FormBox} from 'components/Layout'\nimport { Input, Error, Info, CheckBox, PasswordInput} from 'components/Form'\nimport { Primary } from 'components/Button'\nimport {AccentImg, HalfLoopImg} from 'components/Images'\nimport { useUserData } from 'src/data'\nimport { callApi, useApi } from 'src/apiHelpers'\nimport { useDebouncedEffect} from 'src/hooks'\nimport { VerifyEmailMsg, SignupMsg, VerifyEmailResponse, SignupResponse} from 'pages/api/signup/[action]'\nimport { CheckUsernameResult } from 'pages/api/get/[...item]'\nimport styled from '@emotion/styled'\nimport { usernameValidate } from 'src/utils'\n\nconst COPY = {\n  submitButton: \"Create your account\",\n  headerDescription:\n    \"We're hyped for you to join the KrakenEdu community! Let's learn together.\",\n};\n\nconst Signup = () => {\n  let [formData, setFormData] = useState({\n    email:'',\n    username: '',\n    password:'',\n    newsletter: false,\n  })\n\n  let [status, callSignupRequest] = useApi<SignupMsg, SignupResponse>([formData], ()=> router.push('/signup?verifyEmail'))\n  let [usernameValid, setUsernameValid] = useState<null | boolean>(null)\n  let {data:user} = useUserData()\n  let router = useRouter()\n\n  useEffect(()=>{if(user) router.push('/dashboard')}, [user])\n  useDebouncedEffect(async ()=>{\n    if(!formData.username) return setUsernameValid(null)\n    if(!usernameValidate(formData.username)) return setUsernameValid(null)\n    let res = await callApi<null, CheckUsernameResult>('/api/get/username/'+formData.username)\n    if(res.status===404) setUsernameValid(true)\n    else setUsernameValid(false)\n  }, 500, [formData.username])\n\n  const onSubmit = async (e:React.FormEvent) => {\n    e.preventDefault()\n    await callSignupRequest('/api/signup/request', formData)\n  }\n\n  if(router.query.verifyEmail !== undefined) {\n    return h(VerifyEmail, {email: formData.email, resendEmail: onSubmit})\n  }\n\n  return h(FormBox, {onSubmit, width: 400, ma: true, gap: 32}, [\n    h(Box, {gap:8}, [\n      h(SignUpHeader, [\n        h('h1', 'Sign Up'),\n        h(HalfLoopImg, {\n          src1: '/img/sailboat-1.gif',\n          src2: '/img/sailboat-2.gif',\n          alt: \"an animated gif of a sailboat, boatin'\",\n          startLoop: 333,\n        }),\n      ]),\n      h('p.big', COPY.headerDescription),\n      h('p.textSecondary', ['Or ', h(Link, {href:\"/login\"}, h('a', 'log in')), ' with an existing account.'])\n    ]),\n    status === 'error' ? h(Error, {}, h('div', [\n      \"A user already exists with that email. Try \", h(Link,{href:'/login'}, h('a', 'logging in')),\n      '.'\n    ])) : null,\n    h(LabelBox, {gap:8},[\n      h('div', [\n        h('h4', \"Username\"),\n        h('small.textSecondary', \"Pick a unique username between 3-15 characters.\"),\n      ]),\n      h(Input, {\n        type: 'text',\n        name: \"username\",\n        required: true,\n        minLength: 3,\n        maxLength: 15,\n        value: formData.username,\n        onChange: (e)=> {\n          setFormData({...formData, username:e.currentTarget.value})\n          if(!usernameValidate(e.currentTarget.value || '')){\n            e.currentTarget.setCustomValidity('Your username must contain only letters, numbers, underscores, periods or dashes')\n          }\n          else {\n            e.currentTarget.setCustomValidity('')\n          }\n        }}),\n      formData.username.length < 3 ? null :\n        !usernameValidate(formData.username) ? h('span.accentRed', 'Your username must contain only letters, numbers, underscores, periods or dashes') :\n        usernameValid === null\n        ? ''\n        : usernameValid ? h('span.accentSuccess', 'Great! This username is available.') : h('span.accentRed', \"Sorry, that username is taken.\")\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('div', [\n        h('h4', \"Your Email\"),\n        h('small.textSecondary', \"You'll have to verify this in a moment.\"),\n      ]),\n      h(Input, {type: 'email',\n                name: 'email',\n                required: true,\n                value: formData.email,\n                onChange: (e)=> setFormData({...formData, email:e.currentTarget.value})})\n    ]),\n    h(LabelBox, {gap:8}, [\n      h(\"div\", [\n        h('h4', \"Password\"),\n        h('small.textSecondary', \"Minimum length 8 characters\"),\n      ]),\n      h(PasswordInput, {\n                name: \"new-password\",\n                required: true,\n                minLength: 8,\n                value: formData.password,\n                onChange: (e)=> setFormData({...formData, password:e.currentTarget.value})})\n    ]),\n    h(LabelBox, {gap:8}, [\n      h('div', [\n        h('h4', \"Get email updates?\"),\n        h('small.textSecondary', \"We send out occasional updates on new courses and features. We'll never spam or share your email.\"),\n      ]),\n      h(CheckBox, [\n        h(Input, {type: 'checkbox', name: 'newsletter', checked: formData.newsletter, onChange: e=> {\n          setFormData({...formData, newsletter: e.currentTarget.checked})\n        }}),\n        \"Sure! Gimme the updates.\"\n      ]),\n    ]),\n    h(Primary, {status, style: {justifySelf: 'end'}, type: 'submit'}, COPY.submitButton),\n  ])\n}\n\nconst VerifyEmail = (props: {email?:string, resendEmail: any}) =>  {\n  let router = useRouter()\n  let [key, setKey] = useState('')\n  let [status, callSignupVerify] = useApi<VerifyEmailMsg, VerifyEmailResponse>([key], ()=>{\n    setTimeout(()=>{\n      router.push('/dashboard')\n    }, 3000)\n  })\n\n  const onSubmit = async (e: React.FormEvent)=>{\n    e.preventDefault()\n    await callSignupVerify('/api/signup/verify', {key})\n  }\n\n  useEffect(()=>{\n    if(router.query.verifyEmail && typeof router.query.verifyEmail === 'string') {\n      callSignupVerify('/api/signup/verify', {key:router.query.verifyEmail})\n    }\n  }, [])\n\n  if(router.query.verifyEmail && status === null) return null\n\n  if(status === 'success') return h(Box, { width: 400, ma: true, gap: 16 }, [\n    h(\"h1\", \"All Done!\"),\n    h(\n      \"p.big\",\n      \"Click the button below if you're not redirected in a couple seconds\"\n    ),\n    h(\n      Link,\n      { href: \"/dashboard\" },\n      h(\"a\", {}, h(Primary, \"Back to Krakenedu\"))\n    ),\n  ]);\n\n  return h(FormBox, {onSubmit, width: 400, ma: true, gap: 32}, [\n    h(AccentImg, {src: '/img/plane.gif', alt: \"an animated gif of a paper airplane taking off\" }),\n    h('h1', 'Verify your email'),\n    props.email ? h(Box, {gap: 8}, [\n      `Sweet! We sent an email with a verification code to`,\n      h(Info, {}, h('b', props.email)),\n    ]) : null,\n    h(Box, {gap: 8}, [\n      h('h4', `Copy the code there and submit it here:`),\n      h(Input, {\n        spellCheck: false,\n        type: 'text',\n        value: key,\n        onChange: e=>setKey(e.currentTarget.value.trim())\n      })\n    ]),\n    status === 'error' ? h(Error, {}, [\n      'Your email link is invalid or out of date, please try ',\n      h(Link, {href:'/signup'}, h('a', 'signing up again' )), '.'\n    ]) : null,\n    h(Primary, {type: 'submit', status, style:{justifySelf: 'right'}}, \"Confirm your email\")\n  ])\n}\n\nexport const SignUpHeader = styled('div') `\n  display:grid;\n  grid-gap:16px;\n  grid-template-columns:  auto min-content;\n  align-items: end;\n`\n\nexport default Signup\n"],"sourceRoot":""}